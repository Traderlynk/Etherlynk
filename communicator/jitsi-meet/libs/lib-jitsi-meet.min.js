/*! For license information please see lib-jitsi-meet.min.js.LICENSE */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JitsiMeetJS=t():e.JitsiMeetJS=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=59)}([function(e,t,n){var r=n(37),i=n(65),o={},a=[],s=r.levels.TRACE;e.exports={addGlobalTransport:function(e){r.addGlobalTransport(e)},removeGlobalTransport:function(e){r.removeGlobalTransport(e)},getLogger:function(e,t,n){var i=new r(s,e,t,n);return e?(o[e]=o[e]||[],o[e].push(i)):a.push(i),i},setLogLevelById:function(e,t){for(var n=t?o[t]||[]:a,r=0;r<n.length;r++)n[r].setLevel(e)},setLogLevel:function(e){s=e;for(var t=0;t<a.length;t++)a[t].setLevel(e);for(var n in o){var r=o[n]||[];for(t=0;t<r.length;t++)r[t].setLevel(e)}},levels:r.levels,LogCollector:i}},function(e,t,n){"use strict";(function(e){function r(){if(navigator.webkitGetUserMedia){f=v.RTC_BROWSER_CHROME;var e=navigator.userAgent.match(/chrome\/(\d+)\./i),t=e?parseInt(e[1],10):"undefined";return m.log("This appears to be Chrome, ver: "+t),t}return null}function i(){var e=navigator.userAgent;if(e.match(/Opera|OPR/)){f=v.RTC_BROWSER_OPERA;var t=e.match(/(Opera|OPR) ?\/?(\d+)\.?/)[2];return m.info("This appears to be Opera, ver: "+t),t}return null}function o(){if(navigator.mozGetUserMedia){f=v.RTC_BROWSER_FIREFOX;var e=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10);return m.log("This appears to be Firefox, ver: "+e),e}return null}function a(){return/^((?!chrome).)*safari/i.test(navigator.userAgent)?(f=v.RTC_BROWSER_SAFARI,m.info("This appears to be Safari"),1):null}function s(){var e=void 0,t=window.navigator.userAgent,n=t.indexOf("MSIE ");n>0&&(e=parseInt(t.substring(n+5,t.indexOf(".",n)),10));var r=t.indexOf("Trident/");if(!e&&r>0){var i=t.indexOf("rv:");e=parseInt(t.substring(i+3,t.indexOf(".",i)),10)}return e&&(f=v.RTC_BROWSER_IEXPLORER,m.info("This appears to be IExplorer, ver: "+e)),e}function c(){var e=void 0,t=window.navigator.userAgent,n=t.indexOf("Edge/");return!e&&n>0&&(e=parseInt(t.substring(n+5,t.indexOf(".",n)),10)),e&&(f=v.RTC_BROWSER_EDGE,m.info("This appears to be Edge, ver: "+e)),e}function u(){var e=navigator.userAgent;if(e.match(/Electron/)){f=v.RTC_BROWSER_ELECTRON;var t=e.match(/Electron\/([\d.]+)/)[1];return m.info("This appears to be Electron, ver: "+t),t}return null}function l(){var e=navigator.userAgent;if(e.match(/JitsiMeetNW/)){f=v.RTC_BROWSER_NWJS;var t=e.match(/JitsiMeetNW\/([\d.]+)/)[1];return m.info("This appears to be JitsiMeetNW, ver: "+t),t}return null}function d(){var e=navigator.userAgent.match(/\b(react[ \t_-]*native)(?:\/(\S+))?/i),t=void 0;if(e||"ReactNative"===navigator.product){f=v.RTC_BROWSER_REACT_NATIVE;var n=void 0;e&&e.length>2&&(n=e[1],t=e[2]),n||(n="react-native"),t||(t="unknown"),console.info("This appears to be "+n+", ver: "+t)}else t=null;return t}var p=n(0),h=void n.n(p),f=void 0,m=Object(p.getLogger)(e),v={RTC_BROWSER_CHROME:"rtc_browser.chrome",RTC_BROWSER_OPERA:"rtc_browser.opera",RTC_BROWSER_FIREFOX:"rtc_browser.firefox",RTC_BROWSER_IEXPLORER:"rtc_browser.iexplorer",RTC_BROWSER_EDGE:"rtc_browser.edge",RTC_BROWSER_SAFARI:"rtc_browser.safari",RTC_BROWSER_NWJS:"rtc_browser.nwjs",RTC_BROWSER_ELECTRON:"rtc_browser.electron",RTC_BROWSER_REACT_NATIVE:"rtc_browser.react-native",doesVideoMuteByStreamRemove:function(){return!(v.isFirefox()||v.isEdge())},getBrowserType:function(){return f},getBrowserName:function(){return-1!==navigator.userAgent.indexOf("Android")?"android":f.split("rtc_browser.")[1]},isChrome:function(){return f===v.RTC_BROWSER_CHROME},isOpera:function(){return f===v.RTC_BROWSER_OPERA},isFirefox:function(){return f===v.RTC_BROWSER_FIREFOX},isIExplorer:function(){return f===v.RTC_BROWSER_IEXPLORER},isEdge:function(){return f===v.RTC_BROWSER_EDGE},isSafari:function(){return f===v.RTC_BROWSER_SAFARI},isNWJS:function(){return f===v.RTC_BROWSER_NWJS},isElectron:function(){return f===v.RTC_BROWSER_ELECTRON},isP2PSupported:function(){return!v.isEdge()},isReactNative:function(){return f===v.RTC_BROWSER_REACT_NATIVE},isTemasysPluginUsed:function(){return v.isSafari()||v.isIExplorer()&&v.getIExplorerVersion()<12},usesNewGumFlow:function(){return v.isChrome()&&v.getChromeVersion()>=61||v.isFirefox()},isVideoMuteOnConnInterruptedSupported:function(){return v.isChrome()||v.isElectron()},getFirefoxVersion:function(){return v.isFirefox()?h:null},getChromeVersion:function(){return v.isChrome()?h:null},getOperaVersion:function(){return v.isOpera()?h:null},getIExplorerVersion:function(){return v.isIExplorer()?h:null},getEdgeVersion:function(){return v.isEdge()?h:null},usesPlanB:function(){return!v.usesUnifiedPlan()},usesUnifiedPlan:function(){return v.isFirefox()},supportsBandwidthStatistics:function(){return!v.isFirefox()&&!v.isEdge()},supportsDataChannels:function(){return!v.isEdge()},supportsRTTStatistics:function(){return!v.isFirefox()&&!v.isEdge()},supportsSimulcast:function(){return v.isChrome()||v.isFirefox()||v.isElectron()||v.isNWJS()},supportsRtx:function(){return!v.isFirefox()},supportsRtpSender:function(){return v.isFirefox()}};h=function(){for(var e=void 0,t=[d,u,l,i,r,o,c,s,a],n=0;n<t.length;n++)if(e=t[n]())return e;return m.warn("Browser type defaults to Safari ver 1"),f=v.RTC_BROWSER_SAFARI,1}(),t.a=v}).call(t,"modules/RTC/RTCBrowserType.js")},function(e,t,n){var r,i,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n,a){i=[],r=a,void 0!==(o="function"==typeof r?r.apply(t,i):r)&&(e.exports=o)}(0,function(){var e,t,n;return function(r){function i(e,t){return T.call(e,t)}function o(e,t){var n,r,i,o,a,s,c,u,l,d,p,h,f=t&&t.split("/"),m=_.map,v=m&&m["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,_.nodeIdCompat&&E.test(e[a])&&(e[a]=e[a].replace(E,"")),"."===e[0].charAt(0)&&f&&(h=f.slice(0,f.length-1),e=h.concat(e)),l=0;l<e.length;l++)if("."===(p=e[l]))e.splice(l,1),l-=1;else if(".."===p){if(0===l||1===l&&".."===e[2]||".."===e[l-1])continue;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}if((f||v)&&m){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),f)for(d=f.length;d>0;d-=1)if((i=m[f.slice(0,d).join("/")])&&(i=i[r])){o=i,s=l;break}if(o)break;!c&&v&&v[r]&&(c=v[r],u=l)}!o&&c&&(o=c,s=u),o&&(n.splice(0,s,o),e=n.join("/"))}return e}function s(e,t){return function(){var n=C.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),m.apply(r,n.concat([e,t]))}}function c(e){return function(t){return o(t,e)}}function u(e){return function(t){y[e]=t}}function l(e){if(i(b,e)){var t=b[e];delete b[e],S[e]=!0,f.apply(r,t)}if(!i(y,e)&&!i(S,e))throw new Error("No "+e);return y[e]}function d(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function p(e){return e?d(e):[]}function h(e){return function(){return _&&_.config&&_.config[e]||{}}}var f,m,v,g,y={},b={},_={},S={},T=Object.prototype.hasOwnProperty,C=[].slice,E=/\.js$/;v=function(e,t){var n,r=d(e),i=r[0],a=t[1];return e=r[1],i&&(i=o(i,a),n=l(i)),i?e=n&&n.normalize?n.normalize(e,c(a)):o(e,a):(e=o(e,a),r=d(e),i=r[0],e=r[1],i&&(n=l(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},g={require:function(e){return s(e)},exports:function(e){var t=y[e];return void 0!==t?t:y[e]={}},module:function(e){return{id:e,uri:"",exports:y[e],config:h(e)}}},f=function(e,t,n,o){var c,d,h,f,m,_,T,C=[],E=void 0===n?"undefined":a(n);if(o=o||e,_=p(o),"undefined"===E||"function"===E){for(t=!t.length&&n.length?["require","exports","module"]:t,m=0;m<t.length;m+=1)if(f=v(t[m],_),"require"===(d=f.f))C[m]=g.require(e);else if("exports"===d)C[m]=g.exports(e),T=!0;else if("module"===d)c=C[m]=g.module(e);else if(i(y,d)||i(b,d)||i(S,d))C[m]=l(d);else{if(!f.p)throw new Error(e+" missing "+d);f.p.load(f.n,s(o,!0),u(d),{}),C[m]=y[d]}h=n?n.apply(y[e],C):void 0,e&&(c&&c.exports!==r&&c.exports!==y[e]?y[e]=c.exports:h===r&&T||(y[e]=h))}else e&&(y[e]=n)},e=t=m=function(e,t,n,i,o){if("string"==typeof e)return g[e]?g[e](t):l(v(e,p(t)).f);if(!e.splice){if(_=e,_.deps&&m(_.deps,_.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=i,i=o),i?f(r,e,t,n):setTimeout(function(){f(r,e,t,n)},4),m},m.config=function(e){return m(e)},e._defined=y,n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),i(y,e)||i(b,e)||(b[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("node_modules/almond/almond.js",function(){}),function(e,t){if("function"!=typeof n||!n.amd)return t(e);n("strophe-polyfill",[],function(){return t(e)})}(this,function(e){Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice,r=Array.prototype.concat,i=n.call(arguments,1);return function(){return t.apply(e||this,r.call(i,n.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){var t=this.length,n=Number(arguments[1])||0;for((n=n<0?Math.ceil(n):Math.floor(n))<0&&(n+=t);n<t;n++)if(n in this&&this[n]===e)return n;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,r;if(null===this)throw new TypeError(" this is null or not defined");var i=Object(this),o=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),r=0;r<o;){var a;r in i&&(a=i[r],e.call(n,a,r,i)),r++}});var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.btoa||(e.btoa=function(e){var n,r,i,o,a,s,c,u="",l=0;do{n=e.charCodeAt(l++),r=e.charCodeAt(l++),i=e.charCodeAt(l++),o=n>>2,a=(3&n)<<4|r>>4,s=(15&r)<<2|i>>6,c=63&i,isNaN(r)?(a=(3&n)<<4,s=c=64):isNaN(i)&&(c=64),u=u+t.charAt(o)+t.charAt(a)+t.charAt(s)+t.charAt(c)}while(l<e.length);return u}),e.atob||(e.atob=function(e){var n,r,i,o,a,s,c,u="",l=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{o=t.indexOf(e.charAt(l++)),a=t.indexOf(e.charAt(l++)),s=t.indexOf(e.charAt(l++)),c=t.indexOf(e.charAt(l++)),n=o<<2|a>>4,r=(15&a)<<4|s>>2,i=(3&s)<<6|c,u+=String.fromCharCode(n),64!==s&&(u+=String.fromCharCode(r)),64!==c&&(u+=String.fromCharCode(i))}while(l<e.length);return u})}),function(e,t){"function"==typeof n&&n.amd?n("strophe-sha1",[],function(){return t()}):e.SHA1=t()}(this,function(){function e(e,r){e[r>>5]|=128<<24-r%32,e[15+(r+64>>9<<4)]=r;var a,s,c,u,l,d,p,h,f=new Array(80),m=1732584193,v=-271733879,g=-1732584194,y=271733878,b=-1009589776;for(a=0;a<e.length;a+=16){for(u=m,l=v,d=g,p=y,h=b,s=0;s<80;s++)f[s]=s<16?e[a+s]:o(f[s-3]^f[s-8]^f[s-14]^f[s-16],1),c=i(i(o(m,5),t(s,v,g,y)),i(i(b,f[s]),n(s))),b=y,y=g,g=o(v,30),v=m,m=c;m=i(m,u),v=i(v,l),g=i(g,d),y=i(y,p),b=i(b,h)}return[m,v,g,y,b]}function t(e,t,n,r){return e<20?t&n|~t&r:e<40?t^n^r:e<60?t&n|t&r|n&r:t^n^r}function n(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function r(t,n){var r=a(t);r.length>16&&(r=e(r,8*t.length));for(var i=new Array(16),o=new Array(16),s=0;s<16;s++)i[s]=909522486^r[s],o[s]=1549556828^r[s];var c=e(i.concat(a(n)),512+8*n.length);return e(o.concat(c),672)}function i(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function o(e,t){return e<<t|e>>>32-t}function a(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function s(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function c(e){for(var t,n,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="",o=0;o<4*e.length;o+=3)for(t=(e[o>>2]>>8*(3-o%4)&255)<<16|(e[o+1>>2]>>8*(3-(o+1)%4)&255)<<8|e[o+2>>2]>>8*(3-(o+2)%4)&255,n=0;n<4;n++)8*o+6*n>32*e.length?i+="=":i+=r.charAt(t>>6*(3-n)&63);return i}return{b64_hmac_sha1:function(e,t){return c(r(e,t))},b64_sha1:function(t){return c(e(a(t),8*t.length))},binb2str:s,core_hmac_sha1:r,str_hmac_sha1:function(e,t){return s(r(e,t))},str_sha1:function(t){return s(e(a(t),8*t.length))}}}),function(e,t){"function"==typeof n&&n.amd?n("strophe-md5",[],function(){return t()}):e.MD5=t()}(this,function(){var e=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n},t=function(e,t){return e<<t|e>>>32-t},n=function(e){for(var t=[],n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return t},r=function(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>n%32&255);return t},i=function(e){for(var t="0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15);return n},o=function(n,r,i,o,a,s){return e(t(e(e(r,n),e(o,s)),a),i)},a=function(e,t,n,r,i,a,s){return o(t&n|~t&r,e,t,i,a,s)},s=function(e,t,n,r,i,a,s){return o(t&r|n&~r,e,t,i,a,s)},c=function(e,t,n,r,i,a,s){return o(t^n^r,e,t,i,a,s)},u=function(e,t,n,r,i,a,s){return o(n^(t|~r),e,t,i,a,s)},l=function(t,n){t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;for(var r,i,o,l,d=1732584193,p=-271733879,h=-1732584194,f=271733878,m=0;m<t.length;m+=16)r=d,i=p,o=h,l=f,d=a(d,p,h,f,t[m+0],7,-680876936),f=a(f,d,p,h,t[m+1],12,-389564586),h=a(h,f,d,p,t[m+2],17,606105819),p=a(p,h,f,d,t[m+3],22,-1044525330),d=a(d,p,h,f,t[m+4],7,-176418897),f=a(f,d,p,h,t[m+5],12,1200080426),h=a(h,f,d,p,t[m+6],17,-1473231341),p=a(p,h,f,d,t[m+7],22,-45705983),d=a(d,p,h,f,t[m+8],7,1770035416),f=a(f,d,p,h,t[m+9],12,-1958414417),h=a(h,f,d,p,t[m+10],17,-42063),p=a(p,h,f,d,t[m+11],22,-1990404162),d=a(d,p,h,f,t[m+12],7,1804603682),f=a(f,d,p,h,t[m+13],12,-40341101),h=a(h,f,d,p,t[m+14],17,-1502002290),p=a(p,h,f,d,t[m+15],22,1236535329),d=s(d,p,h,f,t[m+1],5,-165796510),f=s(f,d,p,h,t[m+6],9,-1069501632),h=s(h,f,d,p,t[m+11],14,643717713),p=s(p,h,f,d,t[m+0],20,-373897302),d=s(d,p,h,f,t[m+5],5,-701558691),f=s(f,d,p,h,t[m+10],9,38016083),h=s(h,f,d,p,t[m+15],14,-660478335),p=s(p,h,f,d,t[m+4],20,-405537848),d=s(d,p,h,f,t[m+9],5,568446438),f=s(f,d,p,h,t[m+14],9,-1019803690),h=s(h,f,d,p,t[m+3],14,-187363961),p=s(p,h,f,d,t[m+8],20,1163531501),d=s(d,p,h,f,t[m+13],5,-1444681467),f=s(f,d,p,h,t[m+2],9,-51403784),h=s(h,f,d,p,t[m+7],14,1735328473),p=s(p,h,f,d,t[m+12],20,-1926607734),d=c(d,p,h,f,t[m+5],4,-378558),f=c(f,d,p,h,t[m+8],11,-2022574463),h=c(h,f,d,p,t[m+11],16,1839030562),p=c(p,h,f,d,t[m+14],23,-35309556),d=c(d,p,h,f,t[m+1],4,-1530992060),f=c(f,d,p,h,t[m+4],11,1272893353),h=c(h,f,d,p,t[m+7],16,-155497632),p=c(p,h,f,d,t[m+10],23,-1094730640),d=c(d,p,h,f,t[m+13],4,681279174),f=c(f,d,p,h,t[m+0],11,-358537222),h=c(h,f,d,p,t[m+3],16,-722521979),p=c(p,h,f,d,t[m+6],23,76029189),d=c(d,p,h,f,t[m+9],4,-640364487),f=c(f,d,p,h,t[m+12],11,-421815835),h=c(h,f,d,p,t[m+15],16,530742520),p=c(p,h,f,d,t[m+2],23,-995338651),d=u(d,p,h,f,t[m+0],6,-198630844),f=u(f,d,p,h,t[m+7],10,1126891415),h=u(h,f,d,p,t[m+14],15,-1416354905),p=u(p,h,f,d,t[m+5],21,-57434055),d=u(d,p,h,f,t[m+12],6,1700485571),f=u(f,d,p,h,t[m+3],10,-1894986606),h=u(h,f,d,p,t[m+10],15,-1051523),p=u(p,h,f,d,t[m+1],21,-2054922799),d=u(d,p,h,f,t[m+8],6,1873313359),f=u(f,d,p,h,t[m+15],10,-30611744),h=u(h,f,d,p,t[m+6],15,-1560198380),p=u(p,h,f,d,t[m+13],21,1309151649),d=u(d,p,h,f,t[m+4],6,-145523070),f=u(f,d,p,h,t[m+11],10,-1120210379),h=u(h,f,d,p,t[m+2],15,718787259),p=u(p,h,f,d,t[m+9],21,-343485551),d=e(d,r),p=e(p,i),h=e(h,o),f=e(f,l);return[d,p,h,f]};return{hexdigest:function(e){return i(l(n(e),8*e.length))},hash:function(e){return r(l(n(e),8*e.length))}}}),function(e,t){"function"==typeof n&&n.amd?n("strophe-utils",[],function(){return t()}):e.stropheUtils=t()}(this,function(){return{utf16to8:function(e){var t,n,r="",i=e.length;for(t=0;t<i;t++)n=e.charCodeAt(t),n>=0&&n<=127?r+=e.charAt(t):n>2047?(r+=String.fromCharCode(224|n>>12&15),r+=String.fromCharCode(128|n>>6&63),r+=String.fromCharCode(128|n>>0&63)):(r+=String.fromCharCode(192|n>>6&31),r+=String.fromCharCode(128|n>>0&63));return r},addCookies:function(e){var t,n,r,i,o,s,c;for(t in e||{})o="",s="",c="",n=e[t],r="object"===(void 0===n?"undefined":a(n)),i=escape(unescape(r?n.value:n)),r&&(o=n.expires?";expires="+n.expires:"",s=n.domain?";domain="+n.domain:"",c=n.path?";path="+n.path:""),document.cookie=t+"="+i+o+s+c}}}),function(e,t){if("function"==typeof n&&n.amd)n("strophe-core",["strophe-sha1","strophe-md5","strophe-utils"],function(){return t.apply(this,arguments)});else{var r=t(e.SHA1,e.MD5,e.stropheUtils);e.Strophe=r.Strophe,e.$build=r.$build,e.$iq=r.$iq,e.$msg=r.$msg,e.$pres=r.$pres,e.SHA1=r.SHA1,e.MD5=r.MD5,e.b64_hmac_sha1=r.SHA1.b64_hmac_sha1,e.b64_sha1=r.SHA1.b64_sha1,e.str_hmac_sha1=r.SHA1.str_hmac_sha1,e.str_sha1=r.SHA1.str_sha1}}(this,function(e,t,n){function r(e,t){return new c.Builder(e,t)}function i(e){return new c.Builder("message",e)}function o(e){return new c.Builder("iq",e)}function s(e){return new c.Builder("presence",e)}var c;return c={VERSION:"1.2.14",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<c.XHTML.tags.length;t++)if(e===c.XHTML.tags[t])return!0;return!1},validAttribute:function(e,t){if(void 0!==c.XHTML.attributes[e]&&c.XHTML.attributes[e].length>0)for(var n=0;n<c.XHTML.attributes[e].length;n++)if(t===c.XHTML.attributes[e][n])return!0;return!1},validCSS:function(e){for(var t=0;t<c.XHTML.css.length;t++)if(e===c.XHTML.css[t])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){c.NS[e]=t},forEachChild:function(e,t,n){var r,i;for(r=0;r<e.childNodes.length;r++)i=e.childNodes[r],i.nodeType!==c.ElementType.NORMAL||t&&!this.isTagEqual(i,t)||n(i)},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom(),e.appendChild(e.createElement("strophe"))):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return c._xmlGenerator||(c._xmlGenerator=c._makeGenerator()),c._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<t.length&&null===e;n++)try{e=new ActiveXObject(t[n])}catch(t){e=null}return e},xmlElement:function(e){if(!e)return null;var t,n,r,i=c.xmlGenerator().createElement(e);for(t=1;t<arguments.length;t++){var o=arguments[t];if(o)if("string"==typeof o||"number"==typeof o)i.appendChild(c.xmlTextNode(o));else if("object"===(void 0===o?"undefined":a(o))&&"function"==typeof o.sort)for(n=0;n<o.length;n++){var s=o[n];"object"===(void 0===s?"undefined":a(s))&&"function"==typeof s.sort&&void 0!==s[1]&&null!==s[1]&&i.setAttribute(s[0],s[1])}else if("object"===(void 0===o?"undefined":a(o)))for(r in o)o.hasOwnProperty(r)&&void 0!==o[r]&&null!==o[r]&&i.setAttribute(r,o[r])}return i},xmlescape:function(e){return e=e.replace(/\&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/'/g,"&apos;"),e=e.replace(/"/g,"&quot;")},xmlunescape:function(e){return e=e.replace(/\&amp;/g,"&"),e=e.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&apos;/g,"'"),e=e.replace(/&quot;/g,'"')},xmlTextNode:function(e){return c.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;return DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)),t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===c.ElementType.TEXT&&(t+=e.nodeValue);for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType===c.ElementType.TEXT&&(t+=e.childNodes[n].nodeValue);return c.xmlescape(t)},copyElement:function(e){var t,n;if(e.nodeType===c.ElementType.NORMAL){for(n=c.xmlElement(e.tagName),t=0;t<e.attributes.length;t++)n.setAttribute(e.attributes[t].nodeName,e.attributes[t].value);for(t=0;t<e.childNodes.length;t++)n.appendChild(c.copyElement(e.childNodes[t]))}else e.nodeType===c.ElementType.TEXT&&(n=c.xmlGenerator().createTextNode(e.nodeValue));return n},createHtml:function(e){var t,n,r,i,o,s,u,l,d,p,h;if(e.nodeType===c.ElementType.NORMAL)if(i=e.nodeName.toLowerCase(),c.XHTML.validTag(i))try{for(n=c.xmlElement(i),t=0;t<c.XHTML.attributes[i].length;t++)if(o=c.XHTML.attributes[i][t],void 0!==(s=e.getAttribute(o))&&null!==s&&""!==s&&!1!==s&&0!==s)if("style"===o&&"object"===(void 0===s?"undefined":a(s))&&void 0!==s.cssText&&(s=s.cssText),"style"===o){for(u=[],l=s.split(";"),r=0;r<l.length;r++)d=l[r].split(":"),p=d[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),c.XHTML.validCSS(p)&&(h=d[1].replace(/^\s*/,"").replace(/\s*$/,""),u.push(p+": "+h));u.length>0&&(s=u.join("; "),n.setAttribute(o,s))}else n.setAttribute(o,s);for(t=0;t<e.childNodes.length;t++)n.appendChild(c.createHtml(e.childNodes[t]))}catch(e){n=c.xmlTextNode("")}else for(n=c.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(c.createHtml(e.childNodes[t]));else if(e.nodeType===c.ElementType.FRAGMENT)for(n=c.xmlGenerator().createDocumentFragment(),t=0;t<e.childNodes.length;t++)n.appendChild(c.createHtml(e.childNodes[t]));else e.nodeType===c.ElementType.TEXT&&(n=c.xmlTextNode(e.nodeValue));return n},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=c.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var n=t.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&c.fatal(e.stack),e.sourceURL?c.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?c.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):c.fatal("error: "+e.message)},log:function(e,t){},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){var t;if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var n,r,i=e.nodeName;for(e.getAttribute("_realname")&&(i=e.getAttribute("_realname")),t="<"+i,n=0;n<e.attributes.length;n++)"_realname"!==e.attributes[n].nodeName&&(t+=" "+e.attributes[n].nodeName+"='"+c.xmlescape(e.attributes[n].value)+"'");if(e.childNodes.length>0){for(t+=">",n=0;n<e.childNodes.length;n++)switch(r=e.childNodes[n],r.nodeType){case c.ElementType.NORMAL:t+=c.serialize(r);break;case c.ElementType.TEXT:t+=c.xmlescape(r.nodeValue);break;case c.ElementType.CDATA:t+="<![CDATA["+r.nodeValue+"]]>"}t+="</"+i+">"}else t+="/>";return t},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){c._connectionPlugins[e]=t}},c.Builder=function(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=c.NS.CLIENT:t||(t={xmlns:c.NS.CLIENT})),this.nodeTree=c.xmlElement(e,t),this.node=this.nodeTree},c.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return c.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)e.hasOwnProperty(t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,n){var r=c.xmlElement(e,t,n);return this.node.appendChild(r),"string"!=typeof n&&"number"!=typeof n&&(this.node=r),this},cnode:function(e){var t,n=c.xmlGenerator();try{t=void 0!==n.importNode}catch(e){t=!1}var r=t?n.importNode(e,!0):c.copyElement(e);return this.node.appendChild(r),this.node=r,this},t:function(e){var t=c.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var n=c.createHtml(t);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},c.Handler=function(e,t,n,r,i,o,a){this.handler=e,this.ns=t,this.name=n,this.type=r,this.id=i,this.options=a||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(c.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=o?c.getBareJidFromJid(o):null:this.from=o,this.user=!0},c.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=!1;if(!this.ns)return!0;var n=this;return c.forEachChild(e,null,function(e){n.getNamespace(e)===n.ns&&(t=!0)}),t=t||this.getNamespace(e)===this.ns},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=c.getBareJidFromJid(t));var n=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!c.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(n):n!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(e){throw c._handleError(e),e}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},c.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0},c.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},c.Connection=function(e,t){this.service=e,this.options=t||{};var r=this.options.protocol||"";0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===r.indexOf("ws")?this._proto=new c.Websocket(this):this._proto=new c.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),n.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms);for(var i in c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(i)){var o=c._connectionPlugins[i],a=function(){};a.prototype=o,this[i]=new a,this[i].init(this)}},c.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,n){this.protocolErrorHandlers[e][t]=n},connect:function(e,t,n,r,i,o,a){this.jid=e,this.authzid=c.getBareJidFromJid(this.jid),this.authcid=a||c.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=c.getDomainFromJid(this.jid),this._changeConnectStatus(c.Status.CONNECTING,null),this._proto._connect(r,i,o)},attach:function(e,t,n,r,i,o,a){if(!(this._proto instanceof c.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(e,t,n,r,i,o,a)},restore:function(e,t,n,r,i){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(e,t,n,r,i)},_sessionCachingSupported:function(){if(this._proto instanceof c.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,n,r){var i=null,o=this;"function"==typeof e.tree&&(e=e.tree());var a=e.getAttribute("id");if(a||(a=this.getUniqueId("sendPresence"),e.setAttribute("id",a)),"function"==typeof t||"function"==typeof n){var s=this.addHandler(function(e){i&&o.deleteTimedHandler(i),"error"===e.getAttribute("type")?n&&n(e):t&&t(e)},null,"presence",null,a);r&&(i=this.addTimedHandler(r,function(){return o.deleteHandler(s),n&&n(null),!1}))}return this.send(e),a},sendIQ:function(e,t,n,r){var i=null,o=this;"function"==typeof e.tree&&(e=e.tree());var a=e.getAttribute("id");if(a||(a=this.getUniqueId("sendIQ"),e.setAttribute("id",a)),"function"==typeof t||"function"==typeof n){var s=this.addHandler(function(e){i&&o.deleteTimedHandler(i);var r=e.getAttribute("type");if("result"===r)t&&t(e);else{if("error"!==r)throw{name:"StropheError",message:"Got bad IQ type of "+r};n&&n(e)}},null,"iq",["error","result"],a);r&&(i=this.addTimedHandler(r,function(){return o.deleteHandler(s),n&&n(null),!1}))}return this.send(e),a},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(e)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(e,t){var n=new c.TimedHandler(e,t);return this.addTimeds.push(n),n},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,n,r,i,o,a){var s=new c.Handler(e,t,n,r,i,o,a);return this.addHandlers.push(s),s},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},e=e||[c.SASLAnonymous,c.SASLExternal,c.SASLMD5,c.SASLOAuthBearer,c.SASLPlain,c.SASLSHA1],e.forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus(c.Status.DISCONNECTING,e),c.info("Disconnect was called because: "+e),this.connected){var t=!1;this.disconnecting=!0,this.authenticated&&(t=s({xmlns:c.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else c.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t){for(var n in c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(n)){var r=this[n];if(r.statusChanged)try{r.statusChanged(e,t)}catch(e){c.error(n+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(e,t)}catch(e){c._handleError(e),c.error("User connection callback caused an exception: "+e)}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),c.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(c.Status.DISCONNECTED,e),this.connected=!1},_dataRecv:function(e,t){c.info("_dataRecv called");var n=this._proto._reqToData(e);if(null!==n){this.xmlInput!==c.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==c.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(c.serialize(n)));for(var r,i;this.removeHandlers.length>0;)i=this.removeHandlers.pop(),(r=this.handlers.indexOf(i))>=0&&this.handlers.splice(r,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var o,a,s=n.getAttribute("type");if(null!==s&&"terminate"===s){if(this.disconnecting)return;return o=n.getAttribute("condition"),a=n.getElementsByTagName("conflict"),null!==o?("remote-stream-error"===o&&a.length>0&&(o="conflict"),this._changeConnectStatus(c.Status.CONNFAIL,o)):this._changeConnectStatus(c.Status.CONNFAIL,"unknown"),void this._doDisconnect(o)}var u=this;c.forEachChild(n,null,function(e){var t,n;for(n=u.handlers,u.handlers=[],t=0;t<n.length;t++){var r=n[t];try{!r.isMatch(e)||!u.authenticated&&r.user?u.handlers.push(r):r.run(e)&&u.handlers.push(r)}catch(e){c.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}},mechanisms:{},_connect_cb:function(e,t,n){c.info("_connect_cb was called"),this.connected=!0;var r;try{r=this._proto._reqToData(e)}catch(e){if("badformat"!==e)throw e;this._changeConnectStatus(c.Status.CONNFAIL,"bad-format"),this._doDisconnect("bad-format")}if(r&&(this.xmlInput!==c.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==c.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(c.serialize(r))),this._proto._connect_cb(r)!==c.Status.CONNFAIL)){if(!(r.getElementsByTagNameNS?r.getElementsByTagNameNS(c.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0))return void this._proto._no_auth_received(t);var i,o,a=[],s=r.getElementsByTagName("mechanism");if(s.length>0)for(i=0;i<s.length;i++)o=c.getText(s[i]),this.mechanisms[o]&&a.push(this.mechanisms[o]);if(0===a.length&&0===r.getElementsByTagName("auth").length)return void this._proto._no_auth_received(t);!1!==this.do_authentication&&this.authenticate(a)}},sortMechanismsByPriority:function(e){var t,n,r,i;for(t=0;t<e.length-1;++t){for(r=t,n=t+1;n<e.length;++n)e[n].prototype.priority>e[r].prototype.priority&&(r=n);r!==t&&(i=e[t],e[t]=e[r],e[r]=i)}return e},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);var t=0,n=!1;for(t=0;t<e.length;++t)if(e[t].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[t],this._sasl_mechanism.onStart(this);var i=r("auth",{xmlns:c.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var o=this._sasl_mechanism.onChallenge(this,null);i.t(btoa(o))}this.send(i.tree()),n=!0;break}return n},_attemptLegacyAuth:function(){null===c.getNodeFromJid(this.jid)?(this._changeConnectStatus(c.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(c.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(o({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).tree()))},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(e){var t=atob(c.getText(e)),n=this._sasl_mechanism.onChallenge(this,t),i=r("response",{xmlns:c.NS.SASL});return""!==n&&i.t(btoa(n)),this.send(i.tree()),!0},_auth1_cb:function(e){var t=o({type:"set",id:"_auth_2"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return c.getResourceFromJid(this.jid)||(this.jid=c.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(c.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1},_sasl_success_cb:function(e){if(this._sasl_data["server-signature"]){var t,n=atob(c.getText(e)),r=/([a-z]+)=([^,]+)(,|$)/,i=n.match(r);if("v"===i[1]&&(t=i[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}c.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var o=[],a=function(e,t){for(;e.length;)this.deleteHandler(e.pop());return this._sasl_auth1_cb.bind(this)(t),!1};return o.push(this._addSysHandler(function(e){a.bind(this)(o,e)}.bind(this),null,"stream:features",null,null)),o.push(this._addSysHandler(function(e){a.bind(this)(o,e)}.bind(this),c.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(e){this.features=e;var t,n;for(t=0;t<e.childNodes.length;t++)n=e.childNodes[t],"bind"===n.nodeName&&(this.do_bind=!0),"session"===n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var r=c.getResourceFromJid(this.jid);return r?this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).c("resource",{}).t(r).tree()):this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).tree()),!1},_sasl_bind_cb:function(e){if("error"===e.getAttribute("type")){c.info("SASL binding failed.");var t;return e.getElementsByTagName("conflict").length>0&&(t="conflict"),this._changeConnectStatus(c.Status.AUTHFAIL,t),!1}var n,r=e.getElementsByTagName("bind");if(!(r.length>0))return c.info("SASL binding failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;n=r[0].getElementsByTagName("jid"),n.length>0&&(this.jid=c.getText(n[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(o({type:"set",id:"_session_auth_2"}).c("session",{xmlns:c.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null)))},_sasl_session_cb:function(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return c.info("Session creation failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(c.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(e,t){var n=new c.TimedHandler(e,t);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(e,t,n,r,i){var o=new c.Handler(e,t,n,r,i);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return c.info("_onDisconnectTimeout was called"),this._changeConnectStatus(c.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var e,t,n,r;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)t=this.removeTimeds.pop(),(e=this.timedHandlers.indexOf(t))>=0&&this.timedHandlers.splice(e,1);var i=(new Date).getTime();for(r=[],e=0;e<this.timedHandlers.length;e++)t=this.timedHandlers[e],!this.authenticated&&t.user||(n=t.lastCalled+t.period,n-i<=0?t.run()&&r.push(t):r.push(t));this.timedHandlers=r,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100))}},c.SASLMechanism=function(e,t,n){this.name=e,this.isClientFirst=t,this.priority=n},c.SASLMechanism.prototype={test:function(e){return!0},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},c.SASLAnonymous=function(){},c.SASLAnonymous.prototype=new c.SASLMechanism("ANONYMOUS",!1,20),c.SASLAnonymous.prototype.test=function(e){return null===e.authcid},c.SASLPlain=function(){},c.SASLPlain.prototype=new c.SASLMechanism("PLAIN",!0,30),c.SASLPlain.prototype.test=function(e){return null!==e.authcid},c.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,n.utf16to8(t)},c.SASLSHA1=function(){},c.SASLSHA1.prototype=new c.SASLMechanism("SCRAM-SHA-1",!0,50),c.SASLSHA1.prototype.test=function(e){return null!==e.authcid},c.SASLSHA1.prototype.onChallenge=function(r,i,o){var a=o||t.hexdigest(1234567890*Math.random()),s="n="+n.utf16to8(r.authcid);return s+=",r=",s+=a,r._sasl_data.cnonce=a,r._sasl_data["client-first-message-bare"]=s,s="n,,"+s,this.onChallenge=function(t,r){for(var i,o,a,s,c,u,l,d,p,h,f,m,v="c=biws,",g=t._sasl_data["client-first-message-bare"]+","+r+",",y=t._sasl_data.cnonce,b=/([a-z]+)=([^,]+)(,|$)/;r.match(b);){var _=r.match(b);switch(r=r.replace(_[0],""),_[1]){case"r":i=_[2];break;case"s":o=_[2];break;case"i":a=_[2]}}if(i.substr(0,y.length)!==y)return t._sasl_data={},t._sasl_failure_cb();for(v+="r="+i,g+=v,o=atob(o),o+="\0\0\0",p=n.utf16to8(t.pass),s=u=e.core_hmac_sha1(p,o),l=1;l<a;l++){for(c=e.core_hmac_sha1(p,e.binb2str(u)),d=0;d<5;d++)s[d]^=c[d];u=c}for(s=e.binb2str(s),h=e.core_hmac_sha1(s,"Client Key"),f=e.str_hmac_sha1(s,"Server Key"),m=e.core_hmac_sha1(e.str_sha1(e.binb2str(h)),g),t._sasl_data["server-signature"]=e.b64_hmac_sha1(f,g),d=0;d<5;d++)h[d]^=m[d];return v+=",p="+btoa(e.binb2str(h))}.bind(this),s},c.SASLMD5=function(){},c.SASLMD5.prototype=new c.SASLMechanism("DIGEST-MD5",!1,40),c.SASLMD5.prototype.test=function(e){return null!==e.authcid},c.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},c.SASLMD5.prototype.onChallenge=function(e,r,i){for(var o,a=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,s=i||t.hexdigest(""+1234567890*Math.random()),c="",u=null,l="";r.match(a);)switch(o=r.match(a),r=r.replace(o[0],""),o[2]=o[2].replace(/^"(.+)"$/,"$1"),o[1]){case"realm":c=o[2];break;case"nonce":l=o[2];break;case"qop":o[2];break;case"host":u=o[2]}var d=e.servtype+"/"+e.domain;null!==u&&(d=d+"/"+u);var p=n.utf16to8(e.authcid+":"+c+":"+this._connection.pass),h=t.hash(p)+":"+l+":"+s,f="AUTHENTICATE:"+d,m="";return m+="charset=utf-8,",m+="username="+this._quote(n.utf16to8(e.authcid))+",",m+="realm="+this._quote(c)+",",m+="nonce="+this._quote(l)+",",m+="nc=00000001,",m+="cnonce="+this._quote(s)+",",m+="digest-uri="+this._quote(d)+",",m+="response="+t.hexdigest(t.hexdigest(h)+":"+l+":00000001:"+s+":auth:"+t.hexdigest(f))+",",m+="qop=auth",this.onChallenge=function(){return""},m},c.SASLOAuthBearer=function(){},c.SASLOAuthBearer.prototype=new c.SASLMechanism("OAUTHBEARER",!0,60),c.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},c.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",n.utf16to8(t)},c.SASLExternal=function(){},c.SASLExternal.prototype=new c.SASLMechanism("EXTERNAL",!0,10),c.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},{Strophe:c,$build:r,$iq:o,$msg:i,$pres:s,SHA1:e,MD5:t,b64_hmac_sha1:e.b64_hmac_sha1,b64_sha1:e.b64_sha1,str_hmac_sha1:e.str_hmac_sha1,str_sha1:e.str_sha1}}),function(e,t){if("function"!=typeof n||!n.amd)return t(Strophe,$build);n("strophe-bosh",["strophe-core"],function(e){return t(e.Strophe,e.$build)})}(0,function(e,t){return e.Request=function(t,n,r,i){this.id=++e._requestId,this.xmlData=t,this.data=e.serialize(t),this.origFunc=n,this.func=n,this.rid=r,this.date=NaN,this.sends=i||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},e.Request.prototype={getResponse:function(){var t=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(t=this.xhr.responseXML.documentElement,"parsererror"===t.tagName)throw e.error("invalid response received"),e.error("responseText: "+this.xhr.responseText),e.error("responseXML: "+e.serialize(this.xhr.responseXML)),"parsererror"}else if(this.xhr.responseText)throw e.error("invalid response received"),e.error("responseText: "+this.xhr.responseText),"badformat";return t},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest,e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},e.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this._requests=[]},e.Bosh.prototype={strip:null,_buildBody:function(){var n=t("body",{rid:this.rid++,xmlns:e.NS.HTTPBIND});return null!==this.sid&&n.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),n},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(t,n,r){this.wait=t||this.wait,this.hold=n||this.hold,this.errors=0;var i=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":e.NS.BOSH});r&&i.attrs({route:r});var o=this._conn._connect_cb;this._requests.push(new e.Request(i.tree(),this._onRequestStateChange.bind(this,o.bind(this._conn)),i.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(t,n,r,i,o,a,s){this._conn.jid=t,this.sid=n,this.rid=r,this._conn.connect_callback=i,this._conn.domain=e.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=o||this.wait,this.hold=a||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(e.Status.ATTACHED,null)},_restore:function(t,n,r,i,o){var a=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(void 0!==a&&null!==a&&a.rid&&a.sid&&a.jid&&(void 0===t||null===t||e.getBareJidFromJid(a.jid)===e.getBareJidFromJid(t)||null===e.getNodeFromJid(t)&&e.getDomainFromJid(a.jid)===t)))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(a.jid,a.sid,a.rid,n,r,i,o)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(t){var n,r,i=t.getAttribute("type");if(null!==i&&"terminate"===i)return n=t.getAttribute("condition"),e.error("BOSH-Connection failed: "+n),r=t.getElementsByTagName("conflict"),null!==n?("remote-stream-error"===n&&r.length>0&&(n="conflict"),this._conn._changeConnectStatus(e.Status.CONNFAIL,n)):this._conn._changeConnectStatus(e.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),e.Status.CONNFAIL;this.sid||(this.sid=t.getAttribute("sid"));var o=t.getAttribute("requests");o&&(this.window=parseInt(o,10));var a=t.getAttribute("hold");a&&(this.hold=parseInt(a,10));var s=t.getAttribute("wait");s&&(this.wait=parseInt(s,10));var c=t.getAttribute("inactivity");c&&(this.inactivity=parseInt(c,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t,n=this._getRequestStatus(e);(t=this._conn.protocolErrorHandlers.HTTP[n])&&t.call(this,n)},_hitError:function(t){this.errors++,e.warn("request errored, status: "+t+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(t){t=t?t.bind(this._conn):this._conn._connect_cb.bind(this._conn);var n=this._buildBody();this._requests.push(new e.Request(n.tree(),this._onRequestStateChange.bind(this,t.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var e;this._requests.length>0;)e=this._requests.pop(),e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}},_onIdle:function(){var t=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===t.length&&!this._conn.disconnecting&&(e.info("no requests during idle cycle, sending blank request"),t.push(null)),!this._conn.paused){if(this._requests.length<2&&t.length>0){for(var n=this._buildBody(),r=0;r<t.length;r++)null!==t[r]&&("restart"===t[r]?n.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":e.NS.BOSH}):n.cnode(t[r]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new e.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var i=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(e.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),i>Math.floor(e.TIMEOUT*this.wait)&&(e.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(e.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(t,n){var r;if(4===t.xhr.readyState)try{r=t.xhr.status}catch(t){e.error("Caught an error while retrieving a request's status, reqStatus: "+r)}return void 0===r&&(r="number"==typeof n?n:0),r},_onRequestStateChange:function(t,n){if(e.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)return void(n.abort=!1);if(4===n.xhr.readyState){var r=this._getRequestStatus(n);if(this.disconnecting&&r>=400)return this._hitError(r),void this._callProtocolErrorHandlers(n);var i=r>0&&r<500,o=n.sends>this._conn.maxRetries;if((i||o)&&(this._removeRequest(n),e.debug("request id "+n.id+" should now be removed")),200===r){var a=this._requests[0]===n;(this._requests[1]===n||a&&this._requests.length>0&&this._requests[0].age()>Math.floor(e.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),e.debug("request id "+n.id+"."+n.sends+" got 200"),t(n),this.errors=0}else 0===r||r>=400&&r<600||r>=12e3?(e.error("request id "+n.id+"."+n.sends+" error "+r+" happened"),this._hitError(r),this._callProtocolErrorHandlers(n),r>=400&&r<500&&(this._conn._changeConnectStatus(e.Status.DISCONNECTING,null),this._conn._doDisconnect())):e.error("request id "+n.id+"."+n.sends+" error "+r+" happened");i||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(e.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(t){var n=this,r=this._requests[t],i=this._getRequestStatus(r,-1);if(r.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var o=r.age(),a=!isNaN(o)&&o>Math.floor(e.TIMEOUT*this.wait),s=null!==r.dead&&r.timeDead()>Math.floor(e.SECONDARY_TIMEOUT*this.wait),c=4===r.xhr.readyState&&(i<1||i>=500);if((a||s||c)&&(s&&e.error("Request "+this._requests[t].id+" timed out (secondary), restarting"),r.abort=!0,r.xhr.abort(),r.xhr.onreadystatechange=function(){},this._requests[t]=new e.Request(r.xmlData,r.origFunc,r.rid,r.sends),r=this._requests[t]),0===r.xhr.readyState){e.debug("request id "+r.id+"."+r.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";r.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==r.xhr.setRequestHeader&&r.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(r.xhr.withCredentials=!0)}catch(t){return e.error("XHR open failed: "+t.toString()),this._conn.connected||this._conn._changeConnectStatus(e.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(r.date=new Date,n._conn.options.customHeaders){var e=n._conn.options.customHeaders;for(var t in e)e.hasOwnProperty(t)&&r.xhr.setRequestHeader(t,e[t])}r.xhr.send(r.data)};if(r.sends>1){var d=1e3*Math.min(Math.floor(e.TIMEOUT*this.wait),Math.pow(r.sends,3));setTimeout(function(){l()},d)}else l();r.sends++,this._conn.xmlOutput!==e.Connection.prototype.xmlOutput&&(r.xmlData.nodeName===this.strip&&r.xmlData.childNodes.length?this._conn.xmlOutput(r.xmlData.childNodes[0]):this._conn.xmlOutput(r.xmlData)),this._conn.rawOutput!==e.Connection.prototype.rawOutput&&this._conn.rawOutput(r.data)}else e.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+r.xhr.readyState)},_removeRequest:function(t){e.debug("removing request");var n;for(n=this._requests.length-1;n>=0;n--)t===this._requests[n]&&this._requests.splice(n,1);t.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(e){if("parsererror"!==e)throw e;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(t){e.info("_sendTerminate was called");var n=this._buildBody().attrs({type:"terminate"});t&&n.cnode(t.tree());var r=new e.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"));this._requests.push(r),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?e.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):e.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},e}),function(e,t){if("function"!=typeof n||!n.amd)return t(Strophe,$build);n("strophe-websocket",["strophe-core"],function(e){return t(e.Strophe,e.$build)})}(0,function(e,t){return e.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var n="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?n+="ws":n+="wss",n+="://"+window.location.host,0!==t.indexOf("/")?n+=window.location.pathname+t:n+=t,e.service=n}},e.Websocket.prototype={_buildStream:function(){return t("open",{xmlns:e.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(t,n){var r;if(r=t.getElementsByTagNameNS?t.getElementsByTagNameNS(e.NS.STREAM,"error"):t.getElementsByTagName("stream:error"),0===r.length)return!1;for(var i=r[0],o="",a="",s=0;s<i.childNodes.length;s++){var c=i.childNodes[s];if("urn:ietf:params:xml:ns:xmpp-streams"!==c.getAttribute("xmlns"))break;"text"===c.nodeName?a=c.textContent:o=c.nodeName}var u="WebSocket stream error: ";return u+=o||"unknown",a&&(u+=" - "+a),e.error(u),this._conn._changeConnectStatus(n,o),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(t){if(this._check_streamerror(t,e.Status.CONNFAIL))return e.Status.CONNFAIL},_handleStreamStart:function(t){var n=!1,r=t.getAttribute("xmlns");"string"!=typeof r?n="Missing xmlns in <open />":r!==e.NS.FRAMING&&(n="Wrong xmlns in <open />: "+r);var i=t.getAttribute("version");return"string"!=typeof i?n="Missing version in <open />":"1.0"!==i&&(n="Wrong version in <open />: "+i),!n||(this._conn._changeConnectStatus(e.Status.CONNFAIL,n),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(t){if(0===t.data.indexOf("<open ")||0===t.data.indexOf("<?xml")){var n=t.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===n)return;var r=(new DOMParser).parseFromString(n,"text/xml").documentElement;this._conn.xmlInput(r),this._conn.rawInput(t.data),this._handleStreamStart(r)&&this._connect_cb(r)}else if(0===t.data.indexOf("<close ")){this._conn.rawInput(t.data),this._conn.xmlInput(t);var i=t.getAttribute("see-other-uri");i?(this._conn._changeConnectStatus(e.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=i,this._connect()):(this._conn._changeConnectStatus(e.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var o=this._streamWrap(t.data),a=(new DOMParser).parseFromString(o,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(a,null,t.data)}},_disconnect:function(n){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){n&&this._conn.send(n);var r=t("close",{xmlns:e.NS.FRAMING});this._conn.xmlOutput(r);var i=e.serialize(r);this._conn.rawOutput(i);try{this.socket.send(i)}catch(t){e.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){e.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(e){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(t){this._conn.connected&&!this._conn.disconnecting?(e.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):t&&1006===t.code&&!this._conn.connected&&this.socket?(e.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(e.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):e.info("Websocket closed")},_no_auth_received:function(t){e.error("Server did not send any auth methods"),this._conn._changeConnectStatus(e.Status.CONNFAIL,"Server did not send any auth methods"),t&&(t=t.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(t){e.error("Websocket error "+t),this._conn._changeConnectStatus(e.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var t=this._conn._data;if(t.length>0&&!this._conn.paused){for(var n=0;n<t.length;n++)if(null!==t[n]){var r,i;r="restart"===t[n]?this._buildStream().tree():t[n],i=e.serialize(r),this._conn.xmlOutput(r),this._conn.rawOutput(i),this.socket.send(i)}this._conn._data=[]}},_onMessage:function(t){var n,r,i='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(t.data===i)return this._conn.rawInput(i),this._conn.xmlInput(t),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===t.data.search("<open ")){if(n=(new DOMParser).parseFromString(t.data,"text/xml").documentElement,!this._handleStreamStart(n))return}else r=this._streamWrap(t.data),n=(new DOMParser).parseFromString(r,"text/xml").documentElement;return this._check_streamerror(n,e.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===n.firstChild.nodeName&&"unavailable"===n.firstChild.getAttribute("type")?(this._conn.xmlInput(n),void this._conn.rawInput(e.serialize(n))):void this._conn._dataRecv(n,t.data)},_onOpen:function(){e.info("Websocket open");var t=this._buildStream();this._conn.xmlOutput(t.tree());var n=e.serialize(t);this._conn.rawOutput(n),this.socket.send(n)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},e}),function(e){"function"==typeof n&&n.amd&&n("strophe",["strophe-core","strophe-bosh","strophe-websocket"],function(e){return e})}(),t(["strophe-polyfill"]),t("strophe")})},function(e,t){function n(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];i.forEach(function(e){return e.apply(void 0,t)}),o&&o.apply(void 0,t)}function r(e){i.forEach(function(t){return t(null,null,null,null,e.reason)}),a&&a(e)}var i=[],o=window.onerror,a=window.onunhandledrejection;window.onerror=n,window.onunhandledrejection=r;var s={addHandler:function(e){i.push(e)},callErrorHandler:function(e){var t=window.onerror;t&&t(null,null,null,null,e)},callUnhandledRejectionHandler:function(e){var t=window.onunhandledrejection;t&&t(e)}};e.exports=s},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i});var r="audio",i="video"},function(e,t,n){"use strict";(function(e){function r(e){S||(v.a.loadScript(e.customScriptUrl||"https://api.callstats.io/static/callstats-ws.min.js",!0,!0,void 0,function(){return i(e)}),S=!0)}function i(e){if(!l.a.isBackendInitialized()){var t=f.a.callStatsUserName;l.a.initBackend({callStatsID:e.callStatsID,callStatsSecret:e.callStatsSecret,userName:e.swapUserNameAndAlias?e.callStatsAliasName:t,aliasName:e.swapUserNameAndAlias?t:e.callStatsAliasName,applicationName:e.applicationName})||b.error("CallStats Backend initialization failed bad")}}function o(e){var t=new Error;return t.stack=e.stack,t.name=(e.name||"Unknown error")+(e.gum&&e.gum.error&&e.gum.error.name?" - "+e.gum.error.name:""),t.constraintName=e.gum&&e.gum.constraints?JSON.stringify(e.gum.constraints):"",t.message=e.message,t}function a(e,t){this.rtpStatsMap=new Map,this.eventEmitter=new c.a,this.xmpp=e,this.options=t||{},this.callStatsIntegrationEnabled=this.options.callStatsID&&this.options.callStatsSecret&&!0!==a.disableThirdPartyRequests,this.callStatsIntegrationEnabled&&(h.a.isReactNative()?i(this.options):r(this.options),this.options.callStatsConfIDNamespace||b.warn('"callStatsConfIDNamespace" is not defined')),this.callsStatsInstances=new Map,a.instances.add(this)}t.a=a;var s=n(14),c=n.n(s),u=n(66),l=n(68),d=n(41),p=n(89),h=n(1),f=n(18),m=n(43),v=n.n(m),g=n(11),y=n(42),b=n(0).getLogger(e),_=void 0,S=!1;a.init=function(e){a.audioLevelsEnabled=!e.disableAudioLevels,"number"==typeof e.audioLevelsInterval&&(a.audioLevelsInterval=e.audioLevelsInterval),a.disableThirdPartyRequests=e.disableThirdPartyRequests},a.audioLevelsEnabled=!1,a.audioLevelsInterval=200,a.disableThirdPartyRequests=!1,a.analytics=u.a,Object.defineProperty(a,"instances",{get:function(){return _||(_=new Set),_}}),a.prototype.startRemoteStats=function(e){this.stopRemoteStats(e);try{var t=new p.a(e,a.audioLevelsInterval,2e3,this.eventEmitter);t.start(a.audioLevelsEnabled),this.rtpStatsMap.set(e.id,t)}catch(e){b.error("Failed to start collecting remote statistics: "+e)}},a.localStats=[],a.startLocalStats=function(e,t){if(a.audioLevelsEnabled){var n=new d.a(e,a.audioLevelsInterval,t);this.localStats.push(n),n.start()}},a.prototype.addAudioLevelListener=function(e){a.audioLevelsEnabled&&this.eventEmitter.on(y.a,e)},a.prototype.removeAudioLevelListener=function(e){a.audioLevelsEnabled&&this.eventEmitter.removeListener(y.a,e)},a.prototype.addBeforeDisposedListener=function(e){this.eventEmitter.on(y.b,e)},a.prototype.removeBeforeDisposedListener=function(e){this.eventEmitter.removeListener(y.b,e)},a.prototype.addConnectionStatsListener=function(e){this.eventEmitter.on(y.d,e)},a.prototype.removeConnectionStatsListener=function(e){this.eventEmitter.removeListener(y.d,e)},a.prototype.addByteSentStatsListener=function(e){this.eventEmitter.on(y.c,e)},a.prototype.removeByteSentStatsListener=function(e){this.eventEmitter.removeListener(y.c,e)},a.prototype.dispose=function(){try{this.callsStatsInstances.size||this.eventEmitter.emit(y.b);var e=!0,t=!1,n=void 0;try{for(var r,i=this.callsStatsInstances.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;this.stopCallStats(o.tpc)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}var s=!0,c=!1,u=void 0;try{for(var l,d=this.rtpStatsMap.keys()[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var p=l.value;this._stopRemoteStats(p)}}catch(e){c=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(c)throw u}}this.eventEmitter&&this.eventEmitter.removeAllListeners()}finally{a.instances.delete(this)}},a.stopLocalStats=function(e){if(a.audioLevelsEnabled)for(var t=0;t<a.localStats.length;t++)if(a.localStats[t].stream===e){var n=a.localStats.splice(t,1);n[0].stop();break}},a.prototype._stopRemoteStats=function(e){var t=this.rtpStatsMap.get(e);t&&(t.stop(),this.rtpStatsMap.delete(e))},a.prototype.stopRemoteStats=function(e){this._stopRemoteStats(e.id)},a.prototype.startCallStats=function(e,t){if(this.callStatsIntegrationEnabled){if(this.callsStatsInstances.has(e.id))return void b.error("CallStats instance for ${tpc} exists already");b.info("Starting CallStats for "+e+"...");var n=new l.a(e,{confID:this._getCallStatsConfID(),remoteUserID:t});this.callsStatsInstances.set(e.id,n)}},a._getAllCallStatsInstances=function(){var e=new Set,t=!0,n=!1,r=void 0;try{for(var i,o=a.instances[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value,c=!0,u=!1,l=void 0;try{for(var d,p=s.callsStatsInstances.values()[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var h=d.value;e.add(h)}}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}return e},a.prototype._getCallStatsConfID=function(){return this.options.callStatsConfIDNamespace?this.options.callStatsConfIDNamespace+"/"+this.options.roomName:this.options.roomName},a.prototype.stopCallStats=function(e){var t=this.callsStatsInstances.get(e.id);t&&(1===this.callsStatsInstances.size&&this.eventEmitter.emit(y.b),this.callsStatsInstances.delete(e.id),t.sendTerminateEvent())},a.prototype.isCallstatsEnabled=function(){return this.callStatsIntegrationEnabled},a.prototype.sendConnectionResumeOrHoldEvent=function(e,t){var n=this.callsStatsInstances.get(e.id);n&&n.sendResumeOrHoldEvent(t)},a.prototype.sendIceConnectionFailedEvent=function(e){var t=this.callsStatsInstances.get(e.id);t&&t.sendIceConnectionFailedEvent(),a.analytics.sendEvent("connection.ice_failed")},a.prototype.sendMuteEvent=function(e,t,n){var r=e&&this.callsStatsInstances.get(e.id);l.a.sendMuteEvent(t,n,r)},a.prototype.sendScreenSharingEvent=function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.callsStatsInstances.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0)i.value.sendScreenSharingEvent(e)}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}},a.prototype.sendDominantSpeakerEvent=function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.callsStatsInstances.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0)r.value.sendDominantSpeakerEvent()}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}},a.sendActiveDeviceListEvent=function(e){var t=a._getAllCallStatsInstances();if(t.size){var n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value;l.a.sendActiveDeviceListEvent(e,c)}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}else l.a.sendActiveDeviceListEvent(e,null)},a.prototype.associateStreamWithVideoTag=function(e,t,n,r,i,o){var a=this.callsStatsInstances.get(e.id);a&&a.associateStreamWithVideoTag(t,n,r,i,o)},a.sendGetUserMediaFailed=function(e){var t=e instanceof g.a?o(e):e,n=a._getAllCallStatsInstances();if(n.size){var r=!0,i=!1,s=void 0;try{for(var c,u=n[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var d=c.value;l.a.sendGetUserMediaFailed(t,d)}}catch(e){i=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw s}}}else l.a.sendGetUserMediaFailed(t,null)},a.prototype.sendCreateOfferFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendCreateOfferFailed(e)},a.prototype.sendCreateAnswerFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendCreateAnswerFailed(e)},a.prototype.sendSetLocalDescFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendSetLocalDescFailed(e)},a.prototype.sendSetRemoteDescFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendSetRemoteDescFailed(e)},a.prototype.sendAddIceCandidateFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendAddIceCandidateFailed(e)},a.sendLog=function(e){var t=new Set,n=!0,r=!1,i=void 0;try{for(var o,s=a.instances[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value;c.callsStatsInstances.size&&t.add(c.callsStatsInstances.values().next().value)}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}if(t.size){var u=!0,d=!1,p=void 0;try{for(var h,f=t[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var m=h.value;l.a.sendApplicationLog(e,m)}}catch(e){d=!0,p=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw p}}}else l.a.sendApplicationLog(e,null)},a.prototype.sendFeedback=function(e,t){l.a.sendFeedback(this._getCallStatsConfID(),e,t),a.analytics.sendEvent("feedback.rating",{value:e,detailed:t})},a.LOCAL_JID=n(91).LOCAL_JID,a.reportGlobalError=function(e){e instanceof g.a&&e.gum?a.sendGetUserMediaFailed(e):a.sendLog(e)},a.sendEventToAll=function(e,t){this.analytics.sendEvent(e,t),a.sendLog(JSON.stringify({name:e,data:t}))}}).call(t,"modules/statistics/statistics.js")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"AUTH_STATUS_CHANGED",function(){return r}),n.d(t,"AVAILABLE_DEVICES_CHANGED",function(){return i}),n.d(t,"AVATAR_CHANGED",function(){return o}),n.d(t,"BEFORE_STATISTICS_DISPOSED",function(){return a}),n.d(t,"CONFERENCE_ERROR",function(){return s}),n.d(t,"CONFERENCE_FAILED",function(){return c}),n.d(t,"CONFERENCE_JOINED",function(){return u}),n.d(t,"CONFERENCE_LEFT",function(){return l}),n.d(t,"CONNECTION_INTERRUPTED",function(){return d}),n.d(t,"CONNECTION_RESTORED",function(){return p}),n.d(t,"DATA_CHANNEL_OPENED",function(){return h}),n.d(t,"DISPLAY_NAME_CHANGED",function(){return f}),n.d(t,"DOMINANT_SPEAKER_CHANGED",function(){return m}),n.d(t,"DTMF_SUPPORT_CHANGED",function(){return v}),n.d(t,"ENDPOINT_MESSAGE_RECEIVED",function(){return g}),n.d(t,"JVB121_STATUS",function(){return y}),n.d(t,"KICKED",function(){return b}),n.d(t,"LAST_N_ENDPOINTS_CHANGED",function(){return _}),n.d(t,"LOCK_STATE_CHANGED",function(){return S}),n.d(t,"MESSAGE_RECEIVED",function(){return T}),n.d(t,"PARTICIPANT_CONN_STATUS_CHANGED",function(){return C}),n.d(t,"PARTCIPANT_FEATURES_CHANGED",function(){return E}),n.d(t,"PARTICIPANT_PROPERTY_CHANGED",function(){return w}),n.d(t,"P2P_STATUS",function(){return R}),n.d(t,"PHONE_NUMBER_CHANGED",function(){return k}),n.d(t,"RECORDER_STATE_CHANGED",function(){return I}),n.d(t,"VIDEO_SIP_GW_AVAILABILITY_CHANGED",function(){return P}),n.d(t,"START_MUTED_POLICY_CHANGED",function(){return A}),n.d(t,"STARTED_MUTED",function(){return O}),n.d(t,"SUBJECT_CHANGED",function(){return D}),n.d(t,"SUSPEND_DETECTED",function(){return x}),n.d(t,"TALK_WHILE_MUTED",function(){return N}),n.d(t,"TRACK_ADDED",function(){return L}),n.d(t,"TRACK_AUDIO_LEVEL_CHANGED",function(){return M}),n.d(t,"TRACK_MUTE_CHANGED",function(){return j}),n.d(t,"TRACK_REMOVED",function(){return F}),n.d(t,"TRANSCRIPTION_STATUS_CHANGED",function(){return U}),n.d(t,"USER_JOINED",function(){return H}),n.d(t,"USER_LEFT",function(){return B}),n.d(t,"USER_ROLE_CHANGED",function(){return G}),n.d(t,"USER_STATUS_CHANGED",function(){return J});var r="conference.auth_status_changed",i="conference.availableDevicesChanged",o="conference.avatarChanged",a="conference.beforeStatisticsDisposed",s="conference.error",c="conference.failed",u="conference.joined",l="conference.left",d="conference.connectionInterrupted",p="conference.connectionRestored",h="conference.dataChannelOpened",f="conference.displayNameChanged",m="conference.dominantSpeaker",v="conference.dtmfSupportChanged",g="conference.endpoint_message_received",y="conference.jvb121Status",b="conferenece.kicked",_="conference.lastNEndpointsChanged",S="conference.lock_state_changed",T="conference.messageReceived",C="conference.participant_conn_status_changed",E="conference.partcipant_features_changed",w="conference.participant_property_changed",R="conference.p2pStatus",k="conference.phoneNumberChanged",I="conference.recorderStateChanged",P="conference.videoSIPGWAvailabilityChanged",A="conference.start_muted_policy_changed",O="conference.started_muted",D="conference.subjectChanged",x="conference.suspendDetected",N="conference.talk_while_muted",L="conference.trackAdded",M="conference.audioLevelsChanged",j="conference.trackMuteChanged",F="conference.trackRemoved",U="conference.transcriptionStatusChanged",H="conference.userJoined",B="conference.userLeft",G="conference.roleChanged",J="conference.statusChanged"},function(e,t){var n={ADD_ICE_CANDIDATE_FAILED:"xmpp.add_ice_candidate_failed",AUDIO_MUTED_BY_FOCUS:"xmpp.audio_muted_by_focus",AUTHENTICATION_REQUIRED:"xmpp.authentication_required",BRIDGE_DOWN:"xmpp.bridge_down",CALL_ACCEPTED:"xmpp.callaccepted.jingle",CALL_INCOMING:"xmpp.callincoming.jingle",CALL_ENDED:"xmpp.callended.jingle",CHAT_ERROR_RECEIVED:"xmpp.chat_error_received",CONFERENCE_SETUP_FAILED:"xmpp.conference_setup_failed",CONNECTION_ESTABLISHED:"xmpp.connection.connected",CONNECTION_FAILED:"xmpp.connection.failed",CONNECTION_INTERRUPTED:"xmpp.connection.interrupted",CONNECTION_RESTORED:"xmpp.connection.restored",CONNECTION_ICE_FAILED:"xmpp.connection.ice.failed",DISPLAY_NAME_CHANGED:"xmpp.display_name_changed",EMUC_ROOM_ADDED:"xmpp.emuc_room_added",EMUC_ROOM_REMOVED:"xmpp.emuc_room_removed",ETHERPAD:"xmpp.etherpad",FOCUS_DISCONNECTED:"xmpp.focus_disconnected",FOCUS_LEFT:"xmpp.focus_left",GRACEFUL_SHUTDOWN:"xmpp.graceful_shutdown",ICE_RESTARTING:"rtc.ice_restarting",JINGLE_ERROR:"xmpp.jingle_error",JINGLE_FATAL_ERROR:"xmpp.jingle_fatal_error",KICKED:"xmpp.kicked",LOCAL_ROLE_CHANGED:"xmpp.localrole_changed",MESSAGE_RECEIVED:"xmpp.message_received",MUC_DESTROYED:"xmpp.muc_destroyed",MUC_JOINED:"xmpp.muc_joined",MUC_MEMBER_JOINED:"xmpp.muc_member_joined",MUC_MEMBER_LEFT:"xmpp.muc_member_left",MUC_LEFT:"xmpp.muc_left",MUC_ROLE_CHANGED:"xmpp.muc_role_changed",MUC_LOCK_CHANGED:"xmpp.muc_lock_changed",PARTICIPANT_AUDIO_MUTED:"xmpp.audio_muted",PARTICIPANT_VIDEO_MUTED:"xmpp.video_muted",PARTICIPANT_VIDEO_TYPE_CHANGED:"xmpp.video_type",PARTCIPANT_FEATURES_CHANGED:"xmpp.partcipant_features_changed",PASSWORD_REQUIRED:"xmpp.password_required",PEERCONNECTION_READY:"xmpp.peerconnection_ready",PHONE_NUMBER_CHANGED:"conference.phoneNumberChanged",PRESENCE_STATUS:"xmpp.presence_status",PROMPT_FOR_LOGIN:"xmpp.prompt_for_login",READY_TO_JOIN:"xmpp.ready_to_join",RECORDER_STATE_CHANGED:"xmpp.recorderStateChanged",REMOTE_STATS:"xmpp.remote_stats",RESERVATION_ERROR:"xmpp.room_reservation_error",ROOM_CONNECT_ERROR:"xmpp.room_connect_error",ROOM_CONNECT_NOT_ALLOWED_ERROR:"xmpp.room_connect_error.not_allowed",ROOM_JOIN_ERROR:"xmpp.room_join_error",ROOM_MAX_USERS_ERROR:"xmpp.room_max_users_error",SENDING_CHAT_MESSAGE:"xmpp.sending_chat_message",SESSION_ACCEPT_TIMEOUT:"xmpp.session_accept_timeout",START_MUTED_FROM_FOCUS:"xmpp.start_muted_from_focus",SUBJECT_CHANGED:"xmpp.subject_changed",SUSPEND_DETECTED:"xmpp.suspend_detected",TRANSCRIPTION_STATUS_CHANGED:"xmpp.transcription_status_changed",TRANSPORT_INFO:"xmpp.transportinfo.jingle",VIDEO_SIP_GW_AVAILABILITY_CHANGED:"xmpp.videoSIPGWAvailabilityChanged",ICE_CONNECTION_STATE_CHANGED:"xmpp.ice_connection_state_changed",JSON_MESSAGE_RECEIVED:"xmmp.json_message_received"};e.exports=n},function(e,t){var n={CREATE_ANSWER_FAILED:"rtc.create_answer_failed",CREATE_OFFER_FAILED:"rtc.create_offer_failed",RTC_READY:"rtc.ready",DATA_CHANNEL_OPEN:"rtc.data_channel_open",ENDPOINT_CONN_STATUS_CHANGED:"rtc.endpoint_conn_status_changed",DOMINANT_SPEAKER_CHANGED:"rtc.dominant_speaker_changed",LASTN_ENDPOINT_CHANGED:"rtc.lastn_endpoint_changed",LASTN_VALUE_CHANGED:"rtc.lastn_value_changed",AVAILABLE_DEVICES_CHANGED:"rtc.available_devices_changed",TRACK_ATTACHED:"rtc.track_attached",REMOTE_TRACK_ADDED:"rtc.remote_track_added",REMOTE_TRACK_MUTE:"rtc.remote_track_mute",REMOTE_TRACK_REMOVED:"rtc.remote_track_removed",REMOTE_TRACK_UNMUTE:"rtc.remote_track_unmute",SET_LOCAL_DESCRIPTION_FAILED:"rtc.set_local_description_failed",SET_REMOTE_DESCRIPTION_FAILED:"rtc.set_remote_description_failed",AUDIO_OUTPUT_DEVICE_CHANGED:"rtc.audio_output_device_changed",DEVICE_LIST_CHANGED:"rtc.device_list_changed",DEVICE_LIST_AVAILABLE:"rtc.device_list_available",ENDPOINT_MESSAGE_RECEIVED:"rtc.endpoint_message_received",LOCAL_UFRAG_CHANGED:"rtc.local_ufrag_changed",REMOTE_UFRAG_CHANGED:"rtc.remote_ufrag_changed"};e.exports=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(14),o=n.n(i),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o.a;r(this,e),this.eventEmitter=t,this.addEventListener=this.on=this.addListener,this.removeEventListener=this.off=this.removeListener}return a(e,[{key:"addListener",value:function(e,t){this.eventEmitter.addListener(e,t)}},{key:"removeListener",value:function(e,t){this.eventEmitter.removeListener(e,t)}}]),e}();t.a=s},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=!0,o=!0,a={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":r(e))+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":r(e))+". Please use a boolean."):(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"===("undefined"==typeof window?"undefined":r(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(e){var t=e&&e.navigator,n={};if(n.browser=null,n.version=null,void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)n.browser="chrome",n.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return n.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n}};e.exports={log:a.log,deprecated:a.deprecated,disableLog:a.disableLog,disableWarnings:a.disableWarnings,extractVersion:a.extractVersion,shimCreateObjectURL:a.shimCreateObjectURL,detectBrowser:a.detectBrowser.bind(a)}},function(e,t,n){"use strict";function r(e,t,n){if("object"===(void 0===e?"undefined":a(e))&&void 0!==e.name)switch(this.gum={error:e,constraints:t,devices:n&&Array.isArray(n)?n.slice(0):void 0},e.name){case"PermissionDeniedError":case"SecurityError":this.name=o.PERMISSION_DENIED,this.message=s[this.name]+(this.gum.devices||[]).join(", ");break;case"DevicesNotFoundError":case"NotFoundError":this.name=o.NOT_FOUND,this.message=s[this.name]+(this.gum.devices||[]).join(", ");break;case"ConstraintNotSatisfiedError":case"OverconstrainedError":var r=e.constraintName||e.constraint;t&&t.video&&(!n||n.indexOf("video")>-1)&&("minWidth"===r||"maxWidth"===r||"minHeight"===r||"maxHeight"===r||"width"===r||"height"===r)?(this.name=o.UNSUPPORTED_RESOLUTION,this.message=s[this.name]+i(r,t)):(this.name=o.CONSTRAINT_FAILED,this.message=s[this.name]+e.constraintName);break;default:this.name=o.GENERAL,this.message=e.message||s[this.name]}else{if("string"!=typeof e)throw new Error("Invalid arguments");s[e]?(this.name=e,this.message=t||s[e]):this.message=e}this.stack=e.stack||(new Error).stack}function i(e,t){if(t&&t.video&&t.video.mandatory)switch(e){case"width":return t.video.mandatory.minWidth;case"height":return t.video.mandatory.minHeight;default:return t.video.mandatory[e]||""}return""}var o=n(15),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s={};s[o.UNSUPPORTED_RESOLUTION]="Video resolution is not supported: ",s[o.FIREFOX_EXTENSION_NEEDED]="Firefox extension is not installed",s[o.CHROME_EXTENSION_INSTALLATION_ERROR]="Failed to install Chrome extension",s[o.CHROME_EXTENSION_USER_GESTURE_REQUIRED]="Failed to install Chrome extension - installations can only be initiated by a user gesture.",s[o.CHROME_EXTENSION_USER_CANCELED]="User canceled Chrome's screen sharing prompt",s[o.CHROME_EXTENSION_GENERIC_ERROR]="Unknown error from Chrome extension",s[o.ELECTRON_DESKTOP_PICKER_ERROR]="Unkown error from desktop picker",s[o.ELECTRON_DESKTOP_PICKER_NOT_FOUND]="Failed to detect desktop picker",s[o.GENERAL]="Generic getUserMedia error",s[o.PERMISSION_DENIED]="User denied permission to use device(s): ",s[o.NOT_FOUND]="Requested device(s) was/were not found: ",s[o.CONSTRAINT_FAILED]="Constraint could not be satisfied: ",s[o.TRACK_IS_DISPOSED]="Track has been already disposed",s[o.TRACK_NO_STREAM_FOUND]="Track does not have an associated Media Stream",s[o.NO_DATA_FROM_SOURCE]="The track has stopped receiving data from it's source",r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,t.a=r},function(e,t,n){"use strict";(function(e){function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var i=n(0),o=(n.n(i),n(19)),a=n.n(o),s=n(1),c=Object(i.getLogger)(e),u={filterSpecialChars:function(e){return e?e.replace(/[\\\/\{,\}\+]/g,""):e},iceparams:function(e,t){var n=null,r=void 0,i=void 0;return(i=u.findLine(e,"a=ice-ufrag:",t))&&(r=u.findLine(e,"a=ice-pwd:",t))&&(n={ufrag:u.parseICEUfrag(i),pwd:u.parseICEPwd(r)}),n},parseICEUfrag:function(e){return e.substring(12)},buildICEUfrag:function(e){return"a=ice-ufrag:"+e},parseICEPwd:function(e){return e.substring(10)},buildICEPwd:function(e){return"a=ice-pwd:"+e},parseMID:function(e){return e.substring(6)},parseMLine:function(e){var t={},n=e.substring(2).split(" ");return t.media=n.shift(),t.port=n.shift(),t.proto=n.shift(),""===n[n.length-1]&&n.pop(),t.fmt=n,t},buildMLine:function(e){return"m="+e.media+" "+e.port+" "+e.proto+" "+e.fmt.join(" ")},parseRTPMap:function(e){var t={},n=e.substring(9).split(" ");return t.id=n.shift(),n=n[0].split("/"),t.name=n.shift(),t.clockrate=n.shift(),t.channels=n.length?n.shift():"1",t},parseSCTPMap:function(e){var t=e.substring(10).split(" ");return[t[0],t[1],t.length>2?t[2]:null]},buildRTPMap:function(e){var t="a=rtpmap:"+e.getAttribute("id")+" "+e.getAttribute("name")+"/"+e.getAttribute("clockrate");return e.getAttribute("channels")&&"1"!==e.getAttribute("channels")&&(t+="/"+e.getAttribute("channels")),t},parseCrypto:function(e){var t={},n=e.substring(9).split(" ");return t.tag=n.shift(),t["crypto-suite"]=n.shift(),t["key-params"]=n.shift(),n.length&&(t["session-params"]=n.join(" ")),t},parseFingerprint:function(e){var t={},n=e.substring(14).split(" ");return t.hash=n.shift(),t.fingerprint=n.shift(),t},parseFmtp:function(e){var t=[],n=e.split(" ");n.shift(),n=n.join(" ").split(";");for(var r=0;r<n.length;r++){for(var i=n[r].split("=")[0];i.length&&" "===i[0];)i=i.substring(1);var o=n[r].split("=")[1];i&&o?t.push({name:i,value:o}):i&&t.push({name:"",value:i})}return t},parseICECandidate:function(e){var t={},n=e.split(" ");t.foundation=n[0].substring(12),t.component=n[1],t.protocol=n[2].toLowerCase(),t.priority=n[3],t.ip=n[4],t.port=n[5],t.type=n[7],t.generation=0;for(var r=8;r<n.length;r+=2)switch(n[r]){case"raddr":t["rel-addr"]=n[r+1];break;case"rport":t["rel-port"]=n[r+1];break;case"generation":t.generation=n[r+1];break;case"tcptype":t.tcptype=n[r+1];break;default:c.log('parseICECandidate not translating "'+n[r]+'" = "'+n[r+1]+'"')}return t.network="1",t.id=Math.random().toString(36).substr(2,10),t},buildICECandidate:function(e){var t=["a=candidate:"+e.foundation,e.component,e.protocol,e.priority,e.ip,e.port,"typ",e.type].join(" ");switch(t+=" ",e.type){case"srflx":case"prflx":case"relay":e.hasOwnAttribute("rel-addr")&&e.hasOwnAttribute("rel-port")&&(t+="raddr",t+=" ",t+=e["rel-addr"],t+=" ",t+="rport",t+=" ",t+=e["rel-port"],t+=" ")}return e.hasOwnAttribute("tcptype")&&(t+="tcptype",t+=" ",t+=e.tcptype,t+=" "),t+="generation",t+=" ",t+=e.hasOwnAttribute("generation")?e.generation:"0"},parseSSRC:function(e){for(var t={},n=e.split("\r\n"),r=0;r<n.length;r++)if("a=ssrc:"===n[r].substring(0,7)){var i=n[r].indexOf(" ");t[n[r].substr(i+1).split(":",2)[0]]=n[r].substr(i+1).split(":",2)[1]}return t},parseRTCPFB:function(e){var t=e.substr(10).split(" "),n={};return n.pt=t.shift(),n.type=t.shift(),n.params=t,n},parseExtmap:function(e){var t=e.substr(9).split(" "),n={};return n.value=t.shift(),-1===n.value.indexOf("/")?n.direction="both":(n.direction=n.value.substr(n.value.indexOf("/")+1),n.value=n.value.substr(0,n.value.indexOf("/"))),n.uri=t.shift(),n.params=t,n},findLine:function(e,t,n){for(var r=e.split("\r\n"),i=0;i<r.length;i++)if(r[i].substring(0,t.length)===t)return r[i];if(!n)return!1;r=n.split("\r\n");for(var o=0;o<r.length;o++)if(r[o].substring(0,t.length)===t)return r[o];return!1},findLines:function(e,t,n){for(var r=e.split("\r\n"),i=[],o=0;o<r.length;o++)r[o].substring(0,t.length)===t&&i.push(r[o]);if(i.length||!n)return i;r=n.split("\r\n");for(var a=0;a<r.length;a++)r[a].substring(0,t.length)===t&&i.push(r[a]);return i},candidateToJingle:function(e){if(0===e.indexOf("candidate:"))e="a="+e;else if("a=candidate:"!==e.substring(0,12))return c.log("parseCandidate called with a line that is not a candidate line"),c.log(e),null;"\r\n"===e.substring(e.length-2)&&(e=e.substring(0,e.length-2));var t={},n=e.split(" ");if("typ"!==n[6])return c.log("did not find typ in the right place"),c.log(e),null;t.foundation=n[0].substring(12),t.component=n[1],t.protocol=n[2].toLowerCase(),t.priority=n[3],t.ip=n[4],t.port=n[5],t.type=n[7],t.generation="0";for(var r=8;r<n.length;r+=2)switch(n[r]){case"raddr":t["rel-addr"]=n[r+1];break;case"rport":t["rel-port"]=n[r+1];break;case"generation":t.generation=n[r+1];break;case"tcptype":t.tcptype=n[r+1];break;default:c.log('not translating "'+n[r]+'" = "'+n[r+1]+'"')}return t.network="1",t.id=Math.random().toString(36).substr(2,10),t},candidateFromJingle:function(e){var t="a=candidate:";t+=e.getAttribute("foundation"),t+=" ",t+=e.getAttribute("component"),t+=" ";var n=e.getAttribute("protocol");switch(s.a.isFirefox()&&"ssltcp"===n.toLowerCase()&&(n="tcp"),t+=n,t+=" ",t+=e.getAttribute("priority"),t+=" ",t+=e.getAttribute("ip"),t+=" ",t+=e.getAttribute("port"),t+=" ",t+="typ",t+=" "+e.getAttribute("type"),t+=" ",e.getAttribute("type")){case"srflx":case"prflx":case"relay":e.getAttribute("rel-addr")&&e.getAttribute("rel-port")&&(t+="raddr",t+=" ",t+=e.getAttribute("rel-addr"),t+=" ",t+="rport",t+=" ",t+=e.getAttribute("rel-port"),t+=" ")}return"tcp"===n.toLowerCase()&&(t+="tcptype",t+=" ",t+=e.getAttribute("tcptype"),t+=" "),t+="generation",t+=" ",(t+=e.getAttribute("generation")||"0")+"\r\n"},parsePrimaryVideoSsrc:function(e){var t=e.ssrcs.map(function(e){return e.id}).filter(function(e,t,n){return n.indexOf(e)===t}).length,n=e.ssrcGroups&&e.ssrcGroups.length||0;if(!(t>1&&0===n)){var r=null;if(1===t)r=e.ssrcs[0].id;else if(2===t){var i=e.ssrcGroups.find(function(e){return"FID"===e.semantics});i&&(r=i.ssrcs.split(" ")[0])}else if(t>=3){var o=e.ssrcGroups.find(function(e){return"SIM"===e.semantics});o&&(r=o.ssrcs.split(" ")[0])}return r}},generateSsrc:function(){return a.a.randomInt(1,4294967295)},getSsrcAttribute:function(e,t,n){for(var r=0;r<e.ssrcs.length;++r){var i=e.ssrcs[r];if(i.id===t&&i.attribute===n)return i.value}},parseGroupSsrcs:function(e){return e.ssrcs.split(" ").map(function(e){return parseInt(e,10)})},getMedia:function(e,t){return e.media.find(function(e){return e.type===t})},getUfrag:function(e){var t=e.split("\n").filter(function(e){return e.startsWith("a=ice-ufrag:")});if(t.length>0)return t[0].substr("a=ice-ufrag:".length)},preferVideoCodec:function(e,t){var n=null;if(t){for(var r=0;r<e.rtp.length;++r){var i=e.rtp[r];if(i.codec&&i.codec.toLowerCase()===t.toLowerCase()){n=i.payload;break}}if(n){var o=e.payloads.toString().split(" ").map(function(e){return parseInt(e,10)}),a=o.indexOf(n);o.splice(a,1),o.unshift(n),e.payloads=o.join(" ")}}},stripVideoCodec:function(e,t){if(t){var n=[],i=!0,o=!1,a=void 0;try{for(var s,c=e.rtp[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;u.codec&&u.codec.toLowerCase()===t.toLowerCase()&&n.push(u.payload)}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}if(n.length>0){var l=n.map(function(e){return"apt="+e}),d=e.fmtp.filter(function(e){return-1!==l.indexOf(e.config)});n.push.apply(n,r(d.map(function(e){return e.payload})));var p=e.payloads.toString().split(" ").map(Number),h=p.filter(function(e){return-1===n.indexOf(e)});0===h.length?(e.port=0,e.direction="inactive",e.payloads="*"):e.payloads=h.join(" "),e.rtp=e.rtp.filter(function(e){return-1!==h.indexOf(e.payload)}),e.fmtp=e.fmtp.filter(function(e){return-1!==h.indexOf(e.payload)}),e.rtcpFb&&(e.rtcpFb=e.rtcpFb.filter(function(e){return-1!==h.indexOf(e.payload)}))}}}};t.a=u}).call(t,"modules/xmpp/SDPUtil.js")},function(e,t,n){var r=n(124),i=n(125);t.write=i,t.parse=r.parse,t.parseFmtpConfig=r.parseFmtpConfig,t.parseParams=r.parseParams,t.parsePayloads=r.parsePayloads,t.parseRemoteCandidates=r.parseRemoteCandidates,t.parseImageAttributes=r.parseImageAttributes,t.parseSimulcastStreamList=r.parseSimulcastStreamList},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"===(void 0===e?"undefined":s(e))&&null!==e}function a(e){return void 0===e}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,s,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],a(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(o(n))for(s=Array.prototype.slice.call(arguments,1),u=n.slice(),i=u.length,c=0;c<i;c++)u[c].apply(this,s);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,a,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],a=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){i=s;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"CHROME_EXTENSION_GENERIC_ERROR",function(){return r}),n.d(t,"CHROME_EXTENSION_INSTALLATION_ERROR",function(){return i}),n.d(t,"CHROME_EXTENSION_USER_GESTURE_REQUIRED",function(){return o}),n.d(t,"CHROME_EXTENSION_USER_CANCELED",function(){return a}),n.d(t,"CONSTRAINT_FAILED",function(){return s}),n.d(t,"ELECTRON_DESKTOP_PICKER_ERROR",function(){return c}),n.d(t,"ELECTRON_DESKTOP_PICKER_NOT_FOUND",function(){return u}),n.d(t,"FIREFOX_EXTENSION_NEEDED",function(){return l}),n.d(t,"GENERAL",function(){return d}),n.d(t,"NOT_FOUND",function(){return p}),n.d(t,"PERMISSION_DENIED",function(){return h}),n.d(t,"TRACK_IS_DISPOSED",function(){return f}),n.d(t,"TRACK_NO_STREAM_FOUND",function(){return m}),n.d(t,"UNSUPPORTED_RESOLUTION",function(){return v}),n.d(t,"NO_DATA_FROM_SOURCE",function(){return g});var r="gum.chrome_extension_generic_error",i="gum.chrome_extension_installation_error",o="gum.chrome_extension_user_gesture_required",a="gum.chrome_extension_user_canceled",s="gum.constraint_failed",c="gum.electron_desktop_picker_error",u="gum.electron_desktop_picker_not_found",l="gum.firefox_extension_needed",d="gum.general",p="gum.not_found",h="gum.permission_denied",f="track.track_is_disposed",m="track.no_stream_found",v="gum.unsupported_resolution",g="track.no_data_from_source"},function(e,t){var n={CAMERA:"camera",DESKTOP:"desktop"};e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"LOCAL_TRACK_STOPPED",function(){return r}),n.d(t,"TRACK_AUDIO_LEVEL_CHANGED",function(){return i}),n.d(t,"TRACK_AUDIO_OUTPUT_CHANGED",function(){return o}),n.d(t,"TRACK_MUTE_CHANGED",function(){return a}),n.d(t,"TRACK_VIDEOTYPE_CHANGED",function(){return s}),n.d(t,"NO_DATA_FROM_SOURCE",function(){return c});var r="track.stopped",i="track.audioLevelsChanged",o="track.audioOutputChanged",a="track.trackMuteChanged",s="track.videoTypeChanged",c="track.no_data_from_source"},function(e,t,n){"use strict";(function(e){function r(){var e=l.a.generateUsername();return d.log("generated callstats uid",e),e}function i(){var e=a();return d.log("generated id",e),e}function o(){var e=void 0;try{e=(window||this).localStorage}catch(e){d.error(e)}return e}function a(){return s()+s()+s()+s()}function s(){return(Math.random().toString(16)+"000000000").substr(2,8)}var c=n(0),u=(n.n(c),n(67)),l=n.n(u),d=Object(c.getLogger)(e),p=void 0,h=void 0;t.a={get callStatsUserName(){if(!p){var e=o();e&&(p=e.getItem("callStatsUserName")),p||(p=r(),e&&e.setItem("callStatsUserName",p))}return p},get machineId(){if(!h){var e=o();e&&(h=e.getItem("jitsiMeetId")),h||(h=i(),e&&e.setItem("jitsiMeetId",h))}return h},get sessionId(){var e=o();return e?e.getItem("sessionId"):void 0},set sessionId(e){var t=o();t&&(e?t.setItem("sessionId",e):t.removeItem("sessionId"))}}}).call(t,"modules/settings/Settings.js")},function(e,t){function n(e,t){return Math.floor(Math.random()*(t-e+1))+e}function r(e){return e[n(0,e.length-1)]}function i(e){for(var t="",n=0;n<e;n+=1)t+=r(o);return t}var o="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",a={randomHexDigit:function(){return r("0123456789abcdef")},randomHexString:function(e){for(var t="";e--;)t+=this.randomHexDigit();return t},randomElement:r,randomAlphanumStr:i,randomInt:n};e.exports=a},function(e,t){var n,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":r(window))&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(){return window&&window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()}Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrent=r},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){function e(){o(this,e)}return e}();return function(e){function t(){var e;o(this,t);for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];var s=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i)));return s.connection=null,s}return i(t,e),c(t,[{key:"init",value:function(e){this.connection=e}}]),t}(e)}n.d(t,"a",function(){return u});var s=n(9),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.b=a();var u=a(s.a)},function(e,t,n){"use strict";function r(){var e=i.browserName.chrome,t=null,n=null,r=null,o=i.codeBaseType.chrome;if(window&&(!window.navigator||!window.navigator.userAgent||window.csioReactNative))return window&&window.csioGetOsName&&(t=window.csioGetOsName()),window&&window.csioGetOsVer&&(n=window.csioGetOsVer()),window&&window.csioReactNative&&(r="react-native"),{browserName:e,codeBase:o,os:t,osVersion:n,userAgent:r};var a=(r=navigator.userAgent).toLowerCase(),s=navigator.appVersion,c=""+parseFloat(navigator.appVersion),u=void 0;-1!==(u=a.indexOf("opera"))?(e=i.browserName.opera,c=a.substring(u+6),-1!==(u=a.indexOf("Version"))&&(c=a.substring(u+8)),o=i.codeBaseType.chrome):-1!==(u=a.indexOf("opr"))?(e=i.browserName.opera,c=a.substring(u+4),-1!==(u=a.indexOf("Version"))&&(c=a.substring(u+8)),o=i.codeBaseType.chrome):-1!==(u=a.indexOf("msie"))?(e=i.browserName.msie,c=a.substring(u+5),o=i.codeBaseType.chrome):-1!==(u=a.indexOf("edge"))?(e=i.browserName.edge,c=a.substring(u+5),o=i.codeBaseType.edge):-1!==(u=a.indexOf("chrome"))?(e=i.browserName.chrome,c=a.substring(u+7),o=i.codeBaseType.chrome):-1!==(u=a.indexOf("safari"))?(e=i.browserName.safari,c=a.substring(u+7),-1!==(u=a.indexOf("Version"))&&(c=a.substring(u+8)),o=i.codeBaseType.chrome):-1!==(u=a.indexOf("firefox"))?(e=i.browserName.firefox,c=a.substring(u+8),o=i.codeBaseType.firefox):-1!==(u=a.indexOf("trident"))&&(e=i.browserName.msie,u=a.indexOf("rv"),c=a.substring(u+3,u+7),o=i.codeBaseType.chrome);var l=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}],d=void 0,p=void 0;for(d in l)if(l.hasOwnProperty(d)&&(p=l[d]).r.test(a)){t=p.s;break}switch(t&&/Windows/.test(t)&&(n=/Windows (.*)/.exec(t)[1],t=i.osName.windows),t){case i.osName.mac:n=/mac os x (10[\.\_\d]+)/.exec(a)[1];break;case i.osName.android:n=/android ([\.\_\d]+)/.exec(a)[1];break;case i.osName.ios:n=(n=/os (\d+)_(\d+)_?(\d+)?/.exec(s))[1]+"."+n[2]+"."+(0|n[3])}return{browserName:e,browserVersion:c.toString(),os:t,osVersion:n,codeBase:o,userAgent:r}}Object.defineProperty(t,"__esModule",{value:!0}),t.detect=r;var i=t.Constants={codeBaseType:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",plugin:"Plugin"},browserName:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",msie:"Microsoft Internet Explorer",safari:"Safari"},osName:{windows:"Windows",mac:"Mac OS X",android:"Android",ios:"iOS"}}},function(e,t,n){(function(n,r,i){var o,a,s,c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n){"object"==c(t)&&void 0!==e?e.exports=n():(a=[],o=n,void 0!==(s="function"==typeof o?o.apply(t,a):o)&&(e.exports=s))}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof _dereq_&&_dereq_;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return i(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof _dereq_&&_dereq_,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";t.exports=function(e){function t(e){var t=new n(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var n=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,r){"use strict";function i(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new l(16),this._normalQueue=new l(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=u}function o(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function a(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function s(e){this._normalQueue._pushOne(e),this._queueTick()}var c;try{throw new Error}catch(e){c=e}var u=e("./schedule"),l=e("./queue"),d=e("./util");i.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},i.prototype.hasCustomScheduler=function(){return this._customScheduler},i.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},i.prototype.disableTrampolineIfNecessary=function(){d.hasDevTools&&(this._trampolineEnabled=!1)},i.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},i.prototype.fatalError=function(e,t){t?(n.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),n.exit(2)):this.throwLater(e)},i.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},d.hasDevTools?(i.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?o.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},i.prototype.invoke=function(e,t,n){this._trampolineEnabled?a.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},i.prototype.settlePromises=function(e){this._trampolineEnabled?s.call(this,e):this._schedule(function(){e._settlePromises()})}):(i.prototype.invokeLater=o,i.prototype.invoke=a,i.prototype.settlePromises=s),i.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var n=e.shift(),r=e.shift();t.call(n,r)}else t._settlePromises()}},i.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},i.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},i.prototype._reset=function(){this._isTickUsed=!1},t.exports=i,t.exports.firstLineError=c},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){var i=!1,o=function(e,t){this._reject(t)},a=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},s=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},c=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var u=n(o),l=new e(t);l._propagateFrom(this,1);var d=this._target();if(l._setBoundTo(u),u instanceof e){var p={promiseRejectionQueued:!1,promise:l,target:d,bindingPromise:u};d._then(t,a,void 0,l,p),u._then(s,c,void 0,l,p),l._setOnCancel(u)}else l._resolveCallback(d);return l},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,n){return e.resolve(n).bind(t)}}},{}],4:[function(e,t,n){"use strict";function r(){try{Promise===o&&(Promise=i)}catch(e){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=e("./promise")();o.noConflict=r,t.exports=o},{"./promise":22}],5:[function(e,t,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}t.exports=function(t){function n(e,n){var r;if(null!=e&&(r=e[n]),"function"!=typeof r){var i="Object "+s.classString(e)+" has no method '"+s.toString(n)+"'";throw new t.TypeError(i)}return r}function r(e){return n(e,this.pop()).apply(e,this)}function i(e){return e[this]}function o(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var a,s=e("./util"),c=s.canEvaluate;s.isIdentifier,t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(r,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t;if("number"==typeof e)t=o;else if(c){var n=a(e);t=null!==n?n:i}else t=i;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){var o=e("./util"),a=o.tryCatch,s=o.errorObj,c=t._async;t.prototype.break=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),c.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var r=a(e).call(this._boundValue());r===s&&(this._attachExtraTrace(r.e),c.throwLater(r.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),c.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,n){"use strict";t.exports=function(t){function n(e,n,s){return function(c){var u=s._boundValue();e:for(var l=0;l<e.length;++l){var d=e[l];if(d===Error||null!=d&&d.prototype instanceof Error){if(c instanceof d)return o(n).call(u,c)}else if("function"==typeof d){var p=o(d).call(u,c);if(p===a)return p;if(p)return o(n).call(u,c)}else if(r.isObject(c)){for(var h=i(d),f=0;f<h.length;++f){var m=h[f];if(d[m]!=c[m])continue e}return o(n).call(u,c)}}return t}}var r=e("./util"),i=e("./es5").keys,o=r.tryCatch,a=r.errorObj;return n}},{"./es5":13,"./util":36}],8:[function(e,t,n){"use strict";t.exports=function(e){function t(){this._trace=new t.CapturedTrace(r())}function n(){if(i)return new t}function r(){var e=o.length-1;if(e>=0)return o[e]}var i=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=n,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var n=e.prototype._pushContext,o=e.prototype._popContext,a=e._peekContext,s=e.prototype._peekContext,c=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=n,e.prototype._popContext=o,e._peekContext=a,e.prototype._peekContext=s,e.prototype._promiseCreated=c,i=!1},i=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=r,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(e,t,r){"use strict";t.exports=function(t,r){function i(e,t){return{promise:t}}function o(){return!1}function a(e,t,n){var r=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+H.toString(e));r._attachCancellationCallback(e)})}catch(e){return e}}function s(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?H.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function u(){return this._onCancelField}function l(e){this._onCancelField=e}function d(){this._cancellationParent=void 0,this._onCancelField=void 0}function p(e,t){if(0!=(1&t)){this._cancellationParent=e;var n=e._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function h(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function f(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function m(){this._trace=new x(this._peekContext())}function v(e,t){if(B(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=w(e);H.notEnumerableProp(e,"stack",r.message+"\n"+r.stack.join("\n")),H.notEnumerableProp(e,"__stackCleaned__",!0)}}}function g(e,t,n,r,i){if(void 0===e&&null!==t&&X){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",a="";if(t._trace){for(var s=t._trace.stack.split("\n"),c=C(s),u=c.length-1;u>=0;--u){var l=c[u];if(!J.test(l)){var d=l.match(V);d&&(o="at "+d[1]+":"+d[2]+":"+d[3]+" ");break}}if(c.length>0)for(var p=c[0],u=0;u<s.length;++u)if(s[u]===p){u>0&&(a="\n"+s[u-1]);break}}var h="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+a;r._warn(h,!0,t)}}function y(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),b(n)}function b(e,n,r){if(se.warnings){var i,o=new U(e);if(n)r._attachExtraTrace(o);else if(se.longStackTraces&&(i=t._peekContext()))i.attachExtraTrace(o);else{var a=w(o);o.stack=a.message+"\n"+a.stack.join("\n")}ne("warning",o)||R(o,"",!0)}}function _(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}function S(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function T(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],i=t.length-1,o=t[i],a=-1,s=r.length-1;s>=0;--s)if(r[s]===o){a=s;break}for(var s=a;s>=0;--s){var c=r[s];if(t[i]!==c)break;t.pop(),i--}t=r}}function C(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||W.test(r),o=i&&ie(r);i&&!o&&(K&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function E(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||W.test(r))break}return n>0&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}function w(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&t.length>0?E(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:C(t)}}function R(e,t,n){if("undefined"!=typeof console){var r;if(H.isObject(e)){var i=e.stack;r=t+q(i,e)}else r=t+String(e);"function"==typeof M?M(r,n):"function"!=typeof console.log&&"object"!==c(console.log)||console.log(r)}}function k(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){F.throwLater(e)}"unhandledRejection"===e?ne(e,n,r)||i||R(n,"Unhandled rejection "):ne(e,r)}function I(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{if(t=e&&"function"==typeof e.toString?e.toString():H.toString(e),/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+P(t)+">, no stack trace)"}function P(e){return e.length<41?e:e.substr(0,38)+"..."}function A(){return"function"==typeof ae}function O(e){var t=e.match(oe);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function D(e,t){if(A()){for(var n,r,i=e.stack.split("\n"),o=t.stack.split("\n"),a=-1,s=-1,c=0;c<i.length;++c){var u=O(i[c]);if(u){n=u.fileName,a=u.line;break}}for(var c=0;c<o.length;++c){var u=O(o[c]);if(u){r=u.fileName,s=u.line;break}}a<0||s<0||!n||!r||n!==r||a>=s||(ie=function(e){if(G.test(e))return!0;var t=O(e);return!!(t&&t.fileName===n&&a<=t.line&&t.line<=s)})}}function x(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);ae(this,x),t>32&&this.uncycle()}var N,L,M,j=t._getDomain,F=t._async,U=e("./errors").Warning,H=e("./util"),B=H.canAttachTrace,G=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,J=/\((?:timers\.js):\d+:\d+\)/,V=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,W=null,q=null,K=!1,z=!(0==H.env("BLUEBIRD_DEBUG")),$=!(0==H.env("BLUEBIRD_WARNINGS")||!z&&!H.env("BLUEBIRD_WARNINGS")),Q=!(0==H.env("BLUEBIRD_LONG_STACK_TRACES")||!z&&!H.env("BLUEBIRD_LONG_STACK_TRACES")),X=0!=H.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&($||!!H.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var e=this;setTimeout(function(){e._notifyUnhandledRejection()},1)}},t.prototype._notifyUnhandledRejectionIsHandled=function(){k("rejectionHandled",N,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),k("unhandledRejection",L,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(e,t,n){return b(e,t,n||this)},t.onPossiblyUnhandledRejection=function(e){var t=j();L="function"==typeof e?null===t?e:H.domainBind(t,e):void 0},t.onUnhandledRejectionHandled=function(e){var t=j();N="function"==typeof e?null===t?e:H.domainBind(t,e):void 0};var Y=function(){};t.longStackTraces=function(){if(F.haveItemsQueued()&&!se.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!se.longStackTraces&&A()){var e=t.prototype._captureStackTrace,n=t.prototype._attachExtraTrace;se.longStackTraces=!0,Y=function(){if(F.haveItemsQueued()&&!se.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=n,r.deactivateLongStackTraces(),F.enableTrampoline(),se.longStackTraces=!1},t.prototype._captureStackTrace=m,t.prototype._attachExtraTrace=v,r.activateLongStackTraces(),F.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return se.longStackTraces&&A()};var Z=function(){try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return H.global.dispatchEvent(e),function(e,t){var n=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!H.global.dispatchEvent(n)}}if("function"==typeof Event){var e=new Event("CustomEvent");return H.global.dispatchEvent(e),function(e,t){var n=new Event(e.toLowerCase(),{cancelable:!0});return n.detail=t,!H.global.dispatchEvent(n)}}var e=document.createEvent("CustomEvent");return e.initCustomEvent("testingtheevent",!1,!0,{}),H.global.dispatchEvent(e),function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e.toLowerCase(),!1,!0,t),!H.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),ee=function(){return H.isNode?function(){return n.emit.apply(n,arguments)}:H.global?function(e){var t="on"+e.toLowerCase(),n=H.global[t];return!!n&&(n.apply(H.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),te={promiseCreated:i,promiseFulfilled:i,promiseRejected:i,promiseResolved:i,promiseCancelled:i,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:i},ne=function(e){var t=!1;try{t=ee.apply(null,arguments)}catch(e){F.throwLater(e),t=!0}var n=!1;try{n=Z(e,te[e].apply(null,arguments))}catch(e){F.throwLater(e),n=!0}return n||t};t.config=function(e){if(e=Object(e),"longStackTraces"in e&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&Y()),"warnings"in e){var n=e.warnings;se.warnings=!!n,X=se.warnings,H.isObject(n)&&"wForgottenReturn"in n&&(X=!!n.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!se.cancellation){if(F.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=d,t.prototype._propagateFrom=p,t.prototype._onCancel=u,t.prototype._setOnCancel=l,t.prototype._attachCancellationCallback=s,t.prototype._execute=a,re=p,se.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!se.monitoring?(se.monitoring=!0,t.prototype._fireEvent=ne):!e.monitoring&&se.monitoring&&(se.monitoring=!1,t.prototype._fireEvent=o)),t},t.prototype._fireEvent=o,t.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(e){},t.prototype._attachCancellationCallback=function(e){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(e,t){};var re=h,ie=function(){return!1},oe=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;H.inherits(x,Error),r.CapturedTrace=x,x.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;e=this._length=r;for(var r=e-1;r>=0;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(var r=0;r<e;++r){var a=t[r].stack,s=n[a];if(void 0!==s&&s!==r){s>0&&(t[s-1]._parent=void 0,t[s-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var c=r>0?t[r-1]:this;s<e-1?(c._parent=t[s+1],c._parent.uncycle(),c._length=c._parent._length+1):(c._parent=void 0,c._length=1);for(var u=c._length+1,l=r-2;l>=0;--l)t[l]._length=u,u++;return}}}},x.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=w(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(C(i.stack.split("\n"))),i=i._parent;T(r),S(r),H.notEnumerableProp(e,"stack",_(n,r)),H.notEnumerableProp(e,"__stackCleaned__",!0)}};var ae=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():I(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,W=e,q=t;var n=Error.captureStackTrace;return ie=function(e){return G.test(e)},function(e,t){Error.stackTraceLimit+=6,n(e,t),Error.stackTraceLimit-=6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return W=/@/,q=t,K=!0,function(e){e.stack=(new Error).stack};var i;try{throw new Error}catch(e){i="stack"in e}return"stack"in r||!i||"number"!=typeof Error.stackTraceLimit?(q=function(e,t){return"string"==typeof e?e:"object"!==(void 0===t?"undefined":c(t))&&"function"!=typeof t||void 0===t.name||void 0===t.message?I(t):t.toString()},null):(W=e,q=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(M=function(e){console.warn(e)},H.isNode&&n.stderr.isTTY?M=function(e,t){var n=t?"[33m":"[31m";console.warn(n+e+"[0m\n")}:H.isNode||"string"!=typeof(new Error).stack||(M=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var se={warnings:$,longStackTraces:!1,cancellation:!1,monitoring:!1};return Q&&t.longStackTraces(),{longStackTraces:function(){return se.longStackTraces},warnings:function(){return se.warnings},cancellation:function(){return se.cancellation},monitoring:function(){return se.monitoring},propagateFromFunction:function(){return re},boundValueFunction:function(){return f},checkForgottenReturns:g,setBounds:D,warn:b,deprecated:y,CapturedTrace:x,fireDomEvent:Z,fireGlobalEvent:ee}}},{"./errors":12,"./util":36}],10:[function(e,t,n){"use strict";t.exports=function(e){function t(){return this.value}function n(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(n){return n instanceof e&&n.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:n},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(n,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:e},void 0);var t=arguments[1],r=function(){throw t};return this.caught(e,r)},e.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof e&&n.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:n},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();var i=function(){return r};return this.caught(n,i)}}},{}],11:[function(e,t,n){"use strict";t.exports=function(e,t){function n(){return o(this)}function r(e,n){return i(e,n,t,t)}var i=e.reduce,o=e.all;e.prototype.each=function(e){return i(this,e,t,0)._then(n,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return i(this,e,t,t)},e.each=function(e,r){return i(e,r,t,0)._then(n,void 0,void 0,e,void 0)},e.mapSeries=r}},{}],12:[function(e,t,n){"use strict";function r(e,t){function n(r){if(!(this instanceof n))return new n(r);d(this,"message","string"==typeof r?r:t),d(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return l(n,Error),n}function i(e){if(!(this instanceof i))return new i(e);d(this,"name","OperationalError"),d(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(d(this,"message",e.message),d(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var o,a,s=e("./es5"),c=s.freeze,u=e("./util"),l=u.inherits,d=u.notEnumerableProp,p=r("Warning","warning"),h=r("CancellationError","cancellation error"),f=r("TimeoutError","timeout error"),m=r("AggregateError","aggregate error");try{o=TypeError,a=RangeError}catch(e){o=r("TypeError","type error"),a=r("RangeError","range error")}for(var v="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),g=0;g<v.length;++g)"function"==typeof Array.prototype[v[g]]&&(m.prototype[v[g]]=Array.prototype[v[g]]);s.defineProperty(m.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),m.prototype.isOperational=!0;var y=0;m.prototype.toString=function(){var e=Array(4*y+1).join(" "),t="\n"+e+"AggregateError of:\n";y++,e=Array(4*y+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];r=i.join("\n"),t+=r+"\n"}return y--,t},l(i,Error);var b=Error.__BluebirdErrorTypes__;b||(b=c({CancellationError:h,TimeoutError:f,OperationalError:i,RejectionError:i,AggregateError:m}),s.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:o,RangeError:a,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:p}},{"./es5":13,"./util":36}],13:[function(e,t,n){var r=function(){"use strict";return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,a={}.constructor.prototype,s=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t},c=function(e,t){return{value:e[t]}},u=function(e,t,n){return e[t]=n.value,e},l=function(e){return e},d=function(e){try{return Object(e).constructor.prototype}catch(e){return a}},p=function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}};t.exports={isArray:p,keys:s,names:s,defineProperty:u,getDescriptor:c,freeze:l,getPrototypeOf:d,isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,n){"use strict";t.exports=function(e,t){var n=e.map;e.prototype.filter=function(e,r){return n(this,e,r,t)},e.filter=function(e,r,i){return n(e,r,i,t)}}},{}],15:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function o(e){this.finallyHandler=e}function a(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function s(){return u.call(this,this.promise._target()._settledValue())}function c(e){if(!a(this,e))return p.e=e,p}function u(e){var i=this.promise,u=this.handler;if(!this.called){this.called=!0;var l=this.isFinallyHandler()?u.call(i._boundValue()):u.call(i._boundValue(),e);if(l===r)return l;if(void 0!==l){i._setReturnedNonUndefined();var h=n(l,i);if(h instanceof t){if(null!=this.cancelPromise){if(h._isCancelled()){var f=new d("late cancellation observer");return i._attachExtraTrace(f),p.e=f,p}h.isPending()&&h._attachCancellationCallback(new o(this))}return h._then(s,c,void 0,this,void 0)}}}return i.isRejected()?(a(this),p.e=e,p):(a(this),e)}var l=e("./util"),d=t.CancellationError,p=l.errorObj,h=e("./catch_filter")(r);return i.prototype.isFinallyHandler=function(){return 0===this.type},o.prototype._resultCancelled=function(){a(this.finallyHandler)},t.prototype._passThrough=function(e,t,n,r){return"function"!=typeof e?this.then():this._then(n,r,void 0,new i(this,t,e),void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThrough(e,0,u,u)},t.prototype.tap=function(e){return this._passThrough(e,1,u)},t.prototype.tapCatch=function(e){var n=arguments.length;if(1===n)return this._passThrough(e,1,void 0,u);var r,i=new Array(n-1),o=0;for(r=0;r<n-1;++r){var a=arguments[r];if(!l.isObject(a))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+l.classString(a)));i[o++]=a}i.length=o;var s=arguments[r];return this._passThrough(h(i,s,this),1,void 0,u)},i}},{"./catch_filter":7,"./util":36}],16:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){function s(e,n,r){for(var o=0;o<n.length;++o){r._pushContext();var a=h(n[o])(e);if(r._popContext(),a===p){r._pushContext();var s=t.reject(p.e);return r._popContext(),s}var c=i(a,r);if(c instanceof t)return c}return null}function c(e,n,i,o){if(a.cancellation()){var s=new t(r),c=this._finallyPromise=new t(r);this._promise=s.lastly(function(){return c}),s._captureStackTrace(),s._setOnCancel(this)}else(this._promise=new t(r))._captureStackTrace();this._stack=o,this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(f):f,this._yieldedPromise=null,this._cancellationPhase=!1}var u=e("./errors"),l=u.TypeError,d=e("./util"),p=d.errorObj,h=d.tryCatch,f=[];d.inherits(c,o),c.prototype._isResolved=function(){return null===this._promise},c.prototype._cleanup=function(){this._promise=this._generator=null,a.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},c.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=h(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=h(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},c.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=h(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},c.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=h(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},c.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},c.prototype.promise=function(){return this._promise},c.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},c.prototype._continue=function(e){var n=this._promise;if(e===p)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(e.e,!1);var r=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var o=i(r,this._promise);if(!(o instanceof t)&&null===(o=s(o,this._yieldHandlers,this._promise)))return void this._promiseRejected(new l("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(r))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var a=o._bitField;0==(50397184&a)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&a)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&a)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()},t.coroutine=function(e,t){if("function"!=typeof e)throw new l("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(t).yieldHandler,r=c,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new r(void 0,void 0,n,i),a=o.promise();return o._generator=t,o._promiseFulfilled(void 0),a}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new l("expecting a function but got "+d.classString(e));f.push(e)},t.spawn=function(e){if(a.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new c(e,this),i=r.promise();return r._run(t.spawn),i}}},{"./errors":12,"./util":36}],17:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){var s=e("./util");s.canEvaluate,s.tryCatch,s.errorObj,t.join=function(){var e,t=arguments.length-1;if(t>0&&"function"==typeof arguments[t]){e=arguments[t];var r}var i=[].slice.call(arguments);e&&i.pop();var r=new n(i).promise();return void 0!==e?r.spread(e):r}}},{"./util":36}],18:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){function s(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var i=l();this._callback=null===i?t:d.domainBind(i,t),this._preservedValues=r===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],f.invoke(this._asyncInit,this,void 0)}function u(e,n,i,o){if("function"!=typeof n)return r("expecting a function but got "+d.classString(n));var a=0;if(void 0!==i){if("object"!==(void 0===i?"undefined":c(i))||null===i)return t.reject(new TypeError("options argument must be an object but it is "+d.classString(i)));if("number"!=typeof i.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+d.classString(i.concurrency)));a=i.concurrency}return a="number"==typeof a&&isFinite(a)&&a>=1?a:0,new s(e,n,a,o).promise()}var l=t._getDomain,d=e("./util"),p=d.tryCatch,h=d.errorObj,f=t._async;d.inherits(s,n),s.prototype._asyncInit=function(){this._init$(void 0,-2)},s.prototype._init=function(){},s.prototype._promiseFulfilled=function(e,n){var r=this._values,o=this.length(),s=this._preservedValues,c=this._limit;if(n<0){if(n=-1*n-1,r[n]=e,c>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(c>=1&&this._inFlight>=c)return r[n]=e,this._queue.push(n),!1;null!==s&&(s[n]=e);var u=this._promise,l=this._callback,d=u._boundValue();u._pushContext();var f=p(l).call(d,e,n,o),m=u._popContext();if(a.checkForgottenReturns(f,m,null!==s?"Promise.filter":"Promise.map",u),f===h)return this._reject(f.e),!0;var v=i(f,this._promise);if(v instanceof t){v=v._target();var g=v._bitField;if(0==(50397184&g))return c>=1&&this._inFlight++,r[n]=v,v._proxy(this,-1*(n+1)),!1;if(0==(33554432&g))return 0!=(16777216&g)?(this._reject(v._reason()),!0):(this._cancel(),!0);f=v._value()}r[n]=f}return++this._totalResolved>=o&&(null!==s?this._filter(r,s):this._resolve(r),!0)},s.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},s.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},s.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return u(this,e,t,null)},t.map=function(e,t,n,r){return u(e,t,n,r)}}},{"./util":36}],19:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){var a=e("./util"),s=a.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+a.classString(e));return function(){var r=new t(n);r._captureStackTrace(),r._pushContext();var i=s(e).apply(this,arguments),a=r._popContext();return o.checkForgottenReturns(i,a,"Promise.method",r),r._resolveFromSyncValue(i),r}},t.attempt=t.try=function(e){if("function"!=typeof e)return i("expecting a function but got "+a.classString(e));var r=new t(n);r._captureStackTrace(),r._pushContext();var c;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],l=arguments[2];c=a.isArray(u)?s(e).apply(l,u):s(e).call(l,u)}else c=s(e)();var d=r._popContext();return o.checkForgottenReturns(c,d,"Promise.try",r),r._resolveFromSyncValue(c),r},t.prototype._resolveFromSyncValue=function(e){e===a.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,n){"use strict";function r(e){return e instanceof Error&&l.getPrototypeOf(e)===Error.prototype}function i(e){var t;if(r(e)){t=new u(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var n=l.keys(e),i=0;i<n.length;++i){var o=n[i];d.test(o)||(t[o]=e[o])}return t}return a.markAsOriginatingFromRejection(e),e}function o(e,t){return function(n,r){if(null!==e){if(n){var o=i(s(n));e._attachExtraTrace(o),e._reject(o)}else if(t){var a=[].slice.call(arguments,1);e._fulfill(a)}else e._fulfill(r);e=null}}}var a=e("./util"),s=a.maybeWrapAsError,c=e("./errors"),u=c.OperationalError,l=e("./es5"),d=/^(?:name|message|stack|cause)$/;t.exports=o},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,n){"use strict";t.exports=function(t){function n(e,t){var n=this;if(!o.isArray(e))return r.call(n,e,t);var i=s(t).apply(n._boundValue(),[null].concat(e));i===c&&a.throwLater(i.e)}function r(e,t){var n=this,r=n._boundValue(),i=void 0===e?s(t).call(r,null):s(t).call(r,null,e);i===c&&a.throwLater(i.e)}function i(e,t){var n=this;if(!e){var r=new Error(e+"");r.cause=e,e=r}var i=s(t).call(n._boundValue(),e);i===c&&a.throwLater(i.e)}var o=e("./util"),a=t._async,s=o.tryCatch,c=o.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var o=r;void 0!==t&&Object(t).spread&&(o=n),this._then(o,i,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,t,r){"use strict";t.exports=function(){function r(){}function i(e,t){if(null==e||e.constructor!==o)throw new b("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new b("expecting a function but got "+f.classString(t))}function o(e){e!==S&&i(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function a(e){this.promise._resolveCallback(e)}function s(e){this.promise._rejectCallback(e,!1)}function c(e){var t=new o(S);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var u,l=function(){return new b("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},d=function(){return new o.PromiseInspection(this._target())},p=function(e){return o.reject(new b(e))},h={},f=e("./util");u=f.isNode?function(){var e=n.domain;return void 0===e&&(e=null),e}:function(){return null},f.notEnumerableProp(o,"_getDomain",u);var m=e("./es5"),v=e("./async"),g=new v;m.defineProperty(o,"_async",{value:g});var y=e("./errors"),b=o.TypeError=y.TypeError;o.RangeError=y.RangeError;var _=o.CancellationError=y.CancellationError;o.TimeoutError=y.TimeoutError,o.OperationalError=y.OperationalError,o.RejectionError=y.OperationalError,o.AggregateError=y.AggregateError;var S=function(){},T={},C={},E=e("./thenables")(o,S),w=e("./promise_array")(o,S,E,p,r),R=e("./context")(o),k=R.create,I=e("./debuggability")(o,R),P=(I.CapturedTrace,e("./finally")(o,E,C)),A=e("./catch_filter")(C),O=e("./nodeback"),D=f.errorObj,x=f.tryCatch;return o.prototype.toString=function(){return"[object Promise]"},o.prototype.caught=o.prototype.catch=function(e){var t=arguments.length;if(t>1){var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!f.isObject(o))return p("Catch statement predicate: expecting an object but got "+f.classString(o));r[i++]=o}return r.length=i,e=arguments[n],this.then(void 0,A(r,e,this))}return this.then(void 0,e)},o.prototype.reflect=function(){return this._then(d,d,void 0,this,void 0)},o.prototype.then=function(e,t){if(I.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+f.classString(e);arguments.length>1&&(n+=", "+f.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},o.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},o.prototype.spread=function(e){return"function"!=typeof e?p("expecting a function but got "+f.classString(e)):this.all()._then(e,void 0,void 0,T,void 0)},o.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},o.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new w(this).promise()},o.prototype.error=function(e){return this.caught(f.originatesFromRejection,e)},o.getNewLibraryCopy=t.exports,o.is=function(e){return e instanceof o},o.fromNode=o.fromCallback=function(e){var t=new o(S);t._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=x(e)(O(t,n));return r===D&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},o.all=function(e){return new w(e).promise()},o.cast=function(e){var t=E(e);return t instanceof o||(t=new o(S),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},o.resolve=o.fulfilled=o.cast,o.reject=o.rejected=function(e){var t=new o(S);return t._captureStackTrace(),t._rejectCallback(e,!0),t},o.setScheduler=function(e){if("function"!=typeof e)throw new b("expecting a function but got "+f.classString(e));return g.setScheduler(e)},o.prototype._then=function(e,t,n,r,i){var a=void 0!==i,s=a?i:new o(S),c=this._target(),l=c._bitField;a||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&l)?this._boundValue():c===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var d=u();if(0!=(50397184&l)){var p,h,m=c._settlePromiseCtx;0!=(33554432&l)?(h=c._rejectionHandler0,p=e):0!=(16777216&l)?(h=c._fulfillmentHandler0,p=t,c._unsetRejectionIsUnhandled()):(m=c._settlePromiseLateCancellationObserver,h=new _("late cancellation observer"),c._attachExtraTrace(h),p=t),g.invoke(m,c,{handler:null===d?p:"function"==typeof p&&f.domainBind(d,p),promise:s,receiver:r,value:h})}else c._addCallbacks(e,t,s,r,d);return s},o.prototype._length=function(){return 65535&this._bitField},o.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},o.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},o.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},o.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},o.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},o.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},o.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},o.prototype._isFinal=function(){return(4194304&this._bitField)>0},o.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},o.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},o.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},o.prototype._setAsyncGuaranteed=function(){g.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},o.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==h)return void 0===t&&this._isBound()?this._boundValue():t},o.prototype._promiseAt=function(e){return this[4*e-4+2]},o.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},o.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},o.prototype._boundValue=function(){},o.prototype._migrateCallback0=function(e){var t=(e._bitField,e._fulfillmentHandler0),n=e._rejectionHandler0,r=e._promise0,i=e._receiverAt(0);void 0===i&&(i=h),this._addCallbacks(t,n,r,i,null)},o.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=h),this._addCallbacks(n,r,i,o,null)},o.prototype._addCallbacks=function(e,t,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:f.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:f.domainBind(i,t));else{var a=4*o-4;this[a+2]=n,this[a+3]=r,"function"==typeof e&&(this[a+0]=null===i?e:f.domainBind(i,e)),"function"==typeof t&&(this[a+1]=null===i?t:f.domainBind(i,t))}return this._setLength(o+1),o},o.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},o.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(l(),!1);var n=E(e,this);if(!(n instanceof o))return this._fulfill(e);t&&this._propagateFrom(n,2);var r=n._target();if(r===this)return void this._reject(l());var i=r._bitField;if(0==(50397184&i)){var a=this._length();a>0&&r._migrateCallback0(this);for(var s=1;s<a;++s)r._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&i))this._fulfill(r._value());else if(0!=(16777216&i))this._reject(r._reason());else{var c=new _("late cancellation observer");r._attachExtraTrace(c),this._reject(c)}}},o.prototype._rejectCallback=function(e,t,n){var r=f.ensureErrorObject(e),i=r===e;if(!i&&!n&&I.warnings()){var o="a promise was rejected with a non-error: "+f.classString(e);this._warn(o,!0)}this._attachExtraTrace(r,!!t&&i),this._reject(e)},o.prototype._resolveFromExecutor=function(e){if(e!==S){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)});n=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)}},o.prototype._settlePromiseFromHandler=function(e,t,n,r){var i=r._bitField;if(0==(65536&i)){r._pushContext();var o;t===T?n&&"number"==typeof n.length?o=x(e).apply(this._boundValue(),n):(o=D,o.e=new b("cannot .spread() a non-array: "+f.classString(n))):o=x(e).call(t,n);var a=r._popContext();0==(65536&(i=r._bitField))&&(o===C?r._reject(n):o===D?r._rejectCallback(o.e,!1):(I.checkForgottenReturns(o,a,"",r,this),r._resolveCallback(o)))}},o.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},o.prototype._followee=function(){return this._rejectionHandler0},o.prototype._setFollowee=function(e){this._rejectionHandler0=e},o.prototype._settlePromise=function(e,t,n,i){var a=e instanceof o,s=this._bitField,c=0!=(134217728&s);0!=(65536&s)?(a&&e._invokeInternalOnCancel(),n instanceof P&&n.isFinallyHandler()?(n.cancelPromise=e,x(t).call(n,i)===D&&e._reject(D.e)):t===d?e._fulfill(d.call(n)):n instanceof r?n._promiseCancelled(e):a||e instanceof w?e._cancel():n.cancel()):"function"==typeof t?a?(c&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,i,e)):t.call(n,i,e):n instanceof r?n._isResolved()||(0!=(33554432&s)?n._promiseFulfilled(i,e):n._promiseRejected(i,e)):a&&(c&&e._setAsyncGuaranteed(),0!=(33554432&s)?e._fulfill(i):e._reject(i))},o.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,r=e.receiver,i=e.value;"function"==typeof t?n instanceof o?this._settlePromiseFromHandler(t,r,i,n):t.call(r,i,n):n instanceof o&&n._reject(i)},o.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},o.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},o.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},o.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=l();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():g.settlePromises(this))}},o.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return g.fatalError(e,f.isNode);(65535&t)>0?g.settlePromises(this):this._ensurePossibleRejectionHandled()}},o.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},o.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},o.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},o.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},o.defer=o.pending=function(){return I.deprecated("Promise.defer","new Promise"),{promise:new o(S),resolve:a,reject:s}},f.notEnumerableProp(o,"_makeSelfResolutionError",l),e("./method")(o,S,E,p,I),e("./bind")(o,S,E,I),e("./cancel")(o,w,p,I),e("./direct_resolve")(o),e("./synchronous_inspection")(o),e("./join")(o,w,E,S,g,u),o.Promise=o,o.version="3.5.1",e("./map.js")(o,w,p,E,S,I),e("./call_get.js")(o),e("./using.js")(o,p,E,k,S,I),e("./timers.js")(o,S,I),e("./generators.js")(o,p,S,E,r,I),e("./nodeify.js")(o),e("./promisify.js")(o,S),e("./props.js")(o,w,E,p),e("./race.js")(o,S,E,p),e("./reduce.js")(o,w,p,E,S,I),e("./settle.js")(o,w,I),e("./some.js")(o,w,p),e("./filter.js")(o,S),e("./each.js")(o,S),e("./any.js")(o),f.toFastProperties(o),f.toFastProperties(o.prototype),c({a:1}),c({b:2}),c({c:3}),c(1),c(function(){}),c(void 0),c(!1),c(new o(S)),I.setBounds(v.firstLineError,f.lastLineError),o}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){function a(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}function s(e){var r=this._promise=new t(n);e instanceof t&&r._propagateFrom(e,3),r._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var c=e("./util");return c.isArray,c.inherits(s,o),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function e(n,o){var s=r(this._values,this._promise);if(s instanceof t){s=s._target();var u=s._bitField;if(this._values=s,0==(50397184&u))return this._promise._setAsyncGuaranteed(),s._then(e,this._reject,void 0,this,o);if(0==(33554432&u))return 0!=(16777216&u)?this._reject(s._reason()):this._cancel();s=s._value()}if(null===(s=c.asArray(s))){var l=i("expecting an array or an iterable object but got "+c.classString(s)).reason();return void this._promise._rejectCallback(l,!1)}if(0===s.length)return void(-5===o?this._resolveEmptyArray():this._resolve(a(o)));this._iterate(s)},s.prototype._iterate=function(e){var n=this.getActualLength(e.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,a=null,s=0;s<n;++s){var c=r(e[s],i);c instanceof t?(c=c._target(),a=c._bitField):a=null,o?null!==a&&c.suppressUnhandledRejections():null!==a?0==(50397184&a)?(c._proxy(this,s),this._values[s]=c):o=0!=(33554432&a)?this._promiseFulfilled(c._value(),s):0!=(16777216&a)?this._promiseRejected(c._reason(),s):this._promiseCancelled(s):o=this._promiseFulfilled(c,s)}o||i._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},s.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},s.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var n=0;n<e.length;++n)e[n]instanceof t&&e[n].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(e){return e},s}},{"./util":36}],24:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e){return!S.test(e)}function i(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function o(e,t,n){var r=h.getDataPropertyOrDefault(e,t+n,b);return!!r&&i(r)}function a(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i))for(var o=i.replace(n,""),a=0;a<e.length;a+=2)if(e[a]===o)throw new y("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function s(e,t,n,r){for(var s=h.inheritedDataKeys(e),c=[],u=0;u<s.length;++u){var l=s[u],d=e[l],p=r===T||T(l,d,e);"function"!=typeof d||i(d)||o(e,l,t)||!r(l,d,e,p)||c.push(l,d)}return a(c,t,n),c}function u(e,r,i,o,a,s){function c(){var i=r;r===p&&(i=this);var o=new t(n);o._captureStackTrace();var a="string"==typeof l&&this!==u?this[l]:e,c=f(o,s);try{a.apply(i,m(arguments,c))}catch(e){o._rejectCallback(v(e),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var u=function(){return this}(),l=e;return"string"==typeof l&&(e=o),h.notEnumerableProp(c,"__isPromisified__",!0),c}function l(e,t,n,r,i){for(var o=new RegExp(C(t)+"$"),a=s(e,t,o,n),c=0,u=a.length;c<u;c+=2){var l=a[c],d=a[c+1],f=l+t;if(r===E)e[f]=E(l,p,l,d,t,i);else{var m=r(d,function(){return E(l,p,l,d,t,i)});h.notEnumerableProp(m,"__isPromisified__",!0),e[f]=m}}return h.toFastProperties(e),e}function d(e,t,n){return E(e,t,void 0,e,null,n)}var p={},h=e("./util"),f=e("./nodeback"),m=h.withAppended,v=h.maybeWrapAsError,g=h.canEvaluate,y=e("./errors").TypeError,b={__isPromisified__:!0},_=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],S=new RegExp("^(?:"+_.join("|")+")$"),T=function(e){return h.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},C=function(e){return e.replace(/([$])/,"\\$")},E=g?void 0:u;t.promisify=function(e,t){if("function"!=typeof e)throw new y("expecting a function but got "+h.classString(e));if(i(e))return e;t=Object(t);var n=void 0===t.context?p:t.context,o=!!t.multiArgs,a=d(e,n,o);return h.copyDescriptors(e,a,r),a},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!==(void 0===e?"undefined":c(e)))throw new y("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");t=Object(t);var n=!!t.multiArgs,r=t.suffix;"string"!=typeof r&&(r="Async");var i=t.filter;"function"!=typeof i&&(i=T);var o=t.promisifier;if("function"!=typeof o&&(o=E),!h.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=h.inheritedDataKeys(e),s=0;s<a.length;++s){var u=e[a[s]];"constructor"!==a[s]&&h.isClass(u)&&(l(u.prototype,r,i,o,n),l(u,r,i,o,n))}return l(e,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){function o(e){var t,n=!1;if(void 0!==s&&e instanceof s)t=d(e),n=!0;else{var r=l.keys(e),i=r.length;t=new Array(2*i);for(var o=0;o<i;++o){var a=r[o];t[o]=e[a],t[o+i]=a}}this.constructor$(t),this._isMap=n,this._init$(void 0,n?-6:-3)}function a(e){var n,a=r(e);return u(a)?(n=a instanceof t?a._then(t.props,void 0,void 0,void 0,void 0):new o(a).promise(),a instanceof t&&n._propagateFrom(a,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var s,c=e("./util"),u=c.isObject,l=e("./es5");"function"==typeof Map&&(s=Map);var d=function(){function e(e,r){this[t]=e,this[t+n]=r,t++}var t=0,n=0;return function(r){n=r.size,t=0;var i=new Array(2*r.size);return r.forEach(e,i),i}}(),p=function(e){for(var t=new s,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],o=e[r];t.set(i,o)}return t};c.inherits(o,n),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=p(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return a(this)},t.props=function(e){return a(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,n){"use strict";function r(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}function i(e){this._capacity=e,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(e){return this._capacity<e},i.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},i.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=n,this._length=r},i.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,r(this,0,this,t,this._front+this._length&t-1)},t.exports=i},{}],27:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){function o(e,o){var c=r(e);if(c instanceof t)return s(c);if(null===(e=a.asArray(e)))return i("expecting an array or an iterable object but got "+a.classString(e));var u=new t(n);void 0!==o&&u._propagateFrom(o,3);for(var l=u._fulfill,d=u._reject,p=0,h=e.length;p<h;++p){var f=e[p];(void 0!==f||p in e)&&t.cast(f)._then(l,d,void 0,u,null)}return u}var a=e("./util"),s=function(e){return e.then(function(t){return o(t,e)})};t.race=function(e){return o(e,void 0)},t.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){function s(e,n,r,i){this.constructor$(e);var a=p();this._fn=null===a?n:h.domainBind(a,n),void 0!==r&&(r=t.resolve(r),r._attachCancellationCallback(this)),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function c(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function u(e,t,n,i){return"function"!=typeof t?r("expecting a function but got "+h.classString(t)):new s(e,t,n,i).promise()}function l(e){this.accum=e,this.array._gotAccum(e);var n=i(this.value,this.array._promise);return n instanceof t?(this.array._currentCancellable=n,n._then(d,void 0,void 0,this,void 0)):d.call(this,n)}function d(e){var n=this.array,r=n._promise,i=f(n._fn);r._pushContext();var o;(o=void 0!==n._eachValues?i.call(r._boundValue(),e,this.index,this.length):i.call(r._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(n._currentCancellable=o);var s=r._popContext();return a.checkForgottenReturns(o,s,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),o}var p=t._getDomain,h=e("./util"),f=h.tryCatch;h.inherits(s,n),s.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},s.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},s.prototype.shouldCopyValues=function(){return!1},s.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},s.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},s.prototype._iterate=function(e){this._values=e;var n,r,i=e.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=t.resolve(e[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;r<i;++r){var o={accum:null,value:e[r],index:r,length:i,array:this};n=n._then(l,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(c,c,void 0,n,this)},t.prototype.reduce=function(e,t){return u(this,e,t,null)},t.reduce=function(e,t,n,r){return u(e,t,n,r)}}},{"./util":36}],29:[function(e,t,o){"use strict";var a,s=e("./util"),c=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},u=s.getNativePromise();if(s.isNode&&"undefined"==typeof MutationObserver){var l=r.setImmediate,d=n.nextTick;a=s.isRecentNode?function(e){l.call(r,e)}:function(e){d.call(n,e)}}else if("function"==typeof u&&"function"==typeof u.resolve){var p=u.resolve();a=function(e){p.then(e)}}else a="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?void 0!==i?function(e){i(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:c:function(){var e=document.createElement("div"),t={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),n=!1}).observe(r,t);var i=function(){n||(n=!0,r.classList.toggle("foo"))};return function(n){var r=new MutationObserver(function(){r.disconnect(),n()});r.observe(e,t),i()}}();t.exports=a},{"./util":36}],30:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.constructor$(e)}var o=t.PromiseInspection;e("./util").inherits(i,n),i.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(e,t){var n=new o;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},i.prototype._promiseRejected=function(e,t){var n=new o;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},t.settle=function(e){return r.deprecated(".settle()",".reflect()"),new i(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(e,t){if((0|t)!==t||t<0)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new i(e),o=n.promise();return n.setHowMany(t),n.init(),o}var a=e("./util"),s=e("./errors").RangeError,c=e("./errors").AggregateError,u=a.isArray,l={};a.inherits(i,n),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=u(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(e){this._howMany=e},i.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},i.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(l),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new c,t=this.length();t<this._values.length;++t)this._values[t]!==l&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(e){this._values.push(e)},i.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new s(t)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return o(e,t)},t.prototype.some=function(e){return o(this,e)},t._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(e,t,n){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},a=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return a.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return s.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e,r){if(l(e)){if(e instanceof t)return e;var i=o(e);if(i===u){r&&r._pushContext();var c=t.reject(i.e);return r&&r._popContext(),c}if("function"==typeof i){if(a(e)){var c=new t(n);return e._then(c._fulfill,c._reject,void 0,c,null),c}return s(e,i,r)}}return e}function i(e){return e.then}function o(e){try{return i(e)}catch(e){return u.e=e,u}}function a(e){try{return d.call(e,"_promise0")}catch(e){return!1}}function s(e,r,i){function o(e){s&&(s._resolveCallback(e),s=null)}function a(e){s&&(s._rejectCallback(e,d,!0),s=null)}var s=new t(n),l=s;i&&i._pushContext(),s._captureStackTrace(),i&&i._popContext();var d=!0,p=c.tryCatch(r).call(e,o,a);return d=!1,s&&p===u&&(s._rejectCallback(p.e,!0,!0),s=null),l}var c=e("./util"),u=c.errorObj,l=c.isObject,d={}.hasOwnProperty;return r}},{"./util":36}],34:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.handle=e}function o(e){return clearTimeout(this.handle),e}function a(e){throw clearTimeout(this.handle),e}var s=e("./util"),c=t.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var u=function(e){return l(+this).thenReturn(e)},l=t.delay=function(e,o){var a,s;return void 0!==o?(a=t.resolve(o)._then(u,null,null,e,void 0),r.cancellation()&&o instanceof t&&a._setOnCancel(o)):(a=new t(n),s=setTimeout(function(){a._fulfill()},+e),r.cancellation()&&a._setOnCancel(new i(s)),a._captureStackTrace()),a._setAsyncGuaranteed(),a};t.prototype.delay=function(e){return l(e,this)};var d=function(e,t,n){var r;r="string"!=typeof t?t instanceof Error?t:new c("operation timed out"):new c(t),s.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=n&&n.cancel()};t.prototype.timeout=function(e,t){e=+e;var n,s,c=new i(setTimeout(function(){n.isPending()&&d(n,t,s)},e));return r.cancellation()?(s=this.then(),n=s._then(o,a,void 0,c,void 0),n._setOnCancel(c)):n=this._then(o,a,void 0,c,void 0),n}}},{"./util":36}],35:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){function s(e){setTimeout(function(){throw e},0)}function c(e){var t=r(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function u(e,n){function i(){if(a>=u)return l._fulfill();var o=c(e[a++]);if(o instanceof t&&o._isDisposable()){try{o=r(o._getDisposer().tryDispose(n),e.promise)}catch(e){return s(e)}if(o instanceof t)return o._then(i,s,null,null,null)}i()}var a=0,u=e.length,l=new t(o);return i(),l}function l(e,t,n){this._data=e,this._promise=t,this._context=n}function d(e,t,n){this.constructor$(e,t,n)}function p(e){return l.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function h(e){this.length=e,this.promise=null,this[e-1]=null}var f=e("./util"),m=e("./errors").TypeError,v=e("./util").inherits,g=f.errorObj,y=f.tryCatch,b={};l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():b},l.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=t!==b?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},l.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},v(d,l),d.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},h.prototype._resultCancelled=function(){for(var e=this.length,n=0;n<e;++n){var r=this[n];r instanceof t&&r.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[e-1];if("function"!=typeof i)return n("expecting a function but got "+f.classString(i));var o,s=!0;2===e&&Array.isArray(arguments[0])?(o=arguments[0],e=o.length,s=!1):(o=arguments,e--);for(var c=new h(e),d=0;d<e;++d){var m=o[d];if(l.isDisposer(m)){var v=m;m=m.promise(),m._setDisposable(v)}else{var b=r(m);b instanceof t&&(m=b._then(p,null,null,{resources:c,index:d},void 0))}c[d]=m}for(var _=new Array(c.length),d=0;d<_.length;++d)_[d]=t.resolve(c[d]).reflect();var S=t.all(_).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return g.e=n.error(),g;if(!n.isFulfilled())return void S.cancel();e[t]=n.value()}T._pushContext(),i=y(i);var r=s?i.apply(void 0,e):i(e),o=T._popContext();return a.checkForgottenReturns(r,o,"Promise.using",T),r}),T=S.lastly(function(){var e=new t.PromiseInspection(S);return u(c,e)});return c.promise=T,T._setOnCancel(c),T},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new d(e,this,i());throw new m}}},{"./errors":12,"./util":36}],36:[function(e,t,i){"use strict";function o(){try{var e=P;return P=null,e.apply(this,arguments)}catch(e){return D.e=e,D}}function a(e){return P=e,o}function s(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function u(e){return"function"==typeof e||"object"===(void 0===e?"undefined":c(e))&&null!==e}function l(e){return s(e)?new Error(b(e)):e}function d(e,t){var n,r=e.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=e[n];return i[n]=t,i}function p(e,t,n){if(!A.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function h(e,t,n){if(s(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return A.defineProperty(e,t,r),e}function f(e){throw e}function m(e){try{if("function"==typeof e){var t=A.names(e.prototype),n=A.isES5&&t.length>1,r=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=M.test(e+"")&&A.names(e).length>0;if(n||r||i)return!0}return!1}catch(e){return!1}}function v(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e}function g(e){return j.test(e)}function y(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r}function b(e){try{return e+""}catch(e){return"[no string representation]"}}function _(e){return e instanceof Error||null!==e&&"object"===(void 0===e?"undefined":c(e))&&"string"==typeof e.message&&"string"==typeof e.name}function S(e){try{h(e,"isOperational",!0)}catch(e){}}function T(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function C(e){return _(e)&&A.propertyIsWritable(e,"stack")}function E(e){return{}.toString.call(e)}function w(e,t,n){for(var r=A.names(e),i=0;i<r.length;++i){var o=r[i];if(n(o))try{A.defineProperty(t,o,A.getDescriptor(e,o))}catch(e){}}}function R(e){return G?n.env[e]:void 0}function k(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function I(e,t){return e.bind(t)}var P,A=e("./es5"),O="undefined"==typeof navigator,D={e:{}},x="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r?r:void 0!==this?this:null,N=function(e,t){function n(){this.constructor=e,this.constructor$=t;for(var n in t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}var r={}.hasOwnProperty;return n.prototype=t.prototype,e.prototype=new n,e.prototype},L=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1};if(A.isES5){var n=Object.getOwnPropertyNames;return function(e){for(var r=[],i=Object.create(null);null!=e&&!t(e);){var o;try{o=n(e)}catch(e){return r}for(var a=0;a<o.length;++a){var s=o[a];if(!i[s]){i[s]=!0;var c=Object.getOwnPropertyDescriptor(e,s);null!=c&&null==c.get&&null==c.set&&r.push(s)}}e=A.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(n){if(t(n))return[];var i=[];e:for(var o in n)if(r.call(n,o))i.push(o);else{for(var a=0;a<e.length;++a)if(r.call(e[a],o))continue e;i.push(o)}return i}}(),M=/this\s*\.\s*\S+\s*=/,j=/^[a-z$_][a-z$_0-9]*$/i,F=function(){return"stack"in new Error?function(e){return C(e)?e:new Error(b(e))}:function(e){if(C(e))return e;try{throw new Error(b(e))}catch(e){return e}}}(),U=function(e){return A.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var H="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n};U=function(e){return A.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?H(e):null}}var B=void 0!==n&&"[object process]"===E(n).toLowerCase(),G=void 0!==n&&void 0!==n.env,J={isClass:m,isIdentifier:g,inheritedDataKeys:L,getDataPropertyOrDefault:p,thrower:f,isArray:A.isArray,asArray:U,notEnumerableProp:h,isPrimitive:s,isObject:u,isError:_,canEvaluate:O,errorObj:D,tryCatch:a,inherits:N,withAppended:d,maybeWrapAsError:l,toFastProperties:v,filledRange:y,toString:b,canAttachTrace:C,ensureErrorObject:F,originatesFromRejection:T,markAsOriginatingFromRejection:S,classString:E,copyDescriptors:w,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:B,hasEnvVariables:G,env:R,global:x,getNativePromise:k,domainBind:I};J.isRecentNode=J.isNode&&function(){var e=n.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),J.isNode&&J.toFastProperties(n);try{throw new Error}catch(e){J.lastLineError=e}t.exports=J},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(t,n(32),n(20),n(38).setImmediate)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"CONNECTION_DISCONNECTED",function(){return r}),n.d(t,"CONNECTION_ESTABLISHED",function(){return i}),n.d(t,"CONNECTION_FAILED",function(){return o}),n.d(t,"WRONG_STATE",function(){return a});var r="connection.connectionDisconnected",i="connection.connectionEstablished",o="connection.connectionFailed",a="connection.wrongState"},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){var n=[],r=null;return e.forEach(function(e){e.mediaType===g.a?r=t.micDeviceId:e.videoType===E.a.CAMERA&&(r=t.cameraDeviceId),I+=1;var i=new h.a(R({},e,{deviceId:r,facingMode:t.facingMode,rtcId:I}));n.push(i)}),n}function s(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){var t=e.sourceId,n=e.sourceType,r=e.stream,i=e.track,o=e.videoType,a=i.getSettings(),s=a.deviceId,c=a.facingMode;return I+=1,new h.a({deviceId:s,facingMode:c,mediaType:i.kind,rtcId:I,sourceId:t,sourceType:n,stream:r,track:i,videoType:o||null})})}var c=n(0),u=(n.n(c),n(117)),l=n(3),d=n.n(l),p=n(6),h=n(118),f=n(11),m=n(15),v=n(9),g=n(4),y=n(1),b=n(8),_=n.n(b),S=n(27),T=n(141),C=n(16),E=n.n(C),w=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},k=Object(c.getLogger)(e),I=0,P=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.conference=e,o.peerConnections=new Map,o.peerConnectionIdCounter=1,o.localTracks=[],o.options=n,o._channel=null,o._channelOpen=!1,o._lastN=-1,o._lastNEndpoints=null,o._pinnedEndpoint=null,o._selectedEndpoint=null,o._lastNChangeListener=o._onLastNChanged.bind(o),S.a.isDeviceChangeAvailable("output")&&S.a.addListener(_.a.AUDIO_OUTPUT_DEVICE_CHANGED,function(e){var t=o.getRemoteTracks(g.a),n=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)a.value.setAudioOutput(e)}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}),o}return o(t,e),w(t,[{key:"initializeBridgeChannel",value:function(e,t){var n=this;this._channel=new u.a(e,t,this.eventEmitter),this._channelOpenListener=function(){n._channelOpen=!0;try{n._channel.sendPinnedEndpointMessage(n._pinnedEndpoint),n._channel.sendSelectedEndpointMessage(n._selectedEndpoint)}catch(e){d.a.callErrorHandler(e),k.error("Cannot send selected("+n._selectedEndpoint+")pinned("+n._pinnedEndpoint+") endpoint message.",e)}n.removeListener(_.a.DATA_CHANNEL_OPEN,n._channelOpenListener),n._channelOpenListener=null,-1!==n._lastN&&n._channel.sendSetLastNMessage(n._lastN)},this.addListener(_.a.DATA_CHANNEL_OPEN,this._channelOpenListener),this.addListener(_.a.LASTN_ENDPOINT_CHANGED,this._lastNChangeListener)}},{key:"_onLastNChanged",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this._lastNEndpoints||[],r=[],i=[];this._lastNEndpoints=t,r=n.filter(function(t){return!e.isInLastN(t)}),i=t.filter(function(e){return-1===n.indexOf(e)}),this.conference.eventEmitter.emit(p.LAST_N_ENDPOINTS_CHANGED,r,i)}},{key:"onCallEnded",value:function(){this._channel&&(this._channel&&"websocket"===this._channel.mode&&this._channel.close(),this._channel=null,this._channelOpen=!1)}},{key:"setReceiverVideoConstraint",value:function(e){this._channel&&this._channel.sendReceiverVideoConstraintMessage(e)}},{key:"selectEndpoint",value:function(e){this._selectedEndpoint=e,this._channel&&this._channelOpen&&this._channel.sendSelectedEndpointMessage(e)}},{key:"pinEndpoint",value:function(e){this._pinnedEndpoint=e,this._channel&&this._channelOpen&&this._channel.sendPinnedEndpointMessage(e)}},{key:"createPeerConnection",value:function(e,n,r,i){var o=new T.a(this,this.peerConnectionIdCounter,e,n,t.getPCConstraints(r),r,i);return this.peerConnections.set(o.id,o),this.peerConnectionIdCounter+=1,o}},{key:"_removePeerConnection",value:function(e){var t=e.id;return!!this.peerConnections.has(t)&&(this.peerConnections.delete(t),!0)}},{key:"addLocalTrack",value:function(e){if(!e)throw new Error("track must not be null nor undefined");this.localTracks.push(e),e.conference=this.conference}},{key:"getLastN",value:function(){return this._lastN}},{key:"getLocalVideoTrack",value:function(){var e=this.getLocalTracks(g.b);return e.length?e[0]:void 0}},{key:"getLocalAudioTrack",value:function(){var e=this.getLocalTracks(g.a);return e.length?e[0]:void 0}},{key:"getLocalTracks",value:function(e){var t=this.localTracks.slice();return void 0!==e&&(t=t.filter(function(t){return t.getType()===e})),t}},{key:"getRemoteTracks",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var o,a=this.peerConnections.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=s.getRemoteTracks(void 0,e);c&&(t=t.concat(c))}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t}},{key:"setAudioMute",value:function(e){var t=[];return this.getLocalTracks(g.a).forEach(function(n){t.push(e?n.mute():n.unmute())}),Promise.all(t)}},{key:"removeLocalTrack",value:function(e){var t=this.localTracks.indexOf(e);-1!==t&&this.localTracks.splice(t,1)}},{key:"removeRemoteTracks",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var o,a=this.peerConnections.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=s.removeRemoteTracks(e);t=t.concat(c)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return k.debug("Removed remote tracks for "+e+" count: "+t.length),t}},{key:"closeBridgeChannel",value:function(){this._channel&&(this._channel.close(),this._channelOpen=!1,this.removeListener(_.a.LASTN_ENDPOINT_CHANGED,this._lastNChangeListener))}},{key:"setAudioLevel",value:function(e,t,n,r){var i=e.getTrackBySSRC(t);if(i){if(!i.isAudioTrack())return void k.warn("Received audio level for non-audio track: "+t);i.isLocal()!==r&&k.error(i+" was expected to "+(r?"be":"not be")+" local"),i.setAudioLevel(n,e)}}},{key:"sendChannelMessage",value:function(e,t){if(!this._channel)throw new Error("Channel support is disabled!");this._channel.sendMessage(e,t)}},{key:"setLastN",value:function(e){this._lastN!==e&&(this._lastN=e,this._channel&&this._channelOpen&&this._channel.sendSetLastNMessage(e),this.eventEmitter.emit(_.a.LASTN_VALUE_CHANGED,e))}},{key:"isInLastN",value:function(e){return!this._lastNEndpoints||this._lastNEndpoints.indexOf(e)>-1}}],[{key:"obtainAudioAndVideoPermissions",value:function(e){var t=y.a.usesNewGumFlow();return(t?S.a.newObtainAudioAndVideoPermissions(e):S.a.obtainAudioAndVideoPermissions(e)).then(function(n){var r=t?s(n):a(n,e);return r.some(function(e){return!e._isReceivingData()})?Promise.reject(new f.a(m.NO_DATA_FROM_SOURCE)):r})}},{key:"addListener",value:function(e,t){S.a.addListener(e,t)}},{key:"removeListener",value:function(e,t){S.a.removeListener(e,t)}},{key:"isRTCReady",value:function(){return S.a.isRTCReady()}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.options=e,S.a.init(this.options)}},{key:"getDeviceAvailability",value:function(){return S.a.getDeviceAvailability()}},{key:"getPCConstraints",value:function(e){return e?S.a.p2pPcConstraints:S.a.pcConstraints}},{key:"attachMediaStream",value:function(e,t){return S.a.attachMediaStream(e,t)}},{key:"getStreamID",value:function(e){return S.a.getStreamID(e)}},{key:"getTrackID",value:function(e){return S.a.getTrackID(e)}},{key:"isDeviceListAvailable",value:function(){return S.a.isDeviceListAvailable()}},{key:"isDeviceChangeAvailable",value:function(e){return S.a.isDeviceChangeAvailable(e)}},{key:"getAudioOutputDevice",value:function(){return S.a.getAudioOutputDevice()}},{key:"getCurrentlyAvailableMediaDevices",value:function(){return S.a.getCurrentlyAvailableMediaDevices()}},{key:"getEventDataForActiveDevice",value:function(e){return S.a.getEventDataForActiveDevice(e)}},{key:"setAudioOutputDevice",value:function(e){return S.a.setAudioOutputDevice(e)}},{key:"isUserStream",value:function(e){return t.isUserStreamById(S.a.getStreamID(e))}},{key:"isUserStreamById",value:function(e){return e&&"mixedmslabel"!==e&&"default"!==e}},{key:"enumerateDevices",value:function(e){S.a.enumerateDevices(e)}},{key:"stopMediaStream",value:function(e){S.a.stopMediaStream(e)}},{key:"isDesktopSharingEnabled",value:function(){return S.a.isDesktopSharingEnabled()}}]),t}(v.a);t.a=P}).call(t,"modules/RTC/RTC.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function s(){de=navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?function(e){navigator.mediaDevices.enumerateDevices().then(e,function(){return e([])})}:MediaStreamTrack&&MediaStreamTrack.getSources?function(e){MediaStreamTrack.getSources(function(t){return e(t.map(b))})}:void 0}function c(e,t,n){j.a[n]&&(t&&(e.video.width={ideal:j.a[n].width},e.video.height={ideal:j.a[n].height}),e.video.mandatory.minWidth=j.a[n].width,e.video.mandatory.minHeight=j.a[n].height),e.video.mandatory.minWidth&&(e.video.mandatory.maxWidth=e.video.mandatory.minWidth),e.video.mandatory.minHeight&&(e.video.mandatory.maxHeight=e.video.mandatory.minHeight)}function u(e,t){var n={audio:!1,video:!1},r=F.a.isFirefox()||F.a.isEdge()||F.a.isReactNative()||F.a.isTemasysPluginUsed();if(e.indexOf("video")>=0){if(n.video={mandatory:{},optional:[]},t.cameraDeviceId)r&&(n.video.deviceId=t.cameraDeviceId),n.video.optional.push({sourceId:t.cameraDeviceId});else{var i=t.facingMode||k.a.USER;r&&(n.video.facingMode=i),n.video.optional.push({facingMode:i})}(t.minFps||t.maxFps||t.fps)&&((t.minFps||t.fps)&&(t.minFps=t.minFps||t.fps,n.video.mandatory.minFrameRate=t.minFps),t.maxFps&&(n.video.mandatory.maxFrameRate=t.maxFps)),c(n,r,t.resolution)}if(e.indexOf("audio")>=0&&(F.a.isReactNative()?n.audio=!0:F.a.isFirefox()?t.micDeviceId?n.audio={mandatory:{},deviceId:t.micDeviceId,optional:[{sourceId:t.micDeviceId}]}:n.audio=!0:(n.audio={mandatory:{},optional:[]},t.micDeviceId&&(r&&(n.audio.deviceId=t.micDeviceId),n.audio.optional.push({sourceId:t.micDeviceId})),n.audio.optional.push({echoCancellation:!ie&&!re},{googEchoCancellation:!ie&&!re},{googAutoGainControl:!ae&&!re},{googNoiseSupression:!oe&&!re},{googHighpassFilter:!se&&!re},{googNoiseSuppression2:!oe&&!re},{googEchoCancellation2:!ie&&!re},{googAutoGainControl2:!ae&&!re}))),e.indexOf("screen")>=0)if(F.a.isChrome())n.video={mandatory:{chromeMediaSource:"screen",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[]};else if(F.a.isTemasysPluginUsed())n.video={optional:[{sourceId:X.WebRTCPlugin.plugin.screensharingKey}]};else if(F.a.isFirefox())n.video={mozMediaSource:"window",mediaSource:"window"};else{var o="'screen' WebRTC media source is supported only in Chrome and with Temasys plugin";D.a.callErrorHandler(new Error(o)),Q.error(o)}return e.indexOf("desktop")>=0&&(n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t.desktopStream,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[]}),t.bandwidth&&(n.video||(n.video={mandatory:{},optional:[]}),n.video.optional.push({bandwidth:t.bandwidth})),F.a.isFirefox()&&t.firefox_fake_device&&(n.fake=!0),n}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=JSON.parse(JSON.stringify(t.constraints||fe));if(e.indexOf("video")>=0)if(n.video||(n.video={}),t.cameraDeviceId)n.video.deviceId=t.cameraDeviceId;else{var r=t.facingMode||k.a.USER;n.video.facingMode=r}else n.video=!1;return e.indexOf("audio")>=0?(n.audio&&"boolean"!=typeof n.audio||(n.audio={}),n.audio.optional||(n.audio.optional=[]),n.audio.optional.push({sourceId:t.micDeviceId},{echoCancellation:!ie&&!re},{googEchoCancellation:!ie&&!re},{googAutoGainControl:!ae&&!re},{googNoiseSupression:!oe&&!re},{googHighpassFilter:!se&&!re},{googNoiseSuppression2:!oe&&!re},{googEchoCancellation2:!ie&&!re},{googAutoGainControl2:!ae&&!re})):n.audio=!1,e.indexOf("desktop")>=0&&(n.video&&"boolean"!=typeof n.video||(n.video={}),n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t.desktopStream,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3}}),n}function d(e,t){var n=t&&t.getAudioTracks().length>0,r=t&&t.getVideoTracks().length>0;-1!==e.indexOf("video")&&(ee.video=r),-1!==e.indexOf("audio")&&(ee.audio=n),Y.emit(H.a.AVAILABLE_DEVICES_CHANGED,ee)}function p(e){function t(e){return JSON.stringify({kind:e.kind,deviceId:e.deviceId,groupId:e.groupId,label:e.label,facing:e.facing})}return e.length!==le.length||e.map(t).sort().join("")!==le.map(t).sort().join("")}function h(){de&&de(function(e){void 0===le?le=e.slice(0):p(e)&&m(e),window.setTimeout(h,Z)})}function f(e){var t=e.map(function(e){return{deviceId:e.deviceId,groupId:e.groupId,kind:e.kind,label:e.label}});V.a.analytics.sendEvent("devices.deviceList",{devices:t})}function m(e){le=e.slice(0),Q.info("list of media devices has changed:",le),f(le);var t=le.filter(function(e){return"videoinput"===e.kind}),n=le.filter(function(e){return"audioinput"===e.kind}),r=t.filter(function(e){return""===e.label}),i=n.filter(function(e){return""===e.label});t.length&&t.length===r.length&&(ee.video=!1),n.length&&n.length===i.length&&(ee.audio=!1),Y.emit(H.a.DEVICE_LIST_CHANGED,e)}function v(e,t){e&&e.apply(void 0,a(t))}function g(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?function(t,n,r){return e(t).then(function(e){return v(n,[e]),e}).catch(function(e){throw v(r,[e]),e})}:function(t,n,r){e(t,function(e){v(n,[e])},function(e){v(r,[e])})}}function y(e){MediaStreamTrack.getSources(function(t){return e(t.map(b))})}function b(e){var t=(e.kind||"").toLowerCase();return{facing:e.facing||null,label:e.label,kind:t?"audiooutput"===t?t:t+"input":null,deviceId:e.id,groupId:e.groupId||null}}function _(e,t){var n=void 0,r=void 0,i=void 0,o=[];if(e){var a=e.audioVideo;if(a){var s=window.webkitMediaStream||window.MediaStream,c=a.getAudioTracks();if(c.length){n=new s;for(var u=0;u<c.length;u++)n.addTrack(c[u])}var l=a.getVideoTracks();if(l.length){i=new s;for(var d=0;d<l.length;d++)i.addTrack(l[d])}}else n=e.audio,i=e.video;r=e.desktop}if(r){var p=r,h=p.stream,f=p.sourceId,m=p.sourceType;o.push({stream:h,sourceId:f,sourceType:m,track:h.getVideoTracks()[0],mediaType:L.b,videoType:q.a.DESKTOP})}return n&&o.push({stream:n,track:n.getAudioTracks()[0],mediaType:L.a,videoType:null}),i&&o.push({stream:i,track:i.getVideoTracks()[0],mediaType:L.b,videoType:q.a.CAMERA,resolution:t}),o}function S(e,t){var n="srcObject";if(n in e||(n="mozSrcObject")in e||(n=null),n)return void(e[n]=t);var r=void 0;t&&((r=t.jitsiObjectURL)||(t.jitsiObjectURL=r=(URL||webkitURL).createObjectURL(t))),e.src=r||""}function T(e,t){var n=new Error(e);n.name="WEBRTC_NOT_SUPPORTED",Q.error(e),t(n)}function C(e){if(!e.devices||0===e.devices.length)return e.successCallback(e.streams||{});var t=e.devices.splice(0,1);e.deviceGUM[t](function(n){e.streams=e.streams||{},e.streams[t]=n,C(e)},function(n){Object.keys(e.streams).forEach(function(t){return ve.stopMediaStream(e.streams[t])}),Q.error("failed to obtain "+t+" stream - stop",n),e.errorCallback(n)})}function E(e,t){he=!0,Y.emit(H.a.RTC_READY,!0),G.a.init(e,t),ve.isDeviceListAvailable()&&de&&de(function(e){le=e.splice(0),Q.info("Available devices: ",le),f(le),Y.emit(H.a.DEVICE_LIST_AVAILABLE,le),pe?navigator.mediaDevices.addEventListener("devicechange",function(){return ve.enumerateDevices(m)}):h()})}function w(e){return function(t,n){var r=e.apply(ve,arguments);return n&&ve.isDeviceChangeAvailable("output")&&n.getAudioTracks&&n.getAudioTracks().length&&ne&&t.setSinkId(ve.getAudioOutputDevice()).catch(function(e){var n=new x.a(e,null,["audiooutput"]);D.a.callUnhandledRejectionHandler({promise:this,reason:n}),Q.warn("Failed to set audio output device for the element. Default audio output device will be used instead",t,n)}),r}}var R=n(53),k=n.n(R),I=n(14),P=n.n(I),A=n(0),O=(n.n(A),n(3)),D=n.n(O),x=n(11),N=n(9),L=n(4),M=n(33),j=n.n(M),F=n(1),U=n(8),H=n.n(U),B=n(119),G=n(128),J=n(12),V=n(5),W=n(16),q=n.n(W),K=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},z=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Q=Object(A.getLogger)(e),X=F.a.isTemasysPluginUsed()?n(35):void 0;F.a.usesNewGumFlow()&&n(129);var Y=new P.a,Z=3e3,ee={audio:!1,video:!1},te="default",ne=!1,re=!1,ie=!1,oe=!1,ae=!1,se=!1,ce=document.createElement("audio"),ue=void 0!==ce.setSinkId,le=void 0,de=void 0,pe=!1,he=!1,fe={video:{aspectRatio:16/9,height:{ideal:1080,max:1080,min:240}}},me=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,Y))}return o(t,e),z(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return"boolean"==typeof t.disableAEC&&(ie=t.disableAEC,Q.info("Disable AEC: "+ie)),"boolean"==typeof t.disableNS&&(oe=t.disableNS,Q.info("Disable NS: "+oe)),"boolean"==typeof t.disableAP&&(re=t.disableAP,Q.info("Disable AP: "+re)),"boolean"==typeof t.disableAGC&&(ae=t.disableAGC,Q.info("Disable AGC: "+ae)),"boolean"==typeof t.disableHPF&&(se=t.disableHPF,Q.info("Disable HPF: "+se)),s(),new Promise(function(n,r){if(F.a.usesNewGumFlow())e.RTCPeerConnectionType=window.RTCPeerConnection,e.getUserMedia=function(e,t,n){return window.navigator.mediaDevices.getUserMedia(e).then(function(e){return t&&t(e),e}).catch(function(e){return n&&n(e),Promise.reject(e)})},e.enumerateDevices=function(e){return window.navigator.mediaDevices.enumerateDevices().then(function(t){return e(t),t}).catch(function(t){return Q.error("Error enumerating devices: "+t),e([]),[]})},e.attachMediaStream=function(e,t){return e&&(e.srcObject=t),e},e.getStreamID=function(e){return e.id},e.getTrackID=function(e){return e.id};else if(F.a.isOpera()||F.a.isNWJS()||F.a.isElectron()||F.a.isReactNative()){e.RTCPeerConnectionType=webkitRTCPeerConnection;var i=navigator.webkitGetUserMedia.bind(navigator);e.getUserMedia=g(i),e.enumerateDevices=de,e.attachMediaStream=w(function(e,t){return S(e,t),e}),e.getStreamID=function(e){var t=e.id;return"number"==typeof t?t:J.a.filterSpecialChars(t)},e.getTrackID=function(e){return e.id},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks}),webkitMediaStream.prototype.getAudioTracks||(webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks})}else if(F.a.isEdge())e.RTCPeerConnectionType=B.a,e.getUserMedia=g(navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices),!0),e.enumerateDevices=de,e.attachMediaStream=w(function(e,t){return S(e,t),e}),e.getStreamID=function(e){var t=e.jitsiRemoteId||e.id;return J.a.filterSpecialChars(t)},e.getTrackID=function(e){return e.jitsiRemoteId||e.id};else{if(!F.a.isTemasysPluginUsed())return void T("Browser does not appear to be WebRTC-capable",r);var o=function(){e.RTCPeerConnectionType=RTCPeerConnection,e.getUserMedia=window.getUserMedia,e.enumerateDevices=y,e.attachMediaStream=w(function(e,t){if(t){if("dummyAudio"===t.id||"dummyVideo"===t.id)return;var n=$(e);if(F.a.isTemasysPluginUsed()&&!n.is(":visible")&&n.show(),t.getVideoTracks().length>0&&!$(e).is(":visible"))throw new Error("video element must be visible to attach video stream")}return attachMediaStream(e,t)}),e.getStreamID=function(e){return J.a.filterSpecialChars(e.label)},e.getTrackID=function(e){return e.id},E(t,e.getUserMediaWithConstraints.bind(e))},a=new Promise(function(e){return X.webRTCReady(e)});X.WebRTCPlugin.isPluginInstalled(X.WebRTCPlugin.pluginInfo.prefix,X.WebRTCPlugin.pluginInfo.plugName,X.WebRTCPlugin.pluginInfo.type,function(){a.then(function(){o(),n()})},function(){var e=new Error("Temasys plugin is not installed");e.name="WEBRTC_NOT_READY",e.webRTCReadyPromise=a,r(e)})}e._initPCConstraints(t),F.a.isTemasysPluginUsed()||(E(t,e.getUserMediaWithConstraints.bind(e)),n())})}},{key:"_initPCConstraints",value:function(e){if(F.a.isFirefox())this.pcConstraints={};else if(F.a.isChrome()||F.a.isOpera()||F.a.isNWJS()||F.a.isElectron()||F.a.isReactNative()){this.pcConstraints={optional:[]},e.useIPv6&&this.pcConstraints.optional.push({googIPv6:!0}),this.p2pPcConstraints=JSON.parse(JSON.stringify(this.pcConstraints)),e.disableSuspendVideo||this.pcConstraints.optional.push({googSuspendBelowMinBitrate:!0});var t=(e.testing||{}).forceP2PSuspendVideoRatio;("number"!=typeof t||Math.random()<t)&&(Q.info("Enable suspend video mode for p2p (ratio="+t+")"),V.a.analytics.addPermanentProperties({forceP2PSuspendVideo:!0}),this.p2pPcConstraints.optional.push({googSuspendBelowMinBitrate:!0}))}this.p2pPcConstraints=this.p2pPcConstraints||this.pcConstraints}},{key:"getUserMediaWithConstraints",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=u(e,r);Q.info("Get media constraints",i);try{this.getUserMedia(i,function(n){Q.log("onUserMediaSuccess"),d(e,n),t(n)},function(t){d(e,void 0),Q.warn("Failed to get access to local media. Error ",t,i),n&&n(new x.a(t,i,e))})}catch(t){Q.error("GUM failed: ",t),n&&n(new x.a(t,i,e))}}},{key:"_newGetUserMediaWithConstraints",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(r,i){try{t.getUserMedia(n,function(t){Q.log("onUserMediaSuccess"),d(e,t),r(t)},function(t){Q.warn("Failed to get access to local media.  "+t+" "+n+" "),d(e,void 0),i(new x.a(t,n,e))})}catch(t){Q.error("GUM failed: "+t),i(new x.a(t,n,e))}})}},{key:"_newGetDesktopMedia",value:function(e,t){if(!G.a.isSupported())return Promise.reject(new Error("Desktop sharing is not supported!"));var n=K({},e,{desktopSharingSources:t});return new Promise(function(e,t){G.a.obtainStream(n,function(t){e(t)},function(e){t(e)})})}},{key:"obtainAudioAndVideoPermissions",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this,r=K({},t.desktopSharingExtensionExternalInstallation,{desktopSharingSources:t.desktopSharingSources});return new Promise(function(i,o){var a=function(e){i(_(e,t.resolution))};if(t.devices=t.devices||["audio","video"],t.resolution=t.resolution||"720",G.a.isSupported()||-1===t.devices.indexOf("desktop")||o(new Error("Desktop sharing is not supported!")),F.a.isFirefox()||F.a.isReactNative()||F.a.isTemasysPluginUsed()){var s=function(e,n,r){this.getUserMediaWithConstraints(e,n,r,t)},c={audio:s.bind(n,["audio"]),video:s.bind(n,["video"])};G.a.isSupported()&&(c.desktop=G.a.obtainStream.bind(G.a,r)),C({devices:t.devices,streams:[],successCallback:a,errorCallback:o,deviceGUM:c})}else{var l=t.devices.indexOf("desktop")>-1;l&&t.devices.splice(t.devices.indexOf("desktop"),1),t.devices.length?e.getUserMediaWithConstraints(t.devices,function(e){var i=-1!==t.devices.indexOf("audio"),s=-1!==t.devices.indexOf("video"),c=e.getAudioTracks().length>0,d=e.getVideoTracks().length>0;if(i&&!c||s&&!d){n.stopMediaStream(e);var p=[];return i&&!c&&p.push("audio"),s&&!d&&p.push("video"),void n.getUserMediaWithConstraints(p,function(){o(new x.a({name:"UnknownError"},u(t.devices,t),p))},function(e){o(e)},t)}l?G.a.obtainStream(r,function(t){a({audioVideo:e,desktop:t})},function(t){n.stopMediaStream(e),o(t)}):a({audioVideo:e})},function(e){return o(e)},t):l&&G.a.obtainStream(r,function(e){return a({desktop:e})},function(e){return o(e)})}})}},{key:"newObtainAudioAndVideoPermissions",value:function(e){Q.info("Using the new gUM flow");var t=[],n=function(){return-1!==(e.devices||[]).indexOf("desktop")?this._newGetDesktopMedia(e.desktopSharingExtensionExternalInstallation,e.desktopSharingSources):Promise.resolve()}.bind(this),r=function(e){if(e){var n=e.stream,r=e.sourceId,i=e.sourceType;t.push({stream:n,sourceId:r,sourceType:i,track:n.getVideoTracks()[0],videoType:q.a.DESKTOP})}},i=function(){var t=e.devices||["audio","video"],n=t.filter(function(e){return"desktop"!==e});if(!n.length)return Promise.resolve();var r=l(n,e);return Q.info("Got media constraints: ",r),this._newGetUserMediaWithConstraints(n,r)}.bind(this),o=function(e){if(e){var n=e.getAudioTracks();if(n.length){var r=new MediaStream(n);t.push({stream:r,track:r.getAudioTracks()[0]})}var i=e.getVideoTracks();if(i.length){var o=new MediaStream(i);t.push({stream:o,track:o.getVideoTracks()[0],videoType:q.a.CAMERA})}}};return n().then(r).then(i).then(o).then(function(){return t})}},{key:"getDeviceAvailability",value:function(){return ee}},{key:"isRTCReady",value:function(){return he}},{key:"_isDeviceListAvailable",value:function(){if(!he)throw new Error("WebRTC not ready yet");return Boolean(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices||"undefined"!=typeof MediaStreamTrack&&MediaStreamTrack.getSources)}},{key:"onRTCReady",value:function(){return he?Promise.resolve():new Promise(function(e){var t=function t(){Y.removeListener(H.a.RTC_READY,t),e()};Y.addListener(H.a.RTC_READY,t)})}},{key:"isDeviceListAvailable",value:function(){return this.onRTCReady().then(this._isDeviceListAvailable.bind(this))}},{key:"isDeviceChangeAvailable",value:function(e){return"output"===e||"audiooutput"===e?ue:F.a.isChrome()||F.a.isFirefox()||F.a.isOpera()||F.a.isTemasysPluginUsed()||F.a.isNWJS()||F.a.isElectron()||F.a.isEdge()}},{key:"stopMediaStream",value:function(e){e.getTracks().forEach(function(e){!F.a.isTemasysPluginUsed()&&e.stop&&e.stop()}),e.stop&&e.stop(),e.release&&e.release();var t=e.jitsiObjectURL;t&&(delete e.jitsiObjectURL,(URL||webkitURL).revokeObjectURL(t))}},{key:"isDesktopSharingEnabled",value:function(){return G.a.isSupported()}},{key:"setAudioOutputDevice",value:function(e){return this.isDeviceChangeAvailable("output")||Promise.reject(new Error("Audio output device change is not supported")),ce.setSinkId(e).then(function(){te=e,ne=!0,Q.log("Audio output device set to "+e),Y.emit(H.a.AUDIO_OUTPUT_DEVICE_CHANGED,e)})}},{key:"getAudioOutputDevice",value:function(){return te}},{key:"getCurrentlyAvailableMediaDevices",value:function(){return le}},{key:"getEventDataForActiveDevice",value:function(e){var t=[],n={deviceId:e.deviceId,kind:e.kind,label:e.label,groupId:e.groupId};return t.push(n),{deviceList:t}}}]),t}(N.a),ve=new me;t.a=ve}).call(t,"modules/RTC/RTCUtils.js")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return parseInt(e.ssrcs.split(" ")[0],10)}function o(e){return parseInt(e.ssrcs.split(" ")[1],10)}function a(e){return e.ssrcs?e.ssrcs.map(function(e){return e.id}).filter(function(e,t,n){return n.indexOf(e)===t}).length:0}t.b=i,t.c=o,n.d(t,"a",function(){return l});var s=n(13),c=(n.n(s),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),u=function(){function e(t){if(r(this,e),!t)throw new Error("mLine is undefined");this.mLine=t}return c(e,[{key:"getSSRCAttrValue",value:function(e,t){var n=this.ssrcs.find(function(n){return n.id===e&&n.attribute===t});return n&&n.value}},{key:"removeSSRC",value:function(e){this.mLine.ssrcs&&this.mLine.ssrcs.length&&(this.mLine.ssrcs=this.mLine.ssrcs.filter(function(t){return t.id!==e}))}},{key:"addSSRCAttribute",value:function(e){this.ssrcs.push(e)}},{key:"findGroup",value:function(e,t){return this.ssrcGroups.find(function(n){return n.semantics===e&&(!t||t===n.ssrcs)})}},{key:"findGroups",value:function(e){return this.ssrcGroups.filter(function(t){return t.semantics===e})}},{key:"findGroupByPrimarySSRC",value:function(e,t){return this.ssrcGroups.find(function(n){return n.semantics===e&&i(n)===t})}},{key:"findSSRCByMSID",value:function(e){return this.ssrcs.find(function(t){return"msid"===t.attribute&&(null===e||t.value===e)})}},{key:"getSSRCCount",value:function(){return a(this.mLine)}},{key:"containsAnySSRCGroups",value:function(){return void 0!==this.mLine.ssrcGroups}},{key:"getPrimaryVideoSsrc",value:function(){var e=this.mLine.type;if("video"!==e)throw new Error("getPrimarySsrc doesn't work with '"+e+"'");if(1===a(this.mLine))return this.mLine.ssrcs[0].id;if(this.mLine.ssrcGroups){var t=this.findGroup("SIM");if(t)return i(t);var n=this.findGroup("FID");if(n)return i(n)}}},{key:"getRtxSSRC",value:function(e){var t=this.findGroupByPrimarySSRC("FID",e);return t&&o(t)}},{key:"getSSRCs",value:function(){return this.ssrcs.map(function(e){return e.id}).filter(function(e,t,n){return n.indexOf(e)===t})}},{key:"getPrimaryVideoSSRCs",value:function(){var e=this.mLine.type;if("video"!==e)throw new Error("getPrimaryVideoSSRCs doesn't work with "+e);var t=this.getSSRCs(),n=!0,r=!1,i=void 0;try{for(var a,s=this.ssrcGroups[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;if("FID"===c.semantics){var u=o(c);t.splice(t.indexOf(u),1)}}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}return t}},{key:"dumpSSRCGroups",value:function(){return JSON.stringify(this.mLine.ssrcGroups)}},{key:"removeGroupsWithSSRC",value:function(e){this.mLine.ssrcGroups&&(this.mLine.ssrcGroups=this.mLine.ssrcGroups.filter(function(t){return-1===t.ssrcs.indexOf(""+e)}))}},{key:"removeGroupsBySemantics",value:function(e){this.mLine.ssrcGroups&&(this.mLine.ssrcGroups=this.mLine.ssrcGroups.filter(function(t){return t.semantics!==e}))}},{key:"replaceSSRC",value:function(e,t){this.mLine.ssrcs&&this.mLine.ssrcs.forEach(function(n){n.id===e&&(n.id=t)})}},{key:"addSSRCGroup",value:function(e){this.ssrcGroups.push(e)}},{key:"ssrcs",get:function(){return this.mLine.ssrcs||(this.mLine.ssrcs=[]),this.mLine.ssrcs},set:function(e){this.mLine.ssrcs=e}},{key:"direction",get:function(){return this.mLine.direction},set:function(e){this.mLine.direction=e}},{key:"ssrcGroups",get:function(){return this.mLine.ssrcGroups||(this.mLine.ssrcGroups=[]),this.mLine.ssrcGroups},set:function(e){this.mLine.ssrcGroups=e}}]),e}(),l=function(){function e(t){r(this,e),this.parsedSDP=s.parse(t)}return c(e,[{key:"selectMedia",value:function(e){var t=this.parsedSDP.media.find(function(t){return t.type===e});return t?new u(t):null}},{key:"toRawSDP",value:function(){return s.write(this.parsedSDP)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"LOCAL_STATS_UPDATED",function(){return r}),n.d(t,"REMOTE_STATS_UPDATED",function(){return i});var r="cq.local_stats_updated",i="cq.remote_stats_updated"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"AUTHENTICATION_REQUIRED",function(){return r}),n.d(t,"CHAT_ERROR",function(){return i}),n.d(t,"CONFERENCE_DESTROYED",function(){return o}),n.d(t,"CONFERENCE_MAX_USERS",function(){return a}),n.d(t,"CONNECTION_ERROR",function(){return s}),n.d(t,"NOT_ALLOWED_ERROR",function(){return c}),n.d(t,"FOCUS_DISCONNECTED",function(){return u}),n.d(t,"FOCUS_LEFT",function(){return l}),n.d(t,"GRACEFUL_SHUTDOWN",function(){return d}),n.d(t,"INCOMPATIBLE_SERVER_VERSIONS",function(){return p}),n.d(t,"JINGLE_FATAL_ERROR",function(){return h}),n.d(t,"PASSWORD_NOT_SUPPORTED",function(){return f}),n.d(t,"PASSWORD_REQUIRED",function(){return m}),n.d(t,"RESERVATION_ERROR",function(){return v}),n.d(t,"SETUP_FAILED",function(){return g}),n.d(t,"VIDEOBRIDGE_NOT_AVAILABLE",function(){return y});var r="conference.authenticationRequired",i="conference.chatError",o="conference.destroyed",a="conference.max_users",s="conference.connectionError",c="conference.connectionError.notAllowed",u="conference.focusDisconnected",l="conference.focusLeft",d="conference.gracefulShutdown",p="conference.incompatible_server_versions",h="conference.jingleFatalError",f="conference.passwordNotSupported",m="conference.passwordRequired",v="conference.reservationError",g="conference.setup_failed",y="conference.videobridgeNotAvailable"},function(e,t){function n(){this.attaches=[],this.signalListeners=[],this.mapFnc=null}n.prototype={constructor:n,add:function(e){console.log("Abstract method is called width value: "+e)},remove:function(e){console.log("Abstract method is called with value: "+e)},attach:function(e,t){this.attaches.push({cb:e,that:void 0===t?null:t})},notify:function(e){for(var t=0;t<this.attaches.length;++t){var n=this.attaches[t];n.cb?n.cb.call(n.that,e):n.cb(e)}},addMapFnc:function(e){this.mapFnc=e},map:function(){},mapping:function(e,t){null!==this.mapFnc&&this.mapFnc(e,t)},addSignalListener:function(e,t,n){this.signalListeners.push({signalName:e,cb:t,that:void 0===n?null:n})},signalize:function(e,t){for(var n=0;n<this.signalListeners.length;++n){var r=this.signalListeners[n];r.signalName===e&&null!==r.cb&&void 0!==r.cb&&(r.that?r.cb.call(r.that,t):r.cb(t))}}},e.exports=n},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(e){if(d===clearTimeout)return clearTimeout(e);if((d===r||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function a(){m&&h&&(m=!1,h.length?f=h.concat(f):v=-1,f.length&&s())}function s(){if(!m){var e=i(a);m=!0;for(var t=f.length;t;){for(h=f,f=[];++v<t;)h&&h[v].run();v=-1,t=f.length}h=null,m=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var l,d,p=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{d="function"==typeof clearTimeout?clearTimeout:r}catch(e){d=r}}();var h,f=[],m=!1,v=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new c(e,t)),1!==f.length||m||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t){var n={1080:{width:1920,height:1080,order:7},fullhd:{width:1920,height:1080,order:7},720:{width:1280,height:720,order:6},hd:{width:1280,height:720,order:6},960:{width:960,height:720,order:5},360:{width:640,height:360,order:4},640:{width:640,height:480,order:3},vga:{width:640,height:480,order:3},180:{width:320,height:180,order:2},320:{width:320,height:240,order:1}};e.exports=n},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return v});var i=n(0),o=(n.n(i),n(6)),a=n(17),s=n(4),c=n(1),u=n(8),l=n.n(u),d=n(5),p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=Object(i.getLogger)(e),f=500,m=2e3,v={ACTIVE:"active",INACTIVE:"inactive",INTERRUPTED:"interrupted",RESTORING:"restoring"},g=function(){function e(t,n,i){r(this,e),this.rtc=t,this.conference=n,this.trackTimers={},this.connStatusFromJvb={},this.outOfLastNTimeout="number"==typeof i.outOfLastNTimeout?i.outOfLastNTimeout:f,this.rtcMuteTimeout="number"==typeof i.rtcMuteTimeout?i.rtcMuteTimeout:m,this.rtcMutedTimestamp={},h.info("RtcMuteTimeout set to: "+this.rtcMuteTimeout),this.enteredLastNTimestamp=new Map,this.restoringTimers=new Map}return p(e,null,[{key:"_getNewStateForJvbMode",value:function(e,t,n,r,i){return e?r?v.ACTIVE:c.a.isVideoMuteOnConnInterruptedSupported()?i?t?n?v.INTERRUPTED:v.RESTORING:v.INACTIVE:v.ACTIVE:t?v.ACTIVE:v.INACTIVE:v.INTERRUPTED}},{key:"_getNewStateForP2PMode",value:function(e,t){return c.a.isVideoMuteOnConnInterruptedSupported()?e||!t?v.ACTIVE:v.INTERRUPTED:v.ACTIVE}}]),p(e,[{key:"_getVideoFrozenTimeout",value:function(e){return this.rtc.isInLastN(e)?this.rtcMuteTimeout:this.outOfLastNTimeout}},{key:"init",value:function(){this._onEndpointConnStatusChanged=this.onEndpointConnStatusChanged.bind(this),this.rtc.addListener(l.a.ENDPOINT_CONN_STATUS_CHANGED,this._onEndpointConnStatusChanged),this._onP2PStatus=this.refreshConnectionStatusForAll.bind(this),this.conference.on(o.P2P_STATUS,this._onP2PStatus),c.a.isVideoMuteOnConnInterruptedSupported()&&(this._onTrackRtcMuted=this.onTrackRtcMuted.bind(this),this.rtc.addListener(l.a.REMOTE_TRACK_MUTE,this._onTrackRtcMuted),this._onTrackRtcUnmuted=this.onTrackRtcUnmuted.bind(this),this.rtc.addListener(l.a.REMOTE_TRACK_UNMUTE,this._onTrackRtcUnmuted),this._onRemoteTrackAdded=this.onRemoteTrackAdded.bind(this),this.conference.on(o.TRACK_ADDED,this._onRemoteTrackAdded),this._onRemoteTrackRemoved=this.onRemoteTrackRemoved.bind(this),this.conference.on(o.TRACK_REMOVED,this._onRemoteTrackRemoved),this._onSignallingMuteChanged=this.onSignallingMuteChanged.bind(this)),this._onLastNChanged=this._onLastNChanged.bind(this),this.conference.on(o.LAST_N_ENDPOINTS_CHANGED,this._onLastNChanged),this._onLastNValueChanged=this.refreshConnectionStatusForAll.bind(this),this.rtc.on(l.a.LASTN_VALUE_CHANGED,this._onLastNValueChanged)}},{key:"dispose",value:function(){this.rtc.removeListener(l.a.ENDPOINT_CONN_STATUS_CHANGED,this._onEndpointConnStatusChanged),c.a.isVideoMuteOnConnInterruptedSupported()&&(this.rtc.removeListener(l.a.REMOTE_TRACK_MUTE,this._onTrackRtcMuted),this.rtc.removeListener(l.a.REMOTE_TRACK_UNMUTE,this._onTrackRtcUnmuted),this.conference.off(o.TRACK_ADDED,this._onRemoteTrackAdded),this.conference.off(o.TRACK_REMOVED,this._onRemoteTrackRemoved)),this.conference.off(o.LAST_N_ENDPOINTS_CHANGED,this._onLastNChanged),this.rtc.removeListener(l.a.LASTN_VALUE_CHANGED,this._onLastNValueChanged),this.conference.off(o.P2P_STATUS,this._onP2PStatus);var e=Object.keys(this.trackTimers),t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;this.clearTimeout(s),this.clearRtcMutedTimestamp(s)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}this.connStatusFromJvb={}}},{key:"onEndpointConnStatusChanged",value:function(e,t){h.debug("Detector RTCEvents.ENDPOINT_CONN_STATUS_CHANGED("+Date.now()+"): "+e+": "+t),e!==this.conference.myUserId()&&(this.connStatusFromJvb[e]=t,this.figureOutConnectionStatus(e))}},{key:"_changeConnectionStatus",value:function(e,t){if(e.getConnectionStatus()!==t){var n=e.getId();e._setConnectionStatus(t),h.debug("Emit endpoint conn status("+Date.now()+") "+n+": "+t),d.a.sendLog(JSON.stringify({id:"peer.conn.status",participant:n,status:t})),this.conference.eventEmitter.emit(o.PARTICIPANT_CONN_STATUS_CHANGED,n,t)}}},{key:"clearTimeout",value:function(e){this.trackTimers[e]&&(window.clearTimeout(this.trackTimers[e]),this.trackTimers[e]=null)}},{key:"clearRtcMutedTimestamp",value:function(e){this.rtcMutedTimestamp[e]=null}},{key:"onRemoteTrackAdded",value:function(e){e.isLocal()||e.getType()!==s.b||(h.debug("Detector on remote track added for: "+e.getParticipantId()),e.on(a.TRACK_MUTE_CHANGED,this._onSignallingMuteChanged))}},{key:"onRemoteTrackRemoved",value:function(e){if(!e.isLocal()&&e.getType()===s.b){var t=e.getParticipantId();h.debug("Detector on remote track removed: "+t),e.off(a.TRACK_MUTE_CHANGED,this._onSignallingMuteChanged),this.clearTimeout(t),this.clearRtcMutedTimestamp(t),this.figureOutConnectionStatus(t)}}},{key:"isVideoTrackFrozen",value:function(e){if(!c.a.isVideoMuteOnConnInterruptedSupported())return!1;var t=e.getId(),n=e.hasAnyVideoTrackWebRTCMuted(),r=this.rtcMutedTimestamp[t],i=this._getVideoFrozenTimeout(t);return n&&"number"==typeof r&&Date.now()-r>=i}},{key:"refreshConnectionStatusForAll",value:function(){var e=this.conference.getParticipants(),t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.figureOutConnectionStatus(a.getId())}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"figureOutConnectionStatus",value:function(t){var n=this.conference.getParticipantById(t);if(!n)return void h.warn("figure out conn status - no participant for: "+t);var r=this.conference.isP2PActive(),i=this._isRestoringTimedout(t),o=0===this.rtc.getLastN(),a=n.isVideoMuted()||o,s=this.isVideoTrackFrozen(n),c=this.rtc.isInLastN(t),u=this.connStatusFromJvb[t];"boolean"!=typeof u&&(h.debug("Assuming connection active by JVB - no notification"),u=!0);var l=r?e._getNewStateForP2PMode(a,s):e._getNewStateForJvbMode(u,c,i,a,s);l!==v.RESTORING&&this._clearRestoringTimer(t),h.debug("Figure out conn status for "+t+", is video muted: "+a+" is active(jvb): "+u+" video track frozen: "+s+" p2p mode: "+r+" is in last N: "+c+" currentStatus => newStatus: "+n.getConnectionStatus()+" => "+l),this._changeConnectionStatus(n,l)}},{key:"_onLastNChanged",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Date.now();h.debug("leaving/entering lastN",e,t,n);var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;this.enteredLastNTimestamp.delete(c),this._clearRestoringTimer(c),this.figureOutConnectionStatus(c)}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}var u=!0,l=!1,d=void 0;try{for(var p,f=t[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value;this.enteredLastNTimestamp.set(m,n),this.figureOutConnectionStatus(m)}}catch(e){l=!0,d=e}finally{try{!u&&f.return&&f.return()}finally{if(l)throw d}}}},{key:"_clearRestoringTimer",value:function(e){var t=this.restoringTimers.get(e);t&&(clearTimeout(t),this.restoringTimers.delete(e))}},{key:"_isRestoringTimedout",value:function(e){var t=this,n=this.enteredLastNTimestamp.get(e);return!!(n&&Date.now()-n>=5e3)||(this.restoringTimers.get(e)||this.restoringTimers.set(e,setTimeout(function(){return t.figureOutConnectionStatus(e)},5e3)),!1)}},{key:"onTrackRtcMuted",value:function(e){var t=this,n=e.getParticipantId(),r=this.conference.getParticipantById(n);if(h.debug("Detector track RTC muted: "+n,Date.now()),!r)return void h.error("No participant for id: "+n);if(this.rtcMutedTimestamp[n]=Date.now(),!r.isVideoMuted()){this.clearTimeout(n);var i=this._getVideoFrozenTimeout(n);this.trackTimers[n]=window.setTimeout(function(){h.debug("Set RTC mute timeout for: "+n+"                     of "+i+" ms"),t.clearTimeout(n),t.figureOutConnectionStatus(n)},i)}}},{key:"onTrackRtcUnmuted",value:function(e){var t=e.getParticipantId();h.debug("Detector track RTC unmuted: "+t,Date.now()),this.clearTimeout(t),this.clearRtcMutedTimestamp(t),this.figureOutConnectionStatus(t)}},{key:"onSignallingMuteChanged",value:function(e){var t=e.getParticipantId();h.debug("Detector on track signalling mute changed: "+t,e.isMuted()),this.figureOutConnectionStatus(t)}}]),e}();t.b=g}).call(t,"modules/connectivity/ParticipantConnectionStatus.js")},function(e,t,n){(function(t){var r,r,o=n(0).getLogger(t),a=a||{};e.exports=a,a.options=a.options||{},a.VERSION="0.14.0",a.onwebrtcready=a.onwebrtcready||function(e){},a._onwebrtcreadies=[],a.webRTCReady=function(e){if("function"!=typeof e)throw new Error("Callback provided is not a function");!0===a.onwebrtcreadyDone?e(null!==a.WebRTCPlugin.plugin):a._onwebrtcreadies.push(e)},a.WebRTCPlugin=a.WebRTCPlugin||{},a.WebRTCPlugin.pluginInfo=a.WebRTCPlugin.pluginInfo||{prefix:"Tem",plugName:"TemWebRTCPlugin",pluginId:"plugin0",type:"application/x-temwebrtcplugin",onload:"__TemWebRTCReady0",portalLink:"http://skylink.io/plugin/",downloadLink:null,companyName:"Temasys",downloadLinks:{mac:"http://bit.ly/webrtcpluginpkg",win:"http://bit.ly/webrtcpluginmsi"}},void 0!==a.WebRTCPlugin.pluginInfo.downloadLinks&&null!==a.WebRTCPlugin.pluginInfo.downloadLinks&&(navigator.platform.match(/^Mac/i)?a.WebRTCPlugin.pluginInfo.downloadLink=a.WebRTCPlugin.pluginInfo.downloadLinks.mac:navigator.platform.match(/^Win/i)&&(a.WebRTCPlugin.pluginInfo.downloadLink=a.WebRTCPlugin.pluginInfo.downloadLinks.win)),a.WebRTCPlugin.TAGS={NONE:"none",AUDIO:"audio",VIDEO:"video"},a.WebRTCPlugin.pageId=Math.random().toString(36).slice(2),a.WebRTCPlugin.plugin=null,a.WebRTCPlugin.setLogLevel=null,a.WebRTCPlugin.defineWebRTCInterface=null,a.WebRTCPlugin.isPluginInstalled=null,a.WebRTCPlugin.pluginInjectionInterval=null,a.WebRTCPlugin.injectPlugin=null,a.WebRTCPlugin.PLUGIN_STATES={NONE:0,INITIALIZING:1,INJECTING:2,INJECTED:3,READY:4},a.WebRTCPlugin.pluginState=a.WebRTCPlugin.PLUGIN_STATES.NONE,a.onwebrtcreadyDone=!1,a.WebRTCPlugin.PLUGIN_LOG_LEVELS={NONE:"NONE",ERROR:"ERROR",WARNING:"WARNING",INFO:"INFO",VERBOSE:"VERBOSE",SENSITIVE:"SENSITIVE"},a.WebRTCPlugin.WaitForPluginReady=null,a.WebRTCPlugin.callWhenPluginReady=null,__TemWebRTCReady0=function(){if("complete"===document.readyState)a.WebRTCPlugin.pluginState=a.WebRTCPlugin.PLUGIN_STATES.READY,a.maybeThroughWebRTCReady();else var e=setInterval(function(){"complete"===document.readyState&&(clearInterval(e),a.WebRTCPlugin.pluginState=a.WebRTCPlugin.PLUGIN_STATES.READY,a.maybeThroughWebRTCReady())},100)},a.maybeThroughWebRTCReady=function(){a.onwebrtcreadyDone||(a.onwebrtcreadyDone=!0,a._onwebrtcreadies.length?a._onwebrtcreadies.forEach(function(e){"function"==typeof e&&e(null!==a.WebRTCPlugin.plugin)}):"function"==typeof a.onwebrtcready&&a.onwebrtcready(null!==a.WebRTCPlugin.plugin))},a.TEXT={PLUGIN:{REQUIRE_INSTALLATION:"This website requires you to install a WebRTC-enabling plugin to work on this browser.",NOT_SUPPORTED:"Your browser does not support WebRTC.",BUTTON:"Install Now"},REFRESH:{REQUIRE_REFRESH:"Please refresh page",BUTTON:"Refresh Page"}},a._iceConnectionStates={starting:"starting",checking:"checking",connected:"connected",completed:"connected",done:"completed",disconnected:"disconnected",failed:"failed",closed:"closed"},a._iceConnectionFiredStates=[],a.isDefined=null,a.parseWebrtcDetectedBrowser=function(){var e=null;if(window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0)e=navigator.userAgent.match(/OPR\/(\d+)/i)||[],webrtcDetectedBrowser="opera",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=26,webrtcDetectedType="webkit",webrtcDetectedDCSupport="SCTP";else if(navigator.userAgent.match(/Bowser\/[0-9.]*/g)){e=navigator.userAgent.match(/Bowser\/[0-9.]*/g)||[];var t=parseInt((navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./i)||[])[2]||"0",10);webrtcDetectedBrowser="bowser",webrtcDetectedVersion=parseFloat((e[0]||"0/0").split("/")[1],10),webrtcMinimumVersion=0,webrtcDetectedType="webkit",webrtcDetectedDCSupport=t>30?"SCTP":"RTP"}else if(navigator.userAgent.indexOf("OPiOS")>0)e=navigator.userAgent.match(/OPiOS\/([0-9]+)\./),webrtcDetectedBrowser="opera",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=0,webrtcDetectedType=null,webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf("CriOS")>0)e=navigator.userAgent.match(/CriOS\/([0-9]+)\./)||[],webrtcDetectedBrowser="chrome",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=0,webrtcDetectedType=null,webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf("FxiOS")>0)e=navigator.userAgent.match(/FxiOS\/([0-9]+)\./)||[],webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=0,webrtcDetectedType=null,webrtcDetectedDCSupport=null;else if(document.documentMode)e=/\brv[ :]+(\d+)/g.exec(navigator.userAgent)||[],webrtcDetectedBrowser="IE",webrtcDetectedVersion=parseInt(e[1],10),webrtcMinimumVersion=9,webrtcDetectedType="plugin",webrtcDetectedDCSupport="SCTP",webrtcDetectedVersion||(e=/\bMSIE[ :]+(\d+)/g.exec(navigator.userAgent)||[],webrtcDetectedVersion=parseInt(e[1]||"0",10));else if(window.StyleMedia||navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))e=navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)||[],webrtcDetectedBrowser="edge",webrtcDetectedVersion=parseFloat((e[0]||"0/0").split("/")[1],10),webrtcMinimumVersion=13.10547,webrtcDetectedType="ms",webrtcDetectedDCSupport=null;else if("undefined"!=typeof InstallTrigger||navigator.userAgent.indexOf("irefox")>0)e=navigator.userAgent.match(/Firefox\/([0-9]+)\./)||[],webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=31,webrtcDetectedType="moz",webrtcDetectedDCSupport="SCTP";else if(window.chrome&&window.chrome.webstore||navigator.userAgent.indexOf("Chrom")>0)e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./i)||[],webrtcDetectedBrowser="chrome",webrtcDetectedVersion=parseInt(e[2]||"0",10),webrtcMinimumVersion=38,webrtcDetectedType="webkit",webrtcDetectedDCSupport=webrtcDetectedVersion>30?"SCTP":"RTP";else if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){e=navigator.userAgent.match(/version\/(\d+)/i)||[];var n=navigator.userAgent.match(/(iPhone|iPad)/gi)||[];webrtcDetectedBrowser="safari",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=7,webrtcDetectedType=0===n.length?"plugin":null,webrtcDetectedDCSupport=0===n.length?"SCTP":null}else/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent)&&(e=navigator.userAgent.match(/AppleWebKit\/([0-9]+)\./)||[],webrtcDetectedBrowser="safari",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=0,webrtcDetectedType=null,webrtcDetectedDCSupport=null);window.webrtcDetectedBrowser=webrtcDetectedBrowser,window.webrtcDetectedVersion=webrtcDetectedVersion,window.webrtcMinimumVersion=webrtcMinimumVersion,window.webrtcDetectedType=webrtcDetectedType,window.webrtcDetectedDCSupport=webrtcDetectedDCSupport},a.addEvent=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e[t]=n},a.renderNotificationBar=function(e,t,n,r,i){if("complete"===document.readyState){var o=window,s=document.createElement("iframe");s.name="adapterjs-alert",s.style.position="fixed",s.style.top="-41px",s.style.left=0,s.style.right=0,s.style.width="100%",s.style.height="40px",s.style.backgroundColor="#ffffe1",s.style.border="none",s.style.borderBottom="1px solid #888888",s.style.zIndex="9999999","string"==typeof s.style.webkitTransition?s.style.webkitTransition="all .5s ease-out":"string"==typeof s.style.transition&&(s.style.transition="all .5s ease-out"),document.body.appendChild(s);var c=s.contentWindow?s.contentWindow:s.contentDocument.document?s.contentDocument.document:s.contentDocument;c.document.open(),c.document.write('<span style="display: inline-block; font-family: Helvetica, Arial,sans-serif; font-size: .9rem; padding: 4px; vertical-align: middle; cursor: default;">'+e+"</span>"),t&&n?(c.document.write('<button id="okay">'+t+'</button><button id="cancel">Cancel</button>'),c.document.close(),a.addEvent(c.document.getElementById("okay"),"click",function(e){i&&a.renderNotificationBar(a.TEXT.EXTENSION?a.TEXT.EXTENSION.REQUIRE_REFRESH:a.TEXT.REFRESH.REQUIRE_REFRESH,a.TEXT.REFRESH.BUTTON,"javascript:location.reload()"),window.open(n,r?"_blank":"_top"),e.preventDefault();try{e.cancelBubble=!0}catch(e){}var t=setInterval(function(){isIE||navigator.plugins.refresh(!1),a.WebRTCPlugin.isPluginInstalled(a.WebRTCPlugin.pluginInfo.prefix,a.WebRTCPlugin.pluginInfo.plugName,a.WebRTCPlugin.pluginInfo.type,function(){clearInterval(t),a.WebRTCPlugin.defineWebRTCInterface()},function(){})},500)}),a.addEvent(c.document.getElementById("cancel"),"click",function(e){o.document.body.removeChild(s)})):c.document.close(),setTimeout(function(){"string"==typeof s.style.webkitTransform?s.style.webkitTransform="translateY(40px)":"string"==typeof s.style.transform?s.style.transform="translateY(40px)":s.style.top="0px"},300)}},webrtcDetectedType=null,checkMediaDataChannelSettings=function(e,t,n,r){if("function"==typeof n){var i=!0,a="firefox"===webrtcDetectedBrowser,s="moz"===webrtcDetectedType&&webrtcDetectedVersion>30,c="firefox"===e;if(a&&c||s)try{delete r.mandatory.MozDontOfferDataChannel}catch(e){o.error("Failed deleting MozDontOfferDataChannel"),o.error(e)}else a&&!c&&(r.mandatory.MozDontOfferDataChannel=!0);if(!a)for(var u in r.mandatory)r.mandatory.hasOwnProperty(u)&&-1!==u.indexOf("Moz")&&delete r.mandatory[u];!a||c||s||(i=!1),n(i,r)}},checkIceConnectionState=function(e,t,n){if("function"!=typeof n)return void o.warn("No callback specified in checkIceConnectionState. Aborted.");e=e||"peer",a._iceConnectionFiredStates[e]&&t!==a._iceConnectionStates.disconnected&&t!==a._iceConnectionStates.failed&&t!==a._iceConnectionStates.closed||(a._iceConnectionFiredStates[e]=[]),t=a._iceConnectionStates[t],a._iceConnectionFiredStates[e].indexOf(t)<0&&(a._iceConnectionFiredStates[e].push(t),t===a._iceConnectionStates.connected&&setTimeout(function(){a._iceConnectionFiredStates[e].push(a._iceConnectionStates.done),n(a._iceConnectionStates.done)},1e3),n(t))},createIceServer=null,createIceServers=null,RTCPeerConnection=null,RTCSessionDescription="function"==typeof RTCSessionDescription?RTCSessionDescription:null,RTCIceCandidate="function"==typeof RTCIceCandidate?RTCIceCandidate:null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null,webrtcMinimumVersion=null,!(navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))||0===(navigator.userAgent.match(/android/gi)||[]).length&&0===(navigator.userAgent.match(/chrome/gi)||[]).length&&navigator.userAgent.indexOf("Safari/")>0?("object"==typeof o&&"function"==typeof o.log||(o={}||o,o.log=function(e){},o.info=function(e){},o.error=function(e){},o.dir=function(e){},o.exception=function(e){},o.trace=function(e){},o.warn=function(e){},o.count=function(e){},o.debug=function(e){},o.count=function(e){},o.time=function(e){},o.timeEnd=function(e){},o.group=function(e){},o.groupCollapsed=function(e){},o.groupEnd=function(e){}),a.parseWebrtcDetectedBrowser(),isIE="IE"===webrtcDetectedBrowser,a.WebRTCPlugin.WaitForPluginReady=function(){for(;a.WebRTCPlugin.pluginState!==a.WebRTCPlugin.PLUGIN_STATES.READY;);},a.WebRTCPlugin.callWhenPluginReady=function(e){if(a.WebRTCPlugin.pluginState===a.WebRTCPlugin.PLUGIN_STATES.READY)e();else var t=setInterval(function(){a.WebRTCPlugin.pluginState===a.WebRTCPlugin.PLUGIN_STATES.READY&&(clearInterval(t),e())},100)},a.WebRTCPlugin.setLogLevel=function(e){a.WebRTCPlugin.callWhenPluginReady(function(){a.WebRTCPlugin.plugin.setLogLevel(e)})},a.WebRTCPlugin.injectPlugin=function(){if("complete"===document.readyState&&a.WebRTCPlugin.pluginState===a.WebRTCPlugin.PLUGIN_STATES.INITIALIZING){if(a.WebRTCPlugin.pluginState=a.WebRTCPlugin.PLUGIN_STATES.INJECTING,"IE"===webrtcDetectedBrowser&&webrtcDetectedVersion<=10){var e=document.createDocumentFragment();for(a.WebRTCPlugin.plugin=document.createElement("div"),a.WebRTCPlugin.plugin.innerHTML='<object id="'+a.WebRTCPlugin.pluginInfo.pluginId+'" type="'+a.WebRTCPlugin.pluginInfo.type+'" width="1" height="1"><param name="pluginId" value="'+a.WebRTCPlugin.pluginInfo.pluginId+'" /> <param name="windowless" value="false" /> <param name="pageId" value="'+a.WebRTCPlugin.pageId+'" /> <param name="onload" value="'+a.WebRTCPlugin.pluginInfo.onload+'" /><param name="tag" value="'+a.WebRTCPlugin.TAGS.NONE+'" />'+(a.options.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+"</object>";a.WebRTCPlugin.plugin.firstChild;)e.appendChild(a.WebRTCPlugin.plugin.firstChild);document.body.appendChild(e),a.WebRTCPlugin.plugin=document.getElementById(a.WebRTCPlugin.pluginInfo.pluginId)}else a.WebRTCPlugin.plugin=document.createElement("object"),a.WebRTCPlugin.plugin.id=a.WebRTCPlugin.pluginInfo.pluginId,isIE?(a.WebRTCPlugin.plugin.width="1px",a.WebRTCPlugin.plugin.height="1px"):(a.WebRTCPlugin.plugin.width="0px",a.WebRTCPlugin.plugin.height="0px"),a.WebRTCPlugin.plugin.type=a.WebRTCPlugin.pluginInfo.type,a.WebRTCPlugin.plugin.innerHTML='<param name="onload" value="'+a.WebRTCPlugin.pluginInfo.onload+'"><param name="pluginId" value="'+a.WebRTCPlugin.pluginInfo.pluginId+'"><param name="windowless" value="false" /> '+(a.options.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+'<param name="pageId" value="'+a.WebRTCPlugin.pageId+'"><param name="tag" value="'+a.WebRTCPlugin.TAGS.NONE+'" />',document.body.appendChild(a.WebRTCPlugin.plugin);a.WebRTCPlugin.pluginState=a.WebRTCPlugin.PLUGIN_STATES.INJECTED}},a.WebRTCPlugin.isPluginInstalled=function(e,t,n,r,i){if(isIE){try{new ActiveXObject(e+"."+t)}catch(e){return void i()}r()}else{for(var o=navigator.mimeTypes,a=0;a<o.length;a++)if(o[a].type.indexOf(n)>=0)return void r();i()}},a.WebRTCPlugin.defineWebRTCInterface=function(){if(a.WebRTCPlugin.pluginState===a.WebRTCPlugin.PLUGIN_STATES.READY)return void o.error("AdapterJS - WebRTC interface has already been defined");a.WebRTCPlugin.pluginState=a.WebRTCPlugin.PLUGIN_STATES.INITIALIZING,a.isDefined=function(e){return null!==e&&void 0!==e},createIceServer=function(e,t,n){var r=null,i=e.split(":");return 0===i[0].indexOf("stun")?r={url:e,hasCredentials:!1}:0===i[0].indexOf("turn")&&(r={url:e,hasCredentials:!0,credential:n,username:t}),r},createIceServers=function(e,t,n){for(var r=[],i=0;i<e.length;++i)r.push(createIceServer(e[i],t,n));return r},RTCSessionDescription=function(e){return a.WebRTCPlugin.WaitForPluginReady(),a.WebRTCPlugin.plugin.ConstructSessionDescription(e.type,e.sdp)},RTCPeerConnection=function(e,t){if(void 0!==e&&null!==e&&!Array.isArray(e.iceServers))throw new Error("Failed to construct 'RTCPeerConnection': Malformed RTCConfiguration");if(void 0!==t&&null!==t){var n=!1;if(n|="object"!=typeof t,n|=t.hasOwnProperty("mandatory")&&void 0!==t.mandatory&&null!==t.mandatory&&t.mandatory.constructor!==Object,n|=t.hasOwnProperty("optional")&&void 0!==t.optional&&null!==t.optional&&!Array.isArray(t.optional))throw new Error("Failed to construct 'RTCPeerConnection': Malformed constraints object")}a.WebRTCPlugin.WaitForPluginReady();var r=null;if(e&&Array.isArray(e.iceServers)){r=e.iceServers;for(var i=0;i<r.length;i++)r[i].urls&&!r[i].url&&(r[i].url=r[i].urls),r[i].hasCredentials=a.isDefined(r[i].username)&&a.isDefined(r[i].credential)}if(a.WebRTCPlugin.plugin.PEER_CONNECTION_VERSION&&a.WebRTCPlugin.plugin.PEER_CONNECTION_VERSION>1)return r&&(e.iceServers=r),a.WebRTCPlugin.plugin.PeerConnection(e);var o=t&&t.mandatory?t.mandatory:null,s=t&&t.optional?t.optional:null;return a.WebRTCPlugin.plugin.PeerConnection(a.WebRTCPlugin.pageId,r,o,s)},MediaStreamTrack=function(){},MediaStreamTrack.getSources=function(e){a.WebRTCPlugin.callWhenPluginReady(function(){a.WebRTCPlugin.plugin.GetSources(e)})};var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),o={},o[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};getUserMedia=function(t,n,r){var i={};i.audio=!!t.audio&&e(t.audio),i.video=!!t.video&&e(t.video),a.WebRTCPlugin.callWhenPluginReady(function(){a.WebRTCPlugin.plugin.getUserMedia(i,n,r)})},window.navigator.getUserMedia=getUserMedia,navigator.mediaDevices||"undefined"==typeof Promise||(requestUserMedia=function(e){return new Promise(function(t,n){getUserMedia(e,t,n)})},navigator.mediaDevices={getUserMedia:requestUserMedia,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],id:e.id,deviceId:e.id,groupId:""}}))})})}}),attachMediaStream=function(e,t){if(e&&e.parentNode){var n;null===t?n="":(void 0!==t.enableSoundTracks&&t.enableSoundTracks(!0),n=t.id);var r=0===e.id.length?Math.random().toString(36).slice(2):e.id,i=e.nodeName.toLowerCase();if("object"!==i){var o;switch(i){case"audio":o=a.WebRTCPlugin.TAGS.AUDIO;break;case"video":o=a.WebRTCPlugin.TAGS.VIDEO;break;default:o=a.WebRTCPlugin.TAGS.NONE}var s=document.createDocumentFragment(),c=document.createElement("div"),u="";for(e.className?u='class="'+e.className+'" ':e.attributes&&e.attributes.class&&(u='class="'+e.attributes.class.value+'" '),c.innerHTML='<object id="'+r+'" '+u+'type="'+a.WebRTCPlugin.pluginInfo.type+'"><param name="pluginId" value="'+r+'" /> <param name="pageId" value="'+a.WebRTCPlugin.pageId+'" /> <param name="windowless" value="true" /> <param name="streamId" value="'+n+'" /> <param name="tag" value="'+o+'" /> </object>';c.firstChild;)s.appendChild(c.firstChild);var l="",d="";e.clientWidth||e.clientHeight?(d=e.clientWidth,l=e.clientHeight):(e.width||e.height)&&(d=e.width,l=e.height),e.parentNode.insertBefore(s,e),s=document.getElementById(r),s.width=d,s.height=l,e.parentNode.removeChild(e)}else{for(var p=e.children,h=0;h!==p.length;++h)if("streamId"===p[h].name){p[h].value=n;break}e.setStreamId(n)}var f=document.getElementById(r);return a.forwardEventHandlers(f,e,Object.getPrototypeOf(e)),f}},reattachMediaStream=function(e,t){for(var n=null,r=t.children,i=0;i!==r.length;++i)if("streamId"===r[i].name){a.WebRTCPlugin.WaitForPluginReady(),n=a.WebRTCPlugin.plugin.getStreamWithId(a.WebRTCPlugin.pageId,r[i].value);break}if(null!==n)return attachMediaStream(e,n);o.log("Could not find the stream associated with this element")},window.attachMediaStream=attachMediaStream,window.reattachMediaStream=reattachMediaStream,window.getUserMedia=getUserMedia,a.attachMediaStream=attachMediaStream,a.reattachMediaStream=reattachMediaStream,a.getUserMedia=getUserMedia,a.forwardEventHandlers=function(e,t,n){properties=Object.getOwnPropertyNames(n);for(var r in properties)r&&(propName=properties[r],"function"==typeof propName.slice&&"on"===propName.slice(0,2)&&"function"==typeof t[propName]&&a.addEvent(e,propName.slice(2),t[propName]));var i=Object.getPrototypeOf(n);i&&a.forwardEventHandlers(e,t,i)},RTCIceCandidate=function(e){return e.sdpMid||(e.sdpMid=""),a.WebRTCPlugin.WaitForPluginReady(),a.WebRTCPlugin.plugin.ConstructIceCandidate(e.sdpMid,e.sdpMLineIndex,e.candidate)},a.addEvent(document,"readystatechange",a.WebRTCPlugin.injectPlugin),a.WebRTCPlugin.injectPlugin()},a.WebRTCPlugin.pluginNeededButNotInstalledCb=a.WebRTCPlugin.pluginNeededButNotInstalledCb||function(){a.addEvent(document,"readystatechange",a.WebRTCPlugin.pluginNeededButNotInstalledCbPriv),a.WebRTCPlugin.pluginNeededButNotInstalledCbPriv()},a.WebRTCPlugin.pluginNeededButNotInstalledCbPriv=function(){if(!a.options.hidePluginInstallPrompt){var e=a.WebRTCPlugin.pluginInfo.downloadLink;if(e){var t;t=a.WebRTCPlugin.pluginInfo.portalLink?'This website requires you to install the  <a href="'+a.WebRTCPlugin.pluginInfo.portalLink+'" target="_blank">'+a.WebRTCPlugin.pluginInfo.companyName+" WebRTC Plugin</a> to work on this browser.":a.TEXT.PLUGIN.REQUIRE_INSTALLATION,a.renderNotificationBar(t,a.TEXT.PLUGIN.BUTTON,e)}else a.renderNotificationBar(a.TEXT.PLUGIN.NOT_SUPPORTED)}},a.WebRTCPlugin.isPluginInstalled(a.WebRTCPlugin.pluginInfo.prefix,a.WebRTCPlugin.pluginInfo.plugName,a.WebRTCPlugin.pluginInfo.type,a.WebRTCPlugin.defineWebRTCInterface,a.WebRTCPlugin.pluginNeededButNotInstalledCb)):(function(t){e.exports=function(){return function e(t,n,i){function o(s,c){if(!n[s]){if(!t[s]){var u="function"==typeof r&&r;if(!c&&u)return r(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){return o(t[s][1][e]||e)},d,d.exports,e,t,n,i)}return n[s].exports}for(var a="function"==typeof r&&r,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){"use strict";var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},r.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.getDtlsParameters=function(e,t){var n=r.splitLines(e);n=n.concat(r.splitLines(t));var i=n.filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:i.split(" ")[0],value:i.split(" ")[1]}]}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return n=n.concat(r.splitLines(t)),{usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e),i=n[0].split(" "),o=3;o<i.length;o++){var a=i[o],s=r.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=r.parseRtpMap(s),u=r.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=u.length?r.parseFmtp(u[0]):{},c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";return n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)}),n+="a=rtcp-mux\r\n"},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{payloadType:e.payloadType,ssrc:t}};n.push(r),o&&(r=JSON.parse(JSON.stringify(r)),r.fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var l=r.matchPrefix(e,"b=");return l.length&&(0===l[0].indexOf("b=TIAS:")?l=parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")&&(l=parseInt(l[0].substr(5),10)),n.forEach(function(e){e.maxBitrate=l})),n},r.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n"},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},t.exports=r},{}],2:[function(e,t,n){"use strict";!function(){var n=e("./utils").log,r=e("./utils").browserDetails;t.exports.browserDetails=r,t.exports.extractVersion=e("./utils").extractVersion,t.exports.disableLog=e("./utils").disableLog;var i=e("./chrome/chrome_shim")||null,o=e("./edge/edge_shim")||null,a=e("./firefox/firefox_shim")||null,s=e("./safari/safari_shim")||null;switch(r.browser){case"opera":case"chrome":if(!i||!i.shimPeerConnection)return void n("Chrome shim is not included in this adapter release.");n("adapter.js shimming chrome."),t.exports.browserShim=i,i.shimGetUserMedia(),i.shimMediaStream(),i.shimSourceObject(),i.shimPeerConnection(),i.shimOnTrack();break;case"firefox":if(!a||!a.shimPeerConnection)return void n("Firefox shim is not included in this adapter release.");n("adapter.js shimming firefox."),t.exports.browserShim=a,a.shimGetUserMedia(),a.shimSourceObject(),a.shimPeerConnection(),a.shimOnTrack();break;case"edge":if(!o||!o.shimPeerConnection)return void n("MS edge shim is not included in this adapter release.");n("adapter.js shimming edge."),t.exports.browserShim=o,o.shimGetUserMedia(),o.shimPeerConnection();break;case"safari":if(!s)return void n("Safari shim is not included in this adapter release.");n("adapter.js shimming safari."),t.exports.browserShim=s,s.shimGetUserMedia();break;default:n("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":7,"./safari/safari_shim":9,"./utils":10}],3:[function(e,t,n){"use strict";var r=e("../utils.js").log,i=e("../utils.js").browserDetails,o={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(n){var r=new Event("track");r.track=n.track,r.receiver={track:n.track},r.streams=[e.stream],t.dispatchEvent(r)}),e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;if(this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),!e)return void(this.src="");this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(e,t){r("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new webkitRTCPeerConnection(e,t),i=n.getStats.bind(n);return n.getStats=function(e,t,n){var r=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return i(e,t);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e,t){var n=new Map(Object.keys(e).map(function(t){return[t,e[t]]}));return t=t||e,Object.keys(t).forEach(function(e){n[e]=t[e]}),n};if(arguments.length>=2){var c=function(e){o[1](s(a(e)))};return i.apply(this,[c,arguments[0]])}return new Promise(function(t,n){1===o.length&&"object"==typeof e?i.apply(r,[function(e){t(s(a(e)))},n]):i.apply(r,[function(e){t(s(a(e),e.result()))},n])}).then(t,n)},n},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){t.apply(e,[r,i,n])})}return t.apply(this,arguments)}}),i.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this,r=new Promise(function(r,i){t.apply(n,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)}}};t.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":10,"./getusermedia":4}],4:[function(e,t,n){"use strict";var r=e("../utils.js").log;t.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),o={},o[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},t=function(t,n){if(t=JSON.parse(JSON.stringify(t)),t&&t.audio&&(t.audio=e(t.audio)),t&&"object"==typeof t.video){var i=t.video.facingMode;if((i=i&&("object"==typeof i?i:{ideal:i}))&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete t.video.facingMode,"environment"===i.exact||"environment"===i.ideal))return navigator.mediaDevices.enumerateDevices().then(function(o){o=o.filter(function(e){return"videoinput"===e.kind});var a=o.find(function(e){return-1!==e.label.toLowerCase().indexOf("back")})||o.length&&o[o.length-1];return a&&(t.video.deviceId=i.exact?{exact:a.deviceId}:{ideal:a.deviceId}),t.video=e(t.video),r("chrome: "+JSON.stringify(t)),n(t)});t.video=e(t.video)}return r("chrome: "+JSON.stringify(t)),n(t)},n=function(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},i=function(e,r,i){t(e,function(e){navigator.webkitGetUserMedia(e,r,function(e){i(n(e))})})};navigator.getUserMedia=i;var o=function(e){return new Promise(function(t,n){navigator.getUserMedia(e,t,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:o,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var a=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e,function(e){return a(e).catch(function(e){return Promise.reject(n(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return o(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":10}],5:[function(e,t,n){"use strict";var r=e("sdp"),i=e("../utils").browserDetails,o={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e})),window.RTCPeerConnection=function(e){var t=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=n[e].bind(n)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers){var r=JSON.parse(JSON.stringify(e.iceServers));this.iceOptions.iceServers=r.filter(function(e){if(e&&e.urls){var t=e.urls;return"string"==typeof t&&(t=[t]),!!(t=t.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")||0===e.indexOf("stun:")&&i.version>=14393})[0])}return!1})}this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this,t=r.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){if(n.candidate&&0!==Object.keys(n.candidate).length)-1===n.candidate.candidate.indexOf("typ endOfCandidates")&&(t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n");else for(var r=1;r<t.length;r++)-1===t[r].indexOf("\r\na=end-of-candidates\r\n")&&(t[r]+="a=end-of-candidates\r\n");e.localDescription.sdp=t.join(""),e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),n.candidate||"complete"===e.iceGatheringState||e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&(e.iceGatheringState="complete")}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(e){this.localStreams.push(e.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var r=0;r<t.codecs.length;r++){var i=t.codecs[r];if(e.name.toLowerCase()===i.name.toLowerCase()&&e.clockRate===i.clockRate&&e.numChannels===i.numChannels){n.codecs.push(i),i.rtcpFeedback=i.rtcpFeedback.filter(function(t){for(var n=0;n<e.rtcpFeedback.length;n++)if(e.rtcpFeedback[n].type===t.type&&e.rtcpFeedback[n].parameter===t.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,t){var n=this,i=new RTCIceGatherer(n.iceOptions),o=new RTCIceTransport(i);i.onlocalcandidate=function(a){var s=new Event("icecandidate");s.candidate={sdpMid:e,sdpMLineIndex:t};var c=a.candidate,u=!c||0===Object.keys(c).length;u?(void 0===i.state&&(i.state="completed"),s.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(c.component="RTCP"===o.component?2:1,s.candidate.candidate=r.writeCandidate(c));var l=r.splitSections(n.localDescription.sdp);-1===s.candidate.candidate.indexOf("typ endOfCandidates")?l[s.candidate.sdpMLineIndex+1]+="a="+s.candidate.candidate+"\r\n":l[s.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",n.localDescription.sdp=l.join("");var d=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(n.iceGatheringState){case"new":n._localIceCandidatesBuffer.push(s),u&&d&&n._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":n._emitBufferedCandidates(),n.dispatchEvent(s),null!==n.onicecandidate&&n.onicecandidate(s),d&&(n.dispatchEvent(new Event("icecandidate")),null!==n.onicecandidate&&n.onicecandidate(new Event("icecandidate")),n.iceGatheringState="complete")}},o.onicestatechange=function(){n._updateConnectionState()};var a=new RTCDtlsTransport(o);return a.ondtlsstatechange=function(){n._updateConnectionState()},a.onerror=function(){a.state="failed",n._updateConnectionState()},{iceGatherer:i,iceTransport:o,dtlsTransport:a}},window.RTCPeerConnection.prototype._transceive=function(e,t,n){var i=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:r.localCName},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&(i.encodings=e.recvEncodingParameters,i.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t,n,i=this;if("offer"===e.type)this._pendingOffer&&(t=r.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=r.parseRtpParameters(e);i._pendingOffer[t].localCapabilities=n}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){t=r.splitSections(i.remoteDescription.sdp),n=t.shift();var o=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],s=a.iceGatherer,c=a.iceTransport,u=a.dtlsTransport,l=a.localCapabilities,d=a.remoteCapabilities;if("0"!==e.split("\n",1)[0].split(" ",2)[1]&&!a.isDatachannel){var p=r.getIceParameters(e,n);if(o){var h=r.matchPrefix(e,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return"1"===e.component});h.length&&c.setRemoteCandidates(h)}var f=r.getDtlsParameters(e,n);o&&(f.role="server"),i.usingBundle&&0!==t||(c.start(s,p,o?"controlling":"controlled"),u.start(f));var m=i._getCommonCapabilities(l,d);i._transceive(a,m.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var a=arguments.length>1&&"function"==typeof arguments[1];if(a){var s=arguments[1];window.setTimeout(function(){s(),"new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),i._emitBufferedCandidates()},0)}var c=Promise.resolve();return c.then(function(){a||("new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),window.setTimeout(i._emitBufferedCandidates.bind(i),500))}),c},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t=this,n=new MediaStream,i=[],o=r.splitSections(e.sdp),a=o.shift(),s=r.matchPrefix(a,"a=ice-lite").length>0;switch(this.usingBundle=r.matchPrefix(a,"a=group:BUNDLE ").length>0,o.forEach(function(o,c){var u=r.splitLines(o),l=u[0].substr(2).split(" "),d=l[0],p="0"===l[1],h=r.getDirection(o,a),f=r.matchPrefix(o,"a=mid:");if(f=f.length?f[0].substr(6):r.generateIdentifier(),"application"===d&&"DTLS/SCTP"===l[2])return void(t.transceivers[c]={mid:f,isDatachannel:!0});var m,v,g,y,b,_,S,T,C,E,w,R,k=r.parseRtpParameters(o);p||(w=r.getIceParameters(o,a),R=r.getDtlsParameters(o,a),R.role="client"),T=r.parseRtpEncodingParameters(o);var I,P=r.matchPrefix(o,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];P&&(I=P.value);var A=r.matchPrefix(o,"a=end-of-candidates",a).length>0,O=r.matchPrefix(o,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return"1"===e.component});if("offer"!==e.type||p)"answer"!==e.type||p||(m=t.transceivers[c],v=m.iceGatherer,g=m.iceTransport,y=m.dtlsTransport,b=m.rtpSender,_=m.rtpReceiver,S=m.sendEncodingParameters,C=m.localCapabilities,t.transceivers[c].recvEncodingParameters=T,t.transceivers[c].remoteCapabilities=k,t.transceivers[c].cname=I,(s||A)&&O.length&&g.setRemoteCandidates(O),t.usingBundle&&0!==c||(g.start(v,w,"controlling"),y.start(R)),t._transceive(m,"sendrecv"===h||"recvonly"===h,"sendrecv"===h||"sendonly"===h),!_||"sendrecv"!==h&&"sendonly"!==h?delete m.rtpReceiver:(E=_.track,i.push([E,_]),n.addTrack(E)));else{var D=t.usingBundle&&c>0?{iceGatherer:t.transceivers[0].iceGatherer,iceTransport:t.transceivers[0].iceTransport,dtlsTransport:t.transceivers[0].dtlsTransport}:t._createIceAndDtlsTransports(f,c);if(A&&D.iceTransport.setRemoteCandidates(O),C=RTCRtpReceiver.getCapabilities(d),S=[{ssrc:1001*(2*c+2)}],_=new RTCRtpReceiver(D.dtlsTransport,d),E=_.track,i.push([E,_]),n.addTrack(E),t.localStreams.length>0&&t.localStreams[0].getTracks().length>=c){var x;"audio"===d?x=t.localStreams[0].getAudioTracks()[0]:"video"===d&&(x=t.localStreams[0].getVideoTracks()[0]),x&&(b=new RTCRtpSender(x,D.dtlsTransport))}t.transceivers[c]={iceGatherer:D.iceGatherer,iceTransport:D.iceTransport,dtlsTransport:D.dtlsTransport,localCapabilities:C,remoteCapabilities:k,rtpSender:b,rtpReceiver:_,kind:d,mid:f,cname:I,sendEncodingParameters:S,recvEncodingParameters:T},t._transceive(t.transceivers[c],!1,"sendrecv"===h||"sendonly"===h)}}),this.remoteDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return n.getTracks().length&&(t.remoteStreams.push(n),window.setTimeout(function(){var e=new Event("addstream");e.stream=n,t.dispatchEvent(e),null!==t.onaddstream&&window.setTimeout(function(){t.onaddstream(e)},0),i.forEach(function(r){var i=r[0],o=r[1],a=new Event("track");a.track=i,a.receiver=o,a.streams=[n],t.dispatchEvent(e),null!==t.ontrack&&window.setTimeout(function(){t.ontrack(a)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t=this,n={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n.new>0?e="new":(n.connected>0||n.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this.dispatchEvent(r),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(r)}},window.RTCPeerConnection.prototype.createOffer=function(){var e=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var t;1===arguments.length&&"function"!=typeof arguments[0]?t=arguments[0]:3===arguments.length&&(t=arguments[2]);var n=[],i=0,o=0;if(this.localStreams.length&&(i=this.localStreams[0].getAudioTracks().length,o=this.localStreams[0].getVideoTracks().length),t){if(t.mandatory||t.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==t.offerToReceiveAudio&&(i=t.offerToReceiveAudio),void 0!==t.offerToReceiveVideo&&(o=t.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){n.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?i>0:o>0}),"audio"===e.kind?i--:"video"===e.kind&&o--});i>0||o>0;)i>0&&(n.push({kind:"audio",wantReceive:!0}),i--),o>0&&(n.push({kind:"video",wantReceive:!0}),o--);var a=r.writeSessionBoilerplate(),s=[];n.forEach(function(t,n){var i,o,a=t.track,c=t.kind,u=r.generateIdentifier(),l=e.usingBundle&&n>0?{iceGatherer:s[0].iceGatherer,iceTransport:s[0].iceTransport,dtlsTransport:s[0].dtlsTransport}:e._createIceAndDtlsTransports(u,n),d=RTCRtpSender.getCapabilities(c),p=[{ssrc:1001*(2*n+1)}];a&&(i=new RTCRtpSender(a,l.dtlsTransport)),t.wantReceive&&(o=new RTCRtpReceiver(l.dtlsTransport,c)),s[n]={iceGatherer:l.iceGatherer,iceTransport:l.iceTransport,dtlsTransport:l.dtlsTransport,localCapabilities:d,remoteCapabilities:null,rtpSender:i,rtpReceiver:o,kind:c,mid:u,sendEncodingParameters:p,recvEncodingParameters:null}}),this.usingBundle&&(a+="a=group:BUNDLE "+s.map(function(e){return e.mid}).join(" ")+"\r\n"),n.forEach(function(t,n){var i=s[n];a+=r.writeMediaSection(i,i.localCapabilities,"offer",e.localStreams[0])}),this._pendingOffer=s;var c=new RTCSessionDescription({type:"offer",sdp:a});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,c),Promise.resolve(c)},window.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=r.writeSessionBoilerplate();this.usingBundle&&(t+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(n){if(n.isDatachannel)return void(t+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+n.mid+"\r\n");var i=e._getCommonCapabilities(n.localCapabilities,n.remoteCapabilities);t+=r.writeMediaSection(n,i,"answer",e.localStreams[0])});var n=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,n),Promise.resolve(n)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){if(null===e)this.transceivers.forEach(function(e){e.iceTransport.addRemoteCandidate({})});else{var t=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){t=n;break}var i=this.transceivers[t];if(i){var o=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===o.protocol&&(0===o.port||9===o.port))return;if("1"!==o.component)return;"endOfCandidates"===o.type&&(o={}),i.iceTransport.addRemoteCandidate(o);var a=r.splitSections(this.remoteDescription.sdp);a[t+1]+=(o.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=a.join("")}}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(n){var r=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){r.set(t,e[t]),r[t]=e[t]})}),t&&window.setTimeout(t,0,r),n(r)})})}}};t.exports={shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":10,"./getusermedia":6,sdp:1}],6:[function(e,t,n){"use strict";t.exports=function(){var e=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(n){return t(n).catch(function(t){return Promise.reject(e(t))})}}},{}],7:[function(e,t,n){"use strict";var r=e("../utils").browserDetails,i={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(r.version<38&&e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];if(o.hasOwnProperty("urls"))for(var a=0;a<o.urls.length;a++){var s={url:o.urls[a]};0===o.urls[a].indexOf("turn")&&(s.username=o.username,s.credential=o.credential),n.push(s)}else n.push(e.iceServers[i])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)};var t=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},n=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,r,i){return n.apply(this,[e||null]).then(function(e){return t(e)}).then(r,i)}}}};t.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":10,"./getusermedia":8}],8:[function(e,t,n){"use strict";var r=e("../utils").log,i=e("../utils").browserDetails;t.exports=function(){var e=function(e){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},t=function(t,n,o){var a=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return t=JSON.parse(JSON.stringify(t)),i.version<38&&(r("spec: "+JSON.stringify(t)),t.audio&&(t.audio=a(t.audio)),t.video&&(t.video=a(t.video)),r("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,n,function(t){o(e(t))})},n=function(e){return new Promise(function(n,r){t(e,n,r)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:n,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},i.version<41){var a=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return a().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(i.version<49){var s=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return s(t).catch(function(t){return Promise.reject(e(t))})}}navigator.getUserMedia=function(e,n,r){if(i.version<44)return t(e,n,r);o.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(e).then(n,r)}}},{"../utils":10}],9:[function(e,t,n){"use strict";var r={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};t.exports={shimGetUserMedia:r.shimGetUserMedia}},{}],10:[function(e,t,n){"use strict";var r=!0,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(r)return;void 0!==o&&"function"==typeof o.log&&o.log.apply(o,arguments)}},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(){var e={};if(e.browser=null,e.version=null,"undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return e}};t.exports={log:i.log,disableLog:i.disableLog,browserDetails:i.detectBrowser(),extractVersion:i.extractVersion}},{}]},{},[2])(2)}()}(),a.parseWebrtcDetectedBrowser(),navigator.mozGetUserMedia?(MediaStreamTrack.getSources=function(e){setTimeout(function(){e([{kind:"audio",id:"default",label:"",facing:""},{kind:"video",id:"default",label:"",facing:""}])},0)},attachMediaStream=function(e,t){return e.srcObject=t,e},reattachMediaStream=function(e,t){return e.srcObject=t.srcObject,e},createIceServer=function(e,t,n){o.warn("createIceServer is deprecated. It should be replaced with an application level implementation.");var r=null,i=e.split(":");if(0===i[0].indexOf("stun"))r={urls:[e]};else if(0===i[0].indexOf("turn"))if(webrtcDetectedVersion<27){var a=e.split("?");1!==a.length&&0!==a[1].indexOf("transport=udp")||(r={urls:[a[0]],credential:n,username:t})}else r={urls:[e],credential:n,username:t};return r},createIceServers=function(e,t,n){o.warn("createIceServers is deprecated. It should be replaced with an application level implementation.");var r=[];for(i=0;i<e.length;i++){var a=createIceServer(e[i],t,n);null!==a&&r.push(a)}return r}):navigator.webkitGetUserMedia?(attachMediaStream=function(e,t){return webrtcDetectedVersion>=43?e.srcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):o.error("Error attaching stream to element."),e},reattachMediaStream=function(e,t){return webrtcDetectedVersion>=43?e.srcObject=t.srcObject:e.src=t.src,e},createIceServer=function(e,t,n){o.warn("createIceServer is deprecated. It should be replaced with an application level implementation.");var r=null,i=e.split(":");return 0===i[0].indexOf("stun")?r={url:e}:0===i[0].indexOf("turn")&&(r={url:e,credential:n,username:t}),r},createIceServers=function(e,t,n){o.warn("createIceServers is deprecated. It should be replaced with an application level implementation.");var r=[];if(webrtcDetectedVersion>=34)r={urls:e,credential:n,username:t};else for(i=0;i<e.length;i++){var a=createIceServer(e[i],t,n);null!==a&&r.push(a)}return r}):navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)&&(attachMediaStream=function(e,t){return e.srcObject=t,e},reattachMediaStream=function(e,t){return e.srcObject=t.srcObject,e}),attachMediaStream_base=attachMediaStream,"opera"===webrtcDetectedBrowser&&(attachMediaStream_base=function(e,t){webrtcDetectedVersion>38?e.srcObject=t:void 0!==e.src&&(e.src=URL.createObjectURL(t))}),attachMediaStream=function(e,t){return"chrome"!==webrtcDetectedBrowser&&"opera"!==webrtcDetectedBrowser||t?attachMediaStream_base(e,t):e.src="",e},reattachMediaStream_base=reattachMediaStream,reattachMediaStream=function(e,t){return reattachMediaStream_base(e,t),e},window.attachMediaStream=attachMediaStream,window.reattachMediaStream=reattachMediaStream,window.getUserMedia=function(e,t,n){navigator.getUserMedia(e,t,n)},a.attachMediaStream=attachMediaStream,a.reattachMediaStream=reattachMediaStream,a.getUserMedia=getUserMedia,"undefined"==typeof Promise&&(requestUserMedia=null),a.maybeThroughWebRTCReady()),function(){"use strict";var e=null;a.TEXT.EXTENSION={REQUIRE_INSTALLATION_FF:"To enable screensharing you need to install the Skylink WebRTC tools Firefox Add-on.",REQUIRE_INSTALLATION_CHROME:"To enable screensharing you need to install the Skylink WebRTC tools Chrome Extension.",REQUIRE_REFRESH:"Please refresh this page after the Skylink WebRTC tools extension has been installed.",BUTTON_FF:"Install Now",BUTTON_CHROME:"Go to Chrome Web Store"};var t=function(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t};if(window.navigator.mozGetUserMedia?(e=window.navigator.getUserMedia,navigator.getUserMedia=function(n,r,i){if(n&&n.video&&n.video.mediaSource){if("screen"!==n.video.mediaSource&&"window"!==n.video.mediaSource)return void i(new Error('GetUserMedia: Only "screen" and "window" are supported as mediaSource constraints'));var o=t(n);o.video.mozMediaSource=o.video.mediaSource;var s=setInterval(function(){"complete"===document.readyState&&(clearInterval(s),e(o,r,function(e){["PermissionDeniedError","SecurityError"].indexOf(e.name)>-1&&"https:"===window.parent.location.protocol?a.renderNotificationBar(a.TEXT.EXTENSION.REQUIRE_INSTALLATION_FF,a.TEXT.EXTENSION.BUTTON_FF,"https://addons.mozilla.org/en-US/firefox/addon/skylink-webrtc-tools/",!0,!0):i(e)}))},1)}else e(n,r,i)},a.getUserMedia=window.getUserMedia=navigator.getUserMedia):window.navigator.webkitGetUserMedia&&"safari"!==window.webrtcDetectedBrowser?(e=window.navigator.getUserMedia,navigator.getUserMedia=function(n,i,o){if(n&&n.video&&n.video.mediaSource){if("chrome"!==window.webrtcDetectedBrowser)return void o(new Error("Current browser does not support screensharing"));var s=t(n),c=function(t,n){t?o("permission-denied"===t?new Error("Permission denied for screen retrieval"):new Error("Failed retrieving selected screen")):(s.video.mandatory=s.video.mandatory||{},s.video.mandatory.chromeMediaSource="desktop",s.video.mandatory.maxWidth=window.screen.width>1920?window.screen.width:1920,s.video.mandatory.maxHeight=window.screen.height>1080?window.screen.height:1080,n&&(s.video.mandatory.chromeMediaSourceId=n),delete s.video.mediaSource,e(s,i,o))},u=function(e){e.data&&(e.data.chromeMediaSourceId&&("PermissionDeniedError"===e.data.chromeMediaSourceId?c("permission-denied"):c(null,e.data.chromeMediaSourceId)),e.data.chromeExtensionStatus&&("not-installed"===e.data.chromeExtensionStatus?a.renderNotificationBar(a.TEXT.EXTENSION.REQUIRE_INSTALLATION_CHROME,a.TEXT.EXTENSION.BUTTON_CHROME,e.data.data,!0,!0):c(e.data.chromeExtensionStatus,null)),window.removeEventListener("message",u))};window.addEventListener("message",u),r({captureSourceId:!0})}else e(n,i,o)},a.getUserMedia=window.getUserMedia=navigator.getUserMedia,navigator.mediaDevices.getUserMedia=function(e){return new Promise(function(t,n){window.getUserMedia(e,t,n)})}):navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?o.warn("Edge does not support screensharing feature in getUserMedia"):(e=window.navigator.getUserMedia,navigator.getUserMedia=function(n,r,i){if(n&&n.video&&n.video.mediaSource){var o=t(n);a.WebRTCPlugin.callWhenPluginReady(function(){if(!a.WebRTCPlugin.plugin.HasScreensharingFeature||!a.WebRTCPlugin.plugin.isScreensharingAvailable)return void i(new Error("Your version of the WebRTC plugin does not support screensharing"));o.video.optional=o.video.optional||[],o.video.optional.push({sourceId:a.WebRTCPlugin.plugin.screensharingKey||"Screensharing"}),delete o.video.mediaSource,e(o,r,i)})}else e(n,r,i)},a.getUserMedia=getUserMedia=window.getUserMedia=navigator.getUserMedia,navigator.mediaDevices&&"undefined"!=typeof Promise&&(navigator.mediaDevices.getUserMedia="undefined"==typeof requestUserMedia?void 0:requestUserMedia)),"chrome"===window.webrtcDetectedBrowser){var n=document.createElement("iframe");n.onload=function(){n.isLoaded=!0},n.src="https://cdn.temasys.com.sg/skylink/extensions/detectRTC.html",n.style.display="none",(document.body||document.documentElement).appendChild(n);var r=function(e){if(e=e||{},!n.isLoaded)return void setTimeout(function(){n.contentWindow.postMessage(e,"*")},100);n.contentWindow.postMessage(e,"*")}}else"opera"===window.webrtcDetectedBrowser&&o.warn("Opera does not support screensharing feature in getUserMedia")}()}).call(t,"modules/RTC/adapter.screenshare.js")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"STATUS_AVAILABLE",function(){return r}),n.d(t,"STATUS_UNDEFINED",function(){return i}),n.d(t,"STATUS_BUSY",function(){return o}),n.d(t,"STATE_ON",function(){return a}),n.d(t,"STATE_OFF",function(){return s}),n.d(t,"STATE_PENDING",function(){return c}),n.d(t,"STATE_RETRYING",function(){return u}),n.d(t,"STATE_FAILED",function(){return l});var r="available",i="undefined",o="busy",a="on",s="off",c="pending",u="retrying",l="failed"},function(e,t){function n(){var e={methodName:"",fileLocation:"",line:null,column:null},t=new Error,n=t.stack?t.stack.split("\n"):[];if(!n||n.length<1)return e;var r=null;return n[3]&&(r=n[3].match(/\s*at\s*(.+?)\s*\((\S*)\s*:(\d*)\s*:(\d*)\)/)),!r||r.length<=4?(0===n[2].indexOf("log@")?e.methodName=n[3].substr(0,n[3].indexOf("@")):e.methodName=n[2].substr(0,n[2].indexOf("@")),e):(e.methodName=r[1],e.fileLocation=r[2],e.line=r[3],e.column=r[4],e)}function r(){var e=arguments[0],t=arguments[1],r=Array.prototype.slice.call(arguments,2);if(!(o[t]<e.level))for(var i=n(),s=a.concat(e.transports),c=0;c<s.length;c++){var u=s[c],l=u[t];l&&"function"==typeof l&&l.bind(u,e.id?"["+e.id+"]":"","<"+i.methodName+">: ").apply(u,r)}}function i(e,t,n,i){this.id=t,this.format=i,this.transports=n,this.transports||(this.transports=[]),this.level=o[e];for(var a=Object.keys(o),s=0;s<a.length;s++)this[a[s]]=r.bind(null,this,a[s])}var o={trace:0,debug:1,info:2,log:3,warn:4,error:5};i.consoleTransport=console;var a=[i.consoleTransport];i.addGlobalTransport=function(e){-1===a.indexOf(e)&&a.push(e)},i.removeGlobalTransport=function(e){var t=a.indexOf(e);-1!==t&&a.splice(t,1)},i.prototype.setLevel=function(e){this.level=o[e]},e.exports=i,i.levels={TRACE:"trace",DEBUG:"debug",INFO:"info",LOG:"log",WARN:"warn",ERROR:"error"}},function(e,t,n){function r(e,t){this._id=e,this._clearFn=t}var i=Function.prototype.apply;t.setTimeout=function(){return new r(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(84),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(24),a=function(){function e(t){r(this,e),this.connection=t,this.active=!1,this.results={}}return i(e,[{key:"getResults",value:function(){return this.results}},{key:"start",value:function(){var e=this,t=new o(function(t,n){e.resolveCb=t,e.rejectCb=n});return this.connection.setMessageCallback(this.handleMessage.bind(this)),this.connection.setErrorCallback(this.handleError.bind(this)),this.active=!0,this.forceStopped=!1,this.initiate(),t}},{key:"stop",value:function(){this.active=!1}},{key:"forceStop",value:function(){this.forceStopped=!0,this.stop(),this.finished()}},{key:"isActive",value:function(){return this.active}},{key:"initiate",value:function(){}},{key:"handleMessage",value:function(e){}},{key:"handleError",value:function(e){}},{key:"send",value:function(e){this.connection.send(e)}},{key:"finished",value:function(){this.active=!1,this.resolveCb()}},{key:"failed",value:function(e){this.active=!1,this.rejectCb(e)}}]),e}();t.TurnTest=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(35+58*Math.random());return t}Object.defineProperty(t,"__esModule",{value:!0}),t.randomAsciiString=t.MessageMaker=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(21),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(a),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1200;r(this,e),this.message={timestamp:"",sentBytes:1e4,padding:""};var n=i(t-s.getCurrent().toString().length-JSON.stringify(this.message).length);this.message.padding=n}return o(e,[{key:"make",value:function(e){return this.message.timestamp=s.getCurrent(),this.message.sentBytes=e,JSON.stringify(this.message)}}]),e}();t.MessageMaker=c,t.randomAsciiString=i},function(e,t,n){"use strict";function r(e){for(var t=0,n=e.length,r=0;r<n;r++)t<e[r]&&(t=e[r]);return parseFloat(((t-127)/128).toFixed(3))}function i(e,t){var n=0,r=t-e;return n=r>.2?t-.2:r<-.4?t+.4:e,parseFloat(n.toFixed(3))}function o(e,t,n){this.stream=e,this.intervalId=null,this.intervalMilis=t,this.audioLevel=0,this.callback=n}t.a=o;var a=n(1);window.AudioContext=window.AudioContext||window.webkitAudioContext;var s=null;window.AudioContext&&(s=new AudioContext,s.suspend&&s.suspend()),o.prototype.start=function(){if(o.isLocalStatsSupported()){s.resume();var e=s.createAnalyser();e.smoothingTimeConstant=.8,e.fftSize=2048,s.createMediaStreamSource(this.stream).connect(e);var t=this;this.intervalId=setInterval(function(){var n=new Uint8Array(e.frequencyBinCount);e.getByteTimeDomainData(n);var o=r(n);o!==t.audioLevel&&(t.audioLevel=i(o,t.audioLevel),t.callback(t.audioLevel))},this.intervalMilis)}},o.prototype.stop=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},o.isLocalStatsSupported=function(){return Boolean(s&&!a.a.isTemasysPluginUsed())}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"d",function(){return a});var r="statistics.audioLevel",i="statistics.before_disposed",o="statistics.byte_sent_stats",a="statistics.connectionstats"},function(e,t,n){var r=n(90),i={loadScript:function(e,t,n,i,o,a){var s=document,c=s.createElement("script"),u=s.getElementsByTagName("script")[0];if(c.async=t,i){var l=r();if(l){var d=l.src,p=d.substring(0,d.lastIndexOf("/")+1);d&&p&&(e=p+e)}}o&&(c.onload=o),a&&(c.onerror=a),c.src=e,n?u.parentNode.insertBefore(c,u):u.parentNode.appendChild(c)}};e.exports=i},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/http-bind";return e&&(t+=(-1===t.indexOf("?")?"?":"&")+"token="+e),new c.Strophe.Connection(t)}var s=n(0),c=(n.n(s),n(2)),u=(n.n(c),n(95)),l=(n.n(u),n(19)),d=n.n(l),p=n(45),h=n(25),f=n(1),m=n(96),v=n(99),g=n(106),y=n(107),b=n(108),_=n(109),S=n(9),T=n(110),C=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),E=Object(s.getLogger)(e),w=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.connection=null,o.disconnectInProgress=!1,o.connectionTimes={},o.forceMuted=!1,o.options=e,o.connectParams={},o.token=n,o.authenticatedUser=!1,o._initStrophePlugins(o),o.connection=a(n,e.bosh),o.caps=new T.a(o.connection,o.options.clientNode),o.initFeaturesList(),$(window).on("beforeunload unload",o.disconnect.bind(o)),o}return o(t,e),C(t,[{key:"initFeaturesList",value:function(){this.caps.addFeature("urn:xmpp:jingle:1"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:1"),this.caps.addFeature("urn:xmpp:jingle:transports:ice-udp:1"),this.caps.addFeature("urn:xmpp:jingle:apps:dtls:0"),this.caps.addFeature("urn:xmpp:jingle:transports:dtls-sctp:1"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:audio"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:video"),!this.options.disableRtx&&f.a.supportsRtx()&&this.caps.addFeature("urn:ietf:rfc:4588"),this.caps.addFeature("urn:ietf:rfc:5761"),this.caps.addFeature("urn:ietf:rfc:5888"),f.a.isChrome()&&!1!==this.options.enableLipSync&&(E.info("Lip-sync enabled !"),this.caps.addFeature("http://jitsi.org/meet/lipsync")),this.connection.rayo&&this.caps.addFeature("urn:xmpp:rayo:client:1")}},{key:"getConnection",value:function(){return this.connection}},{key:"connectionHandler",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this,n=arguments[1],r=arguments[2],i=window.performance.now(),o=c.Strophe.getStatusString(n).toLowerCase();if(this.connectionTimes[o]=i,E.log("(TIME) Strophe "+o+(r?"["+r+"]":"")+":\t",i),n===c.Strophe.Status.CONNECTED||n===c.Strophe.Status.ATTACHED){(this.options.useStunTurn||this.options.p2p&&this.options.p2p.useStunTurn)&&this.connection.jingle.getStunAndTurnCredentials(),E.info("My Jabber ID: "+this.connection.jid);var a=this.connection.domain;this.connection.ping.hasPingSupport(a,function(e){e?t.connection.ping.startInterval(a):E.warn("Ping NOT supported by "+a)}),e.password&&(this.authenticatedUser=!0),this.connection&&this.connection.connected&&c.Strophe.getResourceFromJid(this.connection.jid)&&this.eventEmitter.emit(h.CONNECTION_ESTABLISHED,c.Strophe.getResourceFromJid(this.connection.jid))}else if(n===c.Strophe.Status.CONNFAIL)"x-strophe-bad-non-anon-jid"===r?this.anonymousConnectionFailed=!0:this.connectionFailed=!0,this.lastErrorMsg=r;else if(n===c.Strophe.Status.DISCONNECTED){this.connection.ping.stopInterval();var s=this.disconnectInProgress,u=r||this.lastErrorMsg;if(this.disconnectInProgress=!1,this.anonymousConnectionFailed)this.eventEmitter.emit(h.CONNECTION_FAILED,p.PASSWORD_REQUIRED);else if(this.connectionFailed)this.eventEmitter.emit(h.CONNECTION_FAILED,p.OTHER_ERROR,u);else if(s)this.eventEmitter.emit(h.CONNECTION_DISCONNECTED,u);else{E.error("XMPP connection dropped!");var l=c.Strophe.getLastErrorStatus();l>=500&&l<600?this.eventEmitter.emit(h.CONNECTION_FAILED,p.SERVER_ERROR,u||"server-error"):this.eventEmitter.emit(h.CONNECTION_FAILED,p.CONNECTION_DROPPED_ERROR,u||"connection-dropped-error")}}else n===c.Strophe.Status.AUTHFAIL&&this.eventEmitter.emit(h.CONNECTION_FAILED,p.PASSWORD_REQUIRED,r,e)}},{key:"_connect",value:function(e,t){this.anonymousConnectionFailed=!1,this.connectionFailed=!1,this.lastErrorMsg=void 0,this.connection.connect(e,t,this.connectionHandler.bind(this,{jid:e,password:t}))}},{key:"attach",value:function(e){var t=this.connectionTimes.attaching=window.performance.now();E.log("(TIME) Strophe Attaching\t:"+t),this.connection.attach(e.jid,e.sid,parseInt(e.rid,10)+1,this.connectionHandler.bind(this,{jid:e.jid,password:e.password}))}},{key:"connect",value:function(e,t){if(this.connectParams={jid:e,password:t},!e){var n=this.options.hosts,r=n.anonymousdomain,i=n.domain,o=r||i,a=window,s=a.location;if(r){var c=s&&s.search;(c&&-1!==c.indexOf("login=true")||this.token)&&(o=i)}e=o||s&&s.hostname}return this._connect(e,t)}},{key:"createRoom",value:function(e,t){var n=c.Strophe.getNodeFromJid(this.connection.jid),r=e+"@"+this.options.hosts.muc+"/",i=t.useNicks&&t.nick?t.nick:null;return i?n=t.nick:this.authenticatedUser||(n=n.substr(0,8)),(this.authenticatedUser||null!==i)&&(n+="-"+d.a.randomHexString(6)),r+=n,this.connection.emuc.createRoom(r,null,t)}},{key:"getJingleLog",value:function(){var e=this.connection.jingle;return e?e.getLog():{}}},{key:"getXmppLog",value:function(){return(this.connection.logger||{}).log||null}},{key:"dial",value:function(){var e;(e=this.connection.rayo).dial.apply(e,arguments)}},{key:"setMute",value:function(e,t){this.connection.moderate.setMute(e,t)}},{key:"eject",value:function(e){this.connection.moderate.eject(e)}},{key:"getSessions",value:function(){return this.connection.jingle.sessions}},{key:"disconnect",value:function(e){if(this.disconnectInProgress||!this.connection||!this.connection.connected)return void this.eventEmitter.emit(h.WRONG_STATE);if(this.disconnectInProgress=!0,this.connection.flush(),null!==e&&void 0!==e){var t=e.type;"beforeunload"!==t&&"unload"!==t||(this.connection.options.sync=!0)}this.connection.disconnect(),!0!==this.connection.options.sync&&this.connection.flush()}},{key:"_initStrophePlugins",value:function(){var e=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}],t=this.options.p2p&&this.options.p2p.stunServers||e;Object(m.a)(this),Object(v.a)(this,this.eventEmitter,t),Object(g.a)(),Object(y.a)(this),Object(b.a)(),Object(_.a)()}}]),t}(S.a);t.a=w}).call(t,"modules/xmpp/xmpp.js")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"CONNECTION_DROPPED_ERROR",function(){return r}),n.d(t,"CONNECTION_ERROR",function(){return i}),n.d(t,"OTHER_ERROR",function(){return o}),n.d(t,"PASSWORD_REQUIRED",function(){return a}),n.d(t,"SERVER_ERROR",function(){return s});var r="connection.droppedError",i="connection.connectionError",o="connection.otherError",a="connection.passwordRequired",s="connection.serverError"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"ON",function(){return r}),n.d(t,"OFF",function(){return i});var r="on",i="off"},function(e,t){var n={IDENTITY_UPDATED:"authentication.identity_updated"};e.exports=n},function(e,t,n){"use strict";(function(e){function r(e){if("function"==typeof e.querySelector){var t=e.querySelector("error"),n=t&&t.querySelector("text");return t&&{code:t.attributes.code&&t.attributes.code.value,type:t.attributes.type&&t.attributes.type.value,message:n&&n.textContent}}var r=null,i=!0,o=!1,a=void 0;try{for(var s,c=e.children[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;if("error"===u.tagName){r=u;break}}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}if(!r)return null;var l=null,d=!0,p=!1,h=void 0;try{for(var f,m=r.children[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var v=f.value;if("text"===v.tagName){l=v.value;break}}}catch(e){p=!0,h=e}finally{try{!d&&m.return&&m.return()}finally{if(p)throw h}}return{code:r.attributes.code,type:r.attributes.type,message:l}}function i(e,t,n,r,o,a){this.eventEmitter=t,this.connection=n,this.state=null,this.focusMucJid=r,this.jirecon=o,this.url=null,this.type=e,this._isSupported=!(e===i.types.JIRECON&&!this.jirecon||e!==i.types.JIBRI&&e!==i.types.JIBRI_FILE&&e!==i.types.COLIBRI),this.jireconRid=null,this.roomjid=a}t.a=i;var o=n(0),a=(n.n(o),n(2)),s=(n.n(a),n(7)),c=n(49),u=n(3),l=Object(o.getLogger)(e);i.types={COLIBRI:"colibri",JIRECON:"jirecon",JIBRI:"jibri",JIBRI_FILE:"jibri_file"},i.status={ON:"on",OFF:"off",AVAILABLE:"available",UNAVAILABLE:"unavailable",PENDING:"pending",RETRYING:"retrying",ERROR:"error",BUSY:"busy",FAILED:"failed"},i.action={START:"start",STOP:"stop"},i.prototype.handleJibriPresence=function(e){var t=e.attributes;if(t){var n=t.status,o=r(e);l.log("Handle Jibri presence : "+n,o),n!==this.state&&("undefined"===n?this.state=i.status.UNAVAILABLE:n===i.status.OFF?this.state&&"undefined"!==this.state&&this.state!==i.status.UNAVAILABLE?this.state=i.status.OFF:this.state=i.status.AVAILABLE:this.state=n,this.eventEmitter.emit(s.RECORDER_STATE_CHANGED,this.state))}},i.prototype.setRecordingJibri=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e===this.state&&n(c.INVALID_STATE);var s=Object(a.$iq)({to:this.focusMucJid,type:"set"}).c("jibri",{xmlns:"http://jitsi.org/protocol/jibri",action:e===i.status.ON?i.action.START:i.action.STOP,recording_mode:this.type===i.types.JIBRI_FILE?"file":"stream",streamid:this.type===i.types.JIBRI?o.streamId:void 0}).up();l.log("Set jibri recording: "+e,s.nodeTree),l.log(s.nodeTree),this.connection.sendIQ(s,function(e){l.log("Result",e);var n=$(e).find("jibri");t(n.attr("state"),n.attr("url"))},function(e){l.log("Failed to start recording, error: ",r(e)),n(e)})},i.prototype.setRecordingJirecon=function(e,t,n){e===this.state&&n(new Error("Invalid state!"));var r=Object(a.$iq)({to:this.jirecon,type:"set"}).c("recording",{xmlns:"http://jitsi.org/protocol/jirecon",action:e===i.status.ON?i.action.START:i.action.STOP,mucjid:this.roomjid});e===i.status.OFF&&r.attrs({rid:this.jireconRid}),l.log("Start recording");var o=this;this.connection.sendIQ(r,function(n){o.jireconRid=$(n).find("recording").attr("rid");var r=e===i.status.ON?"started":"stopped";l.log("Recording "+r+"(jirecon)"+n),o.state=e,e===i.status.OFF&&(o.jireconRid=null),t(e)},function(e){l.log("Failed to start recording, error: ",e),n(e)})},i.prototype.setRecordingColibri=function(e,t,n,r){var i=Object(a.$iq)({to:this.focusMucJid,type:"set"});i.c("conference",{xmlns:"http://jitsi.org/protocol/colibri"}),i.c("recording",{state:e,token:r.token});var o=this;this.connection.sendIQ(i,function(n){l.log('Set recording "',e,'". Result:',n);var r=$(n).find(">conference>recording"),i=r.attr("state");o.state=i,t(i),"pending"===i&&o.connection.addHandler(function(e){var n=$(e).find("recording").attr("state");n&&(o.state=i,t(n))},"http://jitsi.org/protocol/colibri","iq",null,null,null)},function(e){l.warn(e),n(e)})},i.prototype.setRecording=function(){switch(this.type){case i.types.JIRECON:this.setRecordingJirecon.apply(this,arguments);break;case i.types.COLIBRI:this.setRecordingColibri.apply(this,arguments);break;case i.types.JIBRI:case i.types.JIBRI_FILE:this.setRecordingJibri.apply(this,arguments);break;default:var e="Unknown recording type!";u.callErrorHandler(new Error(e)),l.error(e)}},i.prototype.toggleRecording=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=this.state;if(n===i.status.UNAVAILABLE||n===i.status.FAILED?t(i.status.FAILED,c.RECORDER_UNAVAILABLE):n===i.status.BUSY&&t(i.status.BUSY,c.RECORDER_BUSY),(n===i.status.OFF||n===i.status.AVAILABLE)&&(!e.token&&this.type===i.types.COLIBRI||!e.streamId&&this.type===i.types.JIBRI))return t(i.status.FAILED,c.NO_TOKEN),void l.error("No token passed!");var r=n===i.status.AVAILABLE||n===i.status.OFF?i.status.ON:i.status.OFF,o=this;l.log("Toggle recording (old state, new state): ",n,r),this.setRecording(r,function(e,r){e&&e!==n&&(o.state=e,o.url=r,t(e))},function(e){return t(i.status.FAILED,e)},e)},i.prototype.isSupported=function(){return this._isSupported},i.prototype.getState=function(){return this.state},i.prototype.getURL=function(){return this.url}}).call(t,"modules/xmpp/recording.js")},function(e,t){var n={RECORDER_UNAVAILABLE:"recorder.unavailable",RECORDER_BUSY:"recorder.busy",NO_TOKEN:"recorder.noToken",STATE_CHANGE_FAILED:"recorder.stateChangeFailed",INVALID_STATE:"recorder.invalidState"};e.exports=n},function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var r="pending",i="active",o="ended"},function(e,t,n){"use strict";function r(e){for(var t=e.split("\r\nm="),n=1,r=t.length;n<r;n++){var i="m="+t[n];n!==r-1&&(i+="\r\n"),t[n]=i}var o=t.shift()+"\r\n";this.media=t,this.raw=o+t.join(""),this.session=o}t.a=r;var i=n(12);r.prototype.failICE=!1,r.prototype.removeTcpCandidates=!1,r.prototype.removeUdpCandidates=!1,r.prototype.getMediaSsrcMap=function(){for(var e=this,t={},n=void 0,r=0;r<e.media.length;r++)!function(r){n=i.a.findLines(e.media[r],"a=ssrc:");var o=i.a.parseMID(i.a.findLine(e.media[r],"a=mid:")),a={mediaindex:r,mid:o,ssrcs:{},ssrcGroups:[]};t[r]=a,n.forEach(function(e){var t=e.substring(7).split(" ")[0];a.ssrcs[t]||(a.ssrcs[t]={ssrc:t,lines:[]}),a.ssrcs[t].lines.push(e)}),n=i.a.findLines(e.media[r],"a=ssrc-group:"),n.forEach(function(e){var t=e.indexOf(" "),n=e.substr(0,t).substr(13),r=e.substr(14+n.length).split(" ");r.length&&a.ssrcGroups.push({semantics:n,ssrcs:r})})}(r);return t},r.prototype.containsSSRC=function(e){var t=this.getMediaSsrcMap(),n=!1;return Object.keys(t).forEach(function(r){n||t[r].ssrcs[e]&&(n=!0)}),n},r.prototype.mangle=function(){var e=void 0,t=void 0,n=void 0,r=void 0,o=void 0,a=void 0;for(e=0;e<this.media.length;e++)if(n=this.media[e].split("\r\n"),n.pop(),r=i.a.parseMLine(n.shift()),"audio"===r.media){for(o="",r.fmt.length=0,t=0;t<n.length;t++){if("a=rtpmap:"===n[t].substr(0,9)){if(a=i.a.parseRTPMap(n[t]),"CN"===a.name||"ISAC"===a.name)continue;r.fmt.push(a.id)}o+=n[t]+"\r\n"}this.media[e]=i.a.buildMLine(r)+"\r\n"+o}this.raw=this.session+this.media.join("")},r.prototype.removeSessionLines=function(e){var t=this,n=i.a.findLines(this.session,e);return n.forEach(function(e){t.session=t.session.replace(e+"\r\n","")}),this.raw=this.session+this.media.join(""),n},r.prototype.removeMediaLines=function(e,t){var n=this,r=i.a.findLines(this.media[e],t);return r.forEach(function(t){n.media[e]=n.media[e].replace(t+"\r\n","")}),this.raw=this.session+this.media.join(""),r},r.prototype.toJingle=function(e,t){var n=void 0,r=void 0,o=void 0,a=void 0,s=void 0,c=void 0,u=void 0,l=void 0;if(a=i.a.findLines(this.session,"a=group:"),a.length)for(n=0;n<a.length;n++){l=a[n].split(" ");var d=l.shift().substr(8);for(e.c("group",{xmlns:"urn:xmpp:jingle:apps:grouping:0",semantics:d}),r=0;r<l.length;r++)e.c("content",{name:l[r]}).up();e.up()}for(n=0;n<this.media.length;n++)if(s=i.a.parseMLine(this.media[n].split("\r\n")[0]),"audio"===s.media||"video"===s.media||"application"===s.media){var p=i.a.findLine(this.media[n],"a=ssrc:");u=!!p&&p.substring(7).split(" ")[0],e.c("content",{creator:t,name:s.media});var h=i.a.findLine(this.media[n],"a=mid:");if(h){var f=i.a.parseMID(h);e.attrs({name:f})}if(i.a.findLine(this.media[n],"a=rtpmap:").length){for(e.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:s.media}),u&&e.attrs({ssrc:u}),r=0;r<s.fmt.length;r++){c=i.a.findLine(this.media[n],"a=rtpmap:"+s.fmt[r]),e.c("payload-type",i.a.parseRTPMap(c));var m=i.a.findLine(this.media[n],"a=fmtp:"+s.fmt[r]);if(m)for(l=i.a.parseFmtp(m),o=0;o<l.length;o++)e.c("parameter",l[o]).up();this.rtcpFbToJingle(n,e,s.fmt[r]),e.up()}var v=i.a.findLines(this.media[n],"a=crypto:",this.session);if(v.length&&(e.c("encryption",{required:1}),v.forEach(function(t){return e.c("crypto",i.a.parseCrypto(t)).up()}),e.up()),u){e.c("source",{ssrc:u,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"});var g=i.a.findLines(this.media[n],"a=ssrc:");if(g.length>0)g.forEach(function(t){var n=t.indexOf(" "),r=t.substr(0,n).substr(7);r!==u&&(e.up(),u=r,e.c("source",{ssrc:u,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}));var o=t.substr(n+1);if(e.c("parameter"),-1===o.indexOf(":"))e.attrs({name:o});else{var a=o.split(":",2)[0];e.attrs({name:a});var s=o.split(":",2)[1];s=i.a.filterSpecialChars(s),e.attrs({value:s})}e.up()});else{e.up(),e.c("source",{ssrc:u,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),e.c("parameter"),e.attrs({name:"cname",value:Math.random().toString(36).substring(7)}),e.up();var y=null,b=APP.RTC.getLocalTracks(s.media);b&&(y=b.getTrackId()),null!==y&&(y=i.a.filterSpecialChars(y),e.c("parameter"),e.attrs({name:"msid",value:y}),e.up(),e.c("parameter"),e.attrs({name:"mslabel",value:y}),e.up(),e.c("parameter"),e.attrs({name:"label",value:y}),e.up())}e.up();var _=i.a.findLines(this.media[n],"a=ssrc-group:");_.forEach(function(t){var n=t.indexOf(" "),r=t.substr(0,n).substr(13),i=t.substr(14+r.length).split(" ");i.length&&(e.c("ssrc-group",{semantics:r,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),i.forEach(function(t){return e.c("source",{ssrc:t}).up()}),e.up())})}var S=i.a.findLines(this.media[n],"a=rid");if(S.length){var T=S.map(function(e){return e.split(":")[1]}).map(function(e){return e.split(" ")[0]});T.forEach(function(t){e.c("source",{rid:t,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),e.up()});var C=i.a.findLine(this.media[n],"a=simulcast");C&&(e.c("rid-group",{semantics:"SIM",xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),T.forEach(function(t){e.c("source",{rid:t}).up()}),e.up())}if(i.a.findLine(this.media[n],"a=rtcp-mux")&&e.c("rtcp-mux").up(),this.rtcpFbToJingle(n,e,"*"),a=i.a.findLines(this.media[n],"a=extmap:"),a.length)for(r=0;r<a.length;r++){if(l=i.a.parseExtmap(a[r]),e.c("rtp-hdrext",{xmlns:"urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",uri:l.uri,id:l.value}),l.hasOwnProperty("direction"))switch(l.direction){case"sendonly":e.attrs({senders:"responder"});break;case"recvonly":e.attrs({senders:"initiator"});break;case"sendrecv":e.attrs({senders:"both"});break;case"inactive":e.attrs({senders:"none"})}e.up()}e.up()}this.transportToJingle(n,e);var E=this.media[n];i.a.findLine(E,"a=sendrecv",this.session)?e.attrs({senders:"both"}):i.a.findLine(E,"a=sendonly",this.session)?e.attrs({senders:"initiator"}):i.a.findLine(E,"a=recvonly",this.session)?e.attrs({senders:"responder"}):i.a.findLine(E,"a=inactive",this.session)&&e.attrs({senders:"none"}),"0"===s.port&&e.attrs({senders:"rejected"}),e.up()}return e.up(),e},r.prototype.transportToJingle=function(e,t){var n=void 0,r=this;t.c("transport");var o=i.a.findLine(this.media[e],"a=sctpmap:",r.session);if(o){var a=i.a.parseSCTPMap(o);t.c("sctpmap",{xmlns:"urn:xmpp:jingle:transports:dtls-sctp:1",number:a[0],protocol:a[1]}),a.length>2&&t.attrs({streams:a[2]}),t.up()}if(i.a.findLines(this.media[e],"a=fingerprint:",this.session).forEach(function(o){n=i.a.parseFingerprint(o),n.xmlns="urn:xmpp:jingle:apps:dtls:0",t.c("fingerprint").t(n.fingerprint),delete n.fingerprint,o=i.a.findLine(r.media[e],"a=setup:",r.session),o&&(n.setup=o.substr(8)),t.attrs(n),t.up()}),n=i.a.iceparams(this.media[e],this.session)){n.xmlns="urn:xmpp:jingle:transports:ice-udp:1",t.attrs(n);var s=i.a.findLines(this.media[e],"a=candidate:",this.session);s.length&&s.forEach(function(e){var n=i.a.candidateToJingle(e);r.failICE&&(n.ip="1.1.1.1");var o=n&&"string"==typeof n.protocol?n.protocol.toLowerCase():"";r.removeTcpCandidates&&("tcp"===o||"ssltcp"===o)||r.removeUdpCandidates&&"udp"===o||t.c("candidate",n).up()})}t.up()},r.prototype.rtcpFbToJingle=function(e,t,n){i.a.findLines(this.media[e],"a=rtcp-fb:"+n).forEach(function(e){var n=i.a.parseRTCPFB(e);"trr-int"===n.type?(t.c("rtcp-fb-trr-int",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",value:n.params[0]}),t.up()):(t.c("rtcp-fb",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",type:n.type}),n.params.length>0&&t.attrs({subtype:n.params[0]}),t.up())})},r.prototype.rtcpFbFromJingle=function(e,t){var n="",r=e.find('>rtcp-fb-trr-int[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]');return r.length&&(n+="a=rtcp-fb:* trr-int ",r.attr("value")?n+=r.attr("value"):n+="0",n+="\r\n"),r=e.find('>rtcp-fb[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]'),r.each(function(){n+="a=rtcp-fb:"+t+" "+$(this).attr("type"),$(this).attr("subtype")&&(n+=" "+$(this).attr("subtype")),n+="\r\n"}),n},r.prototype.fromJingle=function(e){var t=this;this.raw="v=0\r\no=- 1923518516 2 IN IP4 0.0.0.0\r\ns=-\r\nt=0 0\r\n";var n=$(e).find('>group[xmlns="urn:xmpp:jingle:apps:grouping:0"]');n.length&&n.each(function(e,n){var r=$(n).find(">content").map(function(e,t){return t.getAttribute("name")}).get();r.length>0&&(t.raw+="a=group:"+(n.getAttribute("semantics")||n.getAttribute("type"))+" "+r.join(" ")+"\r\n")}),this.session=this.raw,e.find(">content").each(function(){var e=t.jingle2media($(this));t.media.push(e)}),this.raw=this.session+this.media.join("")},r.prototype.jingle2media=function(e){var t=e.find("description"),n="",r=this,o=e.find('>transport>sctpmap[xmlns="urn:xmpp:jingle:transports:dtls-sctp:1"]'),a={media:t.attr("media")};if(a.port="1","rejected"===e.attr("senders")&&(a.port="0"),e.find(">transport>fingerprint").length||t.find("encryption").length?a.proto=o.length?"DTLS/SCTP":"RTP/SAVPF":a.proto="RTP/AVPF",o.length){n+="m=application 1 DTLS/SCTP "+o.attr("number")+"\r\n",n+="a=sctpmap:"+o.attr("number")+" "+o.attr("protocol");var s=o.attr("streams");n+=s?" "+s+"\r\n":"\r\n"}else a.fmt=t.find("payload-type").map(function(){return this.getAttribute("id")}).get(),n+=i.a.buildMLine(a)+"\r\n";switch(n+="c=IN IP4 0.0.0.0\r\n",o.length||(n+="a=rtcp:1 IN IP4 0.0.0.0\r\n"),a=e.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]'),a.length&&(a.attr("ufrag")&&(n+=i.a.buildICEUfrag(a.attr("ufrag"))+"\r\n"),a.attr("pwd")&&(n+=i.a.buildICEPwd(a.attr("pwd"))+"\r\n"),a.find(">fingerprint").each(function(){n+="a=fingerprint:"+this.getAttribute("hash"),n+=" "+$(this).text(),n+="\r\n",this.getAttribute("setup")&&(n+="a=setup:"+this.getAttribute("setup")+"\r\n")})),e.attr("senders")){case"initiator":n+="a=sendonly\r\n";break;case"responder":n+="a=recvonly\r\n";break;case"none":n+="a=inactive\r\n";break;case"both":n+="a=sendrecv\r\n"}return n+="a=mid:"+e.attr("name")+"\r\n",t.find("rtcp-mux").length&&(n+="a=rtcp-mux\r\n"),t.find("encryption").length&&t.find("encryption>crypto").each(function(){n+="a=crypto:"+this.getAttribute("tag"),n+=" "+this.getAttribute("crypto-suite"),n+=" "+this.getAttribute("key-params"),this.getAttribute("session-params")&&(n+=" "+this.getAttribute("session-params")),n+="\r\n"}),t.find("payload-type").each(function(){n+=i.a.buildRTPMap(this)+"\r\n",$(this).find(">parameter").length&&(n+="a=fmtp:"+this.getAttribute("id")+" ",n+=$(this).find("parameter").map(function(){var e=this.getAttribute("name");return(e?e+"=":"")+this.getAttribute("value")}).get().join("; "),n+="\r\n"),n+=r.rtcpFbFromJingle($(this),this.getAttribute("id"))}),n+=r.rtcpFbFromJingle(t,"*"),a=t.find('>rtp-hdrext[xmlns="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0"]'),a.each(function(){n+="a=extmap:"+this.getAttribute("id")+" "+this.getAttribute("uri")+"\r\n"}),e.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]>candidate').each(function(){var e=this.getAttribute("protocol");e="string"==typeof e?e.toLowerCase():"",r.removeTcpCandidates&&("tcp"===e||"ssltcp"===e)||r.removeUdpCandidates&&"udp"===e||(r.failICE&&this.setAttribute("ip","1.1.1.1"),n+=i.a.candidateFromJingle(this))}),e.find('description>ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map(function(){return this.getAttribute("ssrc")}).get();t.length&&(n+="a=ssrc-group:"+e+" "+t.join(" ")+"\r\n")}),a=e.find('description>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]'),a.each(function(){var e=this.getAttribute("ssrc");$(this).find(">parameter").each(function(){var t=this.getAttribute("name"),r=this.getAttribute("value");r=i.a.filterSpecialChars(r),n+="a=ssrc:"+e+" "+t,r&&r.length&&(n+=":"+r),n+="\r\n"})}),n}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i});var r="signaling.peerMuted",i="signaling.peerVideoType"},function(e,t){var n={ENVIRONMENT:"environment",USER:"user"};e.exports=n},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){void 0===e.active?e.onended=t:e.oninactive=t}var s=n(14),c=n.n(s),u=n(0),l=(n.n(u),n(17)),d=n(4),p=n(27),h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=Object(u.getLogger)(e),m={track_mute:"onmute",track_unmute:"onunmute",track_ended:"onended"},v=function(e){function t(e,n,o,a,s,c){r(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return u.addEventListener=u.addListener,u.removeEventListener=u.off=u.removeListener,u.containers=[],u.conference=e,u.audioLevel=-1,u.type=s,u.track=o,u.videoType=c,u.handlers=new Map,u.disposed=!1,u._streamInactiveHandler=a,u._setStream(n),u}return o(t,e),h(t,[{key:"_setHandler",value:function(e,t){if(!m.hasOwnProperty(e))return void f.error("Invalid handler type "+e);if(t?this.handlers.set(e,t):this.handlers.delete(e),this.stream){var n=!0,r=!1,i=void 0;try{for(var o,a=this.stream.getVideoTracks()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)o.value[m[e]]=t}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}}},{key:"_unregisterHandlers",value:function(){if(!this.stream)return void f.warn(this+": unable to unregister handlers - no stream object");var e=!0,t=!1,n=void 0;try{for(var r,i=this.handlers.keys()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,s=!0,c=!1,u=void 0;try{for(var l,d=this.stream.getVideoTracks()[Symbol.iterator]();!(s=(l=d.next()).done);s=!0)l.value[m[o]]=void 0}catch(e){c=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(c)throw u}}}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this._streamInactiveHandler&&a(this.stream,void 0)}},{key:"_setStream",value:function(e){if(this.stream!==e&&(this.stream=e,this.stream)){var t=!0,n=!1,r=void 0;try{for(var i,o=this.handlers.keys()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;this._setHandler(s,this.handlers.get(s))}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this._streamInactiveHandler&&a(this.stream,this._streamInactiveHandler)}}},{key:"getType",value:function(){return this.type}},{key:"isAudioTrack",value:function(){return this.getType()===d.a}},{key:"isWebRTCTrackMuted",value:function(){return this.track&&this.track.muted}},{key:"isVideoTrack",value:function(){return this.getType()===d.b}},{key:"isLocal",value:function(){throw new Error("Not implemented by subclass")}},{key:"getOriginalStream",value:function(){return this.stream}},{key:"getStreamId",value:function(){return this.stream?this.stream.id:null}},{key:"getTrack",value:function(){return this.track}},{key:"getTrackId",value:function(){return this.track?this.track.id:null}},{key:"getUsageLabel",value:function(){return this.isAudioTrack()?"mic":this.videoType?this.videoType:"default"}},{key:"_maybeFireTrackAttached",value:function(e){this.conference&&e&&this.conference._onTrackAttach(this,e)}},{key:"attach",value:function(e){var t=e;return this.stream&&(t=p.a.attachMediaStream(e,this.stream)),this.containers.push(t),this._maybeFireTrackAttached(t),this._attachTTFMTracker(t),t}},{key:"detach",value:function(e){for(var t=this.containers,n=t.length-1;n>=0;--n){var r=t[n];e||p.a.attachMediaStream(r,null),e&&r!==e||t.splice(n,1)}e&&p.a.attachMediaStream(e,null)}},{key:"_attachTTFMTracker",value:function(e){}},{key:"dispose",value:function(){return this.removeAllListeners(),this.disposed=!0,Promise.resolve()}},{key:"isScreenSharing",value:function(){}},{key:"getId",value:function(){return this.stream?p.a.getStreamID(this.stream):null}},{key:"isActive",value:function(){return void 0===this.stream.active||this.stream.active}},{key:"setAudioLevel",value:function(e,t){this.audioLevel!==e&&(this.audioLevel=e,this.emit(l.TRACK_AUDIO_LEVEL_CHANGED,e,t))}},{key:"getMSID",value:function(){var e=this.getStreamId(),t=this.getTrackId();return e&&t?e+" "+t:null}},{key:"setAudioOutput",value:function(e){var t=this;return p.a.isDeviceChangeAvailable("output")?this.isVideoTrack()?Promise.resolve():Promise.all(this.containers.map(function(t){return t.setSinkId(e).catch(function(e){throw f.warn("Failed to change audio output device on element. Default or previously set audio output device will be used.",t,e),e})})).then(function(){t.emit(l.TRACK_AUDIO_OUTPUT_CHANGED,e)}):Promise.reject(new Error("Audio output device change is not supported"))}}]),t}(c.a);t.a=v}).call(t,"modules/RTC/JitsiTrack.js")},function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t,n){"use strict";(function(e){var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},n.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},n.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},n.getIceParameters=function(e,t){var r=n.splitLines(e);return r=r.concat(n.splitLines(t)),{usernameFragment:r.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:r.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e),i=r[0].split(" "),o=3;o<i.length;o++){var a=i[o],s=n.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=n.parseRtpMap(s),u=n.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=u.length?n.parseFmtp(u[0]):{},c.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(n.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){r+=n.writeExtmap(e)}),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,u=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};r.push(n),o&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},r.push(n))}}),0===r.length&&c&&r.push({ssrc:c});var l=n.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=l})),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=n.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return t=r[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t){var r=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||n.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e),r=t[0].split(" ");return{kind:r[0].substr(2),port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},"object"===t(e)&&(e.exports=n)}).call(t,n(135)(e))},function(e,t,n){function r(e){if(void 0===e.recorder)throw new Error("Passed an object to startRecorder which is not a TrackRecorder object");e.recorder.start(),e.startTime=new Date}function i(e){if(void 0===e.recorder)throw new Error("Passed an object to stopRecorder which is not a TrackRecorder object");e.recorder.stop()}function o(){if(MediaRecorder.isTypeSupported(u))return u;if(MediaRecorder.isTypeSupported(l))return l;throw new Error("unable to create a MediaRecorder with the right mimetype!")}function a(e){this.recorders=[],this.fileType=o(),this.isRecording=!1,this.jitsiConference=e}function s(){if("undefined"!=typeof MediaStream)return new MediaStream;if("undefined"!=typeof webkitMediaStream)return new webkitMediaStream;throw new Error("cannot create a clean mediaStream")}var c=n(154),u="audio/webm",l="audio/ogg",d=function(e){this.track=e,this.recorder=null,this.data=null,this.name=null,this.startTime=null};a.determineCorrectFileType=o,a.prototype.addTrack=function(e){if(e.isAudioTrack()){var t=this.instantiateTrackRecorder(e);this.recorders.push(t),this.updateNames(),this.isRecording&&r(t)}},a.prototype.instantiateTrackRecorder=function(e){var t=new d(e),n=t.track.getOriginalStream(),r=s();return n.getAudioTracks().forEach(function(e){return r.addTrack(e)}),t.recorder=new MediaRecorder(r,{mimeType:this.fileType}),t.data=[],t.recorder.ondataavailable=function(e){e.data.size>0&&t.data.push(e.data)},t},a.prototype.removeTrack=function(e){if(!e.isVideoTrack()){var t=this.recorders,n=void 0;for(n=0;n<t.length;n++)if(t[n].track.getParticipantId()===e.getParticipantId()){var r=t[n];this.isRecording?i(r):t.splice(n,1)}this.updateNames()}},a.prototype.updateNames=function(){var e=this.jitsiConference;this.recorders.forEach(function(t){if(t.track.isLocal())t.name="the transcriber";else{var n=t.track.getParticipantId(),r=e.getParticipantById(n),i=r.getDisplayName();"undefined"!==i&&(t.name=i)}})},a.prototype.start=function(){if(this.isRecording)throw new Error("audiorecorder is already recording");this.isRecording=!0,this.recorders.forEach(function(e){return r(e)}),console.log("Started the recording of the audio. There are currently "+this.recorders.length+" recorders active.")},a.prototype.stop=function(){this.isRecording=!1,this.recorders.forEach(function(e){return i(e)}),console.log("stopped recording")},a.prototype.download=function(){var e=this;this.recorders.forEach(function(t){var n=new Blob(t.data,{type:e.fileType}),r=URL.createObjectURL(n),i=document.createElement("a");document.body.appendChild(i),i.style="display: none",i.href=r,i.download="test."+e.fileType.split("/")[1],i.click(),window.URL.revokeObjectURL(r)})},a.prototype.getRecordingResults=function(){var e=this;if(this.isRecording)throw new Error("cannot get blobs because the AudioRecorder is still recording!");this.updateNames();var t=[];return this.recorders.forEach(function(n){return t.push(new c(new Blob(n.data,{type:e.fileType}),n.name,n.startTime))}),t},a.prototype.getFileType=function(){return this.fileType},e.exports=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"DEVICE_LIST_CHANGED",function(){return r}),n.d(t,"PERMISSION_PROMPT_IS_SHOWN",function(){return i});var r="mediaDevices.devicechange",i="mediaDevices.permissionPromptIsShown"},function(e,t,n){e.exports=n(60).default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function r(e){if(!P.a[e])return null;var t=P.a[e].order,n=null,r=null;return Object.keys(P.a).forEach(function(e){var i=P.a[e];(!n||n.order<i.order&&i.order<t)&&(r=e,n=i)}),r}function i(e,t){var n=e;return-1!==t.devices.indexOf("audio")&&(n+=".audio"),-1!==t.devices.indexOf("desktop")&&(n+=".desktop"),-1!==t.devices.indexOf("video")&&(n+=".video."+t.resolution),n}var o=n(61),a=n.n(o),s=n(29),c=n(3),u=n.n(c),l=n(30),d=n(6),p=n(62),h=n(45),f=n(25),m=n(162),v=n(58),g=n(49),y=n.n(g),b=n(11),_=n(15),S=n(17),T=n(46),C=n(41),E=n(48),w=n(0),R=n.n(w),k=n(4),I=n(33),P=n.n(I),A=n(34),O=n(26),D=n(1),x=n(163),N=n(43),L=n.n(N),M=n(18),j=n(5),F=n(36),U=R.a.getLogger(e);t.default={version:"jitsi-meet_2606#408f737",JitsiConnection:p.a,constants:{participantConnectionStatus:A.a,recordingStatus:E.a.status,recordingTypes:E.a.types,sipVideoGW:F,transcriptionStatus:T},events:{conference:d,connection:f,track:S,mediaDevices:v,connectionQuality:s},errors:{conference:l,connection:h,recorder:y.a,track:_},errorTypes:{JitsiTrackError:b.a},logLevels:R.a.levels,mediaDevices:m.a,analytics:j.a.analytics,init:function(e){j.a.init(e),window.connectionTimes||(window.connectionTimes={}),!0!==e.enableAnalyticsLogging&&this.analytics.dispose(),e.enableWindowOnErrorHandler&&u.a.addHandler(this.getGlobalOnErrorHandler.bind(this));var t=e.deploymentInfo;if(t&&Object.keys(t).length>0){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);n.id="deployment_info",j.a.sendLog(JSON.stringify(n))}if(this.version){var i={id:"component_version",component:"lib-jitsi-meet",version:this.version};j.a.sendLog(JSON.stringify(i))}return O.a.init(e||{})},isDesktopSharingEnabled:function(){return O.a.isDesktopSharingEnabled()},setLogLevel:function(e){R.a.setLogLevel(e)},setLogLevelById:function(e,t){R.a.setLogLevelById(e,t)},addGlobalLogTransport:function(e){R.a.addGlobalTransport(e)},removeGlobalLogTransport:function(e){R.a.removeGlobalTransport(e)},createLocalTracks:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],o=!1;return!0===n&&window.setTimeout(function(){o||m.a.emitEvent(v.PERMISSION_PROMPT_IS_SHOWN,D.a.getBrowserName())},1e3),window.connectionTimes||(window.connectionTimes={}),window.connectionTimes["obtainPermissions.start"]=window.performance.now(),O.a.obtainAudioAndVideoPermissions(t).then(function(e){if(o=!0,window.connectionTimes["obtainPermissions.end"]=window.performance.now(),j.a.analytics.sendEvent(i("getUserMedia.success",t),{value:t}),!O.a.options.disableAudioLevels)for(var n=0;n<e.length;n++)!function(t){var n=e[t],r=n.getOriginalStream();n.getType()===k.a&&(j.a.startLocalStats(r,n.setAudioLevel.bind(n)),n.addEventListener(S.LOCAL_TRACK_STOPPED,function(){j.a.stopLocalStats(r)}))}(n);var r=O.a.getCurrentlyAvailableMediaDevices();if(r)for(var n=0;n<e.length;n++){var a=e[n];a._setRealDeviceIdFromDeviceList(r)}return e}).catch(function(n){if(o=!0,n.name===_.UNSUPPORTED_RESOLUTION){var a=t.resolution||"720",s=r(a);if(null!==s)return t.resolution=s,U.debug("Retry createLocalTracks with resolution",s),j.a.analytics.sendEvent("getUserMedia.fail.resolution."+a),e.createLocalTracks(t)}if(_.CHROME_EXTENSION_USER_CANCELED===n.name){var c={id:"chrome_extension_user_canceled",message:n.message};j.a.sendLog(JSON.stringify(c)),j.a.analytics.sendEvent("getUserMedia.userCancel.extensionInstall")}else if(_.NOT_FOUND===n.name){var u={id:"usermedia_missing_device",status:n.gum.devices};j.a.sendLog(JSON.stringify(u)),j.a.analytics.sendEvent("getUserMedia.deviceNotFound."+n.gum.devices.join("."))}else{j.a.sendGetUserMediaFailed(n);var l=i("getUserMedia.failed",t);j.a.analytics.sendEvent(l+"."+n.name,{value:t})}return window.connectionTimes["obtainPermissions.end"]=window.performance.now(),Promise.reject(n)})},isDeviceListAvailable:function(){return U.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.isDeviceListAvailable instead"),this.mediaDevices.isDeviceListAvailable()},isDeviceChangeAvailable:function(e){return U.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.isDeviceChangeAvailable instead"),this.mediaDevices.isDeviceChangeAvailable(e)},isMultipleAudioInputSupported:function(){return this.mediaDevices.isMultipleAudioInputSupported()},isCollectingLocalStats:function(){return j.a.audioLevelsEnabled&&C.a.isLocalStatsSupported()},enumerateDevices:function(e){U.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.enumerateDevices instead"),this.mediaDevices.enumerateDevices(e)},getGlobalOnErrorHandler:function(e,t,n,r,i){U.error("UnhandledError: "+e,"Script: "+t,"Line: "+n,"Column: "+r,"StackTrace: ",i),j.a.reportGlobalError(i)},getMachineId:function(){return M.a.machineId},util:{AuthUtil:a.a,RTCUIHelper:x.a,ScriptUtil:L.a}}}.call(t,"JitsiMeetJS.js")},function(e,t){var n={getTokenAuthUrl:function(e,t,n){var r=e;return"string"!=typeof r?null:r.replace("{room}",t).replace("{roleUpgrade}",!0===n)}};e.exports=n},function(e,t,n){"use strict";function r(e,t,n){this.appID=e,this.token=t,this.options=n,this.xmpp=new s.a(n,t),this.addEventListener(o.CONNECTION_FAILED,function(e,t){a.a.sendEventToAll("connection.failed."+e,{label:t})}),this.addEventListener(o.CONNECTION_DISCONNECTED,function(e){e&&a.a.analytics.sendEvent("connection.disconnected."+e),a.a.sendLog(JSON.stringify({id:"connection.disconnected",msg:e}))})}t.a=r;var i=n(63),o=n(25),a=n(5),s=n(44);r.prototype.connect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.xmpp.connect(e.id,e.password)},r.prototype.attach=function(e){this.xmpp.attach(e)},r.prototype.disconnect=function(){var e;(e=this.xmpp).disconnect.apply(e,arguments)},r.prototype.setToken=function(e){this.token=e},r.prototype.initJitsiConference=function(e,t){return new i.a({name:e,config:t,connection:this})},r.prototype.addEventListener=function(e,t){this.xmpp.addListener(e,t)},r.prototype.removeEventListener=function(e,t){this.xmpp.removeListener(e,t)},r.prototype.getConnectionTimes=function(){return this.xmpp.connectionTimes},r.prototype.addFeature=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.xmpp.caps.addFeature(e,t)},r.prototype.removeFeature=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.xmpp.caps.removeFeature(e,t)}},function(e,t,n){"use strict";(function(e){function r(e){if(!e.name||e.name.toLowerCase()!==e.name){var t="Invalid conference name (no conference name passed or it contains invalid characters like capital letters)!";throw U.error(t),new Error(t)}this.eventEmitter=new p.a,this.options=e,this.eventManager=new m.a(this),this.participants={},this._init(e),this.componentsVersions=new a.a(this),this.jvbJingleSession=null,this.lastDominantSpeaker=null,this.dtmfManager=null,this.somebodySupportsDTMF=!1,this.authEnabled=!1,this.startAudioMuted=!1,this.startVideoMuted=!1,this.startMutedPolicy={audio:!1,video:!1},this.availableDevices={audio:void 0,video:void 0},this.isMutedByFocus=!1,this.wasStopped=!1,this.connectionQuality=new s.a(this,this.eventEmitter,e),this.avgRtpStatsReporter=new o.a(this,e.config.avgRtpStatsN||15),this.isJvbConnectionInterrupted=!1,this.speakerStatsCollector=new F.a(this),this.deferredStartP2PTask=null;var n=parseInt(e.config.p2p&&e.config.p2p.backToP2PDelay,10);this.backToP2PDelay=isNaN(n)?5:n,U.info("backToP2PDelay: "+this.backToP2PDelay),this.isP2PConnectionInterrupted=!1,this.p2p=!1,this.p2pJingleSession=null}t.a=r;var i=n(2),o=(n.n(i),n(64)),a=n(92),s=n(93),c=n(0),u=(n.n(c),n(3)),l=n.n(u),d=n(14),p=n.n(d),h=n(94),f=n(30),m=n(111),v=n(6),g=n(113),y=n.n(g),b=n(114),_=n(11),S=n(15),T=n(17),C=n(115),E=n(4),w=n(34),R=n(116),k=n(26),I=n(1),P=n(8),A=(n.n(P),n(5)),O=n(152),D=n(153),x=n.n(D),N=n(16),L=n.n(N),M=n(158),j=n(7),F=(n.n(j),n(160)),U=Object(c.getLogger)(e);r.prototype.constructor=r,r.prototype._init=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.connection&&(this.connection=t.connection,this.xmpp=this.connection.xmpp,this.eventManager.setupXMPPListeners());var n=this.options.config;if(this.room=this.xmpp.createRoom(this.options.name,n),this._onIceConnectionInterrupted=this._onIceConnectionInterrupted.bind(this),this.room.addListener(j.CONNECTION_INTERRUPTED,this._onIceConnectionInterrupted),this._onIceConnectionRestored=this._onIceConnectionRestored.bind(this),this.room.addListener(j.CONNECTION_RESTORED,this._onIceConnectionRestored),this._onIceConnectionEstablished=this._onIceConnectionEstablished.bind(this),this.room.addListener(j.CONNECTION_ESTABLISHED,this._onIceConnectionEstablished),this.room.updateDeviceAvailability(k.a.getDeviceAvailability()),this.rtc||(this.rtc=new k.a(this,t),this.eventManager.setupRTCListeners()),this.participantConnectionStatus=new w.b(this.rtc,this,{rtcMuteTimeout:n._peerConnStatusRtcMuteTimeout,outOfLastNTimeout:n._peerConnStatusOutOfLastNTimeout}),this.participantConnectionStatus.init(),!this.statistics){var r=window.location,i=this.myUserId();n.enableDisplayNameInStats&&n.displayName&&(i=n.displayName),this.statistics=new A.a(this.xmpp,{callStatsAliasName:i,callStatsConfIDNamespace:n.callStatsConfIDNamespace||r&&r.hostname||n.hosts&&n.hosts.domain,callStatsCustomScriptUrl:n.callStatsCustomScriptUrl,callStatsID:n.callStatsID,callStatsSecret:n.callStatsSecret,roomName:this.options.name,swapUserNameAndAlias:n.enableStatsID,applicationName:n.applicationName})}this.eventManager.setupChatRoomListeners(),this.eventManager.setupStatisticsListeners(),n.enableTalkWhileMuted&&new O.a(this,function(){return e.eventEmitter.emit(v.TALK_WHILE_MUTED)}),"channelLastN"in n&&this.setLastN(n.channelLastN),this.jvb121Status=new C.a(this),this.p2pDominantSpeakerDetection=new R.a(this)},r.prototype.join=function(e){this.room&&this.room.join(e)},r.prototype.authenticateAndUpgradeRole=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return h.a.apply(this,t)},r.prototype.isJoined=function(){return this.room&&this.room.joined},r.prototype.isP2PEnabled=function(){return Boolean(this.options.config.p2p&&this.options.config.p2p.enabled)||void 0===this.options.config.p2p},r.prototype.isP2PTestModeEnabled=function(){return Boolean(this.options.config.testing&&this.options.config.testing.p2pTestMode)},r.prototype.leave=function(){var e=this;if(this.participantConnectionStatus&&(this.participantConnectionStatus.dispose(),this.participantConnectionStatus=null),this.avgRtpStatsReporter&&(this.avgRtpStatsReporter.dispose(),this.avgRtpStatsReporter=null),this.getLocalTracks().forEach(function(t){return e.onLocalTrackRemoved(t)}),this.rtc.closeBridgeChannel(),this.statistics&&this.statistics.dispose(),this.jvbJingleSession&&(this.jvbJingleSession.close(),this.jvbJingleSession=null),this.p2pJingleSession&&(this.p2pJingleSession.close(),this.p2pJingleSession=null),this.room){var t=this.room;return t.removeListener(j.CONNECTION_INTERRUPTED,this._onIceConnectionInterrupted),t.removeListener(j.CONNECTION_RESTORED,this._onIceConnectionRestored),t.removeListener(j.CONNECTION_ESTABLISHED,this._onIceConnectionEstablished),this.room=null,t.leave().catch(function(){e.getParticipants().forEach(function(t){return e.onMemberLeft(t.getJid())})})}return Promise.reject(new Error("The conference is has been already left"))},r.prototype.getName=function(){return this.options.name},r.prototype.isAuthEnabled=function(){return this.authEnabled},r.prototype.isLoggedIn=function(){return Boolean(this.authIdentity)},r.prototype.getAuthLogin=function(){return this.authIdentity},r.prototype.isExternalAuthEnabled=function(){return this.room&&this.room.moderator.isExternalAuthEnabled()},r.prototype.getExternalAuthUrl=function(e){var t=this;return new Promise(function(n,r){if(!t.isExternalAuthEnabled())return void r();e?t.room.moderator.getPopupLoginUrl(n,r):t.room.moderator.getLoginUrl(n,r)})},r.prototype.getLocalTracks=function(e){var t=[];return this.rtc&&(t=this.rtc.getLocalTracks(e)),t},r.prototype.getLocalAudioTrack=function(){return this.rtc?this.rtc.getLocalAudioTrack():null},r.prototype.getLocalVideoTrack=function(){return this.rtc?this.rtc.getLocalVideoTrack():null},r.prototype.on=function(e,t){this.eventEmitter&&this.eventEmitter.on(e,t)},r.prototype.off=function(e,t){this.eventEmitter&&this.eventEmitter.removeListener(e,t)},r.prototype.addEventListener=r.prototype.on,r.prototype.removeEventListener=r.prototype.off,r.prototype.addCommandListener=function(e,t){this.room&&this.room.addPresenceListener(e,t)},r.prototype.removeCommandListener=function(e){this.room&&this.room.removePresenceListener(e)},r.prototype.sendTextMessage=function(e){this.room&&this.room.sendMessage(e)},r.prototype.sendCommand=function(e,t){this.room&&(this.room.addToPresence(e,t),this.room.sendPresence())},r.prototype.sendCommandOnce=function(e,t){this.sendCommand(e,t),this.removeCommand(e)},r.prototype.removeCommand=function(e){this.room&&this.room.removeFromPresence(e)},r.prototype.setDisplayName=function(e){this.room&&(this.room.removeFromPresence("nick"),this.room.addToPresence("nick",{attributes:{xmlns:"http://jabber.org/protocol/nick"},value:e}),this.room.sendPresence())},r.prototype.setSubject=function(e){this.room&&this.isModerator()&&this.room.setSubject(e)},r.prototype.getTranscriber=function(){if(void 0===this.transcriber){this.transcriber=new x.a;var e=this.getLocalTracks(E.a),t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.transcriber.addTrack(a)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}var s=this.rtc.getRemoteTracks(E.a),c=!0,u=!1,l=void 0;try{for(var d,p=s[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var h=d.value;this.transcriber.addTrack(h)}}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}}return this.transcriber},r.prototype.getTranscriptionStatus=function(){return this.room.transcriptionStatus},r.prototype.addTrack=function(e){if(e.isVideoTrack()){var t=this.rtc.getLocalVideoTrack();if(t)return e===t?Promise.resolve(e):Promise.reject(new Error("cannot add second video track to the conference"))}return this.replaceTrack(null,e)},r.prototype._fireAudioLevelChangeEvent=function(e,t){var n=this.getActivePeerConnection();t&&n!==t||this.eventEmitter.emit(v.TRACK_AUDIO_LEVEL_CHANGED,this.myUserId(),e)},r.prototype._fireMuteChangeEvent=function(e){this.isMutedByFocus&&e.isAudioTrack()&&!e.isMuted()&&(this.isMutedByFocus=!1,this.room.muteParticipant(this.room.myroomjid,!1)),this.eventEmitter.emit(v.TRACK_MUTE_CHANGED,e)},r.prototype.onLocalTrackRemoved=function(e){e._setConference(null),this.rtc.removeLocalTrack(e),e.removeEventListener(T.TRACK_MUTE_CHANGED,e.muteHandler),e.removeEventListener(T.TRACK_AUDIO_LEVEL_CHANGED,e.audioLevelHandler),e.isVideoTrack()&&e.videoType===L.a.DESKTOP&&this.statistics.sendScreenSharingEvent(!1),this.eventEmitter.emit(v.TRACK_REMOVED,e)},r.prototype.removeTrack=function(e){return this.replaceTrack(e,null)},r.prototype.replaceTrack=function(e,t){var n=this;return e&&e.disposed?Promise.reject(new _.a(S.TRACK_IS_DISPOSED)):t&&t.disposed?Promise.reject(new _.a(S.TRACK_IS_DISPOSED)):this._doReplaceTrack(e,t).then(function(){return e&&n.onLocalTrackRemoved(e),t&&n._setupNewTrack(t),Promise.resolve()},function(e){return Promise.reject(new Error(e))})},r.prototype._doReplaceTrack=function(e,t){var n=[];return this.jvbJingleSession?n.push(this.jvbJingleSession.replaceTrack(e,t)):U.info("_doReplaceTrack - no JVB JingleSession"),this.p2pJingleSession?n.push(this.p2pJingleSession.replaceTrack(e,t)):U.info("_doReplaceTrack - no P2P JingleSession"),Promise.all(n)},r.prototype._setupNewTrack=function(e){if(e.isAudioTrack()||e.isVideoTrack()&&e.videoType!==L.a.DESKTOP){var t=k.a.getCurrentlyAvailableMediaDevices(),n=t.find(function(t){return t.kind===e.getTrack().kind+"input"&&t.label===e.getTrack().label});n&&A.a.sendActiveDeviceListEvent(k.a.getEventDataForActiveDevice(n))}e.isVideoTrack()&&(this.removeCommand("videoType"),this.sendCommand("videoType",{value:e.videoType,attributes:{xmlns:"http://jitsi.org/jitmeet/video"}})),this.rtc.addLocalTrack(e),e.isAudioTrack()?this.room.setAudioMute(e.isMuted()):this.room.setVideoMute(e.isMuted()),e.muteHandler=this._fireMuteChangeEvent.bind(this,e),e.audioLevelHandler=this._fireAudioLevelChangeEvent.bind(this),e.addEventListener(T.TRACK_MUTE_CHANGED,e.muteHandler),e.addEventListener(T.TRACK_AUDIO_LEVEL_CHANGED,e.audioLevelHandler),e._setConference(this),e.isVideoTrack()&&e.videoType===L.a.DESKTOP&&this.statistics.sendScreenSharingEvent(!0),this.eventEmitter.emit(v.TRACK_ADDED,e)},r.prototype._addLocalTrackAsUnmute=function(e){var t=[];return this.jvbJingleSession?t.push(this.jvbJingleSession.addTrackAsUnmute(e)):U.info("Add local MediaStream as unmute - no JVB Jingle session started yet"),this.p2pJingleSession?t.push(this.p2pJingleSession.addTrackAsUnmute(e)):U.info("Add local MediaStream as unmute - no P2P Jingle session started yet"),Promise.all(t)},r.prototype._removeLocalTrackAsMute=function(e){var t=[];return this.jvbJingleSession?t.push(this.jvbJingleSession.removeTrackAsMute(e)):U.info("Remove local MediaStream - no JVB JingleSession started yet"),this.p2pJingleSession?t.push(this.p2pJingleSession.removeTrackAsMute(e)):U.info("Remove local MediaStream - no P2P JingleSession started yet"),Promise.all(t)},r.prototype.getRole=function(){return this.room.role},r.prototype.isModerator=function(){return this.room?this.room.isModerator():null},r.prototype.lock=function(e){var t=this;return this.isModerator()?new Promise(function(n,r){t.room.lockRoom(e||"",function(){return n()},function(e){return r(e)},function(){return r(f.PASSWORD_NOT_SUPPORTED)})}):Promise.reject()},r.prototype.unlock=function(){return this.lock()},r.prototype.selectParticipant=function(e){this.rtc.selectEndpoint(e)},r.prototype.pinParticipant=function(e){this.rtc.pinEndpoint(e)},r.prototype.getLastN=function(){return this.rtc.getLastN()},r.prototype.setLastN=function(e){if(!Number.isInteger(e)&&!Number.parseInt(e,10))throw new Error("Invalid value for lastN: "+e);var t=Number(e);if(t<-1)throw new RangeError("lastN cannot be smaller than -1");if(this.rtc.setLastN(t),this.p2pJingleSession){var n=0!==t;this.p2pJingleSession.setMediaTransferActive(!0,n).catch(function(e){U.error("Failed to adjust video transfer status ("+n+")",e)})}},r.prototype.isInLastN=function(e){return this.rtc.isInLastN(e)},r.prototype.getParticipants=function(){return Object.keys(this.participants).map(function(e){return this.participants[e]},this)},r.prototype.getParticipantCount=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getParticipants();return e||(t=t.filter(function(e){return!e.isHidden()})),t.length+1},r.prototype.getParticipantById=function(e){return this.participants[e]},r.prototype.kickParticipant=function(e){var t=this.getParticipantById(e);t&&this.room.kick(t.getJid())},r.prototype.muteParticipant=function(e){var t=this.getParticipantById(e);t&&this.room.muteParticipant(t.getJid(),!0)},r.prototype.onMemberJoined=function(e,t,n,r,o){var a=this,s=i.Strophe.getResourceFromJid(e);if("focus"!==s&&this.myUserId()!==s){var c=new b.a(e,this,t,r,o);c._role=n,this.participants[s]=c,this.eventEmitter.emit(v.USER_JOINED,s,c),this.xmpp.caps.getFeatures(e).then(function(e){c._supportsDTMF=e.has("urn:xmpp:jingle:dtmf:0"),a.updateDTMFSupport()},function(t){return U.error("Failed to discover features of "+e,t)}),this._maybeStartOrStopP2P()}},r.prototype.onMemberLeft=function(e){var t=this,n=i.Strophe.getResourceFromJid(e);if("focus"!==n&&this.myUserId()!==n){var r=this.participants[n];delete this.participants[n],this.rtc.removeRemoteTracks(n).forEach(function(e){return t.eventEmitter.emit(v.TRACK_REMOVED,e)}),r&&this.eventEmitter.emit(v.USER_LEFT,n,r),this._maybeStartOrStopP2P(!0)}},r.prototype.onLocalRoleChanged=function(e){this.eventEmitter.emit(v.USER_ROLE_CHANGED,this.myUserId(),e),this._maybeStartOrStopP2P()},r.prototype.onUserRoleChanged=function(e,t){var n=i.Strophe.getResourceFromJid(e),r=this.getParticipantById(n);r&&(r._role=t,this.eventEmitter.emit(v.USER_ROLE_CHANGED,n,t))},r.prototype.onDisplayNameChanged=function(e,t){var n=i.Strophe.getResourceFromJid(e),r=this.getParticipantById(n);r&&r._displayName!==t&&(r._displayName=t,this.eventEmitter.emit(v.DISPLAY_NAME_CHANGED,n,t))},r.prototype.onRemoteTrackAdded=function(e){var t=this;if(e.isP2P&&!this.isP2PActive())return void U.info("Trying to add remote P2P track, when not in P2P - IGNORED");if(!e.isP2P&&this.isP2PActive())return void U.info("Trying to add remote JVB track, when in P2P - IGNORED");var n=e.getParticipantId(),r=this.getParticipantById(n);if(!r)return void U.error("No participant found for id: "+n);r._tracks.push(e),this.transcriber&&this.transcriber.addTrack(e);var i=this.eventEmitter;e.addEventListener(T.TRACK_MUTE_CHANGED,function(){return i.emit(v.TRACK_MUTE_CHANGED,e)}),e.addEventListener(T.TRACK_AUDIO_LEVEL_CHANGED,function(e,r){t.getActivePeerConnection()===r&&i.emit(v.TRACK_AUDIO_LEVEL_CHANGED,n,e)}),i.emit(v.TRACK_ADDED,e)},r.prototype.onCallAccepted=function(e,t){this.p2pJingleSession===e&&(U.info("P2P setAnswer"),this.p2pJingleSession.setAnswer(t))},r.prototype.onTransportInfo=function(e,t){this.p2pJingleSession===e&&(U.info("P2P addIceCandidates"),this.p2pJingleSession.addIceCandidates(t))},r.prototype.onRemoteTrackRemoved=function(e){var t=this;this.getParticipants().forEach(function(n){for(var r=n.getTracks(),i=0;i<r.length;i++)if(r[i]===e){n._tracks.splice(i,1),t.eventEmitter.emit(v.TRACK_REMOVED,e),t.transcriber&&t.transcriber.removeTrack(e);break}},this)},r.prototype.onIncomingCall=function(e,t,n){var r=this;if(e.isP2P)return void("moderator"!==this.room.getMemberRole(e.peerjid)?this._rejectIncomingCallNonModerator(e):I.a.isP2PSupported()?this.isP2PEnabled()||this.isP2PTestModeEnabled()?this.p2pJingleSession?this._rejectIncomingCall(e,{reasonTag:"busy",reasonMsg:"P2P already in progress",errorMsg:'Duplicated P2P "session-initiate"'}):this._acceptP2PIncomingCall(e,t):this._rejectIncomingCall(e,{reasonTag:"decline",reasonMsg:"P2P disabled",errorMsg:"P2P mode disabled in the configuration"}):this._rejectIncomingCall(e,{reasonTag:"unsupported-applications",reasonMsg:"P2P not supported",errorMsg:"This client does not support P2P connections"}));if(!this.room.isFocus(e.peerjid))return void this._rejectIncomingCall(e);this.jvbJingleSession=e,this.room.connectionTimes["session.initiate"]=n,this.wasStopped&&A.a.sendEventToAll("session.restart");var i=null;this.options.config&&this.options.config.deploymentInfo&&void 0!==this.options.config.deploymentInfo.crossRegion&&(i=this.options.config.deploymentInfo.crossRegion),A.a.analytics.sendEvent("session.initiate",{value:n-this.room.connectionTimes["muc.joined"],label:i});try{e.initialize(!1,this.room,this.rtc)}catch(e){l.a.callErrorHandler(e)}this._setBridgeChannel(t,e.peerconnection);try{e.acceptOffer(t,function(){r.isP2PActive()&&r.jvbJingleSession&&r._suspendMediaTransferForJvbConnection()},function(e){l.a.callErrorHandler(e),U.error("Failed to accept incoming Jingle session",e)},this.getLocalTracks()),U.info("Starting CallStats for JVB connection..."),this.statistics.startCallStats(this.jvbJingleSession.peerconnection,"jitsi"),this.statistics.startRemoteStats(this.jvbJingleSession.peerconnection)}catch(e){l.a.callErrorHandler(e),U.error(e)}},r.prototype._setBridgeChannel=function(e,t){var n=null,r=$(e).find(">content>transport>web-socket").first();1===r.length&&(n=r[0].getAttribute("url"));var i=void 0;switch(this.options.config.openBridgeChannel){case"datachannel":case!0:case void 0:i="datachannel";break;case"websocket":i="websocket"}"datachannel"!==i||I.a.supportsDataChannels()||(i="websocket"),"datachannel"===i?this.rtc.initializeBridgeChannel(t,null):"websocket"===i&&n&&this.rtc.initializeBridgeChannel(null,n)},r.prototype._rejectIncomingCallNonModerator=function(e){this._rejectIncomingCall(e,{reasonTag:"security-error",reasonMsg:"Only focus can start new sessions",errorMsg:"Rejecting session-initiate from non-focus andnon-moderator user: "+e.peerjid})},r.prototype._rejectIncomingCall=function(e,t){t&&t.errorMsg&&l.a.callErrorHandler(new Error(t.errorMsg)),e.terminate(null,function(e){U.warn("An error occurred while trying to terminate invalid Jingle session",e)},{reason:t&&t.reasonTag,reasonDescription:t&&t.reasonMsg,sendSessionTerminate:!0})},r.prototype.onCallEnded=function(e,t,n){U.info("Call ended: "+t+" - "+n+" P2P ?"+e.isP2P),e===this.jvbJingleSession?(this.wasStopped=!0,A.a.sendEventToAll("session.terminate"),this.statistics&&(this.statistics.stopRemoteStats(this.jvbJingleSession.peerconnection),U.info("Stopping JVB CallStats"),this.statistics.stopCallStats(this.jvbJingleSession.peerconnection)),this.jvbJingleSession=null,this.rtc.onCallEnded()):e===this.p2pJingleSession?("decline"===t&&"force JVB121"===n?(U.info("In forced JVB 121 mode..."),A.a.analytics.addPermanentProperties({forceJvb121:!0})):"connectivity-error"===t&&"ICE FAILED"===n&&A.a.analytics.addPermanentProperties({p2pFailed:!0}),this._stopP2PSession()):U.error("Received onCallEnded for invalid session",e.sid,e.peerjid,t,n)},r.prototype.onSuspendDetected=function(e){e.isP2P||(this.leave(),this.eventEmitter.emit(v.SUSPEND_DETECTED))},r.prototype.updateDTMFSupport=function(){for(var e=!1,t=this.getParticipants(),n=0;n<t.length;n+=1)if(t[n].supportsDTMF()){e=!0;break}e!==this.somebodySupportsDTMF&&(this.somebodySupportsDTMF=e,this.eventEmitter.emit(v.DTMF_SUPPORT_CHANGED,e))},r.prototype.isDTMFSupported=function(){return this.somebodySupportsDTMF},r.prototype.myUserId=function(){return this.room&&this.room.myroomjid?i.Strophe.getResourceFromJid(this.room.myroomjid):null},r.prototype.sendTones=function(e,t,n){if(!this.dtmfManager){var r=this.getActivePeerConnection();if(!r)return void U.warn("cannot sendTones: no peer connection");var i=this.getLocalAudioTrack();if(!i)return void U.warn("cannot sendTones: no local audio stream");this.dtmfManager=new y.a(i,r)}this.dtmfManager.sendTones(e,t,n)},r.prototype.isRecordingSupported=function(){return!!this.room&&this.room.isRecordingSupported()},r.prototype.getRecordingState=function(){return this.room?this.room.getRecordingState():void 0},r.prototype.getRecordingURL=function(){return this.room?this.room.getRecordingURL():null},r.prototype.toggleRecording=function(e){var t=this;if(this.room)return this.room.toggleRecording(e,function(e,n){t.eventEmitter.emit(v.RECORDER_STATE_CHANGED,e,n)});this.eventEmitter.emit(v.RECORDER_STATE_CHANGED,"error",new Error("The conference is not created yet!"))},r.prototype.isSIPCallingSupported=function(){return!!this.room&&this.room.isSIPCallingSupported()},r.prototype.dial=function(e){return this.room?this.room.dial(e):new Promise(function(e,t){t(new Error("The conference is not created yet!"))})},r.prototype.hangup=function(){return this.room?this.room.hangup():new Promise(function(e,t){t(new Error("The conference is not created yet!"))})},r.prototype.startTranscriber=function(){return this.dial("jitsi_meet_transcribe")},r.prototype.stopTranscriber=r.prototype.hangup,r.prototype.getPhoneNumber=function(){return this.room?this.room.getPhoneNumber():null},r.prototype.getPhonePin=function(){return this.room?this.room.getPhonePin():null},r.prototype.getActivePeerConnection=function(){return this.isP2PActive()?this.p2pJingleSession.peerconnection:this.jvbJingleSession?this.jvbJingleSession.peerconnection:null},r.prototype.getConnectionState=function(){var e=this.getActivePeerConnection();return e?e.getConnectionState():null},r.prototype.setStartMutedPolicy=function(e){this.isModerator()&&(this.startMutedPolicy=e,this.room.removeFromPresence("startmuted"),this.room.addToPresence("startmuted",{attributes:{audio:e.audio,video:e.video,xmlns:"http://jitsi.org/jitmeet/start-muted"}}),this.room.sendPresence())},r.prototype.getStartMutedPolicy=function(){return this.startMutedPolicy},r.prototype.isStartAudioMuted=function(){return this.startAudioMuted},r.prototype.isStartVideoMuted=function(){return this.startVideoMuted},r.prototype.getLogs=function(){var e=this.xmpp.getJingleLog(),t={};t.time=new Date,t.url=window.location.href,t.ua=navigator.userAgent;var n=this.xmpp.getXmppLog();return n&&(t.xmpp=n),e.metadata=t,e},r.prototype.getConnectionTimes=function(){return this.room.connectionTimes},r.prototype.setLocalParticipantProperty=function(e,t){this.sendCommand("jitsi_participant_"+e,{value:t})},r.prototype.sendFeedback=function(e,t){this.statistics.sendFeedback(e,t)},r.prototype.isCallstatsEnabled=function(){return this.statistics.isCallstatsEnabled()},r.prototype._onTrackAttach=function(e,t){var n=e.isLocal(),r=null,i=e.isP2P,o=i?e.getParticipantId():"jitsi",a=i?this.p2pJingleSession&&this.p2pJingleSession.peerconnection:this.jvbJingleSession&&this.jvbJingleSession.peerconnection;n?a&&(r=a.getLocalSSRC(e)):r=e.getSSRC(),t.id&&r&&a&&this.statistics.associateStreamWithVideoTag(a,r,n,o,e.getUsageLabel(),t.id)},r.prototype.sendApplicationLog=function(e){A.a.sendLog(e)},r.prototype._isFocus=function(e){return this.room?this.room.isFocus(e):null},r.prototype._fireIncompatibleVersionsEvent=function(){this.eventEmitter.emit(v.CONFERENCE_FAILED,f.INCOMPATIBLE_SERVER_VERSIONS)},r.prototype.sendEndpointMessage=function(e,t){this.rtc.sendChannelMessage(e,t)},r.prototype.broadcastEndpointMessage=function(e){this.sendEndpointMessage("",e)},r.prototype.isConnectionInterrupted=function(){return this.isP2PActive()?this.isP2PConnectionInterrupted:this.isJvbConnectionInterrupted},r.prototype._onIceConnectionInterrupted=function(e){e.isP2P?this.isP2PConnectionInterrupted=!0:this.isJvbConnectionInterrupted=!0,e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(v.CONNECTION_INTERRUPTED)},r.prototype._onIceConnectionFailed=function(e){e.isP2P&&(A.a.analytics.addPermanentProperties({p2pFailed:!0}),this.p2pJingleSession&&this.p2pJingleSession.isInitiator&&A.a.sendEventToAll("p2p.failed"),this._stopP2PSession("connectivity-error","ICE FAILED"))},r.prototype._onIceConnectionRestored=function(e){e.isP2P?this.isP2PConnectionInterrupted=!1:this.isJvbConnectionInterrupted=!1,e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(v.CONNECTION_RESTORED)},r.prototype._acceptP2PIncomingCall=function(e,t){this.isP2PConnectionInterrupted=!1,this.p2pJingleSession=e,this.p2pJingleSession.initialize(!1,this.room,this.rtc),U.info("Starting CallStats for P2P connection...");var n=i.Strophe.getResourceFromJid(this.p2pJingleSession.peerjid);if(this.options.config.enableStatsID){var r=this.participants[n];r&&(n=r.getStatsID()||n)}this.statistics.startCallStats(this.p2pJingleSession.peerconnection,n);var o=this.getLocalTracks();this.p2pJingleSession.acceptOffer(t,function(){U.debug('Got RESULT for P2P "session-accept"')},function(e){U.error("Failed to accept incoming P2P Jingle session",e)},o)},r.prototype._addRemoteJVBTracks=function(){this._addRemoteTracks("JVB",this.jvbJingleSession.peerconnection.getRemoteTracks())},r.prototype._addRemoteP2PTracks=function(){this._addRemoteTracks("P2P",this.p2pJingleSession.peerconnection.getRemoteTracks())},r.prototype._addRemoteTracks=function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;U.info("Adding remote "+e+" track: "+s),this.rtc.eventEmitter.emit(P.REMOTE_TRACK_ADDED,s)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}},r.prototype._onIceConnectionEstablished=function(e){null!==this.p2pJingleSession&&(this.p2pEstablishmentDuration=this.p2pJingleSession.establishmentDuration),null!==this.jvbJingleSession&&(this.jvbEstablishmentDuration=this.jvbJingleSession.establishmentDuration);var t=!1,n=this.options.config.forceJVB121Ratio;if(e.isP2P?this.p2pJingleSession!==e?(U.error("CONNECTION_ESTABLISHED - wrong P2P session instance ?!"),t=!0):!e.isInitiator&&"number"==typeof n&&Math.random()<n&&(U.info("Forcing JVB 121 mode (ratio="+n+")..."),A.a.analytics.addPermanentProperties({forceJvb121:!0}),this._stopP2PSession("decline","force JVB121"),t=!0):t=!0,!isNaN(this.p2pEstablishmentDuration)&&!isNaN(this.jvbEstablishmentDuration)){var r=this.p2pEstablishmentDuration-this.jvbEstablishmentDuration;A.a.analytics.sendEvent("ice.establishmentDurationDiff",{value:r})}t||(this._setP2PStatus(!0),this.jvbJingleSession?this._removeRemoteJVBTracks():U.info("Not removing remote JVB tracks - no session yet"),this._addRemoteP2PTracks(),this.jvbJingleSession&&this._suspendMediaTransferForJvbConnection(),U.info("Starting remote stats with p2p connection"),this.statistics.startRemoteStats(this.p2pJingleSession.peerconnection),this.p2pJingleSession.isInitiator&&A.a.sendEventToAll("p2p.established"))},r.prototype._maybeClearDeferredStartP2P=function(){this.deferredStartP2PTask&&(U.info("Cleared deferred start P2P task"),clearTimeout(this.deferredStartP2PTask),this.deferredStartP2PTask=null)},r.prototype._removeRemoteJVBTracks=function(){this._removeRemoteTracks("JVB",this.jvbJingleSession.peerconnection.getRemoteTracks())},r.prototype._removeRemoteP2PTracks=function(){this._removeRemoteTracks("P2P",this.p2pJingleSession.peerconnection.getRemoteTracks())},r.prototype._removeRemoteTracks=function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;U.info("Removing remote "+e+" track: "+s),this.rtc.eventEmitter.emit(P.REMOTE_TRACK_REMOVED,s)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}},r.prototype._resumeMediaTransferForJvbConnection=function(){U.info("Resuming media transfer over the JVB connection..."),this.jvbJingleSession.setMediaTransferActive(!0,!0).then(function(){U.info("Resumed media transfer over the JVB connection!")},function(e){U.error("Failed to resume media transfer over the JVB connection:",e)})},r.prototype._setP2PStatus=function(e){if(this.p2p===e)return void U.debug("Called _setP2PStatus with the same status: "+e);if(this.p2p=e,e){U.info("Peer to peer connection established!"),A.a.analytics.addPermanentProperties({p2pFailed:!1,forceJvb121:!1});var t=0!==this.rtc.getLastN();this.p2pJingleSession.setMediaTransferActive(!0,t).catch(function(e){U.error("Failed to sync up P2P video transfer status("+t+")",e)})}else U.info("Peer to peer connection closed!");this.jvbJingleSession&&this.statistics.sendConnectionResumeOrHoldEvent(this.jvbJingleSession.peerconnection,!e),this.dtmfManager=null,this.eventEmitter.emit(v.P2P_STATUS,this,this.p2p),this.eventEmitter.emit(this.isConnectionInterrupted()?v.CONNECTION_INTERRUPTED:v.CONNECTION_RESTORED)},r.prototype._startP2PSession=function(e){if(this._maybeClearDeferredStartP2P(),this.p2pJingleSession)return void U.error("P2P session already started!");this.isP2PConnectionInterrupted=!1,this.p2pJingleSession=this.xmpp.connection.jingle.newP2PJingleSession(this.room.myroomjid,e),U.info("Created new P2P JingleSession",this.room.myroomjid,e),this.p2pJingleSession.initialize(!0,this.room,this.rtc),U.info("Starting CallStats for P2P connection...");var t=i.Strophe.getResourceFromJid(this.p2pJingleSession.peerjid);if(this.options.config.enableStatsID){var n=this.participants[t];n&&(t=n.getStatsID()||t)}this.statistics.startCallStats(this.p2pJingleSession.peerconnection,t);var r=this.getLocalTracks();this.p2pJingleSession.invite(r)},r.prototype._suspendMediaTransferForJvbConnection=function(){U.info("Suspending media transfer over the JVB connection..."),this.jvbJingleSession.setMediaTransferActive(!1,!1).then(function(){U.info("Suspended media transfer over the JVB connection !")},function(e){U.error("Failed to suspend media transfer over the JVB connection:",e)})},r.prototype._maybeStartOrStopP2P=function(e){if(!I.a.isP2PSupported()||!this.isP2PEnabled()||this.isP2PTestModeEnabled())return void U.info("Auto P2P disabled");var t=this.getParticipants(),n=t.length,r=this.isModerator(),i=1===n;if(U.debug("P2P? isModerator: "+r+", peerCount: "+n+" => "+i),!i&&this.deferredStartP2PTask&&this._maybeClearDeferredStartP2P(),r&&!this.p2pJingleSession&&i){var o=n&&t[0];if(r&&"moderator"===o.getRole()){var a=this.myUserId(),s=o.getId();if(a>s)return void U.debug("Everyone's a moderator - the other peer should start P2P",a,s);if(a===s)return void U.error("The same IDs ? ",a,s)}var c=o.getJid();if(e){if(this.deferredStartP2PTask)return void U.error("Deferred start P2P task's been set already!");U.info("Will start P2P with: "+c+" after "+this.backToP2PDelay+" seconds..."),this.deferredStartP2PTask=setTimeout(this._startP2PSession.bind(this,c),1e3*this.backToP2PDelay)}else U.info("Will start P2P with: "+c),this._startP2PSession(c)}else this.p2pJingleSession&&!i&&(U.info("Will stop P2P with: "+this.p2pJingleSession.peerjid),this.p2pJingleSession.isInitiator&&n>1&&A.a.sendEventToAll("p2p.switch_to_jvb"),this._stopP2PSession())},r.prototype._stopP2PSession=function(e,t){if(!this.p2pJingleSession)return void U.error("No P2P session to be stopped!");var n=this.isP2PActive();n&&(this.jvbJingleSession&&this._resumeMediaTransferForJvbConnection(),this._removeRemoteP2PTracks()),U.info("Stopping remote stats for P2P connection"),this.statistics.stopRemoteStats(this.p2pJingleSession.peerconnection),U.info("Stopping CallStats for P2P connection"),this.statistics.stopCallStats(this.p2pJingleSession.peerconnection),this.p2pJingleSession.terminate(function(){U.info("P2P session terminate RESULT")},function(t){e&&U.error("An error occurred while trying to terminate P2P Jingle session",t)},{reason:e||"success",reasonDescription:t||"Turing off P2P session",sendSessionTerminate:this.room&&this.getParticipantById(i.Strophe.getResourceFromJid(this.p2pJingleSession.peerjid))}),this.p2pJingleSession=null,this._setP2PStatus(!1),n&&(this.jvbJingleSession?this._addRemoteJVBTracks():U.info("Not adding remote JVB tracks - no session yet"))},r.prototype.isP2PActive=function(){return this.p2p},r.prototype.getP2PConnectionState=function(){return this.isP2PActive()?this.p2pJingleSession.peerconnection.getConnectionState():null},r.prototype.startP2PSession=function(){var e=this.getParticipants();if(1!==e.length)throw new Error("There must be exactly 1 participant to start the P2P session !");var t=e[0].getJid();this._startP2PSession(t)},r.prototype.stopP2PSession=function(){this._stopP2PSession()},r.prototype.getSpeakerStats=function(){return this.speakerStatsCollector.getStats()},r.prototype.setReceiverVideoConstraint=function(e){this.rtc.setReceiverVideoConstraint(e)},r.prototype._getVideoSIPGWHandle=function(){return this.videoSIPGWHandler||(this.videoSIPGWHandler=new M.a(this.room),U.info("Created VideoSIPGW")),this.videoSIPGWHandler},r.prototype.isVideoSIPGWAvailable=function(){return this._getVideoSIPGWHandle().isVideoSIPGWAvailable()},r.prototype.createVideoSIPGWSession=function(e,t){return this.room?this._getVideoSIPGWHandle().createVideoSIPGWSession(e,t):null}}).call(t,"JitsiConference.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(29)),a=n(6),s=n(4),c=n(1),u=n(5),l=n(16),d=(n.n(l),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),p=Object(i.getLogger)(e),h=function(){function e(t){r(this,e),this.name=t,this.count=0,this.sum=0,this.samples=[]}return d(e,[{key:"addNext",value:function(e){"number"!=typeof e?p.error(this.name+" - invalid value for idx: "+this.count,e):isNaN(e)||(this.sum+=e,this.samples.push(e),this.count+=1)}},{key:"calculate",value:function(){return this.sum/this.count}},{key:"appendReport",value:function(e){e[this.name]={value:this.calculate(),samples:this.samples}}},{key:"reset",value:function(){this.samples=[],this.sum=0,this.count=0}}]),e}(),f=function(){function e(t,n,i){var s=this;r(this,e),this.isP2P=n,this._n=i,this._sampleIdx=0,this._avgRTT=new h("stat_avg_rtt"),this._avgRemoteRTTMap=new Map,this._avgRtpStatsReporter=t,this._avgEnd2EndRTT=void 0,this._onConnectionStats=function(e,t){s.isP2P===e.isP2P&&s._calculateAvgStats(t)};var c=t._conference;c.statistics.addConnectionStatsListener(this._onConnectionStats),this.isP2P||(this._onUserLeft=function(e){return s._avgRemoteRTTMap.delete(e)},c.on(a.USER_LEFT,this._onUserLeft),this._onRemoteStatsUpdated=function(e,t){return s._processRemoteStats(e,t)},c.on(o.REMOTE_STATS_UPDATED,this._onRemoteStatsUpdated))}return d(e,[{key:"_calculateAvgStats",value:function(e){if(!e)return void p.error("No stats");if(c.a.supportsRTTStatistics()&&e.transport&&e.transport.length&&this._avgRTT.addNext(e.transport[0].rtt),this._sampleIdx+=1,this._sampleIdx>=this._n){if(c.a.supportsRTTStatistics()){var t=this._avgRtpStatsReporter._conference,n={p2p:this.isP2P,size:t.getParticipantCount()};if(e.transport&&e.transport.length&&Object.assign(n,{localCandidateType:e.transport[0].localCandidateType,remoteCandidateType:e.transport[0].remoteCandidateType,transportType:e.transport[0].type}),this._avgRTT.appendReport(n),this.isP2P){var r=this._avgRtpStatsReporter.jvbStatsMonitor._avgEnd2EndRTT;if(!isNaN(r)){var i=this._avgRTT.calculate()-r;n.stat_avg_rtt_diff={value:i}}}else{var o=this._calculateAvgRemoteRTT(),a=this._avgRTT.calculate();this._avgEnd2EndRTT=a+o,isNaN(a)||isNaN(o)||(n.stat_avg_end2endrtt={value:this._avgEnd2EndRTT})}u.a.analytics.sendEvent("avg.rtp.stats",n)}this._resetAvgStats()}}},{key:"_calculateAvgRemoteRTT",value:function(){var e=0,t=0,n=!0,r=!1,i=void 0;try{for(var o,a=this._avgRemoteRTTMap.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=s.calculate();isNaN(c)||(t+=c,e+=1,s.reset())}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t/e}},{key:"_processRemoteStats",value:function(e,t){var n="number"==typeof t.jvbRTT,r=this._avgRemoteRTTMap.get(e);!r&&n&&(r=new h(e+"_stat_rtt"),this._avgRemoteRTTMap.set(e,r)),n?r.addNext(t.jvbRTT):r&&this._avgRemoteRTTMap.delete(e)}},{key:"_resetAvgStats",value:function(){this._avgRTT.reset(),this._avgRemoteRTTMap&&this._avgRemoteRTTMap.clear(),this._sampleIdx=0}},{key:"dispose",value:function(){var e=this._avgRtpStatsReporter._conference;e.statistics.removeConnectionStatsListener(this._onConnectionStats),this.isP2P||(e.off(o.REMOTE_STATS_UPDATED,this._onRemoteStatsUpdated),e.off(a.USER_LEFT,this._onUserLeft))}}]),e}(),m=function(){function e(t,n){var i=this;if(r(this,e),this._n=n,!(n>0))return void p.info("Avg RTP stats reports are disabled.");p.info("Avg RTP stats will be calculated every "+n+" samples"),this._sampleIdx=0,this._conference=t,this._avgAudioBitrateUp=new h("stat_avg_bitrate_audio_upload"),this._avgAudioBitrateDown=new h("stat_avg_bitrate_audio_download"),this._avgVideoBitrateUp=new h("stat_avg_bitrate_video_upload"),this._avgVideoBitrateDown=new h("stat_avg_bitrate_video_download"),this._avgBandwidthUp=new h("stat_avg_bandwidth_upload"),this._avgBandwidthDown=new h("stat_avg_bandwidth_download"),this._avgPacketLossTotal=new h("stat_avg_packetloss_total"),this._avgPacketLossUp=new h("stat_avg_packetloss_upload"),this._avgPacketLossDown=new h("stat_avg_packetloss_download"),this._avgRemoteFPS=new h("stat_avg_framerate_remote"),this._avgRemoteScreenFPS=new h("stat_avg_framerate_screen_remote"),this._avgLocalFPS=new h("stat_avg_framerate_local"),this._avgLocalScreenFPS=new h("stat_avg_framerate_screen_local"),this._avgRemoteCameraPixels=new h("stat_avg_pixels_remote"),this._avgRemoteScreenPixels=new h("stat_avg_pixels_screen_remote"),this._avgLocalCameraPixels=new h("stat_avg_pixels_local"),this._avgLocalScreenPixels=new h("stat_avg_pixels_screen_local"),this._avgCQ=new h("stat_avg_cq"),this._onLocalStatsUpdated=function(e){return i._calculateAvgStats(e)},t.on(o.LOCAL_STATS_UPDATED,this._onLocalStatsUpdated),this._onP2PStatusChanged=function(){p.debug("Resetting average stats calculation"),i._resetAvgStats(),i.jvbStatsMonitor._resetAvgStats(),i.p2pStatsMonitor._resetAvgStats()},t.on(a.P2P_STATUS,this._onP2PStatusChanged),this._onJvb121StatusChanged=function(e,t){!0===t&&(p.info("Resetting JVB avg RTP stats"),i._resetAvgJvbStats())},t.on(a.JVB121_STATUS,this._onJvb121StatusChanged),this.jvbStatsMonitor=new f(this,!1,n),this.p2pStatsMonitor=new f(this,!0,n)}return d(e,[{key:"_calculateAvgStats",value:function(e){if(!e)return void p.error("No stats");var t=this._conference.isP2PActive(),n=this._conference.getParticipantCount();if(t||!(n<2)){var r=e.bitrate,i=e.bandwidth,o=e.packetLoss,a=e.framerate,s=e.resolution;if(!r)return void p.error('No "bitrate"');if(!i)return void p.error('No "bandwidth"');if(!o)return void p.error('No "packetloss"');if(!a)return void p.error('No "framerate"');if(!s)return void p.error("No resolution");if(this._avgAudioBitrateUp.addNext(r.audio.upload),this._avgAudioBitrateDown.addNext(r.audio.download),this._avgVideoBitrateUp.addNext(r.video.upload),this._avgVideoBitrateDown.addNext(r.video.download),c.a.supportsBandwidthStatistics()&&(this._avgBandwidthUp.addNext(i.upload),this._avgBandwidthDown.addNext(i.download)),this._avgPacketLossUp.addNext(o.upload),this._avgPacketLossDown.addNext(o.download),this._avgPacketLossTotal.addNext(o.total),this._avgCQ.addNext(e.connectionQuality),a&&(this._avgRemoteFPS.addNext(this._calculateAvgVideoFps(a,!1,l.CAMERA)),this._avgRemoteScreenFPS.addNext(this._calculateAvgVideoFps(a,!1,l.DESKTOP)),this._avgLocalFPS.addNext(this._calculateAvgVideoFps(a,!0,l.CAMERA)),this._avgLocalScreenFPS.addNext(this._calculateAvgVideoFps(a,!0,l.DESKTOP))),s&&(this._avgRemoteCameraPixels.addNext(this._calculateAvgVideoPixels(s,!1,l.CAMERA)),this._avgRemoteScreenPixels.addNext(this._calculateAvgVideoPixels(s,!1,l.DESKTOP)),this._avgLocalCameraPixels.addNext(this._calculateAvgVideoPixels(s,!0,l.CAMERA)),this._avgLocalScreenPixels.addNext(this._calculateAvgVideoPixels(s,!0,l.DESKTOP))),this._sampleIdx+=1,this._sampleIdx>=this._n){var d={p2p:t,size:n};e.transport&&e.transport.length&&Object.assign(d,{localCandidateType:e.transport[0].localCandidateType,remoteCandidateType:e.transport[0].remoteCandidateType,transportType:e.transport[0].type}),this._avgAudioBitrateUp.appendReport(d),this._avgAudioBitrateDown.appendReport(d),this._avgVideoBitrateUp.appendReport(d),this._avgVideoBitrateDown.appendReport(d),c.a.supportsBandwidthStatistics()&&(this._avgBandwidthUp.appendReport(d),this._avgBandwidthDown.appendReport(d)),this._avgPacketLossUp.appendReport(d),this._avgPacketLossDown.appendReport(d),this._avgPacketLossTotal.appendReport(d),this._avgRemoteFPS.appendReport(d),isNaN(this._avgRemoteScreenFPS.calculate())||this._avgRemoteScreenFPS.appendReport(d),this._avgLocalFPS.appendReport(d),isNaN(this._avgLocalScreenFPS.calculate())||this._avgLocalScreenFPS.appendReport(d),this._avgRemoteCameraPixels.appendReport(d),isNaN(this._avgRemoteScreenPixels.calculate())||this._avgRemoteScreenPixels.appendReport(d),this._avgLocalCameraPixels.appendReport(d),isNaN(this._avgLocalScreenPixels.calculate())||this._avgLocalScreenPixels.appendReport(d),this._avgCQ.appendReport(d),u.a.analytics.sendEvent("avg.rtp.stats",d),this._resetAvgStats()}}}},{key:"_calculateAvgVideoPixels",value:function(e,t,n){var r=0,i=0,o=this._conference.myUserId(),a=!0,s=!1,c=void 0;try{for(var u,l=Object.keys(e)[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value;if(t?d===o:d!==o){var p=t?null:this._conference.getParticipantById(d),h=e[d];if((t||p)&&h){var f=this._calculatePeerAvgVideoPixels(h,p,n);isNaN(f)||(r+=f,i+=1)}}}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}return r/i}},{key:"_calculatePeerAvgVideoPixels",value:function(e,t,n){var r=Object.keys(e).map(function(e){return Number(e)}),i=null,o=this._conference.getActivePeerConnection();t?(i=t.getTracksByMediaType(s.b))&&(r=r.filter(function(e){return i.find(function(t){return!t.isMuted()&&t.getSSRC()===e&&t.videoType===n})})):(i=this._conference.getLocalTracks(s.b),r=r.filter(function(e){return i.find(function(t){return!t.isMuted()&&o.getLocalSSRC(t)===e&&t.videoType===n})}));var a=0,c=0,u=!0,l=!1,d=void 0;try{for(var p,h=r[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){var f=p.value,m=Number(e[f].height)*Number(e[f].width);!isNaN(m)&&m>0&&(a+=m,c+=1)}}catch(e){l=!0,d=e}finally{try{!u&&h.return&&h.return()}finally{if(l)throw d}}return a/c}},{key:"_calculateAvgVideoFps",value:function(e,t,n){var r=0,i=0,o=this._conference.myUserId(),a=!0,s=!1,c=void 0;try{for(var u,l=Object.keys(e)[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value;if(t?d===o:d!==o){var p=t?null:this._conference.getParticipantById(d),h=e[d];if((t||p)&&h){var f=this._calculatePeerAvgVideoFps(h,p,n);isNaN(f)||(r+=f,i+=1)}}}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}return r/i}},{key:"_calculatePeerAvgVideoFps",value:function(e,t,n){var r=Object.keys(e).map(function(e){return Number(e)}),i=null,o=this._conference.getActivePeerConnection();t?(i=t.getTracksByMediaType(s.b))&&(r=r.filter(function(e){return i.find(function(t){return!t.isMuted()&&t.getSSRC()===e&&t.videoType===n})})):(i=this._conference.getLocalTracks(s.b),r=r.filter(function(e){return i.find(function(t){return!t.isMuted()&&o.getLocalSSRC(t)===e&&t.videoType===n})}));var a=0,c=0,u=!0,l=!1,d=void 0;try{for(var p,h=r[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){var f=p.value,m=Number(e[f]);!isNaN(m)&&m>0&&(a+=m,c+=1)}}catch(e){l=!0,d=e}finally{try{!u&&h.return&&h.return()}finally{if(l)throw d}}return a/c}},{key:"_resetAvgJvbStats",value:function(){this._resetAvgStats(),this.jvbStatsMonitor._resetAvgStats()}},{key:"_resetAvgStats",value:function(){this._avgAudioBitrateUp.reset(),this._avgAudioBitrateDown.reset(),this._avgVideoBitrateUp.reset(),this._avgVideoBitrateDown.reset(),this._avgBandwidthUp.reset(),this._avgBandwidthDown.reset(),this._avgPacketLossUp.reset(),this._avgPacketLossDown.reset(),this._avgPacketLossTotal.reset(),this._avgRemoteFPS.reset(),this._avgRemoteScreenFPS.reset(),this._avgLocalFPS.reset(),this._avgLocalScreenFPS.reset(),this._avgRemoteCameraPixels.reset(),this._avgRemoteScreenPixels.reset(),this._avgLocalCameraPixels.reset(),this._avgLocalScreenPixels.reset(),this._avgCQ.reset(),this._sampleIdx=0}},{key:"dispose",value:function(){this._conference.off(a.P2P_STATUS,this._onP2PStatusChanged),this._conference.off(o.LOCAL_STATS_UPDATED,this._onLocalStatsUpdated),this._conference.off(a.JVB121_STATUS,this._onJvb121StatusChanged),this.jvbStatsMonitor.dispose(),this.p2pStatsMonitor.dispose()}}]),e}();t.a=m}).call(t,"modules/statistics/AvgRTPStatsReporter.js")},function(e,t,n){function r(e,t){this.logStorage=e,this.stringifyObjects=!(!t||!t.stringifyObjects)&&t.stringifyObjects,this.storeInterval=t&&t.storeInterval?t.storeInterval:3e4,this.maxEntryLength=t&&t.maxEntryLength?t.maxEntryLength:1e4,Object.keys(o.levels).forEach(function(e){this[o.levels[e]]=function(e){this._log.apply(this,arguments)}.bind(this,e)}.bind(this)),this.storeLogsIntervalID=null,this.queue=[],this.totalLen=0,this.outputCache=[]}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(37);r.prototype.stringify=function(e){try{return JSON.stringify(e)}catch(e){return"[object with circular refs?]"}},r.prototype.formatLogMessage=function(e){for(var t="",n=1,r=arguments.length;n<r;n++){var a=arguments[n];!this.stringifyObjects&&e!==o.levels.ERROR||"object"!==(void 0===a?"undefined":i(a))||(a=this.stringify(a)),t+=a,n!=r-1&&(t+=" ")}return t.length?t:null},r.prototype._log=function(){var e=this.formatLogMessage.apply(this,arguments);if(e){var t=this.queue.length?this.queue[this.queue.length-1]:void 0;("object"===(void 0===t?"undefined":i(t))?t.text:t)==e?"object"===(void 0===t?"undefined":i(t))?t.count+=1:this.queue[this.queue.length-1]={text:e,count:2}:(this.queue.push(e),this.totalLen+=e.length)}this.totalLen>=this.maxEntryLength&&this._flush(!0,!0)},r.prototype.start=function(){this._reschedulePublishInterval()},r.prototype._reschedulePublishInterval=function(){this.storeLogsIntervalID&&(window.clearTimeout(this.storeLogsIntervalID),this.storeLogsIntervalID=null),this.storeLogsIntervalID=window.setTimeout(this._flush.bind(this,!1,!0),this.storeInterval)},r.prototype.flush=function(){this._flush(!1,!0)},r.prototype._flush=function(e,t){this.totalLen>0&&(this.logStorage.isReady()||e)&&(this.logStorage.isReady()?(this.outputCache.length&&(this.outputCache.forEach(function(e){this.logStorage.storeLogs(e)}.bind(this)),this.outputCache=[]),this.logStorage.storeLogs(this.queue)):this.outputCache.push(this.queue),this.queue=[],this.totalLen=0),t&&this._reschedulePublishInterval()},r.prototype.stop=function(){this._flush(!1,!1)},e.exports=r},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(1),s=n(18),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(){o(this,e)}return c(e,[{key:"sendEvent",value:function(){}}]),e}(),l=function(e){function t(){o(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.eventCache=[],e}return i(t,e),c(t,[{key:"sendEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.eventCache.push({action:e,data:t})}},{key:"drainCachedEvents",value:function(){var e=this.eventCache.slice();return this.eventCache=[],e}}]),t}(u),d=new l,p=function(){function e(){o(this,e),this.disposed=!1,this.browserName=a.a.getBrowserName(),this.analyticsHandlers=new Set,this.permanentProperties=Object.create(null),this.addPermanentProperties({callstatsname:s.a.callStatsUserName}),this.analyticsHandlers.add(d)}return c(e,[{key:"sendEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.assign({browserName:this.browserName},this.permanentProperties,t);this.analyticsHandlers.forEach(function(r){return r.sendEvent(e,r===d?t:n)})}},{key:"dispose",value:function(){d.drainCachedEvents(),this.analyticsHandlers.clear(),this.disposed=!0}},{key:"setAnalyticsHandlers",value:function(e){var t=this;this.disposed||(this.analyticsHandlers=new Set(e),d.drainCachedEvents().forEach(function(e){return t.sendEvent(e.action,e.data)}))}},{key:"addPermanentProperties",value:function(e){this.permanentProperties=Object.assign(this.permanentProperties,e)}}]),e}();t.a=new p},function(e,t,n){function r(){return i.randomElement(o)+"-"+i.randomAlphanumStr(3)}var i=n(19),o=["Aaliyah","Aaron","Abagail","Abbey","Abbie","Abbigail","Abby","Abdiel","Abdul","Abdullah","Abe","Abel","Abelardo","Abigail","Abigale","Abigayle","Abner","Abraham","Ada","Adah","Adalberto","Adaline","Adam","Adan","Addie","Addison","Adela","Adelbert","Adele","Adelia","Adeline","Adell","Adella","Adelle","Aditya","Adolf","Adolfo","Adolph","Adolphus","Adonis","Adrain","Adrian","Adriana","Adrianna","Adriel","Adrien","Adrienne","Afton","Aglae","Agnes","Agustin","Agustina","Ahmad","Ahmed","Aida","Aidan","Aiden","Aileen","Aisha","Aiyana","Akeem","Al","Alaina","Alan","Alana","Alanis","Alanna","Alayna","Alba","Albert","Alberta","Albertha","Alberto","Albin","Albina","Alda","Alden","Alec","Aleen","Alejandra","Alejandrin","Alek","Alena","Alene","Alessandra","Alessandro","Alessia","Aletha","Alex","Alexa","Alexander","Alexandra","Alexandre","Alexandrea","Alexandria","Alexandrine","Alexandro","Alexane","Alexanne","Alexie","Alexis","Alexys","Alexzander","Alf","Alfonso","Alfonzo","Alford","Alfred","Alfreda","Alfredo","Ali","Alia","Alice","Alicia","Alisa","Alisha","Alison","Alivia","Aliya","Aliyah","Aliza","Alize","Allan","Allen","Allene","Allie","Allison","Ally","Alphonso","Alta","Althea","Alva","Alvah","Alvena","Alvera","Alverta","Alvina","Alvis","Alyce","Alycia","Alysa","Alysha","Alyson","Alysson","Amalia","Amanda","Amani","Amara","Amari","Amaya","Amber","Ambrose","Amelia","Amelie","Amely","America","Americo","Amie","Amina","Amir","Amira","Amiya","Amos","Amparo","Amy","Amya","Ana","Anabel","Anabelle","Anahi","Anais","Anastacio","Anastasia","Anderson","Andre","Andreane","Andreanne","Andres","Andrew","Andy","Angel","Angela","Angelica","Angelina","Angeline","Angelita","Angelo","Angie","Angus","Anibal","Anika","Anissa","Anita","Aniya","Aniyah","Anjali","Anna","Annabel","Annabell","Annabelle","Annalise","Annamae","Annamarie","Anne","Annetta","Annette","Annie","Ansel","Ansley","Anthony","Antoinette","Antone","Antonetta","Antonette","Antonia","Antonietta","Antonina","Antonio","Antwan","Antwon","Anya","April","Ara","Araceli","Aracely","Arch","Archibald","Ardella","Arden","Ardith","Arely","Ari","Ariane","Arianna","Aric","Ariel","Arielle","Arjun","Arlene","Arlie","Arlo","Armand","Armando","Armani","Arnaldo","Arne","Arno","Arnold","Arnoldo","Arnulfo","Aron","Art","Arthur","Arturo","Arvel","Arvid","Arvilla","Aryanna","Asa","Asha","Ashlee","Ashleigh","Ashley","Ashly","Ashlynn","Ashton","Ashtyn","Asia","Assunta","Astrid","Athena","Aubree","Aubrey","Audie","Audra","Audreanne","Audrey","August","Augusta","Augustine","Augustus","Aurelia","Aurelie","Aurelio","Aurore","Austen","Austin","Austyn","Autumn","Ava","Avery","Avis","Axel","Ayana","Ayden","Ayla","Aylin","Baby","Bailee","Bailey","Barbara","Barney","Baron","Barrett","Barry","Bart","Bartholome","Barton","Baylee","Beatrice","Beau","Beaulah","Bell","Bella","Belle","Ben","Benedict","Benjamin","Bennett","Bennie","Benny","Benton","Berenice","Bernadette","Bernadine","Bernard","Bernardo","Berneice","Bernhard","Bernice","Bernie","Berniece","Bernita","Berry","Bert","Berta","Bertha","Bertram","Bertrand","Beryl","Bessie","Beth","Bethany","Bethel","Betsy","Bette","Bettie","Betty","Bettye","Beulah","Beverly","Bianka","Bill","Billie","Billy","Birdie","Blair","Blaise","Blake","Blanca","Blanche","Blaze","Bo","Bobbie","Bobby","Bonita","Bonnie","Boris","Boyd","Brad","Braden","Bradford","Bradley","Bradly","Brady","Braeden","Brain","Brandi","Brando","Brandon","Brandt","Brandy","Brandyn","Brannon","Branson","Brant","Braulio","Braxton","Brayan","Breana","Breanna","Breanne","Brenda","Brendan","Brenden","Brendon","Brenna","Brennan","Brennon","Brent","Bret","Brett","Bria","Brian","Briana","Brianne","Brice","Bridget","Bridgette","Bridie","Brielle","Brigitte","Brionna","Brisa","Britney","Brittany","Brock","Broderick","Brody","Brook","Brooke","Brooklyn","Brooks","Brown","Bruce","Bryana","Bryce","Brycen","Bryon","Buck","Bud","Buddy","Buford","Bulah","Burdette","Burley","Burnice","Buster","Cade","Caden","Caesar","Caitlyn","Cale","Caleb","Caleigh","Cali","Calista","Callie","Camden","Cameron","Camila","Camilla","Camille","Camren","Camron","Camryn","Camylle","Candace","Candelario","Candice","Candida","Candido","Cara","Carey","Carissa","Carlee","Carleton","Carley","Carli","Carlie","Carlo","Carlos","Carlotta","Carmel","Carmela","Carmella","Carmelo","Carmen","Carmine","Carol","Carolanne","Carole","Carolina","Caroline","Carolyn","Carolyne","Carrie","Carroll","Carson","Carter","Cary","Casandra","Casey","Casimer","Casimir","Casper","Cassandra","Cassandre","Cassidy","Cassie","Catalina","Caterina","Catharine","Catherine","Cathrine","Cathryn","Cathy","Cayla","Ceasar","Cecelia","Cecil","Cecile","Cecilia","Cedrick","Celestine","Celestino","Celia","Celine","Cesar","Chad","Chadd","Chadrick","Chaim","Chance","Chandler","Chanel","Chanelle","Charity","Charlene","Charles","Charley","Charlie","Charlotte","Chase","Chasity","Chauncey","Chaya","Chaz","Chelsea","Chelsey","Chelsie","Chesley","Chester","Chet","Cheyanne","Cheyenne","Chloe","Chris","Christ","Christa","Christelle","Christian","Christiana","Christina","Christine","Christop","Christophe","Christopher","Christy","Chyna","Ciara","Cicero","Cielo","Cierra","Cindy","Citlalli","Clair","Claire","Clara","Clarabelle","Clare","Clarissa","Clark","Claud","Claude","Claudia","Claudie","Claudine","Clay","Clemens","Clement","Clementina","Clementine","Clemmie","Cleo","Cleora","Cleta","Cletus","Cleve","Cleveland","Clifford","Clifton","Clint","Clinton","Clotilde","Clovis","Cloyd","Clyde","Coby","Cody","Colby","Cole","Coleman","Colin","Colleen","Collin","Colt","Colten","Colton","Columbus","Concepcion","Conner","Connie","Connor","Conor","Conrad","Constance","Constantin","Consuelo","Cooper","Cora","Coralie","Corbin","Cordelia","Cordell","Cordia","Cordie","Corene","Corine","Cornelius","Cornell","Corrine","Cortez","Cortney","Cory","Coty","Courtney","Coy","Craig","Crawford","Creola","Cristal","Cristian","Cristina","Cristobal","Cristopher","Cruz","Crystal","Crystel","Cullen","Curt","Curtis","Cydney","Cynthia","Cyril","Cyrus","Dagmar","Dahlia","Daija","Daisha","Daisy","Dakota","Dale","Dallas","Dallin","Dalton","Damaris","Dameon","Damian","Damien","Damion","Damon","Dan","Dana","Dandre","Dane","D'angelo","Dangelo","Danial","Daniela","Daniella","Danielle","Danika","Dannie","Danny","Dante","Danyka","Daphne","Daphnee","Daphney","Darby","Daren","Darian","Dariana","Darien","Dario","Darion","Darius","Darlene","Daron","Darrel","Darrell","Darren","Darrick","Darrin","Darrion","Darron","Darryl","Darwin","Daryl","Dashawn","Dasia","Dave","David","Davin","Davion","Davon","Davonte","Dawn","Dawson","Dax","Dayana","Dayna","Dayne","Dayton","Dean","Deangelo","Deanna","Deborah","Declan","Dedric","Dedrick","Dee","Deion","Deja","Dejah","Dejon","Dejuan","Delaney","Delbert","Delfina","Delia","Delilah","Dell","Della","Delmer","Delores","Delpha","Delphia","Delphine","Delta","Demarco","Demarcus","Demario","Demetris","Demetrius","Demond","Dena","Denis","Dennis","Deon","Deondre","Deontae","Deonte","Dereck","Derek","Derick","Deron","Derrick","Deshaun","Deshawn","Desiree","Desmond","Dessie","Destany","Destin","Destinee","Destiney","Destini","Destiny","Devan","Devante","Deven","Devin","Devon","Devonte","Devyn","Dewayne","Dewitt","Dexter","Diamond","Diana","Dianna","Diego","Dillan","Dillon","Dimitri","Dina","Dino","Dion","Dixie","Dock","Dolly","Dolores","Domenic","Domenica","Domenick","Domenico","Domingo","Dominic","Dominique","Don","Donald","Donato","Donavon","Donna","Donnell","Donnie","Donny","Dora","Dorcas","Dorian","Doris","Dorothea","Dorothy","Dorris","Dortha","Dorthy","Doug","Douglas","Dovie","Doyle","Drake","Drew","Duane","Dudley","Dulce","Duncan","Durward","Dustin","Dusty","Dwight","Dylan","Earl","Earlene","Earline","Earnest","Earnestine","Easter","Easton","Ebba","Ebony","Ed","Eda","Edd","Eddie","Eden","Edgar","Edgardo","Edison","Edmond","Edmund","Edna","Eduardo","Edward","Edwardo","Edwin","Edwina","Edyth","Edythe","Effie","Efrain","Efren","Eileen","Einar","Eino","Eladio","Elaina","Elbert","Elda","Eldon","Eldora","Eldred","Eldridge","Eleanora","Eleanore","Eleazar","Electa","Elena","Elenor","Elenora","Eleonore","Elfrieda","Eli","Elian","Eliane","Elias","Eliezer","Elijah","Elinor","Elinore","Elisa","Elisabeth","Elise","Eliseo","Elisha","Elissa","Eliza","Elizabeth","Ella","Ellen","Ellie","Elliot","Elliott","Ellis","Ellsworth","Elmer","Elmira","Elmo","Elmore","Elna","Elnora","Elody","Eloisa","Eloise","Elouise","Eloy","Elroy","Elsa","Else","Elsie","Elta","Elton","Elva","Elvera","Elvie","Elvis","Elwin","Elwyn","Elyse","Elyssa","Elza","Emanuel","Emelia","Emelie","Emely","Emerald","Emerson","Emery","Emie","Emil","Emile","Emilia","Emiliano","Emilie","Emilio","Emily","Emma","Emmalee","Emmanuel","Emmanuelle","Emmet","Emmett","Emmie","Emmitt","Emmy","Emory","Ena","Enid","Enoch","Enola","Enos","Enrico","Enrique","Ephraim","Era","Eriberto","Eric","Erica","Erich","Erick","Ericka","Erik","Erika","Erin","Erling","Erna","Ernest","Ernestina","Ernestine","Ernesto","Ernie","Ervin","Erwin","Eryn","Esmeralda","Esperanza","Esta","Esteban","Estefania","Estel","Estell","Estella","Estelle","Estevan","Esther","Estrella","Etha","Ethan","Ethel","Ethelyn","Ethyl","Ettie","Eudora","Eugene","Eugenia","Eula","Eulah","Eulalia","Euna","Eunice","Eusebio","Eva","Evalyn","Evan","Evangeline","Evans","Eve","Eveline","Evelyn","Everardo","Everett","Everette","Evert","Evie","Ewald","Ewell","Ezekiel","Ezequiel","Ezra","Fabian","Fabiola","Fae","Fannie","Fanny","Fatima","Faustino","Fausto","Favian","Fay","Faye","Federico","Felicia","Felicita","Felicity","Felipa","Felipe","Felix","Felton","Fermin","Fern","Fernando","Ferne","Fidel","Filiberto","Filomena","Finn","Fiona","Flavie","Flavio","Fleta","Fletcher","Flo","Florence","Florencio","Florian","Florida","Florine","Flossie","Floy","Floyd","Ford","Forest","Forrest","Foster","Frances","Francesca","Francesco","Francis","Francisca","Francisco","Franco","Frank","Frankie","Franz","Fred","Freda","Freddie","Freddy","Frederic","Frederick","Frederik","Frederique","Fredrick","Fredy","Freeda","Freeman","Freida","Frida","Frieda","Friedrich","Fritz","Furman","Gabe","Gabriel","Gabriella","Gabrielle","Gaetano","Gage","Gail","Gardner","Garett","Garfield","Garland","Garnet","Garnett","Garret","Garrett","Garrick","Garrison","Garry","Garth","Gaston","Gavin","Gay","Gayle","Gaylord","Gene","General","Genesis","Genevieve","Gennaro","Genoveva","Geo","Geoffrey","George","Georgette","Georgiana","Georgianna","Geovanni","Geovanny","Geovany","Gerald","Geraldine","Gerard","Gerardo","Gerda","Gerhard","Germaine","German","Gerry","Gerson","Gertrude","Gia","Gianni","Gideon","Gilbert","Gilberto","Gilda","Giles","Gillian","Gina","Gino","Giovani","Giovanna","Giovanni","Giovanny","Gisselle","Giuseppe","Gladyce","Gladys","Glen","Glenda","Glenna","Glennie","Gloria","Godfrey","Golda","Golden","Gonzalo","Gordon","Grace","Gracie","Graciela","Grady","Graham","Grant","Granville","Grayce","Grayson","Green","Greg","Gregg","Gregoria","Gregorio","Gregory","Greta","Gretchen","Greyson","Griffin","Grover","Guadalupe","Gudrun","Guido","Guillermo","Guiseppe","Gunnar","Gunner","Gus","Gussie","Gust","Gustave","Guy","Gwen","Gwendolyn","Hadley","Hailee","Hailey","Hailie","Hal","Haleigh","Haley","Halie","Halle","Hallie","Hank","Hanna","Hannah","Hans","Hardy","Harley","Harmon","Harmony","Harold","Harrison","Harry","Harvey","Haskell","Hassan","Hassie","Hattie","Haven","Hayden","Haylee","Hayley","Haylie","Hazel","Hazle","Heath","Heather","Heaven","Heber","Hector","Heidi","Helen","Helena","Helene","Helga","Hellen","Helmer","Heloise","Henderson","Henri","Henriette","Henry","Herbert","Herman","Hermann","Hermina","Herminia","Herminio","Hershel","Herta","Hertha","Hester","Hettie","Hilario","Hilbert","Hilda","Hildegard","Hillard","Hillary","Hilma","Hilton","Hipolito","Hiram","Hobart","Holden","Hollie","Hollis","Holly","Hope","Horace","Horacio","Hortense","Hosea","Houston","Howard","Howell","Hoyt","Hubert","Hudson","Hugh","Hulda","Humberto","Hunter","Hyman","Ian","Ibrahim","Icie","Ida","Idell","Idella","Ignacio","Ignatius","Ike","Ila","Ilene","Iliana","Ima","Imani","Imelda","Immanuel","Imogene","Ines","Irma","Irving","Irwin","Isaac","Isabel","Isabell","Isabella","Isabelle","Isac","Isadore","Isai","Isaiah","Isaias","Isidro","Ismael","Isobel","Isom","Israel","Issac","Itzel","Iva","Ivah","Ivory","Ivy","Izabella","Izaiah","Jabari","Jace","Jacey","Jacinthe","Jacinto","Jack","Jackeline","Jackie","Jacklyn","Jackson","Jacky","Jaclyn","Jacquelyn","Jacques","Jacynthe","Jada","Jade","Jaden","Jadon","Jadyn","Jaeden","Jaida","Jaiden","Jailyn","Jaime","Jairo","Jakayla","Jake","Jakob","Jaleel","Jalen","Jalon","Jalyn","Jamaal","Jamal","Jamar","Jamarcus","Jamel","Jameson","Jamey","Jamie","Jamil","Jamir","Jamison","Jammie","Jan","Jana","Janae","Jane","Janelle","Janessa","Janet","Janice","Janick","Janie","Janis","Janiya","Jannie","Jany","Jaquan","Jaquelin","Jaqueline","Jared","Jaren","Jarod","Jaron","Jarred","Jarrell","Jarret","Jarrett","Jarrod","Jarvis","Jasen","Jasmin","Jason","Jasper","Jaunita","Javier","Javon","Javonte","Jay","Jayce","Jaycee","Jayda","Jayde","Jayden","Jaydon","Jaylan","Jaylen","Jaylin","Jaylon","Jayme","Jayne","Jayson","Jazlyn","Jazmin","Jazmyn","Jazmyne","Jean","Jeanette","Jeanie","Jeanne","Jed","Jedediah","Jedidiah","Jeff","Jefferey","Jeffery","Jeffrey","Jeffry","Jena","Jenifer","Jennie","Jennifer","Jennings","Jennyfer","Jensen","Jerad","Jerald","Jeramie","Jeramy","Jerel","Jeremie","Jeremy","Jermain","Jermaine","Jermey","Jerod","Jerome","Jeromy","Jerrell","Jerrod","Jerrold","Jerry","Jess","Jesse","Jessica","Jessie","Jessika","Jessy","Jessyca","Jesus","Jett","Jettie","Jevon","Jewel","Jewell","Jillian","Jimmie","Jimmy","Jo","Joan","Joana","Joanie","Joanne","Joannie","Joanny","Joany","Joaquin","Jocelyn","Jodie","Jody","Joe","Joel","Joelle","Joesph","Joey","Johan","Johann","Johanna","Johathan","John","Johnathan","Johnathon","Johnnie","Johnny","Johnpaul","Johnson","Jolie","Jon","Jonas","Jonatan","Jonathan","Jonathon","Jordan","Jordane","Jordi","Jordon","Jordy","Jordyn","Jorge","Jose","Josefa","Josefina","Joseph","Josephine","Josh","Joshua","Joshuah","Josiah","Josiane","Josianne","Josie","Josue","Jovan","Jovani","Jovanny","Jovany","Joy","Joyce","Juana","Juanita","Judah","Judd","Jude","Judge","Judson","Judy","Jules","Julia","Julian","Juliana","Julianne","Julie","Julien","Juliet","Julio","Julius","June","Junior","Junius","Justen","Justice","Justina","Justine","Juston","Justus","Justyn","Juvenal","Juwan","Kacey","Kaci","Kacie","Kade","Kaden","Kadin","Kaela","Kaelyn","Kaia","Kailee","Kailey","Kailyn","Kaitlin","Kaitlyn","Kale","Kaleb","Kaleigh","Kaley","Kali","Kallie","Kameron","Kamille","Kamren","Kamron","Kamryn","Kane","Kara","Kareem","Karelle","Karen","Kari","Kariane","Karianne","Karina","Karine","Karl","Karlee","Karley","Karli","Karlie","Karolann","Karson","Kasandra","Kasey","Kassandra","Katarina","Katelin","Katelyn","Katelynn","Katharina","Katherine","Katheryn","Kathleen","Kathlyn","Kathryn","Kathryne","Katlyn","Katlynn","Katrina","Katrine","Kattie","Kavon","Kay","Kaya","Kaycee","Kayden","Kayla","Kaylah","Kaylee","Kayleigh","Kayley","Kayli","Kaylie","Kaylin","Keagan","Keanu","Keara","Keaton","Keegan","Keeley","Keely","Keenan","Keira","Keith","Kellen","Kelley","Kelli","Kellie","Kelly","Kelsi","Kelsie","Kelton","Kelvin","Ken","Kendall","Kendra","Kendrick","Kenna","Kennedi","Kennedy","Kenneth","Kennith","Kenny","Kenton","Kenya","Kenyatta","Kenyon","Keon","Keshaun","Keshawn","Keven","Kevin","Kevon","Keyon","Keyshawn","Khalid","Khalil","Kian","Kiana","Kianna","Kiara","Kiarra","Kiel","Kiera","Kieran","Kiley","Kim","Kimberly","King","Kip","Kira","Kirk","Kirsten","Kirstin","Kitty","Kobe","Koby","Kody","Kolby","Kole","Korbin","Korey","Kory","Kraig","Kris","Krista","Kristian","Kristin","Kristina","Kristofer","Kristoffer","Kristopher","Kristy","Krystal","Krystel","Krystina","Kurt","Kurtis","Kyla","Kyle","Kylee","Kyleigh","Kyler","Kylie","Kyra","Lacey","Lacy","Ladarius","Lafayette","Laila","Laisha","Lamar","Lambert","Lamont","Lance","Landen","Lane","Laney","Larissa","Laron","Larry","Larue","Laura","Laurel","Lauren","Laurence","Lauretta","Lauriane","Laurianne","Laurie","Laurine","Laury","Lauryn","Lavada","Lavern","Laverna","Laverne","Lavina","Lavinia","Lavon","Lavonne","Lawrence","Lawson","Layla","Layne","Lazaro","Lea","Leann","Leanna","Leanne","Leatha","Leda","Lee","Leif","Leila","Leilani","Lela","Lelah","Leland","Lelia","Lempi","Lemuel","Lenna","Lennie","Lenny","Lenora","Lenore","Leo","Leola","Leon","Leonard","Leonardo","Leone","Leonel","Leonie","Leonor","Leonora","Leopold","Leopoldo","Leora","Lera","Lesley","Leslie","Lesly","Lessie","Lester","Leta","Letha","Letitia","Levi","Lew","Lewis","Lexi","Lexie","Lexus","Lia","Liam","Liana","Libbie","Libby","Lila","Lilian","Liliana","Liliane","Lilla","Lillian","Lilliana","Lillie","Lilly","Lily","Lilyan","Lina","Lincoln","Linda","Lindsay","Lindsey","Linnea","Linnie","Linwood","Lionel","Lisa","Lisandro","Lisette","Litzy","Liza","Lizeth","Lizzie","Llewellyn","Lloyd","Logan","Lois","Lola","Lolita","Loma","Lon","London","Lonie","Lonnie","Lonny","Lonzo","Lora","Loraine","Loren","Lorena","Lorenz","Lorenza","Lorenzo","Lori","Lorine","Lorna","Lottie","Lou","Louie","Louisa","Lourdes","Louvenia","Lowell","Loy","Loyal","Loyce","Lucas","Luciano","Lucie","Lucienne","Lucile","Lucinda","Lucio","Lucious","Lucius","Lucy","Ludie","Ludwig","Lue","Luella","Luigi","Luis","Luisa","Lukas","Lula","Lulu","Luna","Lupe","Lura","Lurline","Luther","Luz","Lyda","Lydia","Lyla","Lynn","Lyric","Lysanne","Mabel","Mabelle","Mable","Mac","Macey","Maci","Macie","Mack","Mackenzie","Macy","Madaline","Madalyn","Maddison","Madeline","Madelyn","Madelynn","Madge","Madie","Madilyn","Madisen","Madison","Madisyn","Madonna","Madyson","Mae","Maegan","Maeve","Mafalda","Magali","Magdalen","Magdalena","Maggie","Magnolia","Magnus","Maia","Maida","Maiya","Major","Makayla","Makenna","Makenzie","Malachi","Malcolm","Malika","Malinda","Mallie","Mallory","Malvina","Mandy","Manley","Manuel","Manuela","Mara","Marc","Marcel","Marcelina","Marcelino","Marcella","Marcelle","Marcellus","Marcelo","Marcia","Marco","Marcos","Marcus","Margaret","Margarete","Margarett","Margaretta","Margarette","Margarita","Marge","Margie","Margot","Margret","Marguerite","Maria","Mariah","Mariam","Marian","Mariana","Mariane","Marianna","Marianne","Mariano","Maribel","Marie","Mariela","Marielle","Marietta","Marilie","Marilou","Marilyne","Marina","Mario","Marion","Marisa","Marisol","Maritza","Marjolaine","Marjorie","Marjory","Mark","Markus","Marlee","Marlen","Marlene","Marley","Marlin","Marlon","Marques","Marquis","Marquise","Marshall","Marta","Martin","Martina","Martine","Marty","Marvin","Mary","Maryam","Maryjane","Maryse","Mason","Mateo","Mathew","Mathias","Mathilde","Matilda","Matilde","Matt","Matteo","Mattie","Maud","Maude","Maudie","Maureen","Maurice","Mauricio","Maurine","Maverick","Mavis","Max","Maxie","Maxime","Maximilian","Maximillia","Maximillian","Maximo","Maximus","Maxine","Maxwell","May","Maya","Maybell","Maybelle","Maye","Maymie","Maynard","Mayra","Mazie","Mckayla","Mckenna","Mckenzie","Meagan","Meaghan","Meda","Megane","Meggie","Meghan","Mekhi","Melany","Melba","Melisa","Melissa","Mellie","Melody","Melvin","Melvina","Melyna","Melyssa","Mercedes","Meredith","Merl","Merle","Merlin","Merritt","Mertie","Mervin","Meta","Mia","Micaela","Micah","Michael","Michaela","Michale","Micheal","Michel","Michele","Michelle","Miguel","Mikayla","Mike","Mikel","Milan","Miles","Milford","Miller","Millie","Milo","Milton","Mina","Minerva","Minnie","Miracle","Mireille","Mireya","Misael","Missouri","Misty","Mitchel","Mitchell","Mittie","Modesta","Modesto","Mohamed","Mohammad","Mohammed","Moises","Mollie","Molly","Mona","Monica","Monique","Monroe","Monserrat","Monserrate","Montana","Monte","Monty","Morgan","Moriah","Morris","Mortimer","Morton","Mose","Moses","Moshe","Mossie","Mozell","Mozelle","Muhammad","Muriel","Murl","Murphy","Murray","Mustafa","Mya","Myah","Mylene","Myles","Myra","Myriam","Myrl","Myrna","Myron","Myrtice","Myrtie","Myrtis","Myrtle","Nadia","Nakia","Name","Nannie","Naomi","Naomie","Napoleon","Narciso","Nash","Nasir","Nat","Natalia","Natalie","Natasha","Nathan","Nathanael","Nathanial","Nathaniel","Nathen","Nayeli","Neal","Ned","Nedra","Neha","Neil","Nelda","Nella","Nelle","Nellie","Nels","Nelson","Neoma","Nestor","Nettie","Neva","Newell","Newton","Nia","Nicholas","Nicholaus","Nichole","Nick","Nicklaus","Nickolas","Nico","Nicola","Nicolas","Nicole","Nicolette","Nigel","Nikita","Nikki","Nikko","Niko","Nikolas","Nils","Nina","Noah","Noble","Noe","Noel","Noelia","Noemi","Noemie","Noemy","Nola","Nolan","Nona","Nora","Norbert","Norberto","Norene","Norma","Norris","Norval","Norwood","Nova","Novella","Nya","Nyah","Nyasia","Obie","Oceane","Ocie","Octavia","Oda","Odell","Odessa","Odie","Ofelia","Okey","Ola","Olaf","Ole","Olen","Oleta","Olga","Olin","Oliver","Ollie","Oma","Omari","Omer","Ona","Onie","Opal","Ophelia","Ora","Oral","Oran","Oren","Orie","Orin","Orion","Orland","Orlando","Orlo","Orpha","Orrin","Orval","Orville","Osbaldo","Osborne","Oscar","Osvaldo","Oswald","Oswaldo","Otha","Otho","Otilia","Otis","Ottilie","Ottis","Otto","Ova","Owen","Ozella","Pablo","Paige","Palma","Pamela","Pansy","Paolo","Paris","Parker","Pascale","Pasquale","Pat","Patience","Patricia","Patrick","Patsy","Pattie","Paul","Paula","Pauline","Paxton","Payton","Pearl","Pearlie","Pearline","Pedro","Peggie","Penelope","Percival","Percy","Perry","Pete","Peter","Petra","Peyton","Philip","Phoebe","Phyllis","Pierce","Pierre","Pietro","Pink","Pinkie","Piper","Polly","Porter","Precious","Presley","Preston","Price","Prince","Princess","Priscilla","Providenci","Prudence","Queen","Queenie","Quentin","Quincy","Quinn","Quinten","Quinton","Rachael","Rachel","Rachelle","Rae","Raegan","Rafael","Rafaela","Raheem","Rahsaan","Rahul","Raina","Raleigh","Ralph","Ramiro","Ramon","Ramona","Randal","Randall","Randi","Randy","Ransom","Raoul","Raphael","Raphaelle","Raquel","Rashad","Rashawn","Rasheed","Raul","Raven","Ray","Raymond","Raymundo","Reagan","Reanna","Reba","Rebeca","Rebecca","Rebeka","Rebekah","Reece","Reed","Reese","Regan","Reggie","Reginald","Reid","Reilly","Reina","Reinhold","Remington","Rene","Renee","Ressie","Reta","Retha","Retta","Reuben","Reva","Rex","Rey","Reyes","Reymundo","Reyna","Reynold","Rhea","Rhett","Rhianna","Rhiannon","Rhoda","Ricardo","Richard","Richie","Richmond","Rick","Rickey","Rickie","Ricky","Rico","Rigoberto","Riley","Rita","River","Robb","Robbie","Robert","Roberta","Roberto","Robin","Robyn","Rocio","Rocky","Rod","Roderick","Rodger","Rodolfo","Rodrick","Rodrigo","Roel","Rogelio","Roger","Rogers","Rolando","Rollin","Roma","Romaine","Roman","Ron","Ronaldo","Ronny","Roosevelt","Rory","Rosa","Rosalee","Rosalia","Rosalind","Rosalinda","Rosalyn","Rosamond","Rosanna","Rosario","Roscoe","Rose","Rosella","Roselyn","Rosemarie","Rosemary","Rosendo","Rosetta","Rosie","Rosina","Roslyn","Ross","Rossie","Rowan","Rowena","Rowland","Roxane","Roxanne","Roy","Royal","Royce","Rozella","Ruben","Rubie","Ruby","Rubye","Rudolph","Rudy","Rupert","Russ","Russel","Russell","Rusty","Ruth","Ruthe","Ruthie","Ryan","Ryann","Ryder","Rylan","Rylee","Ryleigh","Ryley","Sabina","Sabrina","Sabryna","Sadie","Sadye","Sage","Saige","Sallie","Sally","Salma","Salvador","Salvatore","Sam","Samanta","Samantha","Samara","Samir","Sammie","Sammy","Samson","Sandra","Sandrine","Sandy","Sanford","Santa","Santiago","Santina","Santino","Santos","Sarah","Sarai","Sarina","Sasha","Saul","Savanah","Savanna","Savannah","Savion","Scarlett","Schuyler","Scot","Scottie","Scotty","Seamus","Sean","Sebastian","Sedrick","Selena","Selina","Selmer","Serena","Serenity","Seth","Shad","Shaina","Shakira","Shana","Shane","Shanel","Shanelle","Shania","Shanie","Shaniya","Shanna","Shannon","Shanny","Shanon","Shany","Sharon","Shaun","Shawn","Shawna","Shaylee","Shayna","Shayne","Shea","Sheila","Sheldon","Shemar","Sheridan","Sherman","Sherwood","Shirley","Shyann","Shyanne","Sibyl","Sid","Sidney","Sienna","Sierra","Sigmund","Sigrid","Sigurd","Silas","Sim","Simeon","Simone","Sincere","Sister","Skye","Skyla","Skylar","Sofia","Soledad","Solon","Sonia","Sonny","Sonya","Sophia","Sophie","Spencer","Stacey","Stacy","Stan","Stanford","Stanley","Stanton","Stefan","Stefanie","Stella","Stephan","Stephania","Stephanie","Stephany","Stephen","Stephon","Sterling","Steve","Stevie","Stewart","Stone","Stuart","Summer","Sunny","Susan","Susana","Susanna","Susie","Suzanne","Sven","Syble","Sydnee","Sydney","Sydni","Sydnie","Sylvan","Sylvester","Sylvia","Tabitha","Tad","Talia","Talon","Tamara","Tamia","Tania","Tanner","Tanya","Tara","Taryn","Tate","Tatum","Tatyana","Taurean","Tavares","Taya","Taylor","Teagan","Ted","Telly","Terence","Teresa","Terrance","Terrell","Terrence","Terrill","Terry","Tess","Tessie","Tevin","Thad","Thaddeus","Thalia","Thea","Thelma","Theo","Theodora","Theodore","Theresa","Therese","Theresia","Theron","Thomas","Thora","Thurman","Tia","Tiana","Tianna","Tiara","Tierra","Tiffany","Tillman","Timmothy","Timmy","Timothy","Tina","Tito","Titus","Tobin","Toby","Tod","Tom","Tomas","Tomasa","Tommie","Toney","Toni","Tony","Torey","Torrance","Torrey","Toy","Trace","Tracey","Tracy","Travis","Travon","Tre","Tremaine","Tremayne","Trent","Trenton","Tressa","Tressie","Treva","Trever","Trevion","Trevor","Trey","Trinity","Trisha","Tristian","Tristin","Triston","Troy","Trudie","Trycia","Trystan","Turner","Twila","Tyler","Tyra","Tyree","Tyreek","Tyrel","Tyrell","Tyrese","Tyrique","Tyshawn","Tyson","Ubaldo","Ulices","Ulises","Una","Unique","Urban","Uriah","Uriel","Ursula","Vada","Valentin","Valentina","Valentine","Valerie","Vallie","Van","Vance","Vanessa","Vaughn","Veda","Velda","Vella","Velma","Velva","Vena","Verda","Verdie","Vergie","Verla","Verlie","Vern","Verna","Verner","Vernice","Vernie","Vernon","Verona","Veronica","Vesta","Vicenta","Vicente","Vickie","Vicky","Victor","Victoria","Vida","Vidal","Vilma","Vince","Vincent","Vincenza","Vincenzo","Vinnie","Viola","Violet","Violette","Virgie","Virgil","Virginia","Virginie","Vita","Vito","Viva","Vivian","Viviane","Vivianne","Vivien","Vivienne","Vladimir","Wade","Waino","Waldo","Walker","Wallace","Walter","Walton","Wanda","Ward","Warren","Watson","Wava","Waylon","Wayne","Webster","Weldon","Wellington","Wendell","Wendy","Werner","Westley","Weston","Whitney","Wilber","Wilbert","Wilburn","Wiley","Wilford","Wilfred","Wilfredo","Wilfrid","Wilhelm","Wilhelmine","Will","Willa","Willard","William","Willie","Willis","Willow","Willy","Wilma","Wilmer","Wilson","Wilton","Winfield","Winifred","Winnifred","Winona","Winston","Woodrow","Wyatt","Wyman","Xander","Xavier","Xzavier","Yadira","Yasmeen","Yasmin","Yasmine","Yazmin","Yesenia","Yessenia","Yolanda","Yoshiko","Yvette","Yvonne","Zachariah","Zachary","Zachery","Zack","Zackary","Zackery","Zakary","Zander","Zane","Zaria","Zechariah","Zelda","Zella","Zelma","Zena","Zetta","Zion","Zita","Zoe","Zoey","Zoie","Zoila","Zola","Zora","Zula"];e.exports={generateUsername:r}},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(1),o=n(3),a=n.n(o),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0).getLogger(e),u={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationLog:"applicationLog"},l={fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricStats:"fabricStats",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",activeDeviceList:"activeDeviceList"},d="jitsi",p={ERROR:"error",EVENT:"event",MST_WITH_USERID:"mstWithUserID"},h=void 0,f=function(){function e(t,n){r(this,e),this.confID=n.confID,this.tpc=t,this.peerconnection=t.peerconnection,this.remoteUserID=n.remoteUserID||d,this.hasFabric=!1,e.fabrics.add(this),e.initialized&&this._addNewFabric()}return s(e,null,[{key:"_addNewFabricCallback",value:function(t,n){e.backend&&"success"!==t&&c.error("Monitoring status: "+t+" msg: "+n)}},{key:"_initCallback",value:function(t,n){if(c.log("CallStats Status: err="+t+" msg="+n),"success"===t){var r=!1,i=null,o=!0,a=!1,s=void 0;try{for(var u,l=e.fabrics.values()[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var d=u.value;d.hasFabric||(c.debug("addNewFabric - initCallback"),d._addNewFabric()&&(r=!0,i||(i=d)))}}catch(e){a=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}if(r){e.initialized=!0;var h=i.confID,f=i.peerconnection,m=!0,v=!1,g=void 0;try{for(var y,b=e.reportsQueue[Symbol.iterator]();!(m=(y=b.next()).done);m=!0){var _=y.value;if(_.type===p.ERROR){var S=_.data;e._reportError(i,S.type,S.error,S.pc||f)}else if(_.type===p.EVENT){var T=_.data;e.backend.sendFabricEvent(_.pc||f,T.event,h,T.eventData)}else if(_.type===p.MST_WITH_USERID){var C=_.data;e.backend.associateMstWithUserID(_.pc||f,C.callStatsId,h,C.ssrc,C.usageLabel,C.containerId)}}}catch(e){v=!0,g=e}finally{try{!m&&b.return&&b.return()}finally{if(v)throw g}}e.reportsQueue.length=0}}}},{key:"_reportError",value:function(t,n,r,i){var o=r;o||(c.warn("No error is passed!"),o=new Error("Unknown error")),e.initialized&&t?e.backend.reportError(i,t.confID,n,o):e.reportsQueue.push({type:p.ERROR,data:{error:o,pc:i,type:n}})}},{key:"_reportEvent",value:function(t,n,r){var i=t&&t.peerconnection,o=t&&t.confID;e.initialized&&t?e.backend.sendFabricEvent(i,n,o,r):e.reportsQueue.push({confID:o,pc:i,type:p.EVENT,data:{event:n,eventData:r}})}},{key:"_traceAndCatchBackendCalls",value:function(e){var t=["associateMstWithUserID","sendFabricEvent","sendUserFeedback"],n=!0,r=!1,o=void 0;try{for(var s,l=t[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var d=s.value;!function(t){var n=e[t];e[t]=function(){try{for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return n.apply(e,r)}catch(e){a.a.callErrorHandler(e)}}}(d)}}catch(e){r=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw o}}var p=["associateMstWithUserID","sendFabricEvent","sendUserFeedback"],h=!0,f=!1,m=void 0;try{for(var v,g=p[Symbol.iterator]();!(h=(v=g.next()).done);h=!0){var d=v.value;!function(t){var n=e[t];e[t]=function(){for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];c.debug(t,i),n.apply(e,i)}}(d)}}catch(e){f=!0,m=e}finally{try{!h&&g.return&&g.return()}finally{if(f)throw m}}var y=e.reportError;e.reportError=function(t,n,r){for(var o=arguments.length,s=Array(o>3?o-3:0),l=3;l<o;l++)s[l-3]=arguments[l];r===u.applicationLog?i.a.isReactNative()||console&&console.debug("reportError",t,n,r):c.debug.apply(c,["reportError",t,n,r].concat(s));try{y.call.apply(y,[e,t,n,r].concat(s))}catch(e){r===u.applicationLog?console&&console.error("reportError",e):a.a.callErrorHandler(e)}}}},{key:"initBackend",value:function(t){if(e.backend)throw new Error("CallStats backend has been initialized already!");try{var r=i.a.isReactNative()?n(69):callstats;e.backend=new r,e._traceAndCatchBackendCalls(e.backend),e.userID={aliasName:t.aliasName,userName:t.userName},e.callStatsID=t.callStatsID,e.callStatsSecret=t.callStatsSecret;var o=void 0;return t.applicationName&&(o={applicationVersion:t.applicationName+" ("+i.a.getBrowserName()+")"}),e.backend.initialize(e.callStatsID,e.callStatsSecret,e.userID,e._initCallback,void 0,o),!0}catch(t){return a.a.callErrorHandler(t),e.backend=null,c.error(t),!1}}},{key:"isBackendInitialized",value:function(){return Boolean(e.backend)}},{key:"sendActiveDeviceListEvent",value:function(t,n){e._reportEvent(n,l.activeDeviceList,t)}},{key:"sendApplicationLog",value:function(t,n){try{e._reportError(n,u.applicationLog,t,n&&n.peerconnection)}catch(e){console&&"function"==typeof console.error&&console.error("sendApplicationLog failed",e)}}},{key:"sendFeedback",value:function(t,n,r){e.backend?e.backend.sendUserFeedback(t,{userID:e.userID,overall:n,comment:r}):c.error("Failed to submit feedback to CallStats - no backend")}},{key:"sendGetUserMediaFailed",value:function(t,n){e._reportError(n,u.getUserMedia,t,null)}},{key:"sendMuteEvent",value:function(t,n,r){var i=void 0;i="video"===n?t?l.videoPause:l.videoResume:t?l.audioMute:l.audioUnmute,e._reportEvent(r,i)}},{key:"fabrics",get:function(){return h||(h=new Set),h}}]),s(e,[{key:"_addNewFabric",value:function(){c.info("addNewFabric",this.remoteUserID);try{var t={remoteEndpointType:this.tpc.isP2P?e.backend.endpointType.peer:e.backend.endpointType.server},n=e.backend.addNewFabric(this.peerconnection,this.remoteUserID,e.backend.fabricUsage.multiplex,this.confID,t,e._addNewFabricCallback);this.hasFabric=!0;var r="success"===n.status;return r||c.error("callstats fabric not initilized",n.message),r}catch(e){return a.a.callErrorHandler(e),!1}}},{key:"associateStreamWithVideoTag",value:function(t,n,r,i,o){if(e.backend){var a=n?e.userID:r;e.initialized?e.backend.associateMstWithUserID(this.peerconnection,a,this.confID,t,i,o):e.reportsQueue.push({type:p.MST_WITH_USERID,pc:this.peerconnection,data:{callStatsId:a,containerId:o,ssrc:t,usageLabel:i}})}}},{key:"sendDominantSpeakerEvent",value:function(){e._reportEvent(this,l.dominantSpeaker)}},{key:"sendTerminateEvent",value:function(){e.initialized&&e.backend.sendFabricEvent(this.peerconnection,e.backend.fabricEvent.fabricTerminated,this.confID),e.fabrics.delete(this)}},{key:"sendIceConnectionFailedEvent",value:function(){e._reportError(this,u.iceConnectionFailure,null,this.peerconnection)}},{key:"sendCreateOfferFailed",value:function(t){e._reportError(this,u.createOffer,t,this.peerconnection)}},{key:"sendCreateAnswerFailed",value:function(t){e._reportError(this,u.createAnswer,t,this.peerconnection)}},{key:"sendResumeOrHoldEvent",value:function(t){e._reportEvent(this,t?l.fabricResume:l.fabricHold)}},{key:"sendScreenSharingEvent",value:function(t){e._reportEvent(this,t?l.screenShareStart:l.screenShareStop)}},{key:"sendSetLocalDescFailed",value:function(t){e._reportError(this,u.setLocalDescription,t,this.peerconnection)}},{key:"sendSetRemoteDescFailed",value:function(t){e._reportError(this,u.setRemoteDescription,t,this.peerconnection)}},{key:"sendAddIceCandidateFailed",value:function(t){e._reportError(this,u.addIceCandidate,t,this.peerconnection)}}]),e}();t.a=f,f.backend=null,f.reportsQueue=[],f.initialized=!1,f.callStatsID=null,f.callStatsSecret=null,f.userID=null}).call(t,"modules/statistics/CallStats.js")},function(e,t,n){"use strict";(function(r){var i,o,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function r(){function e(){var e=(Math.random()+1).toString(36);return e.substring(2,e.length)}function t(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function r(){return t()+Fe.currentOffset}function i(){return window.performance.now?window.performance.now():null}function o(){if(Le)return Le.level}function a(){if(Le)return Le.charging}function c(e,t){return e.sort().toString()===t.sort().toString()}function u(e){navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.enumerateDevices().then(function(t){ie?c(ie,t)||(ie=t,xt(e)):(ie=t,xt(e)),setTimeout(function(){u(e)},de)}).catch(function(){setTimeout(function(){u(e)},de)})}function l(){ue||window&&window.addEventListener&&window.addEventListener("beforeunload",function(e){var t;for(t in je)je.hasOwnProperty(t)&&Pt(qe.userLeft,null,t,je[t].ucID,null,null,null);return"Are you sure you want to close the call?"})}function d(e,t,n,r,o){var a=Vt(n,r),s=null;a&&(s=i(),Pt(qe.mediaPlaybackStartEvent,t,n,e,{ssrc:o,highResTs:s},a,null))}function p(e,t,n,r,o){var a=Vt(n,r),s=null;a&&(s=i(),Pt(qe.mediaSuspendedEvent,t,n,e,{ssrc:o,highResTs:s},a,null))}function h(e,t,n,r){var i,o=document.getElementById(t);o&&(o.oncanplay=function(){i=je[e].ucID;var t=Jt(e,n);d(i,t.remoteUserID,e,n,r)},o.onsuspend=function(){i=je[e].ucID;var t=Jt(e,n);p(i,t.remoteUserID,e,n,r)})}function f(e){var t=ve.codebase,n=!1;if(null===e)n=!1;else if(t===ht.firefox){var r="undefined"==typeof mozRTCPeerConnection?"undefined":s(mozRTCPeerConnection),i="undefined"==typeof RTCPeerConnection?"undefined":s(RTCPeerConnection);"undefined"!==r&&e instanceof mozRTCPeerConnection?n=!0:"undefined"!==i&&e instanceof RTCPeerConnection&&(n=!0)}else null!==Ve&&e instanceof Ve&&(n=!0),"function"!=typeof e&&t!==ht.edge||(n=!0),void 0!==s(e.createOffer)&&(n=!0);return n}function m(e,t){var n;return e&&(t===ht.chrome?e.googLocalAddress?(n=e.googLocalAddress,n.concat(":",e.googRemoteAddress)):e.selectedCandidatePairId&&(n=e.selectedCandidatePairId):t===ht.firefox&&(e.localAddr?(n=e.localAddr,n.concat(":",e.remoteAddr)):e.selectedCandidatePairId&&(n=e.selectedCandidatePairId))),Mt(n)}function v(){return!0===navigator.onLine?"online":"offline"}function g(e,t,n){var r=null;n.ssrcMap.hasOwnProperty(e.data.ssrc)&&(n.ssrcMap[e.data.ssrc].mediaType=e.data.mediaType,e.data.googCodecName?r=e.data.googCodecName:e.data.codec&&(r=e.data.codec),n.ssrcMap[e.data.ssrc].codec=r,e.data.codecImplementationName&&(n.ssrcMap[e.data.ssrc].codecImplementationName=e.data.codecImplementationName))}function y(e,t,n){var r,i,o,a,s,c,u,l,d=[];if(void 0!==e.lastStatsSent&&void 0!==e.lastStatsSent.statistics.Transport)for(o=e.lastStatsSent.statistics.Transport,a=e.latestEventSent,s=void 0,r=0;r<t.length;r++){for(s=void 0,i=0;i<o.length;i++)if(t[r].hash===o[i].hash){s=o[i];break}void 0!==s&&(c=parseInt(s.bytesReceived,10),u=parseInt(s.bytesSent,10),l=n-a,l>0&&(t[r].csioReceivedBwKbps=8*(parseInt(t[r].bytesReceived,10)-c)/l,t[r].csioSentBwKbps=8*(parseInt(t[r].bytesSent,10)-u)/l,t[r].csioIntBytesReceived=parseInt(t[r].bytesReceived,10)-c,t[r].csioIntBytesSent=parseInt(t[r].bytesSent,10)-u,void 0!==s.packetsSent&&void 0!==t[r].packetsSent&&(t[r].csioSentPacketRate=(parseInt(t[r].packetsSent,10)-parseInt(s.packetsSent,10))/(l/1e3),t[r].csioIntPacketsSent=parseInt(t[r].packetsSent,10)-parseInt(s.packetsSent,10)),void 0!==s.packetsReceived&&void 0!==t[r].packetsReceived&&(t[r].csioReceivedPacketRate=(parseInt(t[r].packetsReceived,10)-parseInt(s.packetsReceived,10))/(l/1e3),t[r].csioIntPacketsReceived=parseInt(t[r].packetsReceived,10)-parseInt(s.packetsReceived,10))),d.push(t[r]))}return d}function b(e,t,n,r){var i=[];return n===ht.firefox?i=t:t&&(i=y(e,t,r)),i}function _(e){var t,n,r;for(t in e.streams)if(e.streams.hasOwnProperty(t)){if(e.streams[t].inbound)for(r in e.streams[t].inbound)e.streams[t].inbound.hasOwnProperty(r)&&(n=e.streams[t].inbound[r].mark,n===it.bad?e.streams[t].inbound[r].mark=2:n===it.fair?e.streams[t].inbound[r].mark=1:e.streams[t].inbound[r].mark=0);if(e.streams[t].outbound)for(r in e.streams[t].outbound)e.streams[t].outbound.hasOwnProperty(r)&&(n=e.streams[t].outbound[r].mark,n===it.bad?e.streams[t].outbound[r].mark=2:n===it.fair?e.streams[t].outbound[r].mark=1:e.streams[t].outbound[r].mark=0)}return e}function S(e){var t={},n=Kn.getConferenceURL();return e.connectionState&&(t.connectionState=e.connectionState),e.fabricState&&(t.fabricState=e.fabricState),n&&(t.conferenceURL=n),t.streams={},null===e.streams?t:(e.streams.forEach(function(e){var n={cname:e.cname,ssrc:e.ssrc,msid:e.msid,remoteUserID:e.userID,usageLabel:e.usage,associatedVideoTag:e.associatedVideoTag};e.data.hasOwnProperty("csioIntFL")&&(n.fractionLoss=e.data.csioIntFL),e.data.hasOwnProperty("csioIntBRKbps")&&(n.bitrate=e.data.csioIntBRKbps),e.data.hasOwnProperty("csioMark")&&(n.quality=e.data.csioMark),e.data.hasOwnProperty("csioMediaType")&&(n.mediaType=e.data.csioMediaType),e.data.hasOwnProperty("googRtt")&&(n.rtt=e.data.googRtt),e.data.hasOwnProperty("mozRtt")&&(n.rtt=e.data.mozRtt),e.data.hasOwnProperty("roundTripTime")&&(n.rtt=e.data.roundTripTime),e.data.hasOwnProperty("jitter")&&(n.jitter=e.data.jitter),e.data.hasOwnProperty("googJitterReceived")&&(n.jitter=e.data.googJitterReceived),e.data.hasOwnProperty("audioOutputLevel")&&(n.audioOutputLevel=e.data.audioOutputLevel),e.data.hasOwnProperty("audioInputLevel")&&(n.audioInputLevel=e.data.audioInputLevel),e.data.hasOwnProperty("audioLevel")&&(n.audioLevel=e.data.audioLevel),e.data.hasOwnProperty("csioAvgRtt")&&(n.averageRTT=e.data.csioAvgRtt),e.data.hasOwnProperty("csioAvgJitter")&&(n.averageJitter=e.data.csioAvgJitter),e.data.hasOwnProperty("csioPktLossPercentage")&&(n.packetLossPercentage=e.data.csioPktLossPercentage),e.reportType&&"local"===e.reportType?e.streamType&&(n.statsType=e.streamType+"-rtp"):e.reportType&&"remote"===e.reportType&&e.streamType&&(n.statsType="remote-"+e.streamType+"-rtp"),t.streams[e.ssrc]=n}),t)}function T(e,t,n,i,o,a){var s=r();e.hasOwnProperty("token")&&e.hasOwnProperty("ucID")&&!Ue?(G(Ke.processedStats,e,a),t.latestEventSent=s,t.lastFabricState=t.pcState):(e.clockUnsynced=Ue,Re.cacheEvent({channel:Ke.processedStats,data:e}))}function C(e,t){for(var n in t)t.hasOwnProperty(n)&&"id"!==n&&"type"!==n&&"timestamp"!==n&&(e[n]=t[n]);return e}function E(e,n,i,s,c){function u(u){if(u){var l=r(),d=t();void 0===s.lastRawStatsSentInterval||null===s.lastRawStatsSentInterval?s.lastRawStatsSentInterval=d-s.statsPollingStart:s.lastRawStatsSentInterval=d-s.rawstatsTS+s.lastRawStatsSentInterval,void 0===s.lastProcessedStatsSentInterval||null===s.lastProcessedStatsSentInterval?s.lastProcessedStatsSentInterval=_e+1:s.lastProcessedStatsSentInterval=d-s.rawstatsTS+s.lastProcessedStatsSentInterval,s.rawstatsTS=d;var p={},h=ve.codebase,f=s.conferenceID,y=s.remoteUserID;p.version=Z,p.appID=oe,p.conferenceID=encodeURIComponent(f),p.apiTS=l,p.timeShift=0,p.fabricState=s.pcState,p.pcID=s.pcHash,void 0!==i&&(p.ucID=i),De.authToken&&(p.token=De.authToken),p.localID=encodeURIComponent(n),p.remoteID=y?encodeURIComponent(y):null,p.deviceID=ce;var C,E,w,k,O,D,N,L={streams:[]},M=null,j=!1,F=!1,U={},H={};for(M=Kt(u),C=0;C<M.length;++C)if(E=P(M[C]),w=R(E),!A(w))if(w.hasOwnProperty("Transport"))k="Transport",L.hasOwnProperty(k)||(L[k]=[]),h!==ht.firefox?(parseInt(w[k].bytesReceived,10)>0||parseInt(w[k].bytesSent,10)>0)&&(L[k].push(w[k]),"true"!==w[k].googActiveConnection&&!0!==w[k].googActiveConnection||(p.activeConnectionIndex=L[k].length)):(L[k].push(w[k]),"true"!==w[k].selected&&!0!==w[k].selected||(p.activeConnectionIndex=L[k].length));else if(w.localCandidate)U[w.localCandidate.id]=w.localCandidate;else if(w.remoteCandidate)H[w.remoteCandidate.id]=w.remoteCandidate;else if(w.bwe)L.bwe=w.bwe;else if(w.trackStats)L.trackStats||(L.trackStats=[]),L.trackStats.push(w.trackStats);else if(w.codec)L.codec||(L.codec=[]),L.codec.push(w.codec);else if(w.candidatePair)L.candidatePair||(L.candidatePair=[]),L.candidatePair.push(w.candidatePair);else{D=Rt(s,w.ssrc),void 0!==D&&D.localStartTime||(N=It(y,f,i,s,c,null),N&&(F=!0),D=Rt(s,w.ssrc)),D&&(O=D.remoteUserID),void 0===O&&(O=y);var B={userID:O,data:w.data,reportType:w.reportType,streamType:w.streamType,ssrc:w.ssrc};void 0!==D&&(B.cname=D.cname,B.msid=D.msid,B.associatedVideoTag=D.associatedVideoTag,B.usage=D.usageLabel),L.streams.push(B)}if(p.statistics=L,L.Transport&&(j=I(L.Transport,s)),j&&Ln(c,qe.fabricTransportSwitch,f),L.Transport||h!==ht.firefox||(L.Transport=L.candidatePair.filter(function(e){return!(!e.selected&&"true"!==e.selected)})),L.Transport)for(var G=0;G<L.Transport.length;G++)L.Transport[G].hash=m(L.Transport[G],h);s.pcState===ot.disrupted&&x(p),L.trackStats&&(L=Hn(L)),L.Transport&&L.candidatePair&&(L=Un(L)),F&&Pt(qe.ssrcMap,y,f,i,kt(s),s.pcHash);var J={},W={response:null},q={response:null};if(re.fire(re.events.OnPolling,{streams:L.streams,codeBase:h}),re.fire(re.events.OnOneWayAudioDisruptionsRequest,q),null!==q.response&&q.response.forEach(function(e){var t={disruptionType:e.type};Pt(We.audioDisruption,y,f,i,t,s.pcHash)}),re.fire(re.events.OnStatsRequest,W),null!==W.response){if(W.response.streams)for(C=0;C<W.response.streams.length;C++)g(W.response.streams[C],h,s);if(J.streams=W.response.streams,J.fabricState=s.pcState,J.connectionState=v(),L.Transport&&(J.Transport=b(s,L.Transport,h,l)),L.bwe&&(J.bwe=L.bwe),void 0===s.processedStatsTupleArray&&(s.processedStatsTupleArray=[]),be.stats){var K=S(J);be.stats(K)}J.apiTS=l,J.batteryStatus={},J.batteryStatus.batteryLevel=o(),J.batteryStatus.isBatteryCharging=a(),J=_(J),s.processedStatsTupleArray.push(J),p.processedStatistics=s.processedStatsTupleArray,s.lastStatsSent=p;var z=V(p),$=V(p);delete z.processedStatistics,delete $.statistics,s.lastProcessedStatsSentInterval>=_e&&(s.processedStatsTupleArray=[],Pe.add($,$.processedStatistics.length),$.msgStat=Pe.getStat(),T($,s,f,y,n,e),s.lastProcessedStatsSentInterval=0)}}}return u}function w(e){var t;return at.hasOwnProperty(e)?e===at.createOffer||e===at.createAnswer||e===at.setRemoteDescription?t=st.negotiationFailure:e===at.setLocalDescription?t=st.sdpError:e===at.addIceCandidate?t=st.sdpError:e===at.getUserMedia?t=st.mediaConfigError:e===at.iceConnectionFailure?t=st.iceFailure:e===at.signalingError?t=st.signalingError:(e===at.applicationLog||at.applicationError)&&(t=st.applicationLog):t=Tt.invalidWebRTCFunctionName,t}function R(e){var t={};if("inboundrtp"===e.type||"outboundrtp"===e.type||"inbound-rtp"===e.type||"outbound-rtp"===e.type){if(t.ssrc=e.ssrc,t.streamType="inboundrtp"===e.type||"inbound-rtp"===e.type?"inbound":"outbound","Safari"===ve.name&&!e.mediaType){e.id.includes("Audio")?e.mediaType="audio":e.id.includes("Video")&&(e.mediaType="video");var n=e.id.split("_");if(n[1])try{e.ssrc=parseInt(n[1]),t.ssrc=e.ssrc}catch(e){}}t.data=e,void 0!==e.isRemote?t.reportType="true"===e.isRemote||!0===e.isRemote?"remote":"local":t.reportType="local",e.trackId&&(t.trackId=e.trackId),e.mediaType&&(t.mediaType=e.mediaType)}else"candidatepair"===e.type&&e.selected?t.Transport=e:"localcandidate"===e.type||"local-candidate"===e.type?t.localCandidate=e:"remotecandidate"===e.type||"remote-candidate"===e.type?t.remoteCandidate=e:"transport"===e.type||"googCandidatePair"===e.type?t.Transport=e:"VideoBwe"===e.type?t.bwe=e:"track"===e.type?t.trackStats=e:"candidate-pair"===e.type?t.candidatePair=e:"codec"===e.type?t.codec=e:"ssrc"===e.type&&(t.reportType="local",e.bytesSent?t.streamType="outbound":t.streamType="inbound",t.ssrc=e.ssrc,t.data=e);return t}function k(e){var t="None";switch(e){case 0:t="TURN/TLS";break;case 1:t="TURN/TCP";break;case 2:t="TURN/UDP"}return t}function I(e,t){var n,r,i,o,a,s,c,u,l,d=!1,p="None",h=!1,f=ve.codebase,m=function(e){if(e.typePreference){var t=e.typePreference>>24;return"rtp"===e.protocol&&e.address===n&&(t>=0&&t<=2&&(p=k(t)),!0)}return!1};for(c=0;c<e.length;c++)if(u=e[c],f!==ht.firefox||"candidatepair"!==u.type||"true"!==u.selected&&!0!==u.selected?"googCandidatePair"!==u.type||"true"!==u.googActiveConnection&&!0!==u.googActiveConnection?"transport"===u.type&&(h=!0,u.selectedCandidatePairId&&(l=u.selectedCandidatePairId)):(h=!0,n=u.googLocalAddress,r=u.googRemoteAddress,i=u.googLocalCandidateType,o=u.googRemoteCandidateType,a=u.googTransportType):(h=!0,n=u.localAddr,r=u.remoteAddr,i=u.localAddrType,o=u.remoteAddrType,a=u.transportType),h){n&&(s=0===n.indexOf("[")),t.iceCandidates.some(m);break}if(!h)return d;var v=t.transportData;return void 0!==v&&v.localAddr===n&&v.remoteAddr===r&&v.transportType===a&&v.selectedCandidatePairId===l||(t.transportData={localAddr:n,remoteAddr:r,localAddrType:i,remoteAddrType:o,transportType:a,ipv6:s,relayType:p,selectedCandidatePairId:l},d=!0),d}function P(e){var t,n={};e.timestamp instanceof Date&&(n.timestamp=e.timestamp.getTime().toString()),e.type&&(n.type=e.type);var r=0;if(e.names){var i=e.names();for(r=0;r<i.length;++r)n[i[r]]=e.stat(i[r])}else for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);if(n.values){for(r=0;r<n.values.length;++r){e=n.values[r];for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t])}delete n.values}return n}function A(e){if(null===e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}function O(e){return{magicKey:e,statsSubmissionInterval:_e,endpoint:Me,localUserIDObject:se}}function D(e,t,n){void 0===je[e]&&(je[e]={},je[e].participants=null,n&&(je[e].userJoinedSent=!0),t&&(je[e].refreshPresence=t))}function x(e){var t,n=e.statistics.outbound;if(void 0!==n)for(t in n)n.hasOwnProperty(t)&&(n[t].data.mozRtt?n[t].data.mozRtt=0:n[t].data.googRtt?n[t].data.googRtt=0:n[t].data.rtt?n[t].data.rtt=0:n[t].data.roundTripTime&&(n[t].data.roundTripTime=0))}function N(e){return clearInterval(e),null}function L(){var e;for(e in je)je.hasOwnProperty(e)&&(je[e].refreshPresence=N(je[e].refreshPresence),delete je[e].refreshPresence);q()}function M(e){var t=!1;if(!e)return t;var n=je[e];return void 0!==n&&n.participants&&n.participants.length>0&&(t=!0),t}function j(e,t){var n=je[e],r=[];if(void 0===n)r.push(t),je[e]={},je[e].participants=r;else{var i=n.participants;null===i?(r.push(t),n.participants=r):i.push(t)}}function F(e){var t=!1;if(!je[e])return{conferenceFinished:t,ucID:null};var n=je[e].ucID;return 0===je[e].participants.length&&(N(je[e].refreshPresence),q(),Re.sendCachedEvents(De,Ue),delete je[e],t=!0),{conferenceFinished:t,ucID:n}}function U(e,t){Pt(qe.userLeft,null,e,t,null,null,null),q(),He=Et,Et=null}function H(){var e;for(e in je)if(je.hasOwnProperty(e)){if(e===ne)return;Nt(e),je[e].refreshPresence=function(e){return setInterval(function(){Nt(e)},Te)}(e)}K()}function B(e){try{if(window&&window.sessionStorage){var t=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));if(t&&t[e])return t[e].ucID}}catch(e){return null}return null}function G(e,t,n){var r=t.action,i=t.remoteID,o=t.ucID;t.channel=e,De._isTokenValid(De.authToken,oe,ae)?(o&&!Ue&&i||-1!==mt.indexOf(r))&&t.conferenceID!==ne?(t.token=De.authToken,zn(e,t,n),n&&r&&n(Qe.success,r+" sent to the backend.")):(t.clockUnsynced=Ue,Re.cacheEvent({channel:e,data:t,callback:n})):De.sendAuthenticationRequest(oe,ae,function(a,s){a!==Qe.success?(a===Xe.authOngoing&&(t.clockUnsynced=Ue,Re.cacheEvent({channel:e,data:t,callback:n})),n&&a!==Xe.authOngoing&&n(a,s)):a===Qe.success&&"SDK authentication successful."===s&&((o&&!Ue&&i||-1!==mt.indexOf(r))&&t.conferenceID!==ne?(t.token=De.authToken,zn(e,t,n),n&&r&&n(Qe.success,r+" sent to the backend.")):(t.clockUnsynced=Ue,Re.cacheEvent({channel:e,data:t,callback:n})))})}function J(e){e&&e(Xe.authOngoing,"Authentication Ongoing")}function V(e){if(null===e||"object"!=(void 0===e?"undefined":s(e)))return e;var t,n=new e.constructor;for(t in e)e.hasOwnProperty(t)&&(n[t]=V(e[t]));return n}function W(){var e={};Object.keys(je).forEach(function(t){var n=je[t];if(!n)return!0;var r,i,o={ucID:n.ucID,userJoinedSent:n.userJoinedSent},a=[];if(n.participants){var s,c=n.participants;for(r=0;r<c.length;r++)i={},s=c[r],i={pcID:s.pcHash,pcState:s.pcState,iceConnectionState:s.iceConnectionState,iceGatheringState:s.iceGatheringState,iceCandidatesNumber:s.iceCandidates.length,remoteUserID:s.remoteUserID},a.push(i)}o.participants=a,e[t]=o});var t={authStatus:!!De.tokenData,clockSync:!Ue,stateMachine:e,pageURL:window.location.href,eventType:"warn",version:Z};t.wsStatus=Kn.getWSConnectionState(),St(oe,ae,"stateMachine",t)}function q(){Be||(Be=setInterval(function(){W()},Ge))}function K(){N(Be),Be=null}var z=n(70),$=n(71),Q=n(78),X="https://collector.callstats.io:443/",Y="https://auth.callstats.io/",Z="3.24.6",ee="wss://collector.callstats.io:443/csiows/collectCallStats",te="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",ne="csio-conf-id-tmp",re=new $.Reporter;window&&(window.csioChromeLegacyGetStats=!0);var ie,oe=null,ae=null,se=null,ce=null,ue=!1,le=!1,de=1e4,pe=function(e,t){var n="precalltest error ("+e+"): "+t;console.warn(n),St&&St(oe,ae,"log",{msg:n})},he=n(79),fe=null;try{fe=new he.PreCallTest}catch(e){pe("initializing",e)}var me,ve,ge=[],ye={create:Date.now()},be={stats:null,defaultConfig:null,recommendedConfig:null,preCallTest:null},_e=15e3,Se=!1,Te=1e4,Ce=!1,Ee=!0,we=function(){function e(e,t){setTimeout(function(){var t=r(),n=t-e.data.apiTS;e.data.timeShift=n,G(e.channel,e.data,e.callback)},t)}this.eventCache=[],this.updateRemoteUserID=function(e,t){for(var n,r=this,i=0;i<r.eventCache.length;i++)n=r.eventCache[i],n.data.pcID===t&&(n.data.remoteID=e)},this.sendCachedEvents=function(t,n,i,o,a,s){var c=this;if(0!==c.eventCache.length){if(!t.authToken)return void t.sendAuthenticationRequest(oe,ae);if(!n){var u,l,d,p,h=r(),f=[],m=Math.max(_e/c.eventCache.length,Je);for(u=0;u<c.eventCache.length;u++)if(d=c.eventCache[u],!d.data.remoteID&&d.data.pcID||d.data.conferenceID===ne)f.push(c.eventCache[u]);else if(d.data.action!==qe.userJoined){if(d.data.token=t.authToken,i&&d.data.apiTS>=h-o||!d.data.ucID)if(p=decodeURIComponent(d.data.conferenceID),je[p]&&je[p].ucID)d.data.ucID=je[p].ucID;else{if(p!==a){f.push(c.eventCache[u]);continue}d.data.ucID=s}if(d.data.clockUnsynced&&(d.data.apiTS+=Fe.currentOffset),d.channel===Ke.processedStats&&d.data.clockUnsynced&&d.data.processedStatistics&&d.data.processedStatistics.length>0)for(l=0;l<d.data.processedStatistics.length;l++)d.data.processedStatistics[l].apiTS+=Fe.currentOffset;delete d.data.clockUnsynced,e(d,m*(u+1))}else f.push(c.eventCache[u]);c.eventCache=f}}},this.sendCachedUserJoinedEvents=function(t){var n=this;if(0!==n.eventCache.length){if(!t.authToken)return void t.sendAuthenticationRequest(oe,ae);var r,i,o=[],a=Math.max(_e/n.eventCache.length,Je);for(r=0;r<n.eventCache.length;r++)i=n.eventCache[r],!i.data.remoteID&&i.data.pcID||i.data.conferenceID===ne?o.push(n.eventCache[r]):i.data.action===qe.userJoined||i.data.action===We.fabricSetupFailed?(i.data.token=t.authToken,i.data.clockUnsynced&&(i.data.apiTS=i.data.apiTS+Fe.currentOffset),i.data.value&&(i.data.value.statsSubmissionInterval=_e),e(i,a*(r+1))):o.push(n.eventCache[r]);n.eventCache=o}},this.updateConferenceId=function(e){for(var t,n=this,r=0;r<n.eventCache.length;r++)t=n.eventCache[r],t.data.conferenceID===ne&&(t.data.conferenceID=e)},this.cacheEvent=function(e){this.eventCache.push(e)},this.sendCachedFeedback=function(){var e=gt("feedback"),t=JSON.parse(gt("csio_auth_data"));if(e&&t){var n=JSON.parse(e),r=t===n.token;r||ae!==n.userID||(n.token=t,r=!0),r?G(Ke.userFeedback,n):yt("feedback")}}},Re=new we,ke=function(){this.size_max=0,this.size_ewma=0,this.statNum_max=0,this.statNum_ewma=0,this.msg_num=0},Ie=function(){this.stat=new ke,this.add=function(e,t){var n=this.memorySizeOf(e);this.stat.size_ewma=.5*this.stat.size_ewma+.5*n,this.stat.size_max<n&&(this.stat.size_max=n),this.stat.statNum_ewma=.5*this.stat.statNum_ewma+.5*t,this.stat.statNum_max<t&&(this.stat.statNum_max=t),this.stat.msg_num+=1},this.getStat=function(){return this.stat},this.memorySizeOf=function(e){function t(e){if(null!==e&&void 0!==e)switch(void 0===e?"undefined":s(e)){case"number":n+=8;break;case"string":n+=2*e.length;break;case"boolean":n+=4;break;case"object":var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r||"Array"===r)for(var i in e)e.hasOwnProperty(i)&&t(e[i]);else n+=2*e.toString().length}return n}var n=0;return t(e)}},Pe=new Ie,Ae={appSecret:"appSecret",jwt:"jwt"},Oe=function(){var e=this,t="urn:x-callstats:auth:errorActions";this.authInProgress=!1,this.tokenData=null,this.authToken=null,this.type=Ae.appSecret,this.tokenGenerator=function(e,t){t("Token generator not set")};var n=null,i=null,o=!1,a=window.atob,s=window.btoa,c=["Authentication Internal Error","Invalid Credentials","Invalid Credentials","Invalid Credentials","Invalid Credentials","Origin URL missmatch","Invalid Credentials","Authentication Protocol Error"],u=function(e){return s(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},l=function(e){return s(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},d=function(e){return u(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},p=function(e){for(var t=a(e.replace(/[ \r\n]+$/,"")),n=[],r=0;r<t.length;++r){var i=t.charCodeAt(r).toString(16);1===i.length&&(i="0"+i),n.push(i)}return n.join("")},h={};h.cryptotype=null,window.crypto&&window.crypto.subtle?(h.cryptotype="standard",h.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(h.cryptotype="webkit",h.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(h.cryptotype="ie",h.subtlecrypto=window.msCrypto.subtle):(h.subtlecrypto=null,console.info("WebCryptography API not supported in this browser.")),h.sign=function(e,t,n,r){if("HS256"!==e.alg)return r("Use header.alg=HS256");e=JSON.stringify(e),"string"!=typeof t&&(t=JSON.stringify(t));var i=d(e)+"."+d(t);if(window.csioReactNative)return void window.csiosign(i,n,function(e,t){return e?(console.log("Token sign error",e),r(e)):r(null,t)});for(var o=new ArrayBuffer(i.length),a=new Uint8Array(o),s=i.length-1;s>=0;s--)a[s]=i.charCodeAt(s);var c=function(e){for(var t="",n=new Uint8Array(e),o=n.byteLength,a=0;a<o;a++)t+=String.fromCharCode(n[a]);return i+="."+l(t),r(null,i)},u=function(e){return r(e)},p={name:"HMAC"};"ie"!==h.cryptotype&&"webkit"!==h.cryptotype||(p.hash={name:"sha-256"});var f=h.subtlecrypto.sign(p,n,a);"ie"===h.cryptotype?(f.onerror=u,f.oncomplete=function(e){c(e.target.result)}):f.then(c).catch(u)},h.decode=function(e){try{return JSON.parse(a(e.split(".")[1]))}catch(e){return console.error("Couldn't decode token. ",e),null}},h.importKey=function(e,t,n){if(window.csioReactNative)return void t(e);if("webkit"===h.cryptotype)for(;e.length<32;)e+="\0";var r={kty:"oct",k:l(e),alg:"HS256"},i={name:"HMAC",hash:{name:"SHA-256"}};if("ie"===h.cryptotype?r.extractable=!1:r.ext=!1,"webkit"===h.cryptotype&&(i=null,r.use="sig"),"ie"===h.cryptotype||"webkit"===h.cryptotype){var o=JSON.stringify(r);r=new Uint8Array(o.length);for(var a=0;a<o.length;a++)r[a]=o.charCodeAt(a)}var s=h.subtlecrypto.importKey("jwk",r,i,!1,["sign"]);"ie"===h.cryptotype?(s.onerror=n,s.oncomplete=function(e){t(e.target.result)}):s.then(t).catch(n)},this.setAuthType=function(e){this.type=e},this._isTokenValid=function(e,t,n){var i=!1,o=ve.codebase;if(null===e)return!1;try{var a=h.decode(e);if(null!==a&&a.appID===t&&a.userID===encodeURIComponent(n)){var s=null;if(o===ht.firefox){var c=a.expiry.split(" ").join("T");s=Date.parse(c)}else s=new Date(a.expiry);new Date(r())<s&&(i=!0)}return i}catch(e){}return!1},this.setupAuthToken=function(e){vt("csio_auth_data",JSON.stringify(e)),this.authToken=e,this.tokenData=h.decode(e),_e=parseInt(this.tokenData.submissionInterval,10),re.setSubmissionInterval(_e),re.setReportingMode(this.tokenData.adaptiveInterval),Se=this.tokenData.collectSDP},this.sendAuthenticationRequest=function(r,i,a){if(r&&i){if(e.authInProgress)return void J(a);null!==n&&(clearTimeout(n),n=null),f(),e.authInProgress=!0,e.tokenGenerator(o,function(s,c){if(null!==s)return e.authInProgress=!1,void(a&&a(Qe.tokenGenerationError,s.toString()));Gn(Y+"authenticate",{client_id:i+"@"+oe,code:c,grant_type:"authorization_code"},function(s,c){var u=null;e.authInProgress=!1,ye.auth=c;try{u=JSON.parse(s.response)}catch(e){console.error("Authentication response parse error")}if(!u)return void(n=setTimeout(e.sendAuthenticationRequest,5e3,r,i,a));if(200===s.status){if("bearer"!==u.token_type)return console.error("Authentication was successful, but token type was not bearer. Scheduling retry."),void(n=setTimeout(e.sendAuthenticationRequest,5e3,r,i,a));e.setupAuthToken(u.access_token);var l=parseInt(1e3*parseInt(u.expires_in)*.9);if(m(l,r,i,a),o=!1,a&&a(Qe.success,"SDK authentication successful."),u.iceServers&&!le&&fe){try{fe.start(u.iceServers,Ht.bind(this))}catch(e){pe("start",e),fe.crashDisconnect()}St(oe,ae,"log",{msg:"precalltest started"})}le&&St(oe,ae,"log",{msg:"precalltest disabled"}),Bt(),Kn._isChannelReady()?(Re.sendCachedUserJoinedEvents(De),a&&a(Qe.success,"WebSocket establishment successful.")):Kn._setupWebSocketConnection(function(e,t){a&&a(e,t)})}else{if(u[t]&&u[t].length>0)return v(r,i,a,u[t],e.type);console.error("Authentication failed, but no error actions were defined in response."),n=setTimeout(e.sendAuthenticationRequest,5e3,r,i,a)}})})}};var f=function(){null!==i&&(clearTimeout(i),i=null)},m=function(t,n,r,o){f(),i=setTimeout(function(){e.sendAuthenticationRequest(n,r,o)},t)},v=function e(t,n,r,i,a){if(0!==i.length){var s=i.shift();if(s.action===Ct.RETRY)return a===Ae.jwt&&m(s.params.timeout,t,n,r),e(t,n,r,i);if(s.action===Ct.GET_NEW_TOKEN)return o=!0,e(t,n,r,i);if(s.action===Ct.REPORT_ERROR){var u="Authentication Error";return s.params&&s.params.errorCode>=0&&(u=c[s.params.errorCode]),r&&r(Qe.authError,u),e(t,n,r,i)}}};this.appSecretTokenGenerator=function(t){var n=null,r=null,i=!1,o=null;t.indexOf(":")>-1&&(o=p(t.split(":")[0]),t=t.split(":")[1]);var a=function(e){t=null,n=e},s=function(e){i=!0,t=null,console.error("Couldn't import key",e)};return h.importKey(t,a,s),function(t,a){if(i)return a("appsecret based token generation failed");if(!t&&null!==r)return a(null,r);if(null===n)return setTimeout(function(){e.tokenGenerator(t,a)},100);var s={userID:ae,appID:oe};o&&(s.keyID=o),h.sign({alg:"HS256"},s,n,function(e,t){return e?a(e):(r=t,a(null,t))})}}},De=new Oe,xe=new z;try{ve=xe.detectBrowserInfo()}catch(e){console.log("detectBrowserInfo: Error",e)}var Ne;window.csioReactNative||(Ne=xe.measureAppLoadingPerformance(ve),ye.loading=Ne);var Le,Me={type:"browser",name:ve.name,ver:ve.ver,os:ve.os,osVersion:ve.osVersion,userAgent:ve.userAgent},je={},Fe={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},Ue=!0,He=null,Be=null,Ge=2e4,Je=100,Ve=null;"Firefox"===ve.name?Ve=mozRTCPeerConnection:"Chrome"===ve.name||"Opera"===ve.name?Ve=webkitRTCPeerConnection:"Safari"===ve.name?console.log("Browser type Safari"):"Edge"===ve.name&&(Ve=window.RTCPeerConnection);var We={fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",audioDisruption:"audioDisruption",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},qe={autoFabricSetup:"autoFabricSetup",userJoined:"userJoined",userLeft:"userLeft",refreshPresence:"userAlive",ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent",fabricStateChange:"fabricStateChange",iceDisruptionStart:"iceDisruptionStart",iceDisruptionEnd:"iceDisruptionEnd",fabricTransportSwitch:"fabricTransportSwitch",iceConnectionDisruptionStart:"iceConnectionDisruptionStart",iceConnectionDisruptionEnd:"iceConnectionDisruptionEnd",iceAborted:"iceAborted",iceTerminated:"iceTerminated",iceFailed:"iceFailed",iceRestarted:"iceRestarted",fabricDropped:"fabricDropped",connectedDevices:"connectedDevices",iceCompleted:"iceCompleted",iceCandidateFound:"iceCandidateFound"},Ke={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",userFeedback:"userFeedbackEvent",clockSync:"clockSync",preCallTest:"preCallTest"},ze={results:"preCallTestResults",associate:"preCallTestAssociate"},$e={success:"success",failure:"failure"},Qe={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK"},Xe={authOngoing:"authOngoing"},Ye={peer:"peer",server:"server"},Ze={sendonly:"sendonly",receiveonly:"receiveonly",sendrecv:"sendrecv",inactive:"inactive"},et={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},tt={local:"local",remote:"remote"},nt={excellent:5,good:4,fair:3,poor:2,bad:1},rt={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},it={excellent:"excellent",fair:"fair",bad:"bad"},ot={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted",checkingDisrupted:"checkingDisrupted"},at={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},st={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog"},ct={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},ut={video:{gThreshold:.8,rThreshold:.3}},lt={video:{gThreshold:400,rThreshold:1e3}},dt={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},pt={audio:{gThreshold:240,rThreshold:400}},ht={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},ft={signalingState:"signalingState",iceConnectionState:"iceConnectionState",iceGatheringState:"iceGatheringState"},mt=[qe.userJoined,qe.refreshPresence,We.fabricSetupFailed],vt=function(e,t){try{window&&window.localStorage&&window.localStorage.setItem(e,t)}catch(e){return}},gt=function(e){try{if(window&&window.localStorage)return window.localStorage.getItem(e)}catch(e){return null}return null},yt=function(e){try{window&&window.localStorage&&window.localStorage.removeItem(e)}catch(e){return}},bt=function(e,n,r,i,o){var a=null,s=null,c=null,u=new XMLHttpRequest;if("Microsoft Internet Explorer"!==ve.name&&(u.timeout=r),u){u.open("GET",encodeURI(e));for(var l in n)u.setRequestHeader(l,n[l]);a=t(),u.onload=function(){s=t(),c=s-a,i(u,c)},u.ontimeout=o,u.send()}},_t=function(e,t,n){var r=new XMLHttpRequest;r&&(r.open("POST",encodeURI(e)),r.setRequestHeader("Content-Type","application/json"),r.onload=function(){n(r)},r.send(t))},St=function(e,t,n,r){if(Ce&&e){var i=X+"generics",o={appID:e,userID:encodeURIComponent(t),version:Z,eventType:n,data:r},a=JSON.stringify(o);me!==a&&(me=a,_t(i,a,function(e){200===e.status?console.log("Got generic response: %o",e.response):200!==e.status&&console.log("Got error for generic request %o, %s",e,e.status)}))}};window&&window.addEventListener&&window.addEventListener("error",function(e){if(e&&e.filename&&e.filename.indexOf("callstats")>-1){var t,n=!1,r={fileName:e.filename,line:e.lineno,col:e.colno,jsVersion:Z,eventType:"error",message:e.message,pageURL:window.location.href};for(t in je)je.hasOwnProperty(t)&&(r.conferenceID=t,St(oe,ae,"onErrorLog",r),n=!0);n||St(oe,ae,"onErrorLog",r)}});var Tt={invalidWebRTCFunctionName:"Invalid WebRTC function name"},Ct={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2},Et=e(),wt=function(e,n,i){var o=RegExp.prototype.test.bind(/^([a-z])=(.*)/),a=/^ssrc:(\d*) ([\w_]*):(.*)/,s=/^ssrc-group:SIM (\d*)/;n.split(/(\r\n|\r|\n)/).filter(o).forEach(function(n){var o=n[0],c=n.slice(2);if("a"===o){if(a.test(c)){var u=c.match(a),l=u[1];void 0===e.ssrcMap[l]&&(e.ssrcMap[l]={}),e.ssrcMap[l][u[2]]=u[3],e.ssrcMap[l].localStartTime=t(),e.ssrcMap[l].syncedStartTime=r(),e.ssrcMap[l].streamType=i}s.test(c)&&(void 0===e.ssrcMap.ssrcGroup&&(e.ssrcMap.ssrcGroup={},e.ssrcMap.ssrcGroup[i]={}),e.ssrcMap.ssrcGroup[i].simulcastGroup=c.match(/\d+/g))}})},Rt=function(e,t){return e.ssrcMap[t]},kt=function(e){return e.ssrcMap},It=function(e,t,n,r,i,o){if(!i.localDescription||!i.remoteDescription)return!1;var a=i.localDescription.sdp,s=i.remoteDescription.sdp;if(!a||!s||a===r.localSDP&&s===r.remoteSDP)return!1;if(wt(r,a,rt.outbound),wt(r,s,rt.inbound),Se){var c={sdp:{}};c.sdp.localSDP=a!==r.localSDP?a:-1,c.sdp.remoteSDP=s!==r.remoteSDP?s:-1,Ot(e,t,n,c,r.pcHash,o)}return r.localSDP=a,r.remoteSDP=s,!0},Pt=function(e,t,n,i,o,a,s){if(!e)return void console.error("sendEvent: Invalid eventType ");var c=r(),u={version:Z,apiTS:c,action:e,localID:encodeURIComponent(ae),remoteID:t?encodeURIComponent(t):null,conferenceID:encodeURIComponent(n),timeShift:0,appID:oe,ucID:i,pcID:a,deviceID:ce,value:o};return null===n?void St(oe,ae,"log",{msg:"conferenceID is null in sendEvent for "+e}):void G(Ke.callStatsEvent,u,s)},At=function(e,t,n,i){if(!e)return void console.error("sendEvent: Invalid eventType ");var o=r(),a={version:Z,channel:Ke.preCallTest,timestamp:o,apiTS:o,action:e,eventType:e,localID:encodeURIComponent(ae),remoteID:encodeURIComponent(ae),conferenceID:encodeURIComponent(t),timeShift:0,appID:oe,ucID:n,deviceID:ce,token:De.authToken};return e===ze.results&&(a.results=i,null==t)?void zn(Ke.preCallTest,a):(e===ze.associate&&(a.ids=i),void(n&&!Ue?G(Ke.preCallTest,a):(a.clockUnsynced=Ue,Re.cacheEvent({channel:Ke.preCallTest,data:a,callback:null}))))},Ot=function(e,t,n,i,o,a){var s=r(),c={version:Z,appID:oe,conferenceID:encodeURIComponent(t),ucID:n,apiTS:s,localID:encodeURIComponent(ae),remoteID:encodeURIComponent(e),pcID:o,deviceID:ce,sdpPayload:i,action:Ke.sdpSubmission};De.authToken&&n&&!Ue?(c.token=De.authToken,G(Ke.sdpSubmission,c,a)):(c.clockUnsynced=Ue,Re.cacheEvent({channel:Ke.sdpSubmission,data:c,callback:a}),De.authToken||De.sendAuthenticationRequest(oe,ae))},Dt=function(e,t,n,r,i,o,a){Yt(e,function(e){t.localCandidates=e.localCandidates,t.remoteCandidates=e.remoteCandidates,t.iceCandidatePairs=e.iceCandidatePairs,t.activeIceCandidatePair=bn(t.iceCandidatePairs),a.currPair=t.activeIceCandidatePair,Pt(qe.fabricStateChange,i,n,r,a,o)})},xt=function(e){var t={connectedDevices:ie},n=je[e]?je[e].ucID:null;Pt(qe.connectedDevices,null,e,n,t,null)},Nt=function(e){var t={ucID:je[e].ucID,endpoint:Me,magicKey:Et};Pt(qe.refreshPresence,null,e,je[e].ucID,t,null)},Lt=function(e,t){var n={};return n.status=e,t&&(n.message=t),n},Mt=function(e,t){var n,r,i,o=0;if(!e)return o;for(n=0,i=e.length;n<i;n++)r=e.charCodeAt(n),o=(o<<5)-o+r,o|=0;return t&&t(o),o},jt=function(e,n,r,i,o,a){if(!e||!r||!n)return console.error("initialize: Argument missing/invalid"),Lt($e.failure,"initialize: Argument missing/invalid");if(i&&"function"!=typeof i)return console.error("initialize: Argument missing/invalid"),Lt($e.failure,"initialize: Argument missing/invalid");if(o&&"function"!=typeof o)return console.error("initialize: Argument missing/invalid"),Lt($e.failure,"initialize: Argument missing/invalid");if(De.setAuthType(Ae.jwt),"function"!=typeof n){if(De.setAuthType(Ae.appSecret),!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle||window.csioReactNative))return console.error("Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),i&&i(Qe.tokenGenerationError,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),Lt($e.failure,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API");n=De.appSecretTokenGenerator(n)}if("string"==typeof e&&(e=parseInt(e,10)),oe=e,isNaN(oe))return Lt($e.failure,"Invalid Credentials");if("object"==(void 0===r?"undefined":s(r))?(ae=r.aliasName,se=r):ae=r,ye.initializeSinceCreate=t()-ye.create,St(oe,ae,"log",{msg:"callstats initialize in progress"}),a&&(!0===a.disableBeforeUnloadHandler&&(ue=!0),null===a.applicationVersion&&void 0===a.applicationVersion||(Me.appVer=a.applicationVersion),!0===a.disablePrecalltest&&(le=!0)),De.tokenGenerator=n,gt("csio_auth_data"))try{var c=JSON.parse(gt("csio_auth_data"));De._isTokenValid(c,oe,ae)&&(i&&i(Qe.success,"SDK authentication successful."),De.setupAuthToken(c),Bt(),Kn._isChannelReady()||Kn._setupWebSocketConnection(i))}catch(e){console.log("initialize: Error",e)}l(),o&&(be.stats=o);try{De.sendAuthenticationRequest(oe,ae,i)}catch(e){console.log("initialize: Error",e)}return Lt($e.success)},Ft=function(){ye.sent||(ye.remoteofferSinceCreate&&ye.config||ye.errorSinceCreate)&&(St(oe,ae,"timing",ye),ye.sent=!0)},Ut=function(e,t){"function"==typeof t&&be.hasOwnProperty(e)&&(be[e]=t)},Ht=function(e){St(oe,ae,"log",{msg:"precalltest finished"}),be.preCallTest&&be.preCallTest(e);try{ge.push(e.id);var t=null,n=null;for(var r in je)if(je.hasOwnProperty(r)){t=r,je[r].ucID&&(n=je[r].ucID);break}At(ze.results,t,n,e)}catch(e){pe("send results",e)}},Bt=function(){var e="https://appsettings.callstats.io/v1/apps/"+oe,t={Authorization:"Bearer "+De.authToken},n=function(e,t){200!==e.status&&setTimeout(function(){i()},100),ye.config=t,Ft();var n=JSON.parse(e.response);if(console.log("internal config:",n),n.submissionInterval&&(_e=parseInt(n.submissionInterval,10),re.setSubmissionInterval(_e)),n.adaptiveStats&&re.setReportingMode(n.adaptiveStats),n.collectSDP&&(Se=n.collectSDP),n.qmodelThresholdsAPI){var r=n.qmodelThresholdsAPI;Bn("eModelThreshold",r,pt),Bn("throughputThreshold",r,ct),Bn("fractionalLossThreshold",r,dt),Bn("rttThreshold",r,lt),Bn("currOverPrevFrameRateThreshold",r,ut)}},r=function(e){200!==e.status&&setTimeout(function(){o()},100);var t=JSON.parse(e.response),n=function(e,t){var n={};return t&&(n={peerConnection:null,media:null}),e.peerConnection&&(n.peerConnection=e.peerConnection),e.media&&(n.media=e.media),e.sender&&(n.sender=e.sender),e.confidence&&(n.confidence=e.confidence),n};if(be.defaultConfig&&t.default){var r=n(t.default,!0);r!=={}&&be.defaultConfig(r)}if(be.recommendedConfig&&t.recommended){var i=n(t.recommended,!1);i!=={}&&be.recommendedConfig(i)}},i=function r(){bt(e+"/configurations/internal",t,2e3,n,r)},o=function n(){bt(e+"/configurations",t,2e3,r,n)};i(),o()},Gt=function(e){return function(t){return t.pc===e||!(!e.callstatsID||t.pcHash!==e.callstatsID)||void 0}},Jt=function(e,t){var n=null;return je[e]&&je[e].participants&&(n=je[e].participants.filter(Gt(t))),n&&n.length>0?n[0]:null},Vt=function(e,t){var n=null,r=null;return n=Jt(e,t),n&&(r=n.pcHash),r},Wt=function(e){var t=null,n=null,r=null;for(t in je)if(je.hasOwnProperty(t)&&(r=Jt(t,e))){n={fabric:r,conferenceID:t};break}return n},qt=function(e,t){var n=0;if(e&&je[t].participants)for(n=0;n<je[t].participants.length;n++)if(je[t].participants[n].pcHash===e.pcHash){je[t].participants.splice(n,1);break}},Kt=function(e){if(e){var t=[],n=0;if(e&&e.result)t=e.result();else if(e&&e.forEach)e.forEach(function(e){t.push(e)});else for(n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}},zt=function(e){var t,n=null,r=null,i=null,o=[],a=[],s=[],c=0;if(!(n=Kt(e)))return{localCandidates:o,remoteCandidates:a};for(c=0;c<n.length;++c)if(r=P(n[c]),i=R(r),i.localCandidate)o.push(i.localCandidate);else if(i.remoteCandidate)a.push(i.remoteCandidate);else if(i.Transport){if("transport"===i.Transport.type){t=i.Transport.selectedCandidatePairId;continue}s.push(i.Transport)}else i.candidatePair&&s.push(i.candidatePair);if(t)for(c=0;c<s.length;c++)s[c].id===t&&(s[c].googActiveConnection="true");return{localCandidates:o,remoteCandidates:a,iceCandidatePairs:s}},$t=function(e){function t(t){var n={};n=zt(t),e(n)}return t},Qt=function(e){var t=null;return e&&(t=e.message+" : "+e.stack),t},Xt=function(e,t,n,r,i,o){var a=ve.codebase,s=ve.name;if(a===ht.firefox)if(Ee)try{e.getStats().then(n(t,r,i,o,e)).catch(function(s){Ee=!1,St(oe,r,"log",{msg:"### "+a+" getStats reports error "+Qt(s)}),e.getStats(null,n(t,r,i,o,e))})}catch(s){Ee=!1,St(oe,r,"log",{msg:"### "+a+" getStats reports error "+Qt(s)}),e.getStats(null,n(t,r,i,o,e))}else e.getStats(null,n(t,r,i,o,e),function(e){console.log("getstats error ",e)});else if("Safari"===s)e.getStats().then(n(t,r,i,o,e)).catch(function(e){St(oe,r,"log",{msg:"### "+a+" getStats reports error "+Qt(e)})});else if(a===ht.chrome)if(window&&window.csioReactNative)e.getStats(null,n(t,r,i,o,e),function(e){St(oe,r,"log",{msg:"### "+a+" getStats reports error "+Qt(e)})});else if(Ee)try{e.getStats().then(n(t,r,i,o,e)).catch(function(s){Ee=!1,St(oe,r,"log",{msg:"### "+a+" getStats reports error "+Qt(s)}),e.getStats(n(t,r,i,o,e))})}catch(s){Ee=!1,St(oe,r,"log",{msg:"### "+a+" getStats reports error "+Qt(s)}),e.getStats(n(t,r,i,o,e))}else e.getStats(n(t,r,i,o,e));else a===ht.edge&&e.getStats().then(n(t,r,i,o,e)).catch(function(e){St(oe,r,"log",{msg:"### "+a+" getStats reports error "+Qt(e)})})},Yt=function(e,t){try{Xt(e,t,$t)}catch(e){console.log("csioGetStats: Error",e)}},Zt=function(e,t,n,r){if(n||(n=ne),!e||!t)return console.error("sendFabricEvent: Arguments missing/Invalid"),Lt($e.failure,"sendFabricEvent: Arguments missing/Invalid");if(!oe||!ae||!je[n])return console.error("sendFabricEvent: SDK is not initialized or no Fabrics added."),Lt($e.failure,"sendFabricEvent: SDK is not initialized or no Fabrics added.");if(t===We.fabricSetupFailed)return console.error("sendFabricEvent: Unsupported fabricEvent fabricSetupFailed"),Lt($e.failure,"sendFabricEvent: Unsupported fabricEvent fabricSetupFailed");if(!f(e))return console.error("sendFabricEvent: Invalid PeerConnection object passed"),Lt($e.failure,"sendFabricEvent: Invalid PeerConnection object passed");if(!We.hasOwnProperty(t)&&!qe.hasOwnProperty(t))return console.error("sendFabricEvent: Invalid fabricEvents value: ",t),Lt($e.failure,"sendFabricEvent: Invalid fabricEvents value: "+t);var i={},o=null,a=je[n],s=null;if(void 0===a)return console.error("sendFabricEvent: Conference ID not found!"),Lt($e.failure,"sendFabricEvent: Conference ID not found!");if(null===(s=Jt(n,e)))return console.error("sendFabricEvent: fabricData is null"),Lt($e.failure,"sendFabricEvent: fabricData is null");if(o=s.remoteUserID,t===We.activeDeviceList){if(!r||!r.deviceList)return console.error("sendFabricEvent: Arguments missing/Invalid"),Lt($e.failure,"sendFabricEvent: Arguments missing/Invalid");if(!(r.deviceList instanceof Array))return console.error("sendFabricEvent: DeviceList Invalid"),Lt($e.failure,"sendFabricEvent: DeviceList Invalid");i={magicKey:Et,endpoint:Me,activeDevicelist:r.deviceList}}if(Pt(t,o,n,a.ucID,i,s.pcHash,s.pcCallback),t===We.fabricTerminated){if(je[n].participants){s&&(s.statsInterval=N(s.statsInterval),qt(s,n));var c=F(n);c.conferenceFinished&&U(n,c.ucID)}}else t===We.fabricHold?(s.statsInterval=N(s.statsInterval),s.onHold=!0):t===We.fabricResume&&(s.onHold=!1,Sn(s,e,n,o));return Lt($e.success)},en=function(e){return e.length>2e4&&(console.log("Log exceeds 20kb, It will be truncated"),e=e.substring(0,2e4)),e},tn=function(e){return e&&"string"==typeof e?e=en(e):e&&"object"==(void 0===e?"undefined":s(e))&&e.message&&(e.message=en(e.message)),e},nn=function(e,t,n){return t||(e&&e[n]?e[n].sdp:-1)},rn=function(n,r,i,o,a,c){if(r||(r=ne),void 0===n||!i)return console.error("reportError: Arguments missing/invalid"),Lt($e.error,"reportError: Arguments missing/invalid");if(!oe||!ae)return console.error("reportError: SDK is not initialized"),Lt($e.error,"reportError: SDK is not initialized");if(!at.hasOwnProperty(i))return console.error("reportError: Invalid webRTC functionName value: %o",i),Lt($e.error,"reportError: Invalid webRTC functionName value: "+i);void 0===o&&console.warn("reportError: Missing dom error parameter");var u,l,d,p=null,h=t(),m=je[r],v=null,g=h,y=null,b=null,_=null,S=null;if(_=B(r),l=w(i),i!==at.getUserMedia&&(S=e()),o)if(window.DOMException&&o instanceof window.DOMException)o={message:o.message,name:o.name};else if("object"==(void 0===o?"undefined":s(o))){var T={};o.message&&(T.message=o.message),o.name&&(T.name=o.name),o.constraintName&&(T.constraintName=o.constraintName),o.stack&&(T.stack=o.stack),o=T}if(o=tn(o),f(n)){if(m&&(_=m.ucID),v=Jt(r,n),v?(u=v.remoteUserID,g=v.startTime,y=v.pcState,b=v.pc.iceConnectionState,S=v.pcHash,d=v.pcCallback):u=ae,p={failureDelay:h-g,reason:l,domError:o,fabricState:y,iceConnectionState:b,function:i,magicKey:Et,endpoint:Me},i===at.applicationLog||i===at.applicationError?Pt(We.applicationErrorLog,u,r,_,p,S,d):(Pt(We.fabricSetupFailed,u,r,_,p,S,d),ye.errorSinceCreate=t()-ye.create,Ft()),a||c||n&&n.localDescription||n&&n.remoteDescription){var C={sdp:{}};C.sdp.localSDP=nn(n,a,"localDescription"),C.sdp.remoteSDP=nn(n,c,"remoteDescription"),Ot(u,r,_,C,S)}}else null===Et&&(Et=e()),u=ae,p={failureDelay:0,reason:l,domError:o,function:i,magicKey:Et,endpoint:Me},i===at.applicationLog||i===at.applicationError?Pt(We.applicationErrorLog,u,r,_,p,null,null):Pt(We.fabricSetupFailed,u,r,_,p,S,null);return Lt($e.success)},on=function(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t[t.length]=r:r>127&&r<2048?(t[t.length]=r>>6|192,t[t.length]=63&r|128):(t[t.length]=r>>12|224,t[t.length]=r>>6&63|128,t[t.length]=63&r|128)}return new Uint8Array(t).buffer},an=function(e){for(var t,n=new DataView(e),r="",i=0;i<n.byteLength;i++)t=n.getUint8(i).toString(16),t.length<2&&(t="0"+t),r+=t;return r},sn=function(e,t){var n={name:"SHA-256"};if(window.crypto){var r=window.crypto.subtle||window.crypto.webkitSubtle;if(!r)return void Mt(e,t);r.digest(n,on(e)).then(function(e){t(an(e))}).catch(function(){Mt(e,t)})}else if(window.msCrypto){if(!window.msCrypto.subtle)return void Mt(e,t);var i=window.msCrypto.subtle.digest(n,on(e));i.oncomplete=function(e){e.target&&t(an(e.target.result))},i.onerror=function(){Mt(e,t)}}else Mt(e,t)},cn=function(e,t,n){var r;if(!t||!e)return console.error("sendUserFeedback: Arguments missing/Invalid"),Lt($e.error,"sendUserFeedback: Arguments missing/Invalid");if("object"!=(void 0===t?"undefined":s(t)))return console.error("sendUserFeedback: Invalid feedback object."),Lt($e.error,"sendUserFeedback: Invalid feedback object.");if(0===Object.keys(t).length)return console.error("sendUserFeedback: Feedback data object must not be empty."),Lt($e.error,"sendUserFeedback: Feedback data object must not be empty.");var i=je[e],o=null;void 0!==i&&void 0!==i.ucID&&(o=i.ucID);var a=null;if(a=null===Et?He:Et,null===o&&(o=B(e)),null===o)return console.error("sendUserFeedback: ucID unavailable"),Lt($e.error,"sendUserFeedback: ucID unavailable");r="object"==s(t.userID)?t.userID.aliasName:t.userID,t&&t.overall<=0&&(t.overall=null);var c={conferenceID:encodeURIComponent(e),magicKey:a,appID:oe,version:Z,ucID:o,remoteID:encodeURIComponent(r),userID:encodeURIComponent(r),userQoe:{overall:t.overall}};return t.video&&(c.userQoe.video=t.video),t.audio&&(c.userQoe.audio=t.audio),t.screen&&(c.userQoe.screen=t.screen),t.comment&&(c.userQoe.comment=t.comment),De.authToken&&!Ue?(c.token=De.authToken,vt("feedback",JSON.stringify(c)),G(Ke.userFeedback,c,n)):(c.clockUnsynced=Ue,Re.cacheEvent({channel:Ke.userFeedback,data:c,callback:n}),De.sendAuthenticationRequest(oe,r)),Lt($e.success)},un=function(e,t,n,r,i,o){var a=null;if(a="object"==(void 0===t?"undefined":s(t))?t.aliasName:t,n||(n=ne),!(e&&r&&i&&a))return console.error("associateMstWithUserID: Arguments missing"),Lt($e.error,"associateMstWithUserID: Arguments missing");if(!f(e))return console.error("associateMstWithUserID: Invalid PeerConnection object passed"),Lt($e.error,"associateMstWithUserID: Invalid PeerConnection object passed");if(void 0===je[n])return console.error("associateMstWithUserID: conferenceID doesn't exist"),Lt($e.error,"associateMstWithUserID: conferenceID doesn't exist");var c=null;if(null===(c=Jt(n,e)))return console.error("associateMstWithUserID: Unknown pcObject passed"),Lt($e.error,"associateMstWithUserID: Unknown pcObject passed");var u=Rt(c,r);return void 0===u&&(c.ssrcMap[r]={},u=Rt(c,r)),u.remoteUserID=a,u.ssrc=r,u.associatedVideoTag=o,u.usageLabel=i,o&&a!==ae&&h(n,o,e,r),Lt($e.success)},ln=function(e){if(je[ne]){var t=je[ne].participants;if(t)for(var n=0;n<t.length;n++)t[n].conferenceID=e}},dn=function(e){Re.updateConferenceId(encodeURIComponent(e))},pn=function(e,t){var n=Wt(t);n&&Re.updateRemoteUserID(e,n.fabric.pcHash)},hn=function(e,t){var n=null;(n=Wt(t))&&(n.fabric.remoteUserID=e)},fn=function(){Re.sendCachedUserJoinedEvents(De),Re.sendCachedEvents(De,Ue)},mn=function(e,t){return e?(e.conferenceID&&(ln(e.conferenceID),je[e.conferenceID]=je[ne],dn(e.conferenceID),fn()),e.remoteUserID&&t&&(pn(e.remoteUserID,t),hn(e.remoteUserID,t),fn()),Lt($e.success)):(console.error("setIdentifiers: Arguments missing/Invalid"),Lt($e.error,"_setIdentifiers: Arguments missing/Invalid"))},vn=function(e){return window&&!window.csioproxy?(console.error("setCallstatsURLs: cannot be called if window.csioproxy is false"),Lt($e.error,"setCallstatsURLs: cannot be called if window.csioproxy is false")):e?(e.collectorURL&&(X=e.collectorURL),e.authServiceURL&&(Y=e.authServiceURL),e.csioInternalAPIURL&&(te=e.csioInternalAPIURL),e.wsURL&&(ee=e.wsURL),Ce=!0,Jn(),Vn(),q(),Lt($e.success)):(console.error("setCallstatsURLs: Arguments missing/Invalid"),Lt($e.error,"setCallstatsURLs: Arguments missing/Invalid"))},gn=function(n,r,i,o,a,c){var l=null,d=Ye.peer,p=Ze.sendrecv,h={authStatus:!!De.tokenData,clockSync:!Ue,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:o,version:Z};if(q(),St(oe,ae,"stateMachine",h),l=r&&"object"==(void 0===r?"undefined":s(r))?r.aliasName:r,o||(o=ne),!n||!i)return console.error("addNewFabric: Arguments missing/Invalid"),Lt($e.error,"addNewFabric: Arguments missing/Invalid");if(!oe||!ae)return console.error("addNewFabric: SDK not initialized."),Lt($e.error,"addNewFabric: SDK not initialized");if(!f(n))return console.error("addNewFabric: Invalid PeerConnection object passed"),Lt($e.error,"addNewFabric: Invalid PeerConnection object passed");if(!et.hasOwnProperty(i)||i instanceof Function)return console.error("addNewFabric: Invalid fabricUsage value"),Lt($e.error,"addNewFabric: Invalid fabricUsage value");if(a&&"function"!=typeof a){if(a.remoteEndpointType){if(!Ye.hasOwnProperty(a.remoteEndpointType))return console.error("addNewFabric: Invalid remoteEndpointType value"),Lt($e.error,"addNewFabric: Invalid remoteEndpointType value");d=a.remoteEndpointType}if(a.fabricTransmissionDirection){if(!Ze.hasOwnProperty(a.fabricTransmissionDirection))return console.error("addNewFabric: Invalid fabricTransmissionDirection value"),Lt($e.error,"addNewFabric: Invalid fabricTransmissionDirection value");p=a.fabricTransmissionDirection}}var m=t();ye.addnewfabricSinceCreate=m-ye.create,Ft(),null===Et&&(Et=e());var v=!1;if(!M(o)){var g=O(Et);Pt(qe.userJoined,null,o,null,g,null,null),v=!0,h={authStatus:!!De.tokenData,clockSync:!Ue,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:o,version:Z},St(oe,ae,"stateMachine",h)}if(D(o,null,v),!Jt(o,n)){n&&new Q(n,Dn,An,_n,Pn);var y=e(),b={pc:n,remoteUserID:l,fabricUsage:i,magicKey:Et,startTime:m,pcCallback:c,pcState:ot.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:n.iceConnectionState,latestEventSent:m,pcHash:y,localSDP:-1,remoteSDP:-1,statsInterval:null,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0,currentActivePhaseIndex:0,onHold:!1,ssrcMap:{},conferenceID:o,remoteEndpointType:d,fabricTransmissionDirection:p};"function"!=typeof n||n.callstatsID||(n.callstatsID=y),"connected"!==n.iceConnectionState&&"completed"!==n.iceConnectionState||(b.pcState=ot.established),j(o,b),b.pcState===ot.established&&(Nn(n,qe.autoFabricSetup,o),Sn(b,n,o))}if(u(o),fe)try{var _=ge;ge=[];var S=null;if(S=fe.getId(),S&&_.push(S),_.length>0){var T=je[o].ucID;At(ze.associate,o,T,_)}}catch(e){pe("send associate",e)}return Lt($e.success)},yn=function(e,t,n,r){if(!(e&&n&&r&&t))return console.error("reportUserIDChange: Arguments missing/Invalid"),Lt($e.error,"reportUserIDChange: Arguments missing/Invalid");if(!oe||!ae)return console.error("reportUserIDChange: SDK not initialized."),Lt($e.error,"reportUserIDChange: SDK not initialized");if(""===n||""===t)return console.error("reportUserIDChange: id or  conferenceID MUST not be empty"),Lt($e.error,"reportUserIDChange: id or  conferenceID MUST not be empty");if(!f(e))return console.error("reportUserIDChange: Invalid PeerConnection object passed"),Lt($e.error,"reportUserIDChange: Invalid PeerConnection object passed");var i=null,o=je[t];if(void 0===o)return console.error("reportUserIDChange: Conference ID not found!"),Lt($e.error,"reportUserIDChange: Conference ID not found!");var a=null;if(void 0===o.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),St(oe,ae,"log",{msg:"### reportUserIDChange: addNewFabric was not called"}),Lt($e.error,"reportUserIDChange: addNewFabric was not called");if(a=o.ucID,null===(i=Jt(t,e)))return console.error("reportUserIDChange: Invalid pcObject passed as argument"),Lt($e.error,"reportUserIDChange: Invalid pcObject passed as argument");var s={id:n,idType:r};return Pt(We.userIDChangedEvent,void 0,t,a,s,null,i.pcCallback),Lt($e.success)},bn=function(e){var t=null;if(e&&e.length>0){var n=e.filter(function(e){return"true"===e.selected||"true"===e.googActiveConnection||!0===e.selected||!0===e.googActiveConnection});n.length>0&&(t=n[0])}return t},_n=function(e,n){if(e){var r,i=null;if(void 0!==n){var o=n.signalingState;if((i=Wt(n))&&i.fabric){r=i.fabric.signalingState,i.fabric.signalingState=o;var a=i.conferenceID,s=i.fabric,c=s.remoteUserID,u=je[a].ucID,l={changedState:ft.signalingState,prevState:r,newState:o};if(Dt(n,s,a,u,c,s.pcHash,l),"closed"===o&&(Zt(n,We.fabricTerminated,i.conferenceID),fe))try{fe.callFinished()}catch(e){pe("callFinished",e),fe.crashDisconnect()}}if("have-remote-offer"===o||"stable"===o){if(ye.remoteofferSinceCreate=t()-ye.create,Ft(),fe)try{fe.callStarts()}catch(e){pe("callStarts",e),fe.crashDisconnect()}St(oe,ae,"log",{msg:"precalltest told to stop"})}}}},Sn=function(e,n,r){if(!e.onHold){var i=n,o=r;null===e.statsInterval&&(e.statsPollingStart=t(),xn(i,o),e.statsInterval=setInterval(function(){xn(i,o)},1e3))}},Tn=function(e,t,n,r,i,o){o.localCandidates=t.localCandidates,o.remoteCandidates=t.remoteCandidates,o.iceCandidatePairs=t.iceCandidatePairs,Pt(qe.iceFailed,n,r,i,o,t.pcHash,t.pcCallback)},Cn=function(e,t,n,r){var i=t.iceConnectionState,o=t.remoteUserID,a=je[n],s={prevIceConnectionState:i,currIceConnectionState:e.iceConnectionState,currPair:t.activeIceCandidatePair,failureDelay:r};t.pcState=ot.failed,"checking"===i?Tn(0,t,o,n,a.ucID,s):"completed"===i||"connected"===i?Pt(qe.fabricDropped,o,n,a.ucID,s,t.pcHash,t.pcCallback):"disconnected"===i&&t.established?Pt(qe.fabricDropped,o,n,a.ucID,s,t.pcHash,t.pcCallback):"disconnected"===i&&Tn(0,t,o,n,a.ucID,s)},En=function(e,n,r,i){var o=n.iceConnectionState,a=n.remoteUserID,s=je[r],c=t(),u={prevIceConnectionState:o,currIceConnectionState:e.iceConnectionState,prevPair:n.activeIceCandidatePair},l=n.pcState===ot.disrupted,d="completed"===e.iceConnectionState;n.connectivityIceStatusDelay=i,n.established=!0,Yt(e,function(e){if(n.localCandidates=e.localCandidates,n.remoteCandidates=e.remoteCandidates,n.iceCandidatePairs=e.iceCandidatePairs,n.activeIceCandidatePair=bn(n.iceCandidatePairs),u.currPair=n.activeIceCandidatePair,u.disruptionDelay=c-n.disruptedTS,l)Pt(qe.iceDisruptionEnd,a,r,s.ucID,u,n.pcHash);else if(d){var t={};t.iceCandidatePairs=e.iceCandidatePairs,Pt(qe.iceCompleted,a,r,s.ucID,t,n.pcHash)}}),Nn(n.pc,qe.autoFabricSetup,r),n.pcState=ot.established,Sn(n,e,r,a)},wn=function(e,n,r){var i=n.iceConnectionState,o=n.remoteUserID,a=je[r],s=t(),c={prevIceConnectionState:i,currIceConnectionState:e.iceConnectionState,prevIceConnectionStateTs:n.iceConnectionStateTS,currPair:n.activeIceCandidatePair};n.startTime=s,"connected"===i||"completed"===i?(n.pcState=ot.disrupted,n.disruptedTS=s,Pt(qe.iceDisruptionStart,o,r,a.ucID,c,n.pcHash,n.pcCallback),n.pcCallback&&n.pcCallback(Qe.appConnectivityError,"Connectivity check for PC object to "+o+" failed.")):"checking"===i&&(n.pcState=ot.checkingDisrupted,n.disruptedTS=s,Pt(qe.iceConnectionDisruptionStart,o,r,a.ucID,c,n.pcHash,n.pcCallback),n.pcCallback&&n.pcCallback(Qe.appConnectivityError,"Connectivity check for PC object to "+o+" failed."))},Rn=function(e,t,n,r){var i=t.iceConnectionState,o=t.remoteUserID,a=je[n],s={prevIceConnectionState:i,currIceConnectionState:e.iceConnectionState};"new"===i||"checking"===i?(s.failureDelay=r,Pt(qe.iceAborted,o,n,a.ucID,s,t.pcHash,t.pcCallback)):(s.currPair=t.activeIceCandidatePair,Pt(qe.iceTerminated,o,n,a.ucID,s,t.pcHash,t.pcCallback))},kn=function(e,t,n){var r=t.iceConnectionState,i=t.remoteUserID,o=je[n],a={prevIceConnectionState:r,currIceConnectionState:e.iceConnectionState,prevPair:t.activeIceCandidatePair};"new"!==r&&(t.established=!1,Pt(qe.iceRestarted,i,n,o.ucID,a,t.pcHash,t.pcCallback))},In=function(e,n,r,i){var o=n.iceConnectionState,a=n.remoteUserID,s=je[r],c=t(),u={prevIceConnectionState:o,currIceConnectionState:e.iceConnectionState};n.gatheringIceCandidatesDelay=i,"disconnected"===o&&n.pcState===ot.checkingDisrupted&&(u.disruptionDelay=c-n.disruptedTS,Pt(qe.iceConnectionDisruptionEnd,a,r,s.ucID,u,n.pcHash,n.pcCallback))},Pn=function(e,t){if(e&&void 0!==t){var n=null;(n=Wt(t))&&n.fabric&&n.fabric.numNegotiationNeededCalls++}},An=function(e,n){if(e&&void 0!==n){var r,i,o,a,s,c=null,u=null;if((u=Wt(n))&&u.fabric){c=u.fabric,r=u.conferenceID,i=t(),o=i-c.startTime,a=c.iceConnectionState,s=c.iceGatheringState;var l=c.remoteUserID,d=je[r].ucID,p={changedState:ft.iceConnectionState,prevState:a,newState:n.iceConnectionState};if(Dt(n,c,r,d,l,c.pcHash,p),s!==n.iceGatheringState){var h={changedState:ft.iceGatheringState,prevState:s,newState:n.iceGatheringState};Dt(n,c,r,d,l,c.pcHash,h)}"complete"===n.iceGatheringState&&"checking"===n.iceConnectionState&&In(n,c,r,o),"connected"===n.iceConnectionState||"completed"===n.iceConnectionState?En(n,c,r,o):"failed"===n.iceConnectionState?Cn(n,c,r,o):"disconnected"===n.iceConnectionState?wn(n,c,r):"closed"===n.iceConnectionState?Rn(n,c,r,o):"new"===n.iceConnectionState&&kn(),c.iceConnectionState=n.iceConnectionState,c.iceGatheringState=n.iceGatheringState,c.iceConnectionStateTS=t()}}},On=function(e,t){var n=Wt(e);if(n&&n.fabric){var r=n.fabric,i=r.remoteUserID,o=n.conferenceID,a=je[o].ucID;Pt(qe.iceCandidateFound,i,o,a,t,r.pcHash)}},Dn=function(e,t){var n,r,i;if(void 0!==t){if(null!==e.candidate){r=e.candidate.candidate.split(" ");var o="1"===r[1]?"rtp":"rtcp";"0"!==r[5]&&(i=-1!==r[4].indexOf(":"),n={transport:r[2],protocol:o,typePreference:r[3],address:i?"["+r[4]+"]:"+r[5]:r[4]+":"+r[5],type:r[7],media:e.candidate.sdpMid})}var a=null;a=Wt(t),Yt(t,function(e){a.localCandidates=e.localCandidates,a.remoteCandidates=e.remoteCandidates,a.iceCandidatePairs=e.iceCandidatePairs,a.activeIceCandidatePair=bn(a.iceCandidatePairs)}),a&&a.fabric&&(void 0!==n&&-1===a.fabric.iceCandidates.indexOf(n)&&a.fabric.iceCandidates.push(n),n&&a.fabric.fabricSetupSent&&On(t,n))}},xn=function(e,t){if(!je.hasOwnProperty(t))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",t);if("closed"===e.signalingState)return Zt(e,We.fabricTerminated,t),!0;var n=Jt(t,e);if(n.pcState!==ot.established&&n.lastFabricState===n.pcState&&"connected"!==e.iceConnectionState&&"completed"!==e.iceConnectionState)return!0;var r=je[t].ucID;try{Xt(e,n.pcCallback,E,ae,r,n)}catch(e){console.log("csioGetStats: Error",e)}},Nn=function(e,n,r){var i,o=null,a=je[r],s=null,c=t();if(void 0===a&&console.error("sendAutoFabricSetupEvent: Conference ID not found!"),s=Jt(r,e),null===s&&console.error("sendAutoFabricSetupEvent: fabricData is null"),!s.fabricSetupSent){o=s.remoteUserID,i=c-s.startTime;var u={setupDelay:i,iceGatheringDelay:s.gatheringIceCandidatesDelay,iceConnectivityDelay:s.connectivityIceStatusDelay,remoteEndpointType:s.remoteEndpointType,fabricTransmissionDirection:s.fabricTransmissionDirection};Ue||(u.clockSyncOffset=Fe.currentOffset),Yt(e,function(e){u.localCandidates=e.localCandidates,u.remoteCandidates=e.remoteCandidates,u.iceCandidatePairs=e.iceCandidatePairs,s.localCandidates=e.localCandidates,s.remoteCandidates=e.remoteCandidates,s.iceCandidatePairs=e.iceCandidatePairs,s.pcState=ot.established,s.fabricSetupSent=!0,s.activeIceCandidatePair=bn(s.iceCandidatePairs),Pt(n,o,r,a.ucID,u,s.pcHash,s.pcCallback)})}},Ln=function(e,t,n){var r={},i=null,o=je[n],a=null;void 0===o&&console.error("sendFabricTransportSwitchEvent: Conference ID not found!"),a=Jt(n,e),null===a&&console.error("sendFabricTransportSwitchEvent: fabricData is null"),i=a.remoteUserID,r.prevPair=a.activeIceCandidatePair,Yt(e,function(e){r.currPair=bn(e.iceCandidatePairs),a.activeIceCandidatePair=r.currPair,r.switchDelay=null,r.relayType=a.transportData.relayType,Pt(t,i,n,o.ucID,r,a.pcHash,a.pcCallback)})},Mn=function(e,t){if(e.trackStats){var n=e.trackStats.filter(function(e){return e.id===t});if(n.length>0)return n[0]}},jn=function(e,t){if(e.codec){var n=e.codec.filter(function(e){return e.id===t});if(n.length>0)return n[0]}},Fn=function(e,t){if(e.candidatePair){var n=e.candidatePair.filter(function(e){return e.id===t});if(n.length>0)return n[0]}},Un=function(e){for(var t,n,r=e.Transport.length,i=0;i<r;i++)n=e.Transport[i],n.selectedCandidatePairId&&(t=Fn(e,n.selectedCandidatePairId))&&(e.Transport[i]=C(e.Transport[i],t));return e},Hn=function(e){for(var t,n,r,i=e.streams.length,o=0;o<i;o++)t=e.streams[o],t.data.trackId&&(n=Mn(e,t.data.trackId))&&(e.streams[o].data=C(e.streams[o].data,n)),t.data.codecId&&(r=jn(e,t.data.codecId))&&(e.streams[o].data=C(e.streams[o].data,r));return e},Bn=function(e,t,n){t.hasOwnProperty(e)&&(t[e].hasOwnProperty("video")&&(t[e].video.isGreaterBetter?(n.video.gThreshold=t[e].video.upperThreshold,n.video.rThreshold=t[e].video.lowerThreshold):(n.video.gThreshold=t[e].video.lowerThreshold,n.video.rThreshold=t[e].video.upperThreshold)),t[e].hasOwnProperty("audio")&&(t[e].audio.isGreaterBetter?(n.audio.gThreshold=t[e].audio.upperThreshold,n.audio.rThreshold=t[e].audio.lowerThreshold):(n.audio.gThreshold=t[e].audio.lowerThreshold,n.audio.rThreshold=t[e].audio.upperThreshold)))},Gn=function(e,n,r){var i=[],o=null,a=null;for(var s in n)n.hasOwnProperty(s)&&i.push(encodeURIComponent(s)+"="+encodeURIComponent(n[s]));var c=i.join("&"),u=new XMLHttpRequest;u.open("POST",e),u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o=t(),u.onload=function(){a=t(),r(u,a-o)},u.send(c)},Jn=function(){bt(te,null,5e3,function(e){if(200===e.status)try{var t=JSON.parse(e.responseText);Bn("eModelThreshold",t,pt),Bn("throughputThreshold",t,ct),Bn("fractionalLossThreshold",t,dt),Bn("rttThreshold",t,lt),Bn("currOverPrevFrameRateThreshold",t,ut)}catch(e){return e}},function(){Ue&&Vn()})},Vn=function e(){var n=X+"clockSync",r=null,i=null;bt(n,null,5e3,function(n,o){200===n.status?(r=JSON.parse(n.response),i=t(),Wn(r,o,i)):Ue&&setTimeout(function(){e()},100)},function(){Ue&&e()})},Wn=function(e,t,n){if(Ue){var r=t/2;if(r>Fe.maxAllowedLatency)Fe.offsetResults=[],St(oe,ae,"log",{msg:"clockSync restarting"});else{var i=e.now+r,o=i-n;Fe.offsetResults.push(o)}if(Fe.offsetResults.length>=Fe.syncAttempts){var a=Fe.offsetResults.reduce(function(e,t){return e+t});Fe.currentOffset=a/Fe.offsetResults.length,Fe.offsetResults=[],Ue=!1,St(oe,ae,"log",{msg:"clockSync Done"}),Re.sendCachedUserJoinedEvents(De),Re.sendCachedEvents(De,Ue)}else Ue&&setTimeout(function(){Vn()},100)}},qn=function(){var e=this,n=null,r=!1,i=!1,o={},a={initiated:"initiated",connected:"connected",closed:"closed"};this._wsConnectionState=a.closed;var s=function(e,t){try{if(window&&window.sessionStorage){var n=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));n||(n={}),n[e]||(n[e]={}),n[e].ucID=t,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(n))}}catch(e){return}o[e]="https://dashboard.callstats.io/apps/"+oe+"/conferences/"+encodeURIComponent(e)+"/"+t+"/general"};this.getConferenceURL=function(){return o},this._setupWebSocketConnection=function(o){return e._wsConnectionState===a.initiated||e._wsConnectionState===a.connected?(St(oe,ae,"log",{msg:"### _setupWebSocketConnection is called when already connected!"}),console.log("### _setupWebSocketConnection is called when already connected!"),void(o&&o(Qe.success,"WebSocket establishment successful."))):(e._wsConnectionState=a.initiated,n=new WebSocket(ee,"echo-protocol"),n.onopen=function(){console.log("**** Successfully connected to the backend ",i,ae),St(oe,ae,"log",{msg:"Successfully connected to the backend"}),e._wsConnectionState=a.connected,r?i=!0:r=!0,Fe.syncHandler||(St(oe,ae,"log",{msg:"start clockSync"}),Fe.offsetResults=[],Vn(),Fe.syncHandler=!0),Re.sendCachedUserJoinedEvents(De),i&&(H(),Re.sendCachedEvents(De,Ue)),i=!1},n.onclose=function(){e._wsConnectionState=a.closed,console.log("**** Connection to the server closed."),St(oe,ae,"log",{msg:"Connection to the server closed."}),L(),Ue&&(Fe.offsetResults=[],Fe.syncHandler=null,Ue=!1),n&&(n=null),o&&o(Qe.httpError,"Connection to the server closed.")},n.onerror=function(t){e._wsConnectionState=a.closed,St(oe,ae,"log",{msg:"WebSocket establishment failed."}),console.log("WebSocket establishment failed.",t),o&&o(Qe.wsChannelFailure,"WebSocket establishment failed.",t)},void(n.onmessage=function(e){var n,r=e.data,i=t(),a=JSON.parse(r);if("Error"===a.status)"Invalid client token."===a.reason&&(De.tokenData=null,De.authToken=null,De.sendAuthenticationRequest(oe,ae)),o&&o(Qe.csProtoError,r.reason);else if("200 OK"===a.status)if("feedback"===a.event)yt("feedback");else if(a.event===qe.userJoined||a.event===qe.refreshPresence){var c=!1,u=null;n=decodeURIComponent(a.conferenceID),je.hasOwnProperty(n)&&(je[n].ucID!==a.ucID&&(c=!0,s(n,a.ucID),u=a.conferenceCreationTS?a.conferenceCreationTS:a.conferenceDuration),a.event!==qe.userJoined||je[n].refreshPresence||(je[n].refreshPresence=function(e){return setInterval(function(){Nt(e)},Te)}(n),K()),je[n].ucID=a.ucID),Re.sendCachedFeedback(),Re.sendCachedEvents(De,Ue,c,u,n,a.ucID)}else a.event===Ke.clockSync?Wn(a,i):a.event===We.fabricSetupFailed&&(n=decodeURIComponent(a.conferenceID),a.ucID&&(s(n,a.ucID),Re.sendCachedFeedback(),Re.sendCachedEvents(De,Ue,!0,0,n,a.ucID)))}))},this._isChannelReady=function(){return!(!n||1!==n.readyState)},this.getWSConnectionState=function(){return n?n.readyState:-1},this.send=function(e){n.send(JSON.stringify(e))}},Kn=new qn,zn=function(e,t,n){if(Kn._isChannelReady())try{Kn.send(t)}catch(r){r&&"InvalidStateError"===r.name&&Re.cacheEvent({channel:e,data:t,callback:n})}else Re.cacheEvent({channel:e,data:t,callback:n}),Kn._setupWebSocketConnection()};return function(){navigator&&"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(e){Le=e})}(),function(){if(null===(ce=gt("endpointID"))){var e=t(),n=Math.random()*e;sn(n.toString(),function(e){ce=e,vt("endpointID",ce)})}}(),function(){Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,i=arguments[1],o=0;o<r;o++)if(t=n[o],e.call(i,t,o,n))return t}})}(),window&&!window.csioproxy&&(Ce=!0,Jn(),Vn()),window&&window.csioChromeLegacyGetStats&&(Ee=!1),{version:Z,initialize:jt,on:Ut,fabricEvent:We,addNewFabric:gn,sendFabricEvent:Zt,sendUserFeedback:cn,associateMstWithUserID:un,csError:Qe,fabricUsage:et,qualityRating:nt,webRTCFunctions:at,reportError:rn,reportUserIDChange:yn,userIDType:tt,setProxyConfig:vn,callStatsAPIReturnStatus:$e,setIdentifiers:mn,transmissionDirection:Ze,endpointType:Ye}}o=[],i=r,void 0!==(a="function"==typeof i?i.apply(t,o):i)&&(e.exports=a),e.exports=r}("undefined"!=typeof window&&window)}).call(t,n(20))},function(e,t,n){"use strict";function r(){}r.prototype.measureAppLoadingPerformance=function(e){var t=0,n=Number.MAX_VALUE,r=0,i="",o="",a=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{support:"none",total:void 0};var s=a.timing.loadEventEnd-a.timing.navigationStart;if("Chrome"===e.name||"Opera"===e.name){var c,u=a.getEntriesByType("resource");for(c=0;c<u.length;c++)u[c].duration>r&&(o=u[c].name.substr(u[c].name.lastIndexOf("/")+1),r=u[c].duration),u[c].duration<n&&(i=u[c].name.substr(u[c].name.lastIndexOf("/")+1),n=u[c].duration),u[c].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(t=u[c].duration);return{support:"full",callstats:t,min:{name:i,time:n},max:{name:o,time:r},total:s}}return"Firefox"===e.name?{support:"limited",total:s}:void 0},r.prototype.detectBrowserInfo=function(){var e="Chrome",t=null,n=null,r=null,i={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"},o=i.goog;if(!window.navigator.userAgent||window.csioReactNative)return console.log("Invalid userAgent"),window&&window.csioGetOsName&&(t=window.csioGetOsName()),window&&window.csioGetOsVer&&(n=window.csioGetOsVer()),window&&window.csioReactNative&&(r="react-native"),{name:e,codebase:o,os:t,osVersion:n,userAgent:r};r=navigator.userAgent;var a,s=r.toLowerCase(),c=navigator.appVersion,u=""+parseFloat(navigator.appVersion);-1!==(a=s.indexOf("opera"))?(e="Opera",u=s.substring(a+6),-1!==(a=s.indexOf("Version"))&&(u=s.substring(a+8)),o=i.goog):-1!==(a=s.indexOf("opr"))?(e="Opera",u=s.substring(a+4),-1!==(a=s.indexOf("Version"))&&(u=s.substring(a+8)),o=i.goog):-1!==(a=s.indexOf("msie"))?(e="Microsoft Internet Explorer",u=s.substring(a+5),o=i.goog):-1!==(a=s.indexOf("edge"))?(e=i.edge,u=s.substring(a+5),o=i.edge):-1!==(a=s.indexOf("chrome"))?(e=i.goog,u=s.substring(a+7),o=i.goog):-1!==(a=s.indexOf("safari"))?(e="Safari",u=s.substring(a+7),-1!==(a=s.indexOf("version"))&&(u=s.substring(a+8)),o=i.goog):-1!==(a=s.indexOf("firefox"))?(e="Firefox",u=s.substring(a+8),o=i.moz):-1!==(a=s.indexOf("trident"))&&(e="Microsoft Internet Explorer",a=s.indexOf("rv"),u=s.substring(a+3,a+7),o=i.goog);var l,d,p=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}];for(l in p)if(d=p[l],d.r.test(s)){t=d.s;break}switch(t&&/Windows/.test(t)&&(n=/Windows (.*)/.exec(t)[1],t="Windows"),t){case"Mac OS X":n=/mac os x (10[\.\_\d]+)/.exec(s)[1];break;case"Android":n=/android ([\.\_\d]+)/.exec(s)[1];break;case"iOS":n=/os (\d+)_(\d+)_?(\d+)?/.exec(c),n=n[1]+"."+n[2]+"."+(0|n[3])}return{name:e,ver:u.toString(),os:t,osVersion:n,codebase:o,userAgent:r}},e.exports=r},function(e,t,n){function r(){this.invoker=null,this.receiver=null}function i(){this.listeners=[]}function o(e){this.stats=null,this.lastResponsed=(new Date).getTime(),this.onDataSent=e}function a(e){this.ssrc=null,this.direction=void 0,this.mediaType=null,this.resolution=null,this.frameRateReceived=null,this.frameWidth=null,this.rtt=null,this.droppedFramesNum=null,this.packetLosts=null,this.jitter=null,this.bytesReceived=-1,this.packetsReceived=-1,this.packetsDiscarded=-1,this.bytesSent=-1,this.packetsSent=-1,this.stream=e}function s(e,t){return e.rtt===t.rtt?0:e.rtt<t.rtt?-1:1}function c(e,t){return e.frameHeight===t.frameHeight?0:e.frameHeight<t.frameHeight?-1:1}function u(e,t){return e.frameWidth===t.frameWidth?0:e.frameWidth<t.frameWidth?-1:1}function l(e,t){return e.jitter===t.jitter?0:e.jitter<t.jitter?-1:1}function d(e,t){var n=parseInt(e.frameRateReceived),r=parseInt(t.frameRateReceived);return n===r?0:n<r?-1:1}function p(e,t){return e}function h(){this.codeBase=null,this.mediaType={unknown:"unknown",audio:"audio",video:"video"},this.codeBaseType={chrome:"Chrome",firefox:"Firefox",edge:"Edge"}}function f(e){A.call(this),this.extractorFnc=e,this.prev=0,this.delta=0,this.first=0,this.actual=0,this.addSignalListener(I.Signals.onDataSent,this.onDataSent,this)}function m(e){A.call(this),this.extractorFnc=e,this.prev=null}function v(e,t){this.intervalPacketsRecv=t,this.intervalLoss=e}function g(e,t){var n=e.getValue(),r=t.getValue();return n===r?0:n<r?-1:1}function y(e,t){return new v((e.getIntervalLoss()+t.getIntervalLoss())/2,(e.getIntervalPacketsRecv()+t.getIntervalPacketsRecv())/2)}function b(){this.measurements=new P(I.maxItemsNum,I.timeoutInMs),this.packetLostTracker=new f(function(e){return e.packetLosts}),this.measurements.addPlugin(this.packetLostTracker),this.packetsDiscardedTracker=new f(function(e){return e.packetsDiscarded}),this.measurements.addPlugin(this.packetsDiscardedTracker),this.resolutionTracker=new m(function(e){return e.resolution}),this.measurements.addPlugin(this.resolutionTracker),this.jitter95PercentileTracker=new O(l,95,p),this.measurements.addPlugin(this.jitter95PercentileTracker),this.jitter95PercentileTracker.addFilter(function(e){return void 0!==e.jitter&&null!==e.jitter}),this.rtt95PercentileTracker=new O(s,95,p),this.measurements.addPlugin(this.rtt95PercentileTracker),this.rtt95PercentileTracker.addFilter(function(e){return void 0!==e.rtt&&null!==e.rtt&&0<e.rtt}),this.frameHeight50PercentileTracker=new O(c,50,p),this.measurements.addPlugin(this.frameHeight50PercentileTracker),this.frameHeight50PercentileTracker.addFilter(function(e){return void 0!==e.frameHeight&&null!==e.frameHeight&&0<e.frameHeight}),this.frameHeight95PercentileTracker=new O(c,95,p),this.measurements.addPlugin(this.frameHeight95PercentileTracker),this.frameHeight95PercentileTracker.addFilter(function(e){return void 0!==e.frameHeight&&null!==e.frameHeight&&0<e.frameHeight}),this.frameRate50PercentileTracker=new O(d,50,p),this.measurements.addPlugin(this.frameRate50PercentileTracker),this.frameRate50PercentileTracker.addFilter(function(e){return void 0!==e.frameRateReceived&&null!==e.frameRateReceived}),this.frameRate95PercentileTracker=new O(d,95,p),this.measurements.addPlugin(this.frameRate95PercentileTracker),this.frameRate95PercentileTracker.addFilter(function(e){return void 0!==e.frameRateReceived&&null!==e.frameRateReceived}),this.frameWidth50PercentileTracker=new O(u,50,p),this.measurements.addPlugin(this.frameWidth50PercentileTracker),this.frameWidth50PercentileTracker.addFilter(function(e){return void 0!==e.frameWidth&&null!==e.frameWidth&&0<e.frameWidth}),this.frameWidth95PercentileTracker=new O(u,95,p),this.measurements.addPlugin(this.frameWidth95PercentileTracker),this.frameWidth95PercentileTracker.addFilter(function(e){return void 0!==e.frameWidth&&null!==e.frameWidth&&0<e.frameWidth}),this.rttAvgRTTracker=new D(function(e){return e.rtt}),this.measurements.addPlugin(this.rttAvgRTTracker),this.rttAvgRTTracker.addFilter(function(e){return void 0!==e.rtt&&null!==e.rtt&&0<e.rtt}),this.frameRateMeanTracker=new D(function(e){return e.frameRateReceived}),this.measurements.addPlugin(this.frameRateMeanTracker),this.frameRateMeanTracker.addFilter(function(e){return void 0!==e.frameRateReceived&&null!==e.frameRateReceived&&0<e.frameRateReceived}),this.frameHeightMeanTracker=new D(function(e){return e.frameHeight}),this.measurements.addPlugin(this.frameHeightMeanTracker),this.frameHeightMeanTracker.addFilter(function(e){return void 0!==e.frameHeight&&null!==e.frameHeight&&0<e.frameHeight}),this.frameWidthMeanTracker=new D(function(e){return e.frameWidth}),this.measurements.addPlugin(this.frameWidthMeanTracker),this.frameWidthMeanTracker.addFilter(function(e){return void 0!==e.frameHeight&&null!==e.frameWidth&&0<e.frameWidth}),this.jitterAvgTracker=new D(function(e){return e.jitter}),this.measurements.addPlugin(this.jitterAvgTracker),this.jitterAvgTracker.addFilter(function(e){return void 0!==e.jitter&&null!==e.jitter&&0<e.jitter}),this.intervalFractionLosts=new P(I.maxItemsNum,I.timeoutInMs),this.FLPercentileTracker=new O(g,95,y),this.intervalFractionLosts.addPlugin(this.FLPercentileTracker),this.lastSent=0,this.firstAdded=0,this.lastAdded=0,this.doSending=!1,this.mediaType=null,this.direction=null,this.lastTraffic=0}function _(){b.call(this),this.bytesReceivedTracker=new f(function(e){return e.bytesReceived}),this.packetsReceivedTracker=new f(function(e){return e.packetsReceived}),this.addPlugin(this.bytesReceivedTracker),this.addPlugin(this.packetsReceivedTracker),this.csioIntBRKbpsCount=0,this.csioIntPRCount=0}function S(){_.call(this),this.quality={eModel:0,bandwidth:0},this.direction=a.Direction.inbound,this.mediaType=a.MediaTypes.audio}function T(){_.call(this),this.frameRateReceivedTracker=new f(function(e){return e.frameRateReceived}),this.frameRatePercTracker=new O(d,10,p),this.frameRatePercTracker.addFilter(function(e){return void 0!==e.frameRateReceived&&null!==e.frameRateReceived}),this.frameRatePercTracker.attach(this.setFrameRateReceived10,this),this.frameRateReceived10=null,this.addPlugin(this.frameRatePercTracker),this.addPlugin(this.frameRateReceivedTracker),this.quality={eModel:0,bandwidth:0,frameRate:0},this.direction=a.Direction.inbound,this.mediaType=a.MediaTypes.video}function C(){b.call(this),this.bytesSentTracker=new f(function(e){return e.bytesSent}),this.packetsSentTracker=new f(function(e){return e.packetsSent}),this.addPlugin(this.bytesSentTracker),this.addPlugin(this.packetsSentTracker),this.csioIntBRKbpsCount=0,this.csioIntPRCount=0}function E(){C.call(this),this.frameRateReceivedTracker=new f(function(e){return e.frameRateReceived}),this.frameRatePercTracker=new O(d,10,p),this.frameRatePercTracker.addFilter(function(e){return void 0!==e.frameRateReceived&&null!==e.frameRateReceived}),this.frameRatePercTracker.attach(this.setFrameRateReceived10,this),this.frameRateReceived10=null,this.addPlugin(this.frameRatePercTracker),this.addPlugin(this.frameRateReceivedTracker),this.quality={eModel:0,bandwidth:0,frameRate:0},this.direction=a.Direction.outbound,this.mediaType=a.MediaTypes.video}function w(){C.call(this),this.quality={eModel:0,bandwidth:0},this.direction=a.Direction.outbound,this.mediaType=a.MediaTypes.audio}function R(){this.monitors={},this.assembler=new h,this.sendable=!1,this.inbOneWayAudioDisruption={sent:!1,started:0,hasTrafficTs:0},this.outbOneWayAudioDisruption={sent:!1,started:0,hasTrafficTs:0}}function k(e){this.monitors=new R,this.output=new r,this.lastForwarded=(new Date).getTime(),this.lastInterval=0,this.sentCounter=0,this.nextInterval=0,e.addListener(this.monitors.onDataSent,this.monitors),e.addListener(this.onDataSent,this)}function I(){this.states={Idle:"Idle",Run:"Run"},this.events={OnPolling:"OnPolling",OnStatsRequest:"OnStatsRequest",OnStop:"OnStop",OnStart:"OnStart",OnOneWayAudioDisruptionsRequest:"OnOneWayAudioDisruptionsRequest"},this.onDataSent=new i,this.analyzer=new k(this.onDataSent),this.senderGate=new o(this.onDataSent),this.analyzer.output.connect(this.senderGate.receiver,this.senderGate),this.currentState=this.states.Run}var P=n(72),A=n(31),O=n(74),D=n(77);I.disruptions=[],I.adaptiveSending=!0,I.minMeasurementsNum=20,I.SendingTimeTresholds={max:3e4,min:1e3,regular:5e3},I.maxItemsNum=1e3,I.timeoutInMs=3e5,I.Signals={onDataSent:"onDataSent"},r.prototype={constructor:r,connect:function(e,t){this.invoker=void 0===t?null:t,this.receiver=e},send:function(e){return null===this.receiver?void console.warn("There is no receiver to call"):null===this.invoker?void this.receiver(e):void this.receiver.call(this.invoker,e)}},i.prototype={constructor:i,addListener:function(e,t){this.listeners.push({callback:e,that:t})},notify:function(){for(var e=0;e<this.listeners.length;++e){var t=this.listeners[e];void 0!==t.callback&&null!==t.callback&&(null===t.that?t.callback():t.callback.call(t.that))}}},o.prototype={constructor:o,receiver:function(e){this.stats=e,this.initiate=!1},requestStats:function(){var e=null,t=(new Date).getTime();if(null===this.stats)return null;if(this.initiate&&t-I.SendingTimeTresholds.min<this.lastResponsed)return null;var n=t-this.lastResponsed;return console.log("Elapsed time since last report: "+n),e={streams:this.stats},this.stats=null,this.lastResponsed=t,this.onDataSent.notify(),this.initiate=!0,e}},a.MediaTypes={audio:"audio",video:"video"},a.Direction={inbound:"inbound",outbound:"outbound"},a.prototype={constructor:a,toString:function(){return"Measurement {RTT: "+this.RTT+"; }"}},h.prototype={constructor:h,do:function(e,t){var n=new a(e);if(n.ssrc=e.ssrc,n.mediaType=this.getMediaType(e),n.resolution=this.getResolution(e),n.frameRateReceived=this.getFrameRate(e),n.frameWidth=this.getFrameWidth(e),n.frameHeight=this.getFrameHeight(e),n.rtt=this.getLatencyData(e),n.droppedFramesNum=this.getDroppedFramesNum(e),n.packetLosts=this.getPacketLosts(e),n.jitter=this.getJitter(e),e.streamType===a.Direction.inbound?(n.direction=a.Direction.inbound,n.bytesReceived=this.getBytesReceived(e),n.packetsReceived=this.getPacketsReceived(e),n.packetsDiscarded=this.getPacketsDiscarded(e)):e.streamType===a.Direction.outbound&&(n.direction=a.Direction.outbound,n.bytesSent=this.getBytesSent(e),n.packetsSent=this.getPacketsSent(e)),void 0!==t&&!0===t){n.rawdats={};for(var r in e.data)e.data.hasOwnProperty(r)&&(n.rawdats[r]=e.data[r])}return n},setupCodeBase:function(e){this.codeBase=e},getBytesSent:function(e){if(void 0===e.data.bytesSent)return 0;var t=this.checkForNan(parseInt(e.data.bytesSent,10));return null!==t?t:0},getBytesReceived:function(e){if(void 0===e.data.bytesReceived)return 0;var t=this.checkForNan(parseInt(e.data.bytesReceived,10));return null!==t?t:0},getPacketsReceived:function(e){if(void 0===e.data.packetsReceived)return 0;var t=this.checkForNegativeValue(parseInt(e.data.packetsReceived,10));return null!==t?t:0},getPacketsSent:function(e){if(void 0===e.data.packetsSent)return 0;var t=this.checkForNegativeValue(parseInt(e.data.packetsSent,10));return null!==t?t:0},getPacketsDiscarded:function(e){if(void 0===e.data.discardedPackets)return 0;var t=this.checkForNan(parseInt(e.data.discardedPackets,10));return null!==t?t:0},getPacketLosts:function(e){if(void 0===e.data.packetsLost)return 0;var t=this.checkForNegativeValue(parseInt(e.data.packetsLost,10));return null!==t?t:0},getDroppedFramesNum:function(e){if(void 0===e.data.droppedFrames)return 0;var t=this.checkForNegativeValue(parseInt(e.data.droppedFrames,10));return null!==t?t:0},getFrameRate:function(e){var t;return void 0!==e.data.googFrameRateOutput?t=parseInt(e.data.googFrameRateOutput,10):void 0!==e.data.googFrameRateDecoded?t=parseInt(e.data.googFrameRateDecoded,10):void 0!==e.data.googFrameRateReceived?t=parseInt(e.data.googFrameRateReceived,10):void 0!==e.data.googFrameRateSent?t=parseInt(e.data.googFrameRateSent,10):void 0!==e.data.framerateMean&&(t=parseInt(e.data.framerateMean,10)),void 0!==t&&(t=isNaN(t)||t<0?null:t),t},getFrameHeight:function(e){var t;return void 0!==e.data.googFrameHeightReceived?t=e.data.googFrameHeightReceived:void 0!==e.data.googFrameHeightSent?t=e.data.googFrameHeightSent:void 0!==e.data.frameHeight&&(t=e.data.frameHeight),t},getJitter:function(e){if(void 0!==e){var t;return void 0!==e.data.googJitterReceived?(t=this.checkForNan(parseInt(e.data.googJitterReceived,10)),t?t/1e3:t):this.codeBase===this.codeBaseType.chrome&&void 0!==e.data.jitter?(t=this.checkForNan(parseInt(e.data.jitter,10)),t?t/1e3:t):this.codeBase===this.codeBaseType.firefox&&void 0!==e.data.jitter?this.checkForNan(parseInt(e.data.jitter,10)):void 0}},getResolution:function(e){var t,n,r,i="unavailable";return t=this.getFrameRate(e),r=this.getFrameWidth(e),n=this.getFrameHeight(e),void 0!==t&&void 0!==r&&void 0!==n&&r>0&&n>0&&(i=r.concat("x",n,"@",t)),i},getFrameWidth:function(e){var t;return void 0!==e.data.googFrameWidthReceived?t=e.data.googFrameWidthReceived:void 0!==e.data.googFrameWidthSent?t=e.data.googFrameWidthSent:void 0!==e.data.frameWidth&&(t=e.data.frameWidth),t},validateRTT:function(e){return isNaN(e)||e<0?null:e},getLatencyData:function(e){return void 0===e?null:void 0!==e.data.googRtt?this.validateRTT(parseInt(e.data.googRtt,10)):void 0!==e.data.roundTripTime?this.validateRTT(parseInt(e.data.roundTripTime,10)):void 0!==e.data.mozRtt?this.validateRTT(parseInt(e.data.mozRtt,10)):null},getMediaType:function(e){var t=this.mediaType.unknown;if(void 0!==e)return e.data&&void 0!==e.data.mediaType?e.data.mediaType:(e.data.mediaType?t=e.data.mediaType:void 0!==e.data.googFrameRateReceived||void 0!==e.data.googFrameRateSent?t=this.mediaType.video:void 0!==e.data.audioInputLevel||void 0!==e.data.audioOutputLevel||void 0!==e.data.audioLevel?t=this.mediaType.audio:void 0!==e.data.framerateMean&&(t=this.mediaType.video),t)},checkForNan:function(e){return isNaN(e)?null:e},checkForNegativeValue:function(e){if(null!==(e=this.checkForNan(e)))return e<0?null:e},toString:function(){return"ToString function is not defined. for this object"}},f.prototype=Object.create(A.prototype),f.prototype.constructor=f,f.prototype.onDataSent=function(){this.prev=this.actual},f.prototype.getActual=function(){return this.actual},f.prototype.getFirst=function(){return this.first},f.prototype.getDelta=function(){return this.delta=this.actual-this.prev,this.delta},f.prototype.getPrevious=function(){return this.prev},f.prototype.add=function(e){var t=this.extractorFnc(e);if(void 0!==t&&null!==t){if(0===this.first)return this.first=t,void(this.actual=t);this.actual=t,this.notify({last:this.prev,delta:this.delta})}},f.prototype.remove=function(){},m.prototype=Object.create(A.prototype),m.prototype.constructor=m,m.prototype.add=function(e){void 0!==e&&null!==e&&(this.prev=this.extractorFnc(e))},m.prototype.remove=function(){},m.prototype.getPrevious=function(){return this.prev},v.prototype={constructor:v,getIntervalLoss:function(){return this.intervalLoss},getIntervalPacketsRecv:function(){return this.intervalPacketsRecv},getValue:function(){return void 0===this.intervalPacketsRecv||void 0===this.intervalLoss?null:null===this.intervalPacketsRecv||null===this.intervalLoss?null:0===this.intervalLoss&&0===this.intervalPacketsRecv?0:this.intervalLoss/(this.intervalPacketsRecv+this.intervalLoss)}},b.VideoThroughputThresholds={green:1024,red:256},b.AudioThroughputThresholds={green:30,red:8},b.FrameRateRatioTresholds={green:.8,red:.3},b.VideoRTTThresholds={green:400,red:1e3},b.VideoFractionLostTreshdolds={green:10,red:50},b.AudioFractionLostTresholds={green:15,red:30},b.AudioEModelTresholds={green:240,red:400},b.avQualityRating={excellent:3,fair:2,bad:1},b.avQualityRatingString={excellent:"excellent",fair:"fair",bad:"bad"},b.prototype={constructor:b,doStart:function(){return!0},getStartTime:function(){return this.firstAdded},hasTraffic:function(){var e=this.getLastMeasurement();return this.direction===a.Direction.inbound?0<e.bytesReceived:this.direction===a.Direction.outbound&&0<e.bytesSent},getTotalTimeInMs:function(){return 0===this.firstAdded?0:this.lastAdded-this.firstAdded},getDeltaTimeInMs:function(){return 0===this.lastSent?this.lastAdded-this.firstAdded:this.lastAdded-this.lastSent},getLastMeasurement:function(){return this.measurements.getLast()},add:function(e){var t=(new Date).getTime();if(0===this.firstAdded){if(!this.doStart(e))return;this.firstAdded=t}this.lastAdded=t,this.measurements.add(e)},requestSending:function(){this.doSending=!0},setIntBRAndPR:function(e,t,n){var r=this.getDeltaTimeInMs(),i=Math.max(I.SendingTimeTresholds.min,r),o=8*e.getDelta()/i,a=t.getDelta()/(i/1e3);n.data.csioIntBRKbps=o,n.data.csioIntPR=a,0<o?this.csioIntBRKbpsCount=10:0<this.csioIntBRKbpsCount&&(--this.csioIntBRKbpsCount,this.requestSendingIf(1e3<r&&this.csioIntPRCount<5,"OutboundMonitor csioIntBRKbps is 0 and this is the reason for sending")),0<a?this.csioIntPRCount=10:0<this.csioIntPRCount&&(--this.csioIntPRCount,this.requestSendingIf(1e3<r&&this.csioIntPRCount<5,"OutboundMonitor csioIntPR is 0 and this is the reason for sending: "))},requestSendingIf:function(e,t){this.doSending=this.doSending||e},getAvgRTT:function(){return this.rttAvgRTTracker.getResult()},getResolution:function(){return this.resolutionTracker.getPrevious()},percentileTrackerExtractor:function(e,t,n){var r=null,i=e.getResult();return null===i?n:(r=t(i.actual),null===r?n:r)},getRTT95:function(){var e=this.percentileTrackerExtractor(this.rtt95PercentileTracker,function(e){return e.rtt},null),t=this.getLastMeasurement();if(null!==t&&null!==e){var n=Math.max(.1*e,100);this.requestSendingIf(e+n<t.rtt,"RTT95 the reason of sending "+e+" < "+t.rtt)}return e},getJitter95:function(){var e=this.percentileTrackerExtractor(this.jitter95PercentileTracker,function(e){return e.jitter},null),t=this.getLastMeasurement();if(null!==t){var n=Math.max(.1*e,10);this.requestSendingIf(e+n<t.jitter,"Jitter95 the reason of sending "+e+" < "+t.jitter)}return this.result},getFrameRateMean:function(){return this.frameRateMeanTracker.getResult()},getFrameWidth50Percentile:function(){return this.percentileTrackerExtractor(this.frameWidth50PercentileTracker,function(e){return e.frameWidth},null)},getFrameWidth95Percentile:function(){return this.percentileTrackerExtractor(this.frameWidth95PercentileTracker,function(e){return e.frameWidth},null)},getFrameHeight50Percentile:function(){return this.percentileTrackerExtractor(this.frameHeight50PercentileTracker,function(e){return e.frameHeight},null)},getFrameHeight95Percentile:function(){return this.percentileTrackerExtractor(this.frameHeight95PercentileTracker,function(e){return e.frameHeight},null)},getFrameRate50Percentile:function(){return this.percentileTrackerExtractor(this.frameRate50PercentileTracker,function(e){return e.frameRateReceived},null)},getFrameRate95Percentile:function(){return this.percentileTrackerExtractor(this.frameRate95PercentileTracker,function(e){return e.frameRateReceived},null)},getFrameHeightMean:function(){return this.frameHeightMeanTracker.getResult()},getFrameWidthMean:function(){return this.frameWidthMeanTracker.getResult()},getAvgJitter:function(){return this.jitterAvgTracker.getResult()},getQualityEvaluation:function(e,t){if(void 0!==e&&void 0!==t)return null===e||null===e?null:t.green<=e?b.avQualityRating.excellent:t.red<e&&e<t.green?b.avQualityRating.fair:b.avQualityRating.bad},getQualityReverseEvaluation:function(e,t){if(void 0!==e&&void 0!==t)return null===e||null===e?null:t.red<e?b.avQualityRating.bad:t.green<=e&&e<=t.red?b.avQualityRating.fair:b.avQualityRating.excellent},hasData:function(){return this.measurements.refresh(),1<this.measurements.getItemsNum()},addPlugin:function(e){this.measurements.addPlugin(e)},setup:function(e){e.data.csioIntBRKbps=0,e.data.csioAvgBRKbps=0,e.data.csioIntFL=void 0,e.data.csioIntMs=Math.max(I.SendingTimeTresholds.regular,this.getDeltaTimeInMs()),e.data.csioIntPR=void 0,e.data.csioPercentileFl=void 0,e.data.csioAvgJitter=this.getAvgJitter(),e.data.csioAvgRtt=this.getAvgRTT(),e.data.csioPercentileJitter=this.getJitter95(),e.data.csioSig2Latency=this.getRTT95(),e.data.csioTimeElapseMs=this.getTotalTimeInMs(),e.data.csioeM=(null!==this.getRTT95()?this.getRTT95():0)+40,e.data.csiores=this.getResolution(),e.data.csioFrameWidth95Percentile=this.getFrameWidth95Percentile(),e.data.csioFrameWidth50Percentile=this.getFrameWidth50Percentile(),e.data.csioFrameHeight95Percentile=this.getFrameHeight95Percentile(),e.data.csioFrameHeight50Percentile=this.getFrameHeight50Percentile(),e.data.csioFrameRate95Percentile=this.getFrameRate95Percentile(),e.data.csioFrameRate50Percentile=this.getFrameRate50Percentile(),e.data.csioFrameWidthMean=this.getFrameWidthMean(),e.data.csioFrameHeightMean=this.getFrameHeightMean(),e.data.csioFrameRateMean=this.getFrameRateMean()},addIntervalFractionLost:function(e){this.intervalFractionLosts.add(e)},getLastFractionLost:function(){return this.intervalFractionLosts.getLast()},getIntervalFractionLost95:function(){var e,t=this.FLPercentileTracker.getResult();if(null===t)return 0;e=t.actual.getValue();var n=this.getLastFractionLost();if(null!==n&&null!==e){var r=Math.max(.05,n.getValue());this.requestSendingIf(n.getValue()+r<e,"Fraction lost is the reason for sending "+n.getValue()+" "+e)}return e},onDataSent:function(){var e=(new Date).getTime();this.measurements.signalize(I.Signals.onDataSent,null),this.lastSent=e},isValid:function(){for(var e=0;e<arguments.length;e++)if(null===arguments[e]||void 0===arguments[e])return!1;return!0},doSend:function(){if(!1===this.hasData())return!0;var e=this.doSending;return this.doSending=!1,e},getMediaType:function(){return this.mediaType},getDirection:function(){return this.direction}},_.prototype=Object.create(b.prototype),_.prototype.constructor=_,_.prototype.setRTT95=function(e){b.prototype.setRTT95(e)},_.prototype.setup=function(e){b.prototype.setup.call(this,e);var t=new v(this.packetLostTracker.getDelta(),this.packetsReceivedTracker.getDelta());this.addIntervalFractionLost(t),e.data.csioIntPktRcv=this.packetsReceivedTracker.getDelta(),this.setIntBRAndPR(this.bytesReceivedTracker,this.packetsReceivedTracker,e),this.getTotalTimeInMs()>0&&(e.data.csioAvgBRKbps=8*this.bytesReceivedTracker.getPrevious()/this.getTotalTimeInMs()),e.data.csioIntFL=t.getValue(),e.data.csioPercentileFl=this.getIntervalFractionLost95(),e.data.csioeM=(null!==this.getRTT95()?this.getRTT95():0)+40,void 0!==e.data.csioAvgBRKbps&&null!==e.data.csioAvgBRKbps?e.data.csioAvgPacketSize=this.bytesReceivedTracker.getDelta()/this.packetsReceivedTracker.getDelta():e.data.csioAvgPacketSize=null,e.data.csioPktLossPercentage=this.packetLostTracker.getDelta()/this.packetsReceivedTracker.getDelta()*100},S.prototype=Object.create(_.prototype),S.prototype.constructor=S,S.prototype.setup=function(e){_.prototype.setup.call(this,e),e.data.csioMediaType=a.MediaTypes.audio,this.quality.eModel=this.getQualityReverseEvaluation(e.data.csioeM,b.AudioEModelTresholds),this.quality.bandwidth=this.getQualityEvaluation(e.data.csioIntBRKbps,b.AudioThroughputThresholds),e.data.csioMark=this.getQuality()},S.prototype.getQuality=function(){var e=0,t=.5*this.quality.bandwidth+.5*this.quality.eModel;return t=Math.floor(t),t===b.avQualityRating.excellent?e=b.avQualityRatingString.excellent:t===b.avQualityRating.fair?e=b.avQualityRatingString.fair:t===b.avQualityRating.bad&&(e=b.avQualityRatingString.bad),e},T.prototype=Object.create(_.prototype),T.prototype.constructor=T,T.prototype.setFrameRatioQuality=function(){var e=this.frameRateReceivedTracker.getActual(),t=this.frameRateReceivedTracker.getPrevious(),n=0;this.quality.frameRate=0,void 0!==e&&void 0!==t&&null!==e&&null!==t&&0!==t&&(n=e/t,this.quality.frameRate=this.getQualityEvaluation(n,b.FrameRateRatioTresholds))},T.prototype.setFrameRateReceived10=function(e){return null===e?void(this.frameRateReceived10=null):void(this.frameRateReceived10=e.actual)},T.prototype.setup=function(e){_.prototype.setup.call(this,e),e.data.csioMediaType=a.MediaTypes.video,this.setFrameRatioQuality(),this.quality.eModel=this.getQualityReverseEvaluation(e.data.csioeM,b.AudioEModelTresholds),this.quality.bandwidth=this.getQualityEvaluation(e.data.csioIntBRKbps,b.VideoThroughputThresholds),e.data.csioMark=this.getQuality()},T.prototype.getQuality=function(){var e=0,t=.33*this.quality.bandwidth+.33*this.quality.eModel+.33*this.quality.frameRate;return t=Math.floor(t),t===b.avQualityRating.excellent?e=b.avQualityRatingString.excellent:t===b.avQualityRating.fair?e=b.avQualityRatingString.fair:t===b.avQualityRating.bad&&(e=b.avQualityRatingString.bad),e},C.prototype=Object.create(b.prototype),C.prototype.constructor=C,C.prototype.setup=function(e){b.prototype.setup.call(this,e);var t=new v(this.packetLostTracker.getDelta(),this.packetsSentTracker.getDelta());this.addIntervalFractionLost(t),this.setIntBRAndPR(this.bytesSentTracker,this.packetsSentTracker,e),this.getTotalTimeInMs()>0&&(e.data.csioAvgBRKbps=8*this.bytesSentTracker.getPrevious()/this.getTotalTimeInMs()),e.data.csioIntFL=t.getValue(),e.data.csioIntPktRcv=this.packetsSentTracker.getDelta(),e.data.csioPercentileFl=this.getIntervalFractionLost95(),e.data.csioeM=(null!==this.getRTT95()?this.getRTT95():0)+40,void 0!==e.data.csioAvgBRKbps&&null!==e.data.csioAvgBRKbps?e.data.csioAvgPacketSize=this.bytesSentTracker.getDelta()/this.packetsSentTracker.getDelta():e.data.csioAvgPacketSize=null,e.data.csioPktLossPercentage=this.packetLostTracker.getDelta()/this.packetsSentTracker.getDelta()*100},E.prototype=Object.create(C.prototype),E.prototype.constructor=E,E.prototype.setFrameRatioQuality=function(){var e=this.frameRateReceivedTracker.getActual(),t=this.frameRateReceivedTracker.getPrevious(),n=0;this.quality.frameRate=0,void 0!==e&&void 0!==t&&null!==e&&null!==t&&0!==t&&(n=e/t,this.quality.frameRate=this.getQualityEvaluation(n,b.FrameRateRatioTresholds))},E.prototype.setFrameRateReceived10=function(e){return null===e?void(this.frameRateReceived10=null):void(this.frameRateReceived10=e.actual)},E.prototype.setup=function(e){C.prototype.setup.call(this,e),e.data.csioMediaType=a.MediaTypes.video,this.setFrameRatioQuality(),this.quality.eModel=this.getQualityReverseEvaluation(e.data.csioeM,b.AudioEModelTresholds),this.quality.bandwidth=this.getQualityEvaluation(e.data.csioIntBRKbps,b.VideoThroughputThresholds),e.data.csioMark=this.getQuality()},E.prototype.getQuality=function(){var e=0,t=.33*this.quality.bandwidth+.33*this.quality.eModel+.33*this.quality.frameRate;return t=Math.floor(t),t===b.avQualityRating.excellent?e=b.avQualityRatingString.excellent:t===b.avQualityRating.fair?e=b.avQualityRatingString.fair:t===b.avQualityRating.bad&&(e=b.avQualityRatingString.bad),e},w.prototype=Object.create(C.prototype),w.prototype.constructor=w,w.prototype.setEModelQuality=function(e){e<b.AudioEModelTresholds.green?this.quality.eModel=b.avQualityRating.excellent:e>b.AudioEModelTresholds.green&&e<b.AudioEModelTresholds.red?this.quality.eModel=b.avQualityRating.fair:e>b.AudioEModelTresholds.red&&(this.quality.eModel=b.avQualityRating.bad)},w.prototype.setThroughputQuality=function(e){null!==e&&void 0!==e&&(e>b.AudioThroughputThresholds.green?this.quality.bandwidth=b.avQualityRating.excellent:e>b.AudioThroughputThresholds.red&&e<b.AudioThroughputThresholds.green?this.quality.bandwidth=b.avQualityRating.fair:e<b.AudioThroughputThresholds.red&&(this.quality.bandwidth=b.avQualityRating.bad))},w.prototype.setup=function(e){C.prototype.setup.call(this,e),this.setThroughputQuality(e.data.csioIntBRKbps),this.setEModelQuality(e.data.csioeM),e.data.csioMediaType=a.MediaTypes.audio,e.data.csioMark=this.getQuality()},w.prototype.doSend=function(){return this.hasData(),!1},w.prototype.getQuality=function(){var e=0,t=.5*this.quality.bandwidth+.5*this.quality.eModel;return t=Math.floor(t),t===b.avQualityRating.excellent?e=b.avQualityRatingString.excellent:t===b.avQualityRating.fair?e=b.avQualityRatingString.fair:t===b.avQualityRating.bad&&(e=b.avQualityRatingString.bad),e},R.OneWayAudioDisruptionTimeout=5e3,R.AudioDisruptions={inboundOneWayAudio:"inbound-one-way",outboundOneWayAudio:"outbound-one-way"},R.prototype={constructor:R,getMonitor:function(e){var t;if(this.monitors[e.direction]&&(t=this.monitors[e.direction][e.ssrc]),void 0!==t)return this.monitors[e.direction][e.ssrc];var n=e.direction===a.Direction.inbound,r=e.direction===a.Direction.outbound,i=e.mediaType===a.MediaTypes.audio,o=e.mediaType===a.MediaTypes.video;return t=n&&i?new S:r&&i?new w:n&&o?new T:r&&o?new E:null,this.monitors[e.direction]||(this.monitors[e.direction]={}),this.monitors[e.direction][e.ssrc]=t,t},setupCodeBase:function(e){this.assembler.setupCodeBase(e)},isSendable:function(){var e=this.sendable;return this.sendable=!1,e},process:function(e){var t=this.assembler.do(e),n=this.getMonitor(t);return null===n||void 0===n?void console.warn("For ssrc "+t.ssrc+"we do not have monitor"):(n.doSend(t)&&(this.sendable=!0),n.add(t),void n.setup(e))},checkDistortions:function(){var e,t=[],n=[],r=this.monitors[a.Direction.inbound];r&&Object.keys(r).forEach(function(n){e=r[n],e.getMediaType()===a.MediaTypes.audio&&t.push(e)}),r=this.monitors[a.Direction.outbound],r&&Object.keys(r).forEach(function(t){e=r[t],e.getMediaType()===a.MediaTypes.audio&&n.push(e)}),[this.getInbOneWayAudioDisruption(t,n),this.getOutbOneWayAudioDisruption(t,n)].forEach(function(e){e&&I.disruptions.push(e)})},getInbOneWayAudioDisruption:function(e,t){var n=this.inbOneWayAudioDisruption,r=(new Date).getTime();if(n.sent)return null;var i=t.filter(function(e){return 0===e.getStartTime()}).length<1,o=t.filter(function(e){return!e.hasTraffic()}).length<1;return!i||o?null:e.length?e.filter(function(e){return!e.hasTraffic()}).length<1?(n.started=0,null):0===n.started?(n.started=r,null):r-R.OneWayAudioDisruptionTimeout<n.started?null:(n.sent=!0,{type:R.AudioDisruptions.inboundOneWayAudio}):null},getOutbOneWayAudioDisruption:function(e,t){var n=this.outbOneWayAudioDisruption,r=(new Date).getTime();if(n.sent)return null;var i=e.filter(function(e){return 0===e.getStartTime()}).length<1,o=e.filter(function(e){return!e.hasTraffic()}).length<1;return i&&o&&t.length?t.filter(function(e){return!e.hasTraffic()}).length<1?(n.started=0,null):0===n.started?(n.started=r,null):r-R.OneWayAudioDisruptionTimeout<n.started?null:(n.sent=!0,{type:R.AudioDisruptions.outboundOneWayAudio}):null},toString:function(){return"ToString function is not defined. for this object"},onDataSent:function(){for(var e in this.monitors)if(this.monitors.hasOwnProperty(e))for(var t in this.monitors[e])if(this.monitors[e].hasOwnProperty(t)){var n=this.monitors[e][t];null!==n?n.onDataSent():console.warn("A Monitor with ssrc: "+t+" should not be null but it is!")}}},k.prototype={constructor:k,onDataSent:function(){++this.sentCounter},receive:function(e){var t=(new Date).getTime(),n=e.streams,r=e.codeBase;this.monitors.setupCodeBase(r);for(var i=0;i<n.length;++i){var o=n[i];this.monitors.process(o)}this.monitors.checkDistortions();var a=!1;if(!1===I.adaptiveSending)(a=this.lastForwarded+I.SendingTimeTresholds.regular<t)&&(this.output.send(n),this.lastInterval=t-this.lastForwarded,this.lastForwarded=t);else{var s=this.monitors.isSendable();if(0===this.sentCounter?a=!0:this.sentCounter<5?(a=this.lastForwarded+I.SendingTimeTresholds.regular<t,s=!1):a=this.lastForwarded+Math.min(I.SendingTimeTresholds.max,this.nextInterval)<t,a||s)if(this.output.send(n),this.lastInterval=t-this.lastForwarded,this.lastForwarded=t,s)this.lastInterval=Math.max(I.SendingTimeTresholds.min,this.lastInterval/2);else if(a){var c=Math.random()+1;this.nextInterval=Math.min(I.SendingTimeTresholds.max,this.lastInterval*c)}}}},I.prototype={constructor:I,fire:function(e){var t;switch(this.currentState){case this.states.Idle:switch(e){case this.events.OnStart:this.currentState=this.states.Run;break;default:console.warn("Unhandled event "+e+" in "+this.currentState+" mode")}break;case this.states.Run:switch(e){case this.events.OnStop:this.currentState=this.states.Idle;break;case this.events.OnPolling:var n=arguments[1];this.analyzer.receive(n);break;case this.events.OnOneWayAudioDisruptionsRequest:if(void 0===(t=arguments[1])){console.warn("OnStatsRequest event required a parameter to store the response");break}0<I.disruptions.length&&(t.response=I.disruptions,I.disruptions=[]);break;case this.events.OnStatsRequest:if(void 0===(t=arguments[1])){console.warn("OnStatsRequest event required a parameter to store the response");break}t.response=this.senderGate.requestStats();break;default:console.warn("Unhandled event "+e+" in "+this.currentState+" mode")}break;default:console.error("The Reporter machine is in an unkown state: "+this.currentState)}},toString:function(){return"Reporter is in "+this.currentState},setReportingMode:function(e){I.adaptiveSending=!0===e},setSubmissionInterval:function(e){I.SendingTimeTresholds.regular=e,I.adaptiveSending?(I.SendingTimeTresholds.min=1e3,I.SendingTimeTresholds.max=3e4):(I.SendingTimeTresholds.min=e,I.SendingTimeTresholds.max=e)}},e.exports.Reporter=I},function(e,t,n){function r(e,t){this.items=[],this.plugins=[],this.timeoutInMs=t,this.maxItemsNum=e,this.minItemsNum=0,this.last=null}var i=n(73);r.prototype={constructor:r,signalize:function(e,t){for(var n=0;n<this.plugins.length;++n){var r=this.plugins[n];null!==r.signalize&&void 0!==r.signalize?r.signalize.call(r,e,t):console.warn(r)}},toString:function(){return""}},r.prototype.getLast=function(){return this.last},r.prototype.setMaxItemsNum=function(e){this.maxItemsNum=e},r.prototype.setTimeoutInMs=function(e){this.timeoutInMs=e},r.prototype.setMinItemsNum=function(e){this.minItemsNum=e},r.prototype.refresh=function(){if(!(this.items.length<=this.minItemsNum)){for(;0<this.maxItemsNum&&this.maxItemsNum<=this.items.length;)this.remove();0<this.timeoutInMs&&this.timeoutInMs<this.items[0].getElapsed()&&(this.remove(),this.refresh())}},r.prototype.getItemsNum=function(){return this.items.length},r.prototype.add=function(e){this.refresh(),this.items.push(new i(e));for(var t=0;t<this.plugins.length;t++)this.plugins[t].add(e);this.last=e},r.prototype.map=function(e){for(var t=0;t<this.plugins.length;t++)this.plugins[t].map(e)},r.prototype.remove=function(){for(var e=this.items.shift(),t=0;t<this.plugins.length;t++)this.plugins[t].remove(e.value)},r.prototype.foreach=function(e,t){var n=this.items;void 0!==t&&(n=t(n));for(var r=0;r<n.length;r++)e(n[r].value)},r.prototype.addPlugin=function(e){this.plugins.push(e)},e.exports=r},function(e,t){function n(e){this.value=e,this.created=(new Date).getTime()}n.prototype={constructor:n,getElapsed:function(){return(new Date).getTime()-this.created},toString:function(){return""}},e.exports=n},function(e,t,n){function r(e,t,n){if(a.call(this),99<t||t<1)throw new RangeError("Percentile parameter must be between 1 and 99");this.comparator=e,this.percentile=t,this.meanCalcer=void 0===n?function(e,t){return(e+t)/2}:n,this.ratio=t/(100-t),this.maxtree=new o(e),this.mintree=new o(e),this.ratio<1?this.required=1/this.ratio+1:1<this.ratio?this.required=this.ratio+1:this.required=2,this.maxcounter=this.mincounter=0,this.result=null,this.filter=null}var i=n(75),o=n(76),a=n(31);r.prototype=Object.create(a.prototype),r.prototype.constructor=r,r.prototype.addFilter=function(e,t){this.filter={callback:e,that:t}},r.prototype.doFilter=function(e){return null===this.filter||(void 0===this.filter.that||null===this.filter.that?this.filter.callback(e):this.filter.callback.call(this.filter.that,e))},r.prototype.getResult=function(){return this.result},r.prototype.add=function(e){if(this.doFilter(e)){if(this.maxcounter<1)return this.maxtree.insert(e),void++this.maxcounter;this.comparator(e,this.maxtree.getTopValue())<=0?(this.maxtree.insert(e),++this.maxcounter):(this.mintree.insert(e),++this.mincounter),this.balancing(),this.calculate()}},r.prototype.remove=function(e){if(this.doFilter(e)){if(this.maxtree.delete(e))--this.maxcounter;else{if(!this.mintree.delete(e))throw new ReferenceError("The requested value "+e+" is not found in trees");--this.mincounter}this.balancing(),this.calculate()}},r.prototype.balancing=function(){var e=function(){for(var e=(this.maxcounter+1)/(this.mincounter-1);;e=(this.maxcounter+1)/(this.mincounter-1)){if(this.ratio<e||this.mincounter<1)return;this.maxtree.insertByTop(this.mintree.deleteBottomValue()),++this.maxcounter,--this.mincounter}},t=function(){for(var e=(this.maxcounter-1)/(this.mincounter+1);;e=(this.maxcounter-1)/(this.mincounter+1)){if(e<this.ratio||this.maxcounter<1)return;this.mintree.insertByBottom(this.maxtree.deleteTopValue()),++this.mincounter,--this.maxcounter}};if(!(this.maxcounter+this.mincounter<this.required)){if(this.mincounter<1)return void t.call(this);if(this.maxcounter<1)return void e.call(this);var n=this.maxcounter/this.mincounter;this.ratio<n?t.call(this):e.call(this)}},r.prototype.calculate=function(){var e,t,n=new i,r=null,o=this.mincounter+this.maxcounter;if(!(o<1)){if(this.mincounter<1?(t=this.maxtree.getTopValue(),e=this.maxtree.getBottomValue()):this.maxcounter<1?(t=this.mintree.getTopValue(),e=this.mintree.getBottomValue()):(t=this.mintree.getTopValue(),e=this.maxtree.getBottomValue()),n.min=e,n.max=t,n.tracked=o,o<this.required||this.mincounter<1)return r=this.ratio<1?e:1<this.ratio?t:this.meanCalcer(e,t),n.actual=r,n.estimated=!0,this.result=n,void this.notify(this.result);var a=this.maxcounter/this.mincounter;r=this.ratio<a?this.maxtree.getTopValue():a<this.ratio?this.mintree.getBottomValue():this.meanCalcer(this.mintree.getBottomValue(),this.maxtree.getTopValue()),n.actual=r,this.result=n,this.notify(this.result)}},r.prototype.map=function(e){this.mapping(this.result.actual,e)},e.exports=r},function(e,t){function n(){this.estimated=!1,this.tracked=0,this.max=this.min=this.actual=null}n.prototype={constructor:n,toString:function(){return"Tracked: "+this.tracked+" Estimated: "+this.estimated+" Min: "+this.min+" Max: "+this.max+" Actual: "+this.actual}},e.exports=n},function(e,t){function n(e){this.value=[],this.value.push(e),this.left=null,this.right=null}function r(e){this.root=null,this.top=null,this.bottom=null,this.comparator=e,this.node_counter=0,this.duplicate_counter=0}n.prototype={constructor:n,toString:function(){return this.value.toString()}},r.prototype={constructor:r},r.prototype.getTop=function(){return this.top},r.prototype.getTopValue=function(){return null===this.top?null:this.top.value[0]},r.prototype.getBottomValue=function(){return null===this.bottom?null:this.bottom.value[0]},r.prototype.getBottom=function(){return this.bottom},r.prototype.getDuplicatedCounter=function(){return this.duplicate_counter},r.prototype.getNodeCounter=function(){return this.node_counter},r.prototype.getSize=function(){return this.duplicate_counter+this.node_counter},r.prototype.logTree=function(){function e(t,n,r){if(null!==t){for(var i="-",o=0;o<n;++o)i+="--";console.log(i+"> ("+r+") values: ["+t.value.toString()+"]"),null!==t.left&&e(t.left,n+1,"Left"),null!==t.right&&e(t.right,n+1,"Right")}}return null===this.root?void console.log("This tree is empty"):(console.log("Size of the tree: "+this.getSize()+" Node: "+this.getNodeCounter()+" Duplicates: "+this.getDuplicatedCounter()+" Top: "+this.getTop().toString()+" Bottom: "+this.getBottom().toString()),void e(this.root,0,"Root"))},r.prototype.insertByTop=function(e){this.inserting(e,this.top)},r.prototype.insertByBottom=function(e){this.inserting(e,this.bottom)},r.prototype.insert=function(e){this.inserting(e,this.root)},r.prototype.inserting=function(e,t){var r=function(){var t=new n(e);return(null===this.top||this.comparator(this.top.value[0],t.value[0])<0)&&(this.top=t),(null===this.bottom||this.comparator(t.value[0],this.bottom.value[0])<0)&&(this.bottom=t),t};if(null===this.root)return this.root=r.call(this),void(this.node_counter=1);for(var i=null,o=t,a=0,s=function(t){return t===e};null!==o;){if(0===(a=this.comparator(e,o.value[0])))return void(o.value.find(s)||(o.value.push(e),++this.duplicate_counter));i=o,o=a<0?o.left:o.right}++this.node_counter,a<0?i.left=r.call(this):i.right=r.call(this)},r.prototype.search=function(e){for(var t,n=this.root,r=null,i=function(t){return t===e};null!==n;){if(0===(t=this.comparator(e,n.value[0])))return n.value.find(i)?(n.parent=r,n):null;r=n,n=t<0?n.left:n.right}return null},r.prototype.getRightist=function(e){for(var t=null;null!==e.right;)t=e,e=e.right;return e.parent=t,e},r.prototype.getLeftist=function(e){for(var t=null;null!==e.left;)t=e,e=e.left;return e.parent=t,e},r.prototype.deleteBottomValue=function(){for(;null===this.bottom;)return null;var e=this.bottom.value[0];return this.delete(e),e},r.prototype.deleteTopValue=function(){for(;null===this.top;)return null;var e=this.top.value[0];return this.delete(e),e},r.prototype.delete=function(e){var t=null,n=function(e,t,n){null!==t?t.left===e?t.left=n:t.right=n:this.root=n},r=function(e){return null===this.root?void(this.bottom=this.top=null):(0===this.comparator(this.top.value[0],e.value[0])&&(this.top=this.getRightist(this.root)),void(0===this.comparator(this.bottom.value[0],e.value[0])&&(this.bottom=this.getLeftist(this.root))))};if(null===(t=this.search(e)))return!1;if(1<t.value.length)return t.value.splice(t.value.indexOf(e),1),--this.duplicate_counter,!0;if(--this.node_counter,null===t.left&&null===t.right)n.call(this,t,t.parent,null);else if(null===t.left)n.call(this,t,t.parent,t.right);else if(null===t.right)n.call(this,t,t.parent,t.left);else{for(var i=t.left,o=t;null!==i.right;o=i,i=i.right);o===t?o.left=i.left:o.right=i.left,t.value.shift(),t.value=t.value.concat(i.value)}return r.call(this,t),!0},e.exports=r},function(e,t,n){function r(e){i.call(this),this.avg=0,this.sum=0,this.count=0,this.filter=null,this.extractor=void 0===e?function(e){return e}:e}var i=n(31);r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.add=function(e){(null===this.filter||void 0===this.filter||this.filter(e))&&(this.sum+=parseInt(this.extractor(e)),++this.count,this.calc(this))},r.prototype.addFilter=function(e){this.filter=e},r.prototype.remove=function(e){(null===this.filter||void 0===this.filter||this.filter(e))&&(this.sum-=parseInt(this.extractor(e)),--this.count,this.calc(this))},r.prototype.calc=function(){this.count<1||(this.avg=this.sum/this.count,this.notify(this.avg))},r.prototype.getResult=function(){return this.avg},e.exports=r},function(e,t){function n(e,t,n,r,i){this.pc=e,this.onIceCandidateCallback=t,this.onIceConnectionStateChangeCallback=n,this.onPcSignalingStateChangeCallback=r,this.onPcNegotiationNeededCallback=i,e.addEventListener?(this.pc.addEventListener("icecandidate",this.iceCandidateCallback.bind(this),!1),this.pc.addEventListener("iceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this),!1),this.pc.addEventListener("signalingstatechange",this.pcSignalingStateChangeCallback.bind(this),!1),this.pc.addEventListener("negotiationneeded",this.pcNegotiationNeededCallback.bind(this),!1)):e.attachEvent&&(this.pc.attachEvent("onicecandidate",this.iceCandidateCallback.bind(this)),this.pc.attachEvent("oniceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this)),this.pc.attachEvent("onsignalingstatechange",this.pcSignalingStateChangeCallback.bind(this)),this.pc.attachEvent("onnegotiationneeded",this.pcNegotiationNeededCallback.bind(this)))}n.prototype.iceCandidateCallback=function(e){try{this.onIceCandidateCallback(e,this.pc)}catch(e){console.log("onIceCandidateCallback: Error",e)}},n.prototype.iceConnectionStateChangeCallback=function(e){try{this.onIceConnectionStateChangeCallback(e,this.pc)}catch(e){console.log("onIceConnectionStateChangeCallback: Error",e)}},n.prototype.pcSignalingStateChangeCallback=function(e){try{this.onPcSignalingStateChangeCallback(e,this.pc)}catch(e){console.log("onPcSignalingStateChangeCallback: Error",e)}},n.prototype.pcNegotiationNeededCallback=function(e){try{this.onPcNegotiationNeededCallback(e,this.pc)}catch(e){console.log("onPcNegotiationNeededCallback: Error",e)}},e.exports=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.PreCallTest=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(80),a=n(85),s=n(86),c=n(87),u=n(88),l=n(23),d=n(24),p={RTT:"rtt",THROUGHPUT:"throughput"},h=function(){function e(){r(this,e),this.browserInfo=(0,l.detect)(),this.turnConnection=new o.TurnConnection(this.browserInfo),this.onlineCheck=new u.OnlineCheck,this.callsInProgress=0,this.turnTests=[p.RTT,p.THROUGHPUT],this.active=!1,this.rtt=null,this.resultsHandler=null}return i(e,[{key:"start",value:function(e,t){if(this.browserInfo.browserName!==l.Constants.browserName.msie&&(!window||!window.csioReactNative)&&(this.iceServers=e,this.callback=t,!this.active&&!(this.callsInProgress>0)&&e)){this.turnTestCounter=0,this.resultsHandler=new c.ResultsHandler;var n={type:"browser",os:this.browserInfo.os,osVersion:this.browserInfo.osVersion,buildName:this.browserInfo.browserName,buildVersion:this.browserInfo.browserVersion};this.resultsHandler.add("endpointInfo",n),this.onlineCheck.start(),this.active=!0,this._start()}}},{key:"_start",value:function(){var e=this;this.active&&this.turnConnection.connect(this.iceServers).then(function(){e.active&&e.startTurnTests().then(function(){e.stop()},function(t){e.stop()})},function(t){e.resultsHandler.failure(t),e.resultsHandler.getFailureNumber()>=10?e.stop():(e.turnConnection.disconnect(),setTimeout(function(){e._start()},0))})}},{key:"stop",value:function(){var e=this;if(this.browserInfo.browserName!==l.Constants.browserName.msie&&this.active){this.active=!1,this.activeTurnTest&&this.activeTurnTest.forceStop();var t=this.onlineCheck.stop();this.resultsHandler.add("onlineStatus",t),this.turnConnection.getIceResults().then(function(t){e.resultsHandler.add("ice",t),e.turnConnection.disconnect(),e.sendResults()},function(t){e.resultsHandler.failure(t),e.turnConnection.disconnect(),e.sendResults()})}}},{key:"sendResults",value:function(){var e=this.resultsHandler.getResults();this.callback&&this.callback(e),this.resultsHandler=null}},{key:"callStarts",value:function(){this.callsInProgress+=1,this.stop()}},{key:"callFinished",value:function(){this.callsInProgress-=1}},{key:"getId",value:function(){return this.resultsHandler?this.resultsHandler.getId():null}},{key:"crashDisconnect",value:function(){try{this.turnConnection.disconnect()}catch(e){}}},{key:"startTurnTests",value:function(){var e=this;if(this.turnTestCounter>=this.turnTests.length)return new d(function(e,t){e()});var t=this.turnTests[this.turnTestCounter],n=null;switch(t){case p.RTT:n=new a.RttTest(this.turnConnection);break;case p.THROUGHPUT:n=new s.ThroughputTest(this.turnConnection,this.rtt);break;default:return new d(function(e,n){n(new Error("Unknown test: "+t))})}return this.activeTurnTest=n,this.active?n.start().then(function(){return e.handleTestResults(t,n.getResults()),e.turnTestCounter+=1,e.activeTurnTest=null,e.startTurnTests()},function(r){return e.handleTestResults(t,n.getResults(),r),e.turnTestCounter+=1,e.activeTurnTest=null,e.startTurnTests()}):new d(function(e,t){t(new Error("Test trying to start while testing is not active"))})}},{key:"handleTestResults",value:function(e,t){null==(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)&&e==p.RTT&&(this.rtt=t.median),this.resultsHandler&&this.resultsHandler.add(e,t)}}]),e}();t.PreCallTest=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.TurnConnection=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(81),a=n(82),s=n(23),c=n(24),u=function(){function e(t){r(this,e),this.reset(),this.statshandler=new a.GetStatsHandler(t)}return i(e,[{key:"reset",value:function(){this.iceServers=null,this.pctpc1=null,this.pctpc2=null,this.sendChannel=null,this.messageCallback=null,this.errorCallback=null,this.parsedIceResults={}}},{key:"setMessageCallback",value:function(e){this.messageCallback=e}},{key:"setErrorCallback",value:function(e){this.errorCallback=e}},{key:"send",value:function(e){if(this.sendChannel)try{this.sendChannel.send(e)}catch(e){this.raiseSendError(e)}else this.raiseSendError(new Error("No send channel"))}},{key:"raiseSendError",value:function(e){this.errorCallback&&this.errorCallback(e)}},{key:"assignEvent",value:function(e,t,n){e.addEventListener?e.addEventListener(t,n.bind(this),!1):e.attachEvent&&(t="on"+t,e.attachEvent(t,n.bind(this)))}},{key:"connect",value:function(e){var t=this;this.reset();var n=new c(function(e,n){t.resolveCb=e,t.rejectCb=n});this.iceServers=e;var r=null;try{if(RTCPeerConnection?r=RTCPeerConnection:webkitRTCPeerConnection?r=webkitRTCPeerConnection:mozRTCPeerConnection?r=mozRTCPeerConnection:window&&window.RTCPeerConnection&&(r=window.RTCPeerConnection),!r)return this.rejectCb(new Error("RTCPeerConnection not found")),n}catch(e){return this.rejectCb(e),n}var i={ordered:!1,maxRetransmits:0},o={iceTransportPolicy:"all",iceServers:this.iceServers};try{this.pctpc1=new r(o),this.pctpc2=new r(o)}catch(e){return this.rejectDisconnect(e),n}return this.connectionTimer=setTimeout(function(){delete t.connectionTimer,t.rejectDisconnect(new Error("Connection timeout"))},3e4),this.sendChannel=this.pctpc1.createDataChannel("precalltest",i),this.sendChannel.binaryType="arraybuffer",this.assignEvent(this.sendChannel,"error",function(e){t.raiseSendError(e),t.rejectDisconnect(e)}),this.assignEvent(this.pctpc2,"datachannel",function(e){var n=e.channel;t.assignEvent(n,"open",function(e){t.resolveCb&&t.resolveCb()}),t.assignEvent(n,"close",function(e){t&&t.disconnect&&t.disconnect()}),t.assignEvent(n,"message",function(e){t.messageCallback&&t.messageCallback(e.data)}),t.assignEvent(n,"error",function(e){t.errorCallback&&t.errorCallback(e),t.rejectDisconnect(e)})}),this.assignEvent(this.pctpc1,"icecandidate",function(e){t.onIceCandidate(t.pctpc1,e)}),this.assignEvent(this.pctpc1,"iceconnectionstatechange",function(e){t.onIceStateChange(t.pctpc1,e)}),this.assignEvent(this.pctpc2,"icecandidate",function(e){t.onIceCandidate(t.pctpc2,e)}),this.assignEvent(this.pctpc2,"iceconnectionstatechange",function(e){t.onIceStateChange(t.pctpc2,e)}),this.pctpc1.createOffer().then(function(e,n){t.onCreateOfferSuccess(e)},function(e){t.onCreateOfferError(t.pctpc1,e)}),n}},{key:"rejectDisconnect",value:function(e){this.rejectCb&&(this.rejectCb(e),this.disconnect())}},{key:"disconnect",value:function(){if(clearTimeout(this.connectionTimer),this.pctpc1)try{this.pctpc1.close()}catch(e){}if(this.pctpc1=null,this.pctpc2)try{this.pctpc2.close()}catch(e){}this.pctpc2=null,this.resolveCb=null,this.rejectCb=null}},{key:"getName",value:function(e){return e===this.pctpc1?"pctpc1":"pctpc2"}},{key:"getOtherPc",value:function(e){return e===this.pctpc1?this.pctpc2:this.pctpc1}},{key:"onCreateOfferError",value:function(e,t){this.rejectDisconnect(t)}},{key:"onCreateAnswerError",value:function(e,t){this.rejectDisconnect(t)}},{key:"onCreateOfferSuccess",value:function(e){var t=this;this.pctpc1.setLocalDescription(e).then(function(){t.onSetLocalSuccess(t.pctpc1)},function(e){t.onSetSessionDescriptionError(t.pctpc1,e)}),this.pctpc2.setRemoteDescription(e).then(function(){t.onSetRemoteSuccess(t.pctpc2)},function(e){t.onSetRemoteSessionDescriptionError(t.pctpc2,e)}),this.pctpc2.createAnswer().then(function(e){t.onCreateAnswerSuccess(e)},function(e){t.onCreateAnswerError(t.pctpc2,e)})}},{key:"onSetLocalSuccess",value:function(e){}},{key:"onSetRemoteSuccess",value:function(e){}},{key:"onSetSessionDescriptionError",value:function(e,t){this.rejectDisconnect(t)}},{key:"onSetRemoteSessionDescriptionError",value:function(e,t){this.rejectDisconnect(t)}},{key:"onCreateAnswerSuccess",value:function(e){var t=this;this.pctpc2.setLocalDescription(e).then(function(){t.onSetLocalSuccess(t.pctpc2)},function(e){t.onSetSessionDescriptionError(t.pctpc2,e)}),this.pctpc1.setRemoteDescription(e).then(function(){t.onSetRemoteSuccess(t.pctpc1)},function(e){t.onSetRemoteSessionDescriptionError(t.pctpc1,e)})}},{key:"onIceCandidate",value:function(e,t){var n=this;if(t.candidate){var r=new o.ParsedIceCandidate(t.candidate);e==this.pctpc1&&this.statshandler.codeBase==s.Constants.codeBaseType.chrome&&(r.isRelay()&&(r.isTypeTransportUdp()&&(this.parsedIceResults.relayUdpGathered=!0),r.isTypeTransportTcp()&&(this.parsedIceResults.relayTcpGathered=!0),r.isTypeTransportTls()&&(this.parsedIceResults.relayTlsGathered=!0)),r.isServerReflexive()&&(this.parsedIceResults.srflxGathered=!0)),r.isRelay()&&this.getOtherPc(e).addIceCandidate(t.candidate).then(function(){n.onAddIceCandidateSuccess(e)},function(t){n.onAddIceCandidateError(e,t,r.isRelay())})}}},{key:"onAddIceCandidateSuccess",value:function(e){}},{key:"onAddIceCandidateError",value:function(e,t,n){n&&this.rejectDisconnect(t)}},{key:"onIceStateChange",value:function(e,t){var n=this,r="(?)";e&&(r=e.iceConnectionState),"failed"===r&&this.rejectDisconnect(new Error("ICE failure")),"checking"!==r||this.iceTimer||(this.iceTimer=setTimeout(function(){delete n.iceTimer,n.rejectDisconnect(new Error("ICE timeout"))},1e4)),"completed"!==r&&"connected"!==r||delete this.iceTimer}},{key:"getIceResults",value:function(){var e=this;return new c(function(t,n){var r=e.iceServers,i=!0,o=!1,a=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;r.hasOwnProperty(u)||delete u.credential}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}var l={turnIpAddress:"",turnIpVersion:"",turnTransport:"",iceServers:r,ipv6Supported:!1,ipv4Supported:!1,relayTlsGathered:!1,relayTcpGathered:!1,relayUdpGathered:!1,srflxGathered:!1,relayTlsSuccess:!1,relayTcpSuccess:!1,relayUdpSuccess:!1,srflxSuccess:!1};for(var d in e.parsedIceResults)e.parsedIceResults.hasOwnProperty(d)&&(l[d]=e.parsedIceResults[d]);e.pctpc1?e.statshandler.getIceCandidates(e.pctpc1).then(function(e){var n=!0,r=!1,i=void 0;try{for(var o,a=e.iceCandidatePairs[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s.googActiveConnection||s.selected){var c=!0,u=!1,d=void 0;try{for(var p,h=e.localCandidates[Symbol.iterator]();!(c=(p=h.next()).done);c=!0){var f=p.value,m=null;if(m=f.ip?f.ip:f.ipAddress,f.id==s.localCandidateId){l.turnIpAddress=m;var v=-1!==m.indexOf(":");l.turnIpVersion=v?"ipv6":"ipv4",l.turnTransport=f.mozLocalTransport}"relay"!==f.candidateType&&"relayed"!==f.candidateType||("udp"===f.mozLocalTransport&&(l.relayUdpSuccess=!0),"tcp"===f.mozLocalTransport&&(l.relayTcpSuccess=!0),"tls"===f.mozLocalTransport&&(l.relayTlsSuccess=!0)),-1!==m.indexOf(":")?l.ipv6Supported=!0:l.ipv4Supported=!0}}catch(e){u=!0,d=e}finally{try{!c&&h.return&&h.return()}finally{if(u)throw d}}}}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}var g=!0,y=!1,b=void 0;try{for(var _,S=e.localCandidates[Symbol.iterator]();!(g=(_=S.next()).done);g=!0){var T=_.value;"relay"!==T.candidateType&&"relayed"!==T.candidateType||("udp"===T.mozLocalTransport&&(l.relayUdpGathered=!0),"tcp"===T.mozLocalTransport&&(l.relayTcpGathered=!0),"tls"===T.mozLocalTransport&&(l.relayTlsGathered=!0)),"srflx"!==T.candidateType&&"serverreflexive"!==T.candidateType||(l.srflxGathered=!0)}}catch(e){y=!0,b=e}finally{try{!g&&S.return&&S.return()}finally{if(y)throw b}}var C=!0,E=!1,w=void 0;try{for(var R,k=e.iceCandidatePairs[Symbol.iterator]();!(C=(R=k.next()).done);C=!0){var I=R.value;if("succeeded"===I.state){var P=!0,A=!1,O=void 0;try{for(var D,x=e.localCandidates[Symbol.iterator]();!(P=(D=x.next()).done);P=!0){var N=D.value;N.id==I.localCandidateId&&("relay"!==N.candidateType&&"relayed"!==N.candidateType||("udp"===N.mozLocalTransport&&(l.relayUdpSuccess=!0),"tcp"===N.mozLocalTransport&&(l.relayTcpSuccess=!0),"tls"===N.mozLocalTransport&&(l.relayTlsSuccess=!0)),"srflx"!==N.candidateType&&"serverreflexive"!==N.candidateType||(l.srflxSuccess=!0))}}catch(e){A=!0,O=e}finally{try{!P&&x.return&&x.return()}finally{if(A)throw O}}}}}catch(e){E=!0,w=e}finally{try{!C&&k.return&&k.return()}finally{if(E)throw w}}t(l)},function(e){n(e)}):n(new Error("PC not available for stats"))},function(e){reject(e)})}}]),e}();t.TurnConnection=u},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){r(this,e),this.iceCandidateStr=t.candidate,this.parse()}return i(e,[{key:"parse",value:function(){var e=this.iceCandidateStr.split(" ");e.length<8||(this.protocol="1"===e[1]?"rtp":"rtcp",this.transport=e[2],this.typeTransport=this.extractTypeTransport(e[3]),this.ipv6=-1!==e[4].indexOf(":"),this.ipAddress=e[4],this.port=e[5],this.type=e[7])}},{key:"extractTypeTransport",value:function(e){var t="None",n=e>>24;if("rtp"===this.protocol&&n>=0&&n<=2)switch(n){case 0:t="TLS";break;case 1:t="TCP";break;case 2:t="UDP"}return t}},{key:"getString",value:function(){return this.iceCandidateStr}},{key:"getType",value:function(){return this.type}},{key:"isHost",value:function(){return"host"===this.type.toLowerCase()}},{key:"isServerReflexive",value:function(){return"srflx"===this.type.toLowerCase()}},{key:"isPeerReflexive",value:function(){return"prflx"===this.type.toLowerCase()}},{key:"isRelay",value:function(){return"relay"===this.type.toLowerCase()||"relayed"===this.type.toLowerCase()}},{key:"getTypeTransport",value:function(){return this.typeTransport}},{key:"isTypeTransportUdp",value:function(){return"UDP"===this.typeTransport}},{key:"isTypeTransportTcp",value:function(){return"TCP"===this.typeTransport}},{key:"isTypeTransportTls",value:function(){return"TLS"===this.typeTransport}},{key:"getTransport",value:function(){return this.transport}},{key:"isUdp",value:function(){return"udp"===this.transport.toLowerCase()}},{key:"isTcp",value:function(){return"tcp"===this.transport.toLowerCase()}},{key:"getProtocol",value:function(){return this.protocol}},{key:"isRtp",value:function(){return"rtp"===this.protocol}},{key:"isRtcp",value:function(){return"rtcp"===this.protocol}},{key:"isIpv6",value:function(){return this.ipv6}},{key:"getIpAddress",value:function(){return this.ipAddress}},{key:"getPort",value:function(){return this.port}}]),e}();t.ParsedIceCandidate=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.GetStatsHandler=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(23),a=n(83),s=n(24),c=function(){function e(t){r(this,e),this.codeBase=t.codeBase,this.browserName=t.browserName,this.adapter=new a.StatsAdapter(this.codeBase,this.browserName),this.isPromiseBased=!0}return i(e,[{key:"getIceCandidates",value:function(e){var t=this;return new s(function(n,r){t.csioGetStats(t.iceCandidatesHandler.bind(t),e,function(e){n(e)})})}},{key:"iceCandidatesHandler",value:function(e,t){t(this.adapter.getIceCandidates(e))}},{key:"csioGetStats",value:function(e,t,n){var r=o.Constants.codeBaseType.firefox,i=o.Constants.codeBaseType.chrome,a=o.Constants.codeBaseType.edge,s=o.Constants.browserName.safari;t&&(this.codeBase===r?this.getStatsFirefox(e,t,n):this.browserName===s?this.getStatsSafari(e,t,n):this.codeBase===i?this.getStatsChrome(e,t,n):this.codeBase===a&&this.getStatsEdge(e,t,n))}},{key:"getStatsFirefox",value:function(e,t,n){var r=this;if(r.isPromiseBased)try{t.getStats().then(function(t){e(t,n)}).catch(function(i){r.isPromiseBased=!1,t.getStats(null,function(t){e(t,n)},function(){})})}catch(i){r.isPromiseBased=!1,t.getStats(null,function(t){e(t,n)},function(){})}else t.getStats(null,function(t){e(t,n)},function(){})}},{key:"getStatsChrome",value:function(e,t,n){var r=this;if(window&&window.csioReactNative)t.getStats(null,function(t){e(t,n)},function(e){});else if(r.isPromiseBased)try{t.getStats().then(function(t){e(t,n)}).catch(function(i){r.isPromiseBased=!1,t.getStats(function(t){e(t,n)})})}catch(r){isPromiseBased=!1,t.getStats(function(t){e(t,n)})}else t.getStats(function(t){e(t,n)})}},{key:"getStatsEdge",value:function(e,t,n){t.getStats().then(function(t){e(t,n)}).catch(function(e){})}},{key:"getStatsSafari",value:function(e,t,n){t.getStats().then(function(t){e(t,n)}).catch(function(e){})}}]),e}();t.GetStatsHandler=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.StatsAdapter=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(23),a=function(){function e(t,n){r(this,e),this.codeBase=t,this.browser=n}return i(e,[{key:"getIceCandidates",value:function(e){if(!e)return null;var t=this.extractRawStats(e);return this.processRawStatsForIceInfo(t)}},{key:"extractRawStats",value:function(e){var t=[],n=void 0,r=o.Constants.codeBaseType.firefox,i=o.Constants.codeBaseType.chrome,a=o.Constants.browserName.safari;if(this.codeBase===r&&this.browser!==a)e.forEach(function(e){t.push(e)});else if(this.codeBase===i&&this.browser!==a)e&&e.result?t=e.result():e&&e.forEach&&(t=[],e.forEach(function(e){t.push(e)}));else for(n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}},{key:"processRawStatsForIceInfo",value:function(e){var t=[],n=[],r=[],i=void 0;if(!e)return null;for(var o=0;o<e.length;++o){var a=this.getParsedStats(e[o]),s=this.statsClassifier(a);if(s.candidatePair)r.push(s.candidatePair);else if(s.transportStats){if("transport"===s.transportStats.type){i=s.transportStats.selectedCandidatePairId;continue}r.push(s.transportStats)}else if(s.localCandidate){var c=s.localCandidate;if("relay"==c.candidateType||"relayed"==c.candidateType){if(!c.mozLocalTransport){var u=c.priority>>24;c.mozLocalTransport=this.formatRelayType(u)}c.mozLocalTransport=c.mozLocalTransport.toLowerCase()}t.push(c)}else s.remoteCandidate&&n.push(s.remoteCandidate)}if(i)for(var l=0;l<r.length;++l)r[l].id===i&&(r[l].googActiveConnection="true");return{localCandidates:t,remoteCandidates:n,iceCandidatePairs:r}}},{key:"getParsedStats",value:function(e){var t={};if(e.timestamp instanceof Date&&(t.timestamp=e.timestamp.getTime().toString()),e.type&&(t.type=e.type),e.names)for(var n=e.names(),r=0;r<n.length;++r)t[n[r]]=e.stat(n[r]);else Object.assign(t,e);if(t.values){var i=!0,o=!1,a=void 0;try{for(var s,c=t.values[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;Object.assign(t,u)}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}delete t.values}return t}},{key:"statsClassifier",value:function(e){var t={},n=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=!0,o=!1,a=void 0;try{for(var s,c=n[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;if(e.type===u)return!0}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}return!1},r=n("inbound-rtp","inboundrtp"),i="true"===e.isRemote||!0===e.isRemote;return r||n("outbound-rtp","outboundrtp")?(t.tracks={},t.tracks.data=e,t.tracks.ssrc=e.ssrc,t.tracks.streamType=r?"inbound":"outbound",t.tracks.reportType="local",void 0!==e.isRemote&&(t.tracks.reportType=i?"remote":"local")):n("candidatepair")&&e.selected?t.transportStats=e:n("localcandidate","local-candidate")?t.localCandidate=e:n("remotecandidate","remote-candidate")?t.remoteCandidate=e:n("transport","googCandidatePair")?t.transportStats=e:n("VideoBwe")?t.bwe=e:n("track")?t.trackStats=e:n("candidate-pair")?t.candidatePair=e:n("codec")?t.codec=e:n("ssrc")&&(t.tracks={},t.tracks.data=e,t.tracks.ssrc=e.ssrc,t.tracks.reportType="local",t.tracks.streamType=e.bytesSent?"outbound":"inbound"),t}},{key:"formatRelayType",value:function(e){var t="none";switch(e){case 0:t="tls";break;case 1:t="tcp";break;case 2:t="udp"}return t}}]),e}();t.StatsAdapter=a},function(e,t,n){(function(e,t){!function(e,n){"use strict";function r(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return u[c]=r,s(c),c++}function i(e){delete u[e]}function o(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}function a(e){if(l)setTimeout(a,0,e);else{var t=u[e];if(t){l=!0;try{o(t)}finally{i(e),l=!1}}}}if(!e.setImmediate){var s,c=1,u={},l=!1,d=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?function(){s=function(e){t.nextTick(function(){a(e)})}}():function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&a(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),s=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){a(e.data)},s=function(t){e.port2.postMessage(t)}}():d&&"onreadystatechange"in d.createElement("script")?function(){var e=d.documentElement;s=function(t){var n=d.createElement("script");n.onreadystatechange=function(){a(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():function(){s=function(e){setTimeout(a,0,e)}}(),p.setImmediate=r,p.clearImmediate=i}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(20),n(32))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0}),t.RttTest=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},u=n(21),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u),d=n(39),p=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.sendTimer=null,n.countSent=0,n.rtts=[],n}return o(t,d.TurnTest),s(t,[{key:"initiate",value:function(){this.results.startTimestamp=l.getCurrent(),this.sendPing()}},{key:"handleMessage",value:function(e){if(this.isActive()){var t=parseInt(e,10),n=this.calculateRtt(t);this.rtts.push(n),this.countSent<10?this.sendPing():this.calculateMetrics()}}},{key:"handleError",value:function(e){this.fillResults(),this.failed(e)}},{key:"sendPing",value:function(){if(this.isActive()){var e=l.getCurrent();this.send(e.toString()),this.countSent+=1,this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.countSent<10?this.sendTimer=setTimeout(this.sendPing.bind(this),100):this.sendTimer=setTimeout(this.calculateMetrics.bind(this),500)}}},{key:"calculateRtt",value:function(e){return l.getCurrent()-e}},{key:"calculateMetrics",value:function(){this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.fillResults(),this.finished()}},{key:"fillResults",value:function(){this.results.sentMessages=this.countSent,this.results.unAckedMessages=this.countSent-this.rtts.length,this.results.maxMessages=10,this.results.forceStopped=this.forceStopped,this.results.median=this.median(),this.results.variance=this.variance(),this.results.endTimestamp=l.getCurrent()}},{key:"median",value:function(){if(0==this.rtts.length)return null;this.rtts.sort();var e=Math.floor(this.rtts.length/2);return this.rtts[e]}},{key:"variance",value:function(){if(0==this.rtts.length)return null;var e=0,t=this.median(),n=!0,r=!1,i=void 0;try{for(var o,a=this.rtts[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;e+=Math.abs(s-t)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return e/=this.rtts.length}},{key:"stop",value:function(){this.isActive()&&(c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),this.fillResults())}}]),t}();t.RttTest=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0}),t.ThroughputTest=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},u=n(21),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u),d=n(40),p=n(39),h=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(o.sentBytes=0,o.receivedBytes=0,o.secondHalfBytes=0,o.secondHalfStart=null,o.bufferEmpty=0,o.chunkSize=1200,o.messageMaker=new d.MessageMaker(o.chunkSize),o.duration=5e3,null!=n){var a=50*n;o.duration=Math.max(Math.min(a,1e4),1e3)}return o.sendTimer=null,o.lastMessage=null,o.intervals=[],o.intervalStart=0,o.intervalLength=100,o.intervalBytes=0,o}return o(t,p.TurnTest),s(t,[{key:"initiate",value:function(){this.startSend()}},{key:"handleMessage",value:function(e){var t=this;if(this.isActive()){this.lastMessage=e,this.receivedBytes+=e.length;var n=l.getCurrent();if(this.sendTimer||(this.results.startTimestamp=n,this.sendTimer=setTimeout(function(){t.stop(),t.finished()},this.duration)),0==this.intervalStart&&(this.intervalStart=n),this.intervalBytes+=e.length,n-this.intervalStart>=this.intervalLength){var r=n-this.intervalStart,i=this.averageThroughput(this.intervalBytes,r),o=null;try{o=n-JSON.parse(this.lastMessage).timestamp}catch(e){}this.intervals.push({startTimestamp:this.intervalStart,endTimestamp:n,bytesReceived:this.intervalBytes,average:i,rtt:o}),this.intervalStart=n,this.intervalBytes=0}this.results.startTimestamp&&n-this.results.startTimestamp>this.duration/2&&(this.secondHalfStart||(this.secondHalfStart=n),this.secondHalfBytes+=e.length)}}},{key:"handleError",value:function(e){this.stop(),this.failed(e)}},{key:"averageThroughput",value:function(e,t){return e/(t/1e3)*8/1024}},{key:"bufferListener",value:function(){this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this)),this.fillBuffer()}},{key:"fillBuffer",value:function(){for(0==this.sendChannel.bufferedAmount&&(this.bufferEmpty+=1);this.isActive();){if(this.sendChannel.bufferedAmount>this.bufferFullThreshold)return void(this.usePolling?setTimeout(this.fillBuffer.bind(this),250):this.sendChannel.addEventListener("bufferedamountlow",this.bufferListener.bind(this)));var e=this.messageMaker.make(this.sentBytes);this.sentBytes+=e.length,this.send(e)}this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this))}},{key:"startSend",value:function(){this.isActive()&&(this.bufferFullThreshold=1e3*this.chunkSize,this.sendChannel=this.connection.sendChannel,this.usePolling=!0,"number"==typeof this.sendChannel.bufferedAmountLowThreshold&&(this.usePolling=!1,this.sendChannel.bufferedAmountLowThreshold=this.bufferFullThreshold/10),setTimeout(this.fillBuffer.bind(this),0))}},{key:"fillResults",value:function(){this.results.endTimestamp=l.getCurrent(),this.results.maxDuration=this.duration,this.results.forceStopped=this.forceStopped,this.results.bufferEmpty=this.bufferEmpty,this.results.intervals=this.intervals,this.results.bytesPrepared=this.sentBytes,this.results.bytesReceived=this.receivedBytes;var e=0,t=0;this.secondHalfStart&&(e=this.results.endTimestamp-this.secondHalfStart,t=this.averageThroughput(this.secondHalfBytes,e));var n=this.results.endTimestamp-this.results.startTimestamp,r=this.averageThroughput(this.receivedBytes,n);r>t&&(t=r),this.results.average=t;var i=null;try{i=JSON.parse(this.lastMessage)}catch(e){return}var o=i.sentBytes+this.lastMessage.length;this.results.bytesSent=o,this.results.fractionLostBytes=1-this.receivedBytes/o}},{key:"stop",value:function(){this.isActive()&&(clearTimeout(this.sendTimer),this.sendTimer=null,c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),this.fillResults())}}]),t}();t.ThroughputTest=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0}),t.ResultsHandler=void 0;var o="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(e){return void 0===e?"undefined":i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":i(e)},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(21),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(s),u=n(40),l=function(){function e(){r(this,e),this.start=c.getCurrent(),this.id=Math.trunc(this.start)+"-"+(0,u.randomAsciiString)(20),this.version="1.1.2",this.failures=[],this.results={},this.forceStopped=!1}return a(e,[{key:"getResults",value:function(){return{id:this.id,version:this.version,forceStopped:this.forceStopped,startTimestamp:this.start,endTimestamp:c.getCurrent(),failures:this.failures,tests:this.results}}},{key:"getFailureNumber",value:function(){return this.failures.length}},{key:"getId",value:function(){return this.id}},{key:"add",value:function(e,t){this.results[e]=t,t.forceStopped&&!0===t.forceStopped&&(this.forceStopped=!0)}},{key:"failure",value:function(e){"object"===(void 0===e?"undefined":o(e))&&(e=e.toString());var t={timestamp:c.getCurrent(),reason:e};this.failures.push(t)}}]),e}();t.ResultsHandler=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.OnlineCheck=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(21),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o),s=function(){function e(){r(this,e)}return i(e,[{key:"start",value:function(){var e=this;this.onlineCheck=[],window&&window.addEventListener&&"function"==typeof window.addEventListener&&(window.addEventListener("offline",function(){e.addEntry()}),window.addEventListener("online",function(){e.addEntry()}),this.addEntry())}},{key:"addEntry",value:function(){var e=a.getCurrent();if(navigator&&navigator.onLine){var t=navigator.onLine;this.onlineCheck.push({timestamp:e,online:t})}}},{key:"stop",value:function(){var e=this;return window.removeEventListener("offline",function(){e.addEntry()}),window.removeEventListener("online",function(){e.addEntry()}),this.onlineCheck}}]),e}();t.OnlineCheck=s},function(e,t,n){"use strict";(function(e){function r(e,t){return!t||t<=0||!e||e<=0?0:Math.round(e/t*100)}function i(){this.loss={},this.bitrate={download:0,upload:0},this.resolution={},this.framerate=0}function o(){this.bandwidth={},this.bitrate={},this.packetLoss=null,this.transport=[]}function a(e,t,n,r){this._browserType=s.a.getBrowserType();var i=h[this._browserType];if(!i)throw"The browser type '"+this._browserType+"' isn't supported!";this._getStatValue=this._defineGetStatValueMethod(i),this.peerconnection=e,this.baselineAudioLevelsReport=null,this.currentAudioLevelsReport=null,this.currentStatsReport=null,this.previousStatsReport=null,this.audioLevelsIntervalId=null,this.eventEmitter=r,this.conferenceStats=new o,this.audioLevelsIntervalMilis=t,this.statsIntervalId=null,this.statsIntervalMilis=n,this.ssrc2stats=new Map}t.a=a;var s=n(1),c=n(42),u=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=n(3),d=n(0).getLogger(e),p=s.a.isChrome()||s.a.isOpera()||s.a.isFirefox()||s.a.isNWJS()||s.a.isElectron()||s.a.isTemasysPluginUsed()||s.a.isEdge(),h={};h[s.a.RTC_BROWSER_FIREFOX]={ssrc:"ssrc",packetsReceived:"packetsReceived",packetsLost:"packetsLost",packetsSent:"packetsSent",bytesReceived:"bytesReceived",bytesSent:"bytesSent",framerateMean:"framerateMean"},h[s.a.RTC_BROWSER_CHROME]={receiveBandwidth:"googAvailableReceiveBandwidth",sendBandwidth:"googAvailableSendBandwidth",remoteAddress:"googRemoteAddress",transportType:"googTransportType",localAddress:"googLocalAddress",activeConnection:"googActiveConnection",ssrc:"ssrc",packetsReceived:"packetsReceived",packetsSent:"packetsSent",packetsLost:"packetsLost",bytesReceived:"bytesReceived",bytesSent:"bytesSent",googFrameHeightReceived:"googFrameHeightReceived",googFrameWidthReceived:"googFrameWidthReceived",googFrameHeightSent:"googFrameHeightSent",googFrameWidthSent:"googFrameWidthSent",googFrameRateReceived:"googFrameRateReceived",googFrameRateSent:"googFrameRateSent",audioInputLevel:"audioInputLevel",audioOutputLevel:"audioOutputLevel",currentRoundTripTime:"googRtt",remoteCandidateType:"googRemoteCandidateType",localCandidateType:"googLocalCandidateType"},h[s.a.RTC_BROWSER_EDGE]={sendBandwidth:"googAvailableSendBandwidth",remoteAddress:"remoteAddress",transportType:"protocol",localAddress:"localAddress",activeConnection:"activeConnection",ssrc:"ssrc",packetsReceived:"packetsReceived",packetsSent:"packetsSent",packetsLost:"packetsLost",bytesReceived:"bytesReceived",bytesSent:"bytesSent",googFrameHeightReceived:"frameHeight",googFrameWidthReceived:"frameWidth",googFrameHeightSent:"frameHeight",googFrameWidthSent:"frameWidth",googFrameRateReceived:"framesPerSecond",googFrameRateSent:"framesPerSecond",audioInputLevel:"audioLevel",audioOutputLevel:"audioLevel",currentRoundTripTime:"roundTripTime"},h[s.a.RTC_BROWSER_OPERA]=h[s.a.RTC_BROWSER_CHROME],h[s.a.RTC_BROWSER_NWJS]=h[s.a.RTC_BROWSER_CHROME],h[s.a.RTC_BROWSER_ELECTRON]=h[s.a.RTC_BROWSER_CHROME],h[s.a.RTC_BROWSER_IEXPLORER]=h[s.a.RTC_BROWSER_CHROME],h[s.a.RTC_BROWSER_SAFARI]=h[s.a.RTC_BROWSER_CHROME],h[s.a.RTC_BROWSER_REACT_NATIVE]=h[s.a.RTC_BROWSER_CHROME],i.prototype.setLoss=function(e){this.loss=e||{}},i.prototype.setResolution=function(e){this.resolution=e||{}},i.prototype.addBitrate=function(e){this.bitrate.download+=e.download,this.bitrate.upload+=e.upload},i.prototype.resetBitrate=function(){this.bitrate.download=0,this.bitrate.upload=0},i.prototype.setFramerate=function(e){this.framerate=e||0},a.prototype.stop=function(){this.audioLevelsIntervalId&&(clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=null),this.statsIntervalId&&(clearInterval(this.statsIntervalId),this.statsIntervalId=null)},a.prototype.errorCallback=function(e){l.callErrorHandler(e),d.error("Get stats error",e),this.stop()},a.prototype.start=function(e){var t=this;e&&(this.audioLevelsIntervalId=setInterval(function(){t.peerconnection.getStats(function(e){var n=null;n=e&&e.result&&"function"==typeof e.result?e.result():e,t.currentAudioLevelsReport=n,t.processAudioLevelReport(),t.baselineAudioLevelsReport=t.currentAudioLevelsReport},t.errorCallback)},t.audioLevelsIntervalMilis)),p&&(this.statsIntervalId=setInterval(function(){t.peerconnection.getStats(function(e){var n=null;n=e&&e.result&&"function"==typeof e.result?e.result():e,t.currentStatsReport=n;try{t.processStatsReport()}catch(e){l.callErrorHandler(e),d.error("Unsupported key:"+e,e)}t.previousStatsReport=t.currentStatsReport},t.errorCallback)},t.statsIntervalMilis))},a.prototype._defineGetStatValueMethod=function(e){var t=function(t){var n=e[t];if(n)return n;throw"The property '"+t+"' isn't supported!"},n=void 0;switch(this._browserType){case s.a.RTC_BROWSER_CHROME:case s.a.RTC_BROWSER_OPERA:case s.a.RTC_BROWSER_NWJS:case s.a.RTC_BROWSER_ELECTRON:n=function(e,t){return e.stat(t)};break;case s.a.RTC_BROWSER_REACT_NATIVE:n=function(e,t){var n=void 0;return e.values.some(function(e){return!!e.hasOwnProperty(t)&&(n=e[t],!0)}),n};break;case s.a.RTC_BROWSER_EDGE:n=function(e,t){return e[t]};break;default:n=function(e,t){return e[t]}}return function(e,r){return n(e,t(r))}},a.prototype.getNonNegativeStat=function(e,t){var n=this._getStatValue(e,t);return"number"!=typeof n&&(n=Number(n)),isNaN(n)?0:Math.max(0,n)},a.prototype.processStatsReport=function(){var e=this;if(this.previousStatsReport){var t=this._getStatValue,n={};for(var o in this.currentStatsReport)if(this.currentStatsReport.hasOwnProperty(o)){var a=this.currentStatsReport[o];if(a){try{var l=t(a,"receiveBandwidth"),p=t(a,"sendBandwidth");(l||p)&&(this.conferenceStats.bandwidth={download:Math.round(l/1e3),upload:Math.round(p/1e3)})}catch(e){}if("googCandidatePair"===a.type){var h=function(){var n=void 0,r=void 0,i=void 0,o=void 0,s=void 0,c=void 0,u=void 0;try{if(!(n=t(a,"activeConnection")))return"continue";r=t(a,"remoteAddress"),u=t(a,"transportType"),o=t(a,"localAddress"),i=t(a,"localCandidateType"),s=t(a,"remoteCandidateType"),c=e.getNonNegativeStat(a,"currentRoundTripTime")}catch(e){}if(!r||!u||!o||"true"!==n)return"continue";var l=e.conferenceStats.transport;return l.some(function(e){return e.ip===r&&e.type===u&&e.localip===o})||l.push({ip:r,type:u,localip:o,p2p:e.peerconnection.isP2P,localCandidateType:i,remoteCandidateType:s,rtt:c}),"continue"}();if("continue"===h)continue}if("candidatepair"===a.type){if("succeeded"!==a.state)continue;var f=this.currentStatsReport[a.localCandidateId],m=this.currentStatsReport[a.remoteCandidateId];this.conferenceStats.transport.push({ip:m.ipAddress+":"+m.portNumber,type:f.transport,localip:f.ipAddress+":"+f.portNumber,p2p:this.peerconnection.isP2P,localCandidateType:f.candidateType,remoteCandidateType:m.candidateType})}if("transportdiagnostics"===a.msType&&this.conferenceStats.transport.push({ip:a.remoteAddress,type:a.protocol,localip:a.localAddress,p2p:this.peerconnection.isP2P}),("ssrc"===a.type||"outboundrtp"===a.type||"inboundrtp"===a.type||"track"===a.type)&&(!s.a.isEdge()||"inboundrtp"!==a.type&&"outboundrtp"!==a.type)){var v=this.previousStatsReport[o],g=this.getNonNegativeStat(a,"ssrc");if("track"===a.type&&Array.isArray(a.ssrcIds)&&(g=Number(a.ssrcIds[0])),v&&g&&(s.a.isEdge()||!0!==a.isRemote&&!0!==a.remoteSource)){var y=this.ssrc2stats.get(g);y||(y=new i,this.ssrc2stats.set(g,y));var b=!0,_="packetsReceived",S=t(a,_);void 0!==S&&null!==S&&""!==S||(b=!1,_="packetsSent",void 0!==(S=t(a,_))&&null!==S||d.warn("No packetsReceived nor packetsSent stat found")),(!S||S<0)&&(S=0);var T=this.getNonNegativeStat(v,_),C=Math.max(0,S-T),E=this.getNonNegativeStat(a,"packetsLost"),w=this.getNonNegativeStat(v,"packetsLost"),R=Math.max(0,E-w);y.setLoss({packetsTotal:C+R,packetsLost:R,isDownloadStream:b});var k=this.getNonNegativeStat(a,"bytesReceived"),I=this.getNonNegativeStat(v,"bytesReceived"),P=Math.max(0,k-I),A=0,O=t(a,"bytesSent");"number"!=typeof O&&"string"!=typeof O||(O=Number(O),isNaN(O)||(n[g]=O,O>0&&(A=O-t(v,"bytesSent")))),A=Math.max(0,A);var D=a.timestamp-v.timestamp,x=0,N=0;D>0&&(x=Math.round(8*P/D),N=Math.round(8*A/D)),y.addBitrate({download:x,upload:N});var L={height:null,width:null};try{var M=void 0,j=void 0;(M=t(a,"googFrameHeightReceived"))&&(j=t(a,"googFrameWidthReceived"))?(L.height=M,L.width=j):(M=t(a,"googFrameHeightSent"))&&(j=t(a,"googFrameWidthSent"))&&(L.height=M,L.width=j)}catch(e){}var F=void 0;try{F=t(a,"googFrameRateReceived")||t(a,"googFrameRateSent")||0}catch(e){try{F=this.getNonNegativeStat(a,"framerateMean")}catch(e){}}y.setFramerate(Math.round(F||0)),L.height&&L.width?y.setResolution(L):y.setResolution(null)}}}}var U={download:0,upload:0},H={download:0,upload:0},B=0,G=0,J={},V={},W=0,q=0,K=0,z=0,$=!0,Q=!1,X=void 0;try{for(var Y,Z=this.ssrc2stats[Symbol.iterator]();!($=(Y=Z.next()).done);$=!0){var ee=Y.value,te=u(ee,2),ne=te[0],re=te[1],ie=re.loss,oe=ie.isDownloadStream?"download":"upload";U[oe]+=ie.packetsTotal,H[oe]+=ie.packetsLost,B+=re.bitrate.download,G+=re.bitrate.upload;var ae=this.peerconnection.getTrackBySSRC(ne);if(ae){ae.isAudioTrack()?(W+=re.bitrate.download,q+=re.bitrate.upload):(K+=re.bitrate.download,z+=re.bitrate.upload);var se=ae.getParticipantId();if(se){var ce=re.resolution;if(ce.width&&ce.height&&-1!==ce.width&&-1!==ce.height){var ue=J[se]||{};ue[ne]=ce,J[se]=ue}if(0!==re.framerate){var le=V[se]||{};le[ne]=re.framerate,V[se]=le}}else d.error("No participant ID returned by "+ae)}else this.peerconnection.isP2P&&d.error("JitsiTrack not found for SSRC "+ne+" in "+this.peerconnection);re.resetBitrate()}}catch(e){Q=!0,X=e}finally{try{!$&&Z.return&&Z.return()}finally{if(Q)throw X}}this.eventEmitter.emit(c.c,this.peerconnection,n),this.conferenceStats.bitrate={upload:G,download:B},this.conferenceStats.bitrate.audio={upload:q,download:W},this.conferenceStats.bitrate.video={upload:z,download:K},this.conferenceStats.packetLoss={total:r(H.download+H.upload,U.download+U.upload),download:r(H.download,U.download),upload:r(H.upload,U.upload)},this.eventEmitter.emit(c.d,this.peerconnection,{bandwidth:this.conferenceStats.bandwidth,bitrate:this.conferenceStats.bitrate,packetLoss:this.conferenceStats.packetLoss,resolution:J,framerate:V,transport:this.conferenceStats.transport}),this.conferenceStats.transport=[]}},a.prototype.processAudioLevelReport=function(){if(this.baselineAudioLevelsReport){var e=this._getStatValue;for(var t in this.currentAudioLevelsReport)if(this.currentAudioLevelsReport.hasOwnProperty(t)){var n=this.currentAudioLevelsReport[t];if("ssrc"===n.type||"track"===n.type){var r=this.baselineAudioLevelsReport[t],i=this.getNonNegativeStat(n,"ssrc");if(!i&&Array.isArray(n.ssrcIds)&&(i=Number(n.ssrcIds[0])),r)if(i){var o=void 0;try{o=e(n,"audioInputLevel")||e(n,"audioOutputLevel")}catch(e){return d.warn("Audio Levels are not available in the statistics."),void clearInterval(this.audioLevelsIntervalId)}if(o){var a=void 0;a="ssrc"===n.type?!e(n,"packetsReceived"):!n.remoteSource,s.a.isEdge()?o=o<0?Math.pow(10,o/20):0:o/=32767,this.eventEmitter.emit(c.a,this.peerconnection,i,o,a)}}else Date.now()-n.timestamp<3e3&&d.warn("No ssrc: ");else d.warn(i+" not enough data")}}}}}).call(t,"modules/statistics/RTPStatsCollector.js")},function(e,t,n){var r,i,o;"function"==typeof Symbol&&Symbol.iterator,function(n,a){i=[],r=a,void 0!==(o="function"==typeof r?r.apply(t,i):r)&&(e.exports=o)}(this||window,function(){function e(e,t){var n,r=null;if(t=t||u,"string"==typeof e&&e)for(n=t.length;n--;)if(t[n].src===e){r=t[n];break}return r}function t(e){var t,n,r=null;for(e=e||u,t=0,n=e.length;t<n;t++)if(!e[t].hasAttribute("src")){if(r){r=null;break}r=e[t]}return r}function n(e,t){var r,i,o=null,a="number"==typeof t;return t=a?Math.round(t):0,"string"==typeof e&&e&&(a?r=e.match(/(data:text\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/):(r=e.match(/^(?:|[^:@]*@|.+\)@(?=data:text\/javascript|blob|http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)(data:text\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/))&&r[1]||(r=e.match(/\)@(data:text\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/)),r&&r[1]&&(t>0?(i=e.slice(e.indexOf(r[0])+r[0].length),o=n(i,t-1)):o=r[1])),o}function r(){return null}function i(){return null}function o(){if(0===u.length)return null;var r,i,s,m,v,g=[],y=o.skipStackDepth||1;for(r=0;r<u.length;r++)d&&l?a.test(u[r].readyState)&&g.push(u[r]):g.push(u[r]);if(i=new Error,h&&(s=i.stack),!s&&f)try{throw i}catch(e){s=e.stack}if(s&&(m=n(s,y),!(v=e(m,g))&&c&&m===c&&(v=t(g))),v||1===g.length&&(v=g[0]),v||p&&(v=document.currentScript),!v&&d&&l)for(r=g.length;r--;)if("interactive"===g[r].readyState){v=g[r];break}return v||(v=g[g.length-1]||null),v}var a=/^(interactive|loaded|complete)$/,s=window.location?window.location.href:null,c=s?s.replace(/#.*$/,"").replace(/\?.*$/,"")||null:null,u=document.getElementsByTagName("script"),l="readyState"in(u[0]||document.createElement("script")),d=!window.opera||"[object Opera]"!==window.opera.toString(),p="currentScript"in document;"stackTraceLimit"in Error&&Error.stackTraceLimit!==1/0&&(Error.stackTraceLimit,Error.stackTraceLimit=1/0);var h=!1,f=!1;!function(){try{var e=new Error;throw h="string"==typeof e.stack&&!!e.stack,e}catch(e){f="string"==typeof e.stack&&!!e.stack}}(),o.skipStackDepth=1;var m=o;return m.near=o,m.far=r,m.origin=i,m})},function(e,t){var n={LOCAL_JID:"local"};e.exports=n},function(e,t,n){"use strict";(function(e){function r(e){this.versions={},this.conference=e,this.conference.addCommandListener("versions",this.processPresence.bind(this))}t.a=r;var i=n(5),o=n(0).getLogger(e);r.FOCUS_COMPONENT="focus",r.VIDEOBRIDGE_COMPONENT="videobridge",r.XMPP_SERVER_COMPONENT="xmpp",r.prototype.processPresence=function(e,t,n){var a=this;if("http://jitsi.org/jitmeet"!==e.attributes.xmlns)return void o.warn("Ignored presence versions node - invalid xmlns",e);if(!this.conference._isFocus(n))return void o.warn("Received versions not from the focus user: "+e,n);var s=[];e.children.forEach(function(e){var t=e.attributes.name;if(t!==r.FOCUS_COMPONENT&&t!==r.XMPP_SERVER_COMPONENT&&t!==r.VIDEOBRIDGE_COMPONENT)return void o.warn("Received version for not supported component name: "+t);var n=e.value;a.versions[t]!==n&&(a.versions[t]=n,o.info("Got "+t+" version: "+n),s.push({id:"component_version",component:t,version:n}))}),s.length>0&&i.a.sendLog(JSON.stringify(s))},r.prototype.getComponentVersion=function(e){return this.versions[e]}}).call(t,"modules/version/ComponentsVersions.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){if(n<5e3)return 1;var r=0,i=Math.min(t.height,t.width);if(e){var a=m.find(function(e){return e.height<=i});if(a)for(i=a.height;i>=180&&"break"!==function(){var e=i;if(!(a=m.find(function(t){return t.height===e})))return"break";r+=a.target}();i/=2);}else{var s=t.width*t.height;r=s<=76800?600:s<=307200?1700:s<=518400?2e3:2500}return Math.min(r,o(Math.max(0,n-1e3)))}function o(e){return e>6e4?Number.MAX_SAFE_INTEGER:v*Math.pow(1.08,e/1e3)}var a=n(29),s=n(6),c=n(0),u=(n.n(c),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),l=n(7),d=n(16),p=n(33),h=Object(c.getLogger)(e),f="stats",m=[{width:1920,height:1080,layers:3,max:5e3,target:4e3,min:800},{width:1280,height:720,layers:3,max:2500,target:2500,min:600},{width:960,height:540,layers:3,max:900,target:900,min:450},{width:640,height:360,layers:2,max:700,target:500,min:150},{width:480,height:270,layers:2,max:450,target:350,min:150},{width:320,height:180,layers:1,max:200,target:150,min:30}],v=800,g=function(){function e(t,n,i){var o=this;r(this,e),this.eventEmitter=n,this._conference=t,this._localStats={connectionQuality:100,jvbRTT:void 0},this._lastConnectionQualityUpdate=-1,this._remoteStats={},this._timeIceConnected=-1,this._timeVideoUnmuted=-1,i.startBitrate&&i.startBitrate>0&&(v=i.startBitrate),t.on(s.CONNECTION_INTERRUPTED,function(){o._updateLocalConnectionQuality(0),o.eventEmitter.emit(a.LOCAL_STATS_UPDATED,o._localStats),o._broadcastLocalStats()}),t.room.addListener(l.ICE_CONNECTION_STATE_CHANGED,function(e,t){e.isP2P||"connected"!==t||(o._timeIceConnected=window.performance.now())}),t.on(s.ENDPOINT_MESSAGE_RECEIVED,function(e,t){t.type===f&&o._updateRemoteStats(e.getId(),t.values)}),t.statistics.addConnectionStatsListener(this._updateLocalStats.bind(this)),t.on(s.TRACK_MUTE_CHANGED,function(e){e.isVideoTrack()&&(e.isMuted()?o._timeVideoUnmuted=-1:o._maybeUpdateUnmuteTime())}),t.on(s.TRACK_ADDED,function(e){e.isVideoTrack()&&!e.isMuted()&&o._maybeUpdateUnmuteTime()})}return u(e,[{key:"_maybeUpdateUnmuteTime",value:function(){this._timeVideoUnmuted<0&&(this._timeVideoUnmuted=window.performance.now())}},{key:"_calculateConnectionQuality",value:function(e,t,n){var r=p[n],o=100,a=void 0;if(this._localStats.packetLoss&&(a=this._localStats.packetLoss.upload,t&&(a*=.5)),t||!r||e===d.DESKTOP||this._timeIceConnected<0||this._timeVideoUnmuted<0)void 0===a?(h.error("Cannot calculate connection quality, unknown packet loss."),o=100):o=a<=2?100:a<=4?70:a<=6?50:a<=8?30:a<=12?10:0;else{var s=window.performance.now()-Math.max(this._timeVideoUnmuted,this._timeIceConnected),c=this._conference.getActivePeerConnection(),u=Boolean(c&&c.isSimulcastOn()),l=i(u,r,s);l*=.9,o=100*this._localStats.bitrate.upload/l,a&&a>=10&&(o=Math.min(o,30))}if(this._lastConnectionQualityUpdate>0){var f=this._localStats.connectionQuality,m=(window.performance.now()-this._lastConnectionQualityUpdate)/1e3;o=Math.min(o,f+2*m)}return Math.min(100,o)}},{key:"_updateLocalConnectionQuality",value:function(e){this._localStats.connectionQuality=e,this._lastConnectionQualityUpdate=window.performance.now()}},{key:"_broadcastLocalStats",value:function(){var e={bitrate:this._localStats.bitrate,packetLoss:this._localStats.packetLoss,connectionQuality:this._localStats.connectionQuality,jvbRTT:this._localStats.jvbRTT};try{this._conference.broadcastEndpointMessage({type:f,values:e})}catch(e){}}},{key:"_updateLocalStats",value:function(e,t){if(!e.isP2P){var n=t.transport&&t.transport.length&&t.transport[0].rtt;this._localStats.jvbRTT=n||void 0}if(e===this._conference.getActivePeerConnection()){var r=void 0,i=!this._conference.isConnectionInterrupted(),o=this._conference.getLocalVideoTrack(),s=o?o.videoType:void 0,c=!o||o.isMuted(),u=o?o.resolution:null;c||this._maybeUpdateUnmuteTime();for(r in t)t.hasOwnProperty(r)&&(this._localStats[r]=t[r]);i&&this._updateLocalConnectionQuality(this._calculateConnectionQuality(s,c,u)),this.eventEmitter.emit(a.LOCAL_STATS_UPDATED,this._localStats),this._broadcastLocalStats()}}},{key:"_updateRemoteStats",value:function(e,t){this._remoteStats[e]={bitrate:t.bitrate,packetLoss:t.packetLoss,connectionQuality:t.connectionQuality,jvbRTT:t.jvbRTT},this.eventEmitter.emit(a.REMOTE_STATS_UPDATED,e,this._remoteStats[e])}},{key:"getStats",value:function(){return this._localStats}}]),e}();t.a=g}).call(t,"modules/connectivity/ConnectionQuality.js")},function(e,t,n){"use strict";function r(e){var t=this,n=e.id,r=e.password,a=e.onLoginSuccessful,s=e.roomPassword,c=!1,u=void 0,l=new o.a(this.connection.options),d=new Promise(function(e,o){u=o,l.addListener(i.CONNECTION_DISCONNECTED,function(){l=void 0}),l.addListener(i.CONNECTION_ESTABLISHED,function(){c||(a&&a(),l.createRoom(t.options.name,t.options.config).moderator.authenticate().then(function(){l&&l.disconnect(),c||(t.join(s),e())}).catch(function(e){var t=e.error,n=e.message;l.disconnect(),o({authenticationError:t,message:n})}))}),l.addListener(i.CONNECTION_FAILED,function(e,t,n){o({connectionError:e,credentials:n,message:t}),l=void 0}),c||l.connect(n,r)});return d.cancel=function(){c=!0,u({}),l&&l.disconnect()},d}t.a=r;var i=n(25),o=n(44)},function(e,t,n){var r,i,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(s,c){"object"===a(t)&&void 0!==e?c(n(2)):(i=[n(2)],r=c,void 0!==(o="function"==typeof r?r.apply(t,i):r)&&(e.exports=o))}(0,function(e){"use strict";e.Strophe.addConnectionPlugin("disco",{_connection:null,_identities:[],_features:[],_items:[],init:function(t){this._connection=t,this._identities=[],this._features=[],this._items=[],t.addHandler(this._onDiscoInfo.bind(this),e.Strophe.NS.DISCO_INFO,"iq","get",null,null),t.addHandler(this._onDiscoItems.bind(this),e.Strophe.NS.DISCO_ITEMS,"iq","get",null,null)},addIdentity:function(e,t,n,r){for(var i=0;i<this._identities.length;i++)if(this._identities[i].category==e&&this._identities[i].type==t&&this._identities[i].name==n&&this._identities[i].lang==r)return!1;return this._identities.push({category:e,type:t,name:n,lang:r}),!0},addFeature:function(e){for(var t=0;t<this._features.length;t++)if(this._features[t]==e)return!1;return this._features.push(e),!0},removeFeature:function(e){for(var t=0;t<this._features.length;t++)if(this._features[t]===e)return this._features.splice(t,1),!0;return!1},addItem:function(e,t,n,r){return!(n&&!r||(this._items.push({jid:e,name:t,node:n,call_back:r}),0))},info:function(t,n,r,i,o){var a={xmlns:e.Strophe.NS.DISCO_INFO};n&&(a.node=n);var s=e.$iq({from:this._connection.jid,to:t,type:"get"}).c("query",a);this._connection.sendIQ(s,r,i,o)},items:function(t,n,r,i,o){var a={xmlns:e.Strophe.NS.DISCO_ITEMS};n&&(a.node=n);var s=e.$iq({from:this._connection.jid,to:t,type:"get"}).c("query",a);this._connection.sendIQ(s,r,i,o)},_buildIQResult:function(t,n){var r=t.getAttribute("id"),i=t.getAttribute("from"),o=e.$iq({type:"result",id:r});return null!==i&&o.attrs({to:i}),o.c("query",n)},_onDiscoInfo:function(t){var n,r=t.getElementsByTagName("query")[0].getAttribute("node"),i={xmlns:e.Strophe.NS.DISCO_INFO};r&&(i.node=r);var o=this._buildIQResult(t,i);for(n=0;n<this._identities.length;n++)i={category:this._identities[n].category,type:this._identities[n].type},this._identities[n].name&&(i.name=this._identities[n].name),this._identities[n].lang&&(i["xml:lang"]=this._identities[n].lang),o.c("identity",i).up();for(n=0;n<this._features.length;n++)o.c("feature",{var:this._features[n]}).up();return this._connection.send(o.tree()),!0},_onDiscoItems:function(t){var n,r,i={xmlns:e.Strophe.NS.DISCO_ITEMS},o=t.getElementsByTagName("query")[0].getAttribute("node");if(o){for(i.node=o,n=[],r=0;r<this._items.length;r++)if(this._items[r].node==o){n=this._items[r].call_back(t);break}}else n=this._items;var a=this._buildIQResult(t,i);for(r=0;r<n.length;r++){var s={jid:n[r].jid};n[r].name&&(s.name=n[r].name),n[r].node&&(s.node=n[r].node),a.c("item",s).up()}return this._connection.send(a.tree()),!0}})})},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=(n.n(a),n(2)),c=(n.n(s),n(97)),u=n(22),l=n(7),d=n.n(l),p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},f=Object(a.getLogger)(e),m=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.xmpp=e,n.rooms={},n}return o(t,e),p(t,[{key:"init",value:function(e){h(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this.connection.addHandler(this.onPresence.bind(this),null,"presence",null,null,null,null),this.connection.addHandler(this.onPresenceUnavailable.bind(this),null,"presence","unavailable",null),this.connection.addHandler(this.onPresenceError.bind(this),null,"presence","error",null),this.connection.addHandler(this.onMessage.bind(this),null,"message",null,null),this.connection.addHandler(this.onMute.bind(this),"http://jitsi.org/jitmeet/audio","iq","set",null,null)}},{key:"createRoom",value:function(e,t,n){var r=s.Strophe.getBareJidFromJid(e);if(this.rooms[r]){var i="You are already in the room!";throw f.error(i),new Error(i)}return this.rooms[r]=new c.a(this.connection,e,t,this.xmpp,n),this.eventEmitter.emit(d.a.EMUC_ROOM_ADDED,this.rooms[r]),this.rooms[r]}},{key:"doLeave",value:function(e){this.eventEmitter.emit(d.a.EMUC_ROOM_REMOVED,this.rooms[e]),delete this.rooms[e]}},{key:"onPresence",value:function(e){var t=e.getAttribute("from");if(e.getAttribute("type"))return!0;var n=this.rooms[s.Strophe.getBareJidFromJid(t)];return n?($(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="201"]').length&&n.createNonAnonymousRoom(),n.onPresence(e),!0):void 0}},{key:"onPresenceUnavailable",value:function(e){var t=e.getAttribute("from"),n=this.rooms[s.Strophe.getBareJidFromJid(t)];if(n)return n.onPresenceUnavailable(e,t),!0}},{key:"onPresenceError",value:function(e){var t=e.getAttribute("from"),n=this.rooms[s.Strophe.getBareJidFromJid(t)];if(n)return n.onPresenceError(e,t),!0}},{key:"onMessage",value:function(e){var t=e.getAttribute("from"),n=this.rooms[s.Strophe.getBareJidFromJid(t)];if(n)return n.onMessage(e,t),!0}},{key:"onMute",value:function(e){var t=e.getAttribute("from"),n=this.rooms[s.Strophe.getBareJidFromJid(t)];if(n)return n.onMute(e),!0}}]),t}(u.a);t.a=function(e){s.Strophe.addConnectionPlugin("emuc",new m(e))}}).call(t,"modules/xmpp/strophe.emuc.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){for(var n=[],r=0;r<e.length;r++)e[r].tagName===t&&n.push(e[r]);return n}function s(e){try{var t=JSON.parse(e);if(t&&"object"===(void 0===t?"undefined":S(t))){var n=t[E[0]],r=t[E[1]];if(("string"==typeof n||n instanceof String)&&r)return t;T.debug("parsing valid json but does not have correct structure","topic: ",n,"payload: ",r)}}catch(e){return!1}return!1}var c=n(0),u=(n.n(c),n(2)),l=(n.n(u),n(3)),d=n.n(l),p=n(46),h=n(9),f=n(18),m=n(4),v=n(7),g=n.n(v),y=n(98),b=n(48),_=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T=Object(c.getLogger)(e),C={packet2JSON:function(e,t){var n=this;$(e).children().each(function(){var e=$(this).prop("tagName"),r={tagName:e};r.attributes={},$($(this)[0].attributes).each(function(e,t){r.attributes[t.name]=t.value});var i=u.Strophe.getText($(this)[0]);i&&(r.value=i),r.children=[],t.push(r),n.packet2JSON($(this),r.children)})},json2packet:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];r&&(t.c(r.tagName,r.attributes),r.value&&t.t(r.value),r.children&&this.json2packet(r.children,t),t.up())}}},E=["jitsi-meet-muc-msg-topic","payload"],w=function(e){function t(e,n,o,a,s){r(this,t);var c=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return c.xmpp=a,c.connection=e,c.roomjid=u.Strophe.getBareJidFromJid(n),c.myroomjid=n,c.password=o,T.info("Joined MUC as "+c.myroomjid),c.members={},c.presMap={},c.presHandlers={},c.joined=!1,c.role=null,c.focusMucJid=null,c.noBridgeAvailable=!1,c.options=s||{},c.moderator=new y.a(c.roomjid,c.xmpp,c.eventEmitter,{connection:c.xmpp.options,conference:c.options}),c.initPresenceMap(s),c.lastPresences={},c.phoneNumber=null,c.phonePin=null,c.connectionTimes={},c.participantPropertyListener=null,c.locked=!1,c.transcriptionStatus=p.OFF,c}return o(t,e),_(t,[{key:"initPresenceMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.presMap.to=this.myroomjid,this.presMap.xns="http://jabber.org/protocol/muc",this.presMap.nodes=[],this.presMap.nodes.push({tagName:"user-agent",value:navigator.userAgent,attributes:{xmlns:"http://jitsi.org/jitmeet/user-agent"}}),e.enableStatsID&&this.presMap.nodes.push({tagName:"stats-id",value:f.a.callStatsUserName}),this.addVideoInfoToPresence(!1),e.deploymentInfo&&e.deploymentInfo.userRegion&&this.presMap.nodes.push({tagName:"region",attributes:{id:e.deploymentInfo.userRegion,xmlns:"http://jitsi.org/jitsi-meet"}})}},{key:"updateDeviceAvailability",value:function(e){this.presMap.nodes.push({tagName:"devices",children:[{tagName:"audio",value:e.audio},{tagName:"video",value:e.video}]})}},{key:"join",value:function(e){var t=this;this.password=e,this.moderator.allocateConferenceFocus(function(){return t.sendPresence(!0)})}},{key:"sendPresence",value:function(e){var t=this.presMap.to;if(t&&(this.joined||e)){var n=Object(u.$pres)({to:t});e&&(n.c("x",{xmlns:this.presMap.xns}),this.password&&n.c("password").t(this.password).up(),n.up()),C.json2packet(this.presMap.nodes,n),this.connection.send(n),e&&this.connection.flush()}}},{key:"doLeave",value:function(){T.log("do leave",this.myroomjid);var e=Object(u.$pres)({to:this.myroomjid,type:"unavailable"});this.presMap.length=0,this.connection.flush(),this.connection.send(e),this.connection.flush()}},{key:"discoRoomInfo",value:function(){var e=this,t=Object(u.$iq)({type:"get",to:this.roomjid}).c("query",{xmlns:u.Strophe.NS.DISCO_INFO});this.connection.sendIQ(t,function(t){var n=1===$(t).find('>query>feature[var="muc_passwordprotected"]').length;n!==e.locked&&(e.eventEmitter.emit(g.a.MUC_LOCK_CHANGED,n),e.locked=n)},function(e){d.a.callErrorHandler(e),T.error("Error getting room info: ",e)})}},{key:"createNonAnonymousRoom",value:function(){var e=Object(u.$iq)({type:"get",to:this.roomjid}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("x",{xmlns:"jabber:x:data",type:"submit"}),t=this;this.connection.sendIQ(e,function(e){if(!$(e).find('>query>x[xmlns="jabber:x:data"]>field[var="muc#roomconfig_whois"]').length){var n="non-anonymous rooms not supported";return d.a.callErrorHandler(new Error(n)),void T.error(n)}var r=Object(u.$iq)({to:t.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});r.c("x",{xmlns:"jabber:x:data",type:"submit"}),r.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),r.c("field",{var:"muc#roomconfig_whois"}).c("value").t("anyone").up().up(),t.connection.sendIQ(r)},function(e){d.a.callErrorHandler(e),T.error("Error getting room configuration form: ",e)})}},{key:"onPresence",value:function(e){var t=e.getAttribute("from"),n={};n.show=$(e).find(">show").text();var r=$(e).find(">status");r.length&&(n.status=r.text());var i=!1,o=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>item');n.affiliation=o.attr("affiliation"),n.role=o.attr("role");var a=o.attr("jid");n.jid=a,n.isFocus=a&&0===a.indexOf(this.moderator.getFocusUserJid()+"/"),n.isHiddenDomain=a&&a.indexOf("@")>0&&this.options.hiddenDomain===a.substring(a.indexOf("@")+1,a.indexOf("/")),$(e).find(">x").remove();var s=[];C.packet2JSON(e,s),this.lastPresences[t]=s;for(var c=null,l=0;l<s.length;l++){var d=s[l];switch(d.tagName){case"nick":n.nick=d.value;break;case"userId":n.id=d.value;break;case"stats-id":n.statsID=d.value}}if(t===this.myroomjid){var p="owner"===n.affiliation?n.role:"none";if(this.role!==p&&(this.role=p,this.eventEmitter.emit(g.a.LOCAL_ROLE_CHANGED,this.role)),!this.joined){this.joined=!0;var h=this.connectionTimes["muc.joined"]=window.performance.now();T.log("(TIME) MUC joined:\t",h),this.password&&(this.locked=!0),this.eventEmitter.emit(g.a.MUC_JOINED)}}else if(void 0===this.members[t])this.members[t]=n,T.log("entered",t,n),n.isFocus?this._initFocus(t,a):this.eventEmitter.emit(g.a.MUC_MEMBER_JOINED,t,n.nick,n.role,n.isHiddenDomain,n.statsID),i=void 0!==n.status;else{var f=this.members[t];f.role!==n.role&&(f.role=n.role,this.eventEmitter.emit(g.a.MUC_ROLE_CHANGED,t,n.role)),n.isFocus&&(f.isFocus=!0,this._initFocus(t,a)),n.displayName&&(f.displayName=n.displayName),f.status!==n.status&&(i=!0,f.status=n.status)}for(var m=0;m<s.length;m++){var v=s[m];switch(v.tagName){case"nick":if(!n.isFocus){var y=this.xmpp.options.displayJids?u.Strophe.getResourceFromJid(t):n.nick;y&&y.length>0&&this.eventEmitter.emit(g.a.DISPLAY_NAME_CHANGED,t,y)}break;case"bridgeNotAvailable":n.isFocus&&!this.noBridgeAvailable&&(this.noBridgeAvailable=!0,this.eventEmitter.emit(g.a.BRIDGE_DOWN));break;case"jibri-recording-status":c=v;break;case"transcription-status":var b=v.attributes;if(!b)break;var _=b.status;_&&_!==this.transcriptionStatus&&(this.transcriptionStatus=_,this.eventEmitter.emit(g.a.TRANSCRIPTION_STATUS_CHANGED,_));break;case"call-control":var S=v.attributes;if(!S)break;this.phoneNumber=S.phone||null,this.phonePin=S.pin||null,this.eventEmitter.emit(g.a.PHONE_NUMBER_CHANGED);break;default:this.processNode(v,t)}}i&&this.eventEmitter.emit(g.a.PRESENCE_STATUS,t,n.status),c&&(this.lastJibri=c,this.recording&&this.recording.handleJibriPresence(c))}},{key:"_initFocus",value:function(e,t){this.focusMucJid=e,this.recording||(this.recording=new b.a(this.options.recordingType,this.eventEmitter,this.connection,this.focusMucJid,this.options.jirecon,this.roomjid),this.lastJibri&&this.recording.handleJibriPresence(this.lastJibri)),T.info("Ignore focus: "+e+", real JID: "+t)}},{key:"setParticipantPropertyListener",value:function(e){this.participantPropertyListener=e}},{key:"processNode",value:function(e,t){try{var n=this.presHandlers[e.tagName];e.tagName.startsWith("jitsi_participant_")&&(n=[this.participantPropertyListener]),n&&n.forEach(function(n){n(e,u.Strophe.getResourceFromJid(t),t)})}catch(t){d.a.callErrorHandler(t),T.error("Error processing:"+e.tagName+" node.",t)}}},{key:"sendMessage",value:function(e,t){var n=Object(u.$msg)({to:this.roomjid,type:"groupchat"});n.c("body",e).up(),t&&n.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(t).up().up(),this.connection.send(n),this.eventEmitter.emit(g.a.SENDING_CHAT_MESSAGE,e)}},{key:"setSubject",value:function(e){var t=Object(u.$msg)({to:this.roomjid,type:"groupchat"});t.c("subject",e),this.connection.send(t)}},{key:"onParticipantLeft",value:function(e,t){delete this.lastPresences[e],t||(this.eventEmitter.emit(g.a.MUC_MEMBER_LEFT,e),this.moderator.onMucMemberLeft(e))}},{key:"onPresenceUnavailable",value:function(e,t){var n=this;if($(e).find('>ignore[xmlns="http://jitsi.org/jitmeet/"]').length)return!0;if($(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>destroy').length){var r=void 0,i=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>destroy>reason');return i.length&&(r=i.text()),this.eventEmitter.emit(g.a.MUC_DESTROYED,r),this.connection.emuc.doLeave(this.roomjid),!0}var o=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="110"]').length,a=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="307"]').length,s=Object.keys(this.members);o?s.length>0&&(s.forEach(function(e){var t=n.members[e];delete n.members[e],n.onParticipantLeft(e,t.isFocus)}),this.connection.emuc.doLeave(this.roomjid),a||this.eventEmitter.emit(g.a.MUC_LEFT)):(delete this.members[t],this.onParticipantLeft(t,!1)),a&&this.myroomjid===t&&this.eventEmitter.emit(g.a.KICKED)}},{key:"onMessage",value:function(e,t){var n=$(e).find('>nick[xmlns="http://jabber.org/protocol/nick"]').text()||u.Strophe.getResourceFromJid(t),r=$(e).find(">body").text();if("error"===e.getAttribute("type"))return this.eventEmitter.emit(g.a.CHAT_ERROR_RECEIVED,$(e).find(">text").text(),r),!0;var i=$(e).find(">subject");if(i.length){var o=i.text();(o||""===o)&&(this.eventEmitter.emit(g.a.SUBJECT_CHANGED,o),T.log("Subject is changed to "+o))}var a=$(e).find(">delay").attr("stamp");if(!a&&(a=$(e).find('>[xmlns="jabber:x:delay"]').attr("stamp"))){var c=a.match(/(\d{4})(\d{2})(\d{2}T\d{2}:\d{2}:\d{2})/);a=c[1]+"-"+c[2]+"-"+c[3]+"Z"}t===this.roomjid&&$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="104"]').length&&this.discoRoomInfo();var l=s(r);if(l)return void this.eventEmitter.emit(g.a.JSON_MESSAGE_RECEIVED,t,l);r&&(T.log("chat",n,r),this.eventEmitter.emit(g.a.MESSAGE_RECEIVED,t,n,r,this.myroomjid,a))}},{key:"onPresenceError",value:function(e,t){if($(e).find('>error[type="auth"]>not-authorized[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').length)T.log("on password required",t),this.eventEmitter.emit(g.a.PASSWORD_REQUIRED);else if($(e).find('>error[type="cancel"]>not-allowed[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').length){var n=u.Strophe.getDomainFromJid(e.getAttribute("to"));n===this.xmpp.options.hosts.anonymousdomain?this.eventEmitter.emit(g.a.ROOM_JOIN_ERROR):(T.warn("onPresError ",e),this.eventEmitter.emit(g.a.ROOM_CONNECT_NOT_ALLOWED_ERROR))}else $(e).find(">error>service-unavailable").length?(T.warn("Maximum users limit for the room has been reached",e),this.eventEmitter.emit(g.a.ROOM_MAX_USERS_ERROR)):(T.warn("onPresError ",e),this.eventEmitter.emit(g.a.ROOM_CONNECT_ERROR))}},{key:"kick",value:function(e){var t=Object(u.$iq)({to:this.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{nick:u.Strophe.getResourceFromJid(e),role:"none"}).c("reason").t("You have been kicked.").up().up().up();this.connection.sendIQ(t,function(t){return T.log("Kick participant with jid: ",e,t)},function(e){return T.log("Kick participant error: ",e)})}},{key:"lockRoom",value:function(e,t,n,r){var i=this;this.connection.sendIQ(Object(u.$iq)({to:this.roomjid,type:"get"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}),function(o){if($(o).find('>query>x[xmlns="jabber:x:data"]>field[var="muc#roomconfig_roomsecret"]').length){var a=Object(u.$iq)({to:i.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});a.c("x",{xmlns:"jabber:x:data",type:"submit"}),a.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),a.c("field",{var:"muc#roomconfig_roomsecret"}).c("value").t(e).up().up(),a.c("field",{var:"muc#roomconfig_whois"}).c("value").t("anyone").up().up(),i.connection.sendIQ(a,t,n)}else r()},n)}},{key:"addToPresence",value:function(e,t){t.tagName=e,this.removeFromPresence(e),this.presMap.nodes.push(t)}},{key:"removeFromPresence",value:function(e){var t=this.presMap.nodes.filter(function(t){return e!==t.tagName});this.presMap.nodes=t}},{key:"addPresenceListener",value:function(e,t){if("function"!=typeof t)throw new Error('"handler" is not a function');var n=this.presHandlers[e];n||(this.presHandlers[e]=n=[]),-1===n.indexOf(t)?n.push(t):T.warn("Trying to add the same handler more than once for: "+e)}},{key:"removePresenceListener",value:function(e,t){var n=this.presHandlers[e],r=n?n.indexOf(t):-1;-1!==r?n.splice(r,1):T.warn("Handler for: "+e+" was not registered")}},{key:"isFocus",value:function(e){var t=this.members[e];return t?t.isFocus:null}},{key:"isModerator",value:function(){return"moderator"===this.role}},{key:"getMemberRole",value:function(e){return this.members[e]?this.members[e].role:null}},{key:"setVideoMute",value:function(e,t){this.sendVideoInfoPresence(e),t&&t(e)}},{key:"setAudioMute",value:function(e,t){return this.sendAudioInfoPresence(e,t)}},{key:"addAudioInfoToPresence",value:function(e){this.removeFromPresence("audiomuted"),this.addToPresence("audiomuted",{attributes:{xmlns:"http://jitsi.org/jitmeet/audio"},value:e.toString()})}},{key:"sendAudioInfoPresence",value:function(e,t){this.addAudioInfoToPresence(e),this.connection&&this.sendPresence(),t&&t()}},{key:"addVideoInfoToPresence",value:function(e){this.removeFromPresence("videomuted"),this.addToPresence("videomuted",{attributes:{xmlns:"http://jitsi.org/jitmeet/video"},value:e.toString()})}},{key:"sendVideoInfoPresence",value:function(e){this.addVideoInfoToPresence(e),this.connection&&this.sendPresence()}},{key:"getMediaPresenceInfo",value:function(e,t){var n=this.lastPresences[this.roomjid+"/"+e];if(!n)return null;var r={muted:!1,videoType:void 0},i=null;if(t===m.a)i=a(n,"audiomuted");else{if(t!==m.b)return T.error("Unsupported media type: "+t),null;i=a(n,"videomuted");var o=a(n,"videoType");o.length>0&&(r.videoType=o[0].value)}return r.muted=i.length>0&&"true"===i[0].value,r}},{key:"isRecordingSupported",value:function(){return!!this.recording&&this.recording.isSupported()}},{key:"getRecordingState",value:function(){return this.recording?this.recording.getState():void 0}},{key:"getRecordingURL",value:function(){return this.recording?this.recording.getURL():null}},{key:"toggleRecording",value:function(e,t){return this.recording?this.recording.toggleRecording(e,t):t("error",new Error("The conference is not created yet!"))}},{key:"isSIPCallingSupported",value:function(){return!!this.moderator&&this.moderator.isSipGatewayEnabled()}},{key:"dial",value:function(e){return this.connection.rayo.dial(e,"fromnumber",u.Strophe.getBareJidFromJid(this.myroomjid),this.password,this.focusMucJid)}},{key:"hangup",value:function(){return this.connection.rayo.hangup()}},{key:"getPhoneNumber",value:function(){return this.phoneNumber}},{key:"getPhonePin",value:function(){return this.phonePin}},{key:"muteParticipant",value:function(e,t){T.info("set mute",t);var n=Object(u.$iq)({to:this.focusMucJid,type:"set"}).c("mute",{xmlns:"http://jitsi.org/jitmeet/audio",jid:e}).t(t.toString()).up();this.connection.sendIQ(n,function(e){return T.log("set mute",e)},function(e){return T.log("set mute error",e)})}},{key:"onMute",value:function(e){if(e.getAttribute("from")!==this.focusMucJid)return T.warn("Ignored mute from non focus peer"),!1;var t=$(e).find("mute");if(t.length){var n="true"===t.text();this.eventEmitter.emit(g.a.AUDIO_MUTED_BY_FOCUS,n)}return!0}},{key:"leave",value:function(){var e=this;return new Promise(function(t,n){function r(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];o.removeListener(g.a.MUC_LEFT,r),clearTimeout(i),e?n(new Error("The timeout for the confirmation about leaving the room expired.")):t()}var i=setTimeout(function(){return r(!0)},5e3),o=e.eventEmitter;o.on(g.a.MUC_LEFT,r),e.doLeave()})}}]),t}(h.a);t.a=w}).call(t,"modules/xmpp/ChatRoom.js")},function(e,t,n){"use strict";(function(e){function r(e){var t=1;return function(n){if(n)return void(t=1);var r=Math.pow(2,t-1);return t+=1,r*e}}function i(e,t,n,i){function o(e){if(e.data&&e.data.sessionId){if(e.origin!==window.location.origin)return void c.warn("Ignoring sessionId from different origin: "+e.origin);s.a.sessionId=e.data.sessionId}}this.roomName=e,this.xmppService=t,this.getNextTimeout=r(1e3),this.getNextErrorTimeout=r(1e3),this.externalAuthEnabled=!1,this.options=i,this.sipGatewayEnabled=this.options.connection.hosts&&void 0!==this.options.connection.hosts.call_control,this.eventEmitter=n,this.connection=this.xmppService.connection,window.addEventListener?window.addEventListener("message",o,!1):window.attachEvent("onmessage",o)}t.a=i;var o=n(2),a=(n.n(o),n(1)),s=n(18),c=n(0).getLogger(e),u=n(7),l=n(47),d=n(3);i.prototype.isExternalAuthEnabled=function(){return this.externalAuthEnabled},i.prototype.isSipGatewayEnabled=function(){return this.sipGatewayEnabled},i.prototype.onMucMemberLeft=function(e){c.info("Someone left is it focus ? "+e),"focus"===o.Strophe.getResourceFromJid(e)&&(c.info("Focus has left the room - leaving conference"),this.eventEmitter.emit(u.FOCUS_LEFT))},i.prototype.setFocusUserJid=function(e){this.focusUserJid||(this.focusUserJid=e,c.info("Focus jid set to:  "+this.focusUserJid))},i.prototype.getFocusUserJid=function(){return this.focusUserJid},i.prototype.getFocusComponent=function(){var e=this.options.connection.hosts.focus;return e||(e="focus."+this.options.connection.hosts.domain),e},i.prototype.createConferenceIq=function(){var e=Object(o.$iq)({to:this.getFocusComponent(),type:"set"}),t=s.a.sessionId,n=s.a.machineId;c.info("Session ID: "+t+" machine UID: "+n),e.c("conference",{xmlns:"http://jitsi.org/protocol/focus",room:this.roomName,"machine-uid":n}),t&&e.attrs({"session-id":t}),void 0!==this.options.connection.enforcedBridge&&e.c("property",{name:"enforcedBridge",value:this.options.connection.enforcedBridge}).up(),void 0!==this.options.connection.hosts&&void 0!==this.options.connection.hosts.call_control&&e.c("property",{name:"call_control",value:this.options.connection.hosts.call_control}).up(),void 0!==this.options.conference.channelLastN&&e.c("property",{name:"channelLastN",value:this.options.conference.channelLastN}).up(),e.c("property",{name:"disableRtx",value:Boolean(this.options.conference.disableRtx)}).up(),e.c("property",{name:"enableLipSync",value:!1!==this.options.connection.enableLipSync}).up(),void 0!==this.options.conference.audioPacketDelay&&e.c("property",{name:"audioPacketDelay",value:this.options.conference.audioPacketDelay}).up(),this.options.conference.startBitrate&&e.c("property",{name:"startBitrate",value:this.options.conference.startBitrate}).up(),this.options.conference.minBitrate&&e.c("property",{name:"minBitrate",value:this.options.conference.minBitrate}).up();var r=void 0;switch(this.options.conference.openBridgeChannel){case"datachannel":case!0:case void 0:r=!0;break;case"websocket":r=!1}return r&&!a.a.supportsDataChannels()&&(r=!1),e.c("property",{name:"openSctp",value:r}).up(),void 0!==this.options.conference.startAudioMuted&&e.c("property",{name:"startAudioMuted",value:this.options.conference.startAudioMuted}).up(),void 0!==this.options.conference.startVideoMuted&&e.c("property",{name:"startVideoMuted",value:this.options.conference.startVideoMuted}).up(),void 0!==this.options.conference.stereo&&e.c("property",{name:"stereo",value:this.options.conference.stereo}).up(),void 0!==this.options.conference.useRoomAsSharedDocumentName&&e.c("property",{name:"useRoomAsSharedDocumentName",value:this.options.conference.useRoomAsSharedDocumentName}).up(),e.up(),e},i.prototype.parseSessionId=function(e){var t=$(e).find("conference").attr("session-id");t&&(c.info("Received sessionId:  "+t),s.a.sessionId=t)},i.prototype.parseConfigOptions=function(e){this.setFocusUserJid($(e).find("conference").attr("focusjid"));var t=$(e).find(">conference>property[name='authentication'][value='true']").length>0;c.info("Authentication enabled: "+t),this.externalAuthEnabled=$(e).find(">conference>property[name='externalAuth'][value='true']").length>0,c.info("External authentication enabled: "+this.externalAuthEnabled),this.externalAuthEnabled||this.parseSessionId(e);var n=$(e).find(">conference").attr("identity");this.eventEmitter.emit(l.IDENTITY_UPDATED,t,n),$(e).find(">conference>property[name='sipGatewayEnabled'][value='true']").length&&(this.sipGatewayEnabled=!0),c.info("Sip gateway enabled:  "+this.sipGatewayEnabled)},i.prototype.allocateConferenceFocus=function(e){var t=this;this.setFocusUserJid(this.options.connection.focusUserJid),this.connection.sendIQ(this.createConferenceIq(),function(n){return t._allocateConferenceFocusSuccess(n,e)},function(n){return t._allocateConferenceFocusError(n,e)}),this.connection.flush()},i.prototype._allocateConferenceFocusError=function(e,t){var n=this,r=$(e).find(">error>session-invalid").length||$(e).find(">error>not-acceptable").length;if(r&&(c.info("Session expired! - removing"),s.a.sessionId=void 0),$(e).find(">error>graceful-shutdown").length)return void this.eventEmitter.emit(u.GRACEFUL_SHUTDOWN);var i=$(e).find(">error>reservation-error");if(i.length){var a=i.attr("error-code"),l=$(e).find(">error>text"),p=void 0;return l&&(p=l.text()),void this.eventEmitter.emit(u.RESERVATION_ERROR,a,p)}if($(e).find(">error>not-authorized").length)return c.warn("Unauthorized to start the conference",e),o.Strophe.getDomainFromJid(e.getAttribute("to"))!==this.options.connection.hosts.anonymousdomain&&(this.externalAuthEnabled=!0),void this.eventEmitter.emit(u.AUTHENTICATION_REQUIRED);var h=this.getNextErrorTimeout(),f="Focus error, retry after "+h;d.callErrorHandler(new Error(f)),c.error(f,e);var m=this.getFocusComponent(),v=h/1e3;r||this.eventEmitter.emit(u.FOCUS_DISCONNECTED,m,v),this.getNextTimeout(!0),window.setTimeout(function(){return n.allocateConferenceFocus(t)},h)},i.prototype._allocateConferenceFocusSuccess=function(e,t){var n=this;if(this.parseConfigOptions(e),this.getNextErrorTimeout(!0),"true"===$(e).find("conference").attr("ready"))this.getNextTimeout(!0),t();else{var r=this.getNextTimeout();c.info("Waiting for the focus... "+r),window.setTimeout(function(){return n.allocateConferenceFocus(t)},r)}},i.prototype.authenticate=function(){var e=this;return new Promise(function(t,n){e.connection.sendIQ(e.createConferenceIq(),function(n){e.parseSessionId(n),t()},function(e){return n({error:$(e).find("iq>error :first").prop("tagName"),message:$(e).find("iq>error>text").text()})})})},i.prototype.getLoginUrl=function(e,t){this._getLoginUrl(!1,e,t)},i.prototype._getLoginUrl=function(e,t,n){function r(e,t){d.callErrorHandler(new Error(e)),c.error(e,t),n(t)}var i=Object(o.$iq)({to:this.getFocusComponent(),type:"get"}),a={xmlns:"http://jitsi.org/protocol/focus",room:this.roomName,"machine-uid":s.a.machineId},u="auth url";e&&(a.popup=!0,u="POPUP "+u),i.c("login-url",a),this.connection.sendIQ(i,function(e){var n=$(e).find("login-url").attr("url");n=decodeURIComponent(n),n?(c.info("Got "+u+": "+n),t(n)):r("Failed to get "+u+" from the focus",e)},r.bind(void 0,"Get "+u+" error"))},i.prototype.getPopupLoginUrl=function(e,t){this._getLoginUrl(!0,e,t)},i.prototype.logout=function(e){var t=Object(o.$iq)({to:this.getFocusComponent(),type:"set"}),n=s.a.sessionId;if(!n)return void e();t.c("logout",{xmlns:"http://jitsi.org/protocol/focus","session-id":n}),this.connection.sendIQ(t,function(t){var n=$(t).find("logout").attr("logout-url");n&&(n=decodeURIComponent(n)),c.info("Log out OK, url: "+n,t),s.a.sessionId=void 0,e(n)},function(e){d.callErrorHandler(new Error("Logout error")),c.error("Logout error",e)})}}).call(t,"modules/xmpp/moderator.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,n){c.Strophe.addConnectionPlugin("jingle",new S(e,t,n))}t.a=a;var s=n(0),c=(n.n(s),n(2)),u=(n.n(c),n(7)),l=n.n(u),d=n(3),p=n.n(d),h=n(19),f=n.n(h),m=n(5),v=n(100),g=n(22),y=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),b=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},_=Object(s.getLogger)(e),S=function(e){function t(e,n,o){r(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.xmpp=e,a.eventEmitter=n,a.sessions={},a.jvbIceConfig={iceServers:[]},a.p2pIceConfig={iceServers:[]},Array.isArray(o)&&(_.info("Configured STUN servers: ",o),a.p2pIceConfig.iceServers=o),a.mediaConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},a}return o(t,e),y(t,[{key:"init",value:function(e){b(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this.connection.addHandler(this.onJingle.bind(this),"urn:xmpp:jingle:1","iq","set",null,null)}},{key:"onJingle",value:function(e){var t=$(e).find("jingle").attr("sid"),n=$(e).find("jingle").attr("action"),r=e.getAttribute("from"),i=Object(c.$iq)({type:"result",to:r,id:e.getAttribute("id")});_.log("on jingle "+n+" from "+r,e);var o=this.sessions[t];if("session-initiate"!==n){if(!o)return i.attrs({type:"error"}),i.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),_.warn("invalid session id",e),this.connection.send(i),!0;if(r!==o.peerjid)return _.warn("jid mismatch for session id",t,o.peerjid,e),i.attrs({type:"error"}),i.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),this.connection.send(i),!0}else if(void 0!==o)return i.attrs({type:"error"}),i.c("error",{type:"cancel"}).c("service-unavailable",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up(),_.warn("duplicate session id",t,e),this.connection.send(i),!0;var a=window.performance.now();switch(n){case"session-initiate":_.log("(TIME) received session-initiate:\t",a);var s=$(e).find("jingle>startmuted");if(s&&s.length>0){var u=s.attr("audio"),d=s.attr("video");this.eventEmitter.emit(l.a.START_MUTED_FROM_FOCUS,"true"===u,"true"===d)}var h="focus"!==c.Strophe.getResourceFromJid(r);_.info("Marking session from "+r+" as "+(h?"":"*not*")+" P2P"),o=new v.a($(e).find("jingle").attr("sid"),$(e).attr("to"),r,this.connection,this.mediaConstraints,h?this.p2pIceConfig:this.jvbIceConfig,h,!1,this.xmpp.options),this.sessions[o.sid]=o,this.eventEmitter.emit(l.a.CALL_INCOMING,o,$(e).find(">jingle"),a),m.a.analytics.sendEvent("xmpp.session-initiate",{value:a});break;case"session-accept":this.eventEmitter.emit(l.a.CALL_ACCEPTED,o,$(e).find(">jingle"));break;case"content-modify":o.modifyContents($(e).find(">jingle"));break;case"transport-info":this.eventEmitter.emit(l.a.TRANSPORT_INFO,o,$(e).find(">jingle"));break;case"session-terminate":_.log("terminating...",o.sid);var f=null,g=null;$(e).find(">jingle>reason").length&&(f=$(e).find(">jingle>reason>:first")[0].tagName,g=$(e).find(">jingle>reason>text").text()),this.terminate(o.sid,f,g),this.eventEmitter.emit(l.a.CALL_ENDED,o,f,g);break;case"transport-replace":_.info("(TIME) Start transport replace",a),m.a.analytics.sendEvent("xmpp.transport-replace.start",{value:a}),o.replaceTransport($(e).find(">jingle"),function(){var e=window.performance.now();_.info("(TIME) Transport replace success!",e),m.a.analytics.sendEvent("xmpp.transport-replace.success",{value:e})},function(e){p.a.callErrorHandler(e),_.error("Transport replace failed",e),o.sendTransportReject()});break;case"addsource":case"source-add":o.addRemoteStream($(e).find(">jingle>content"));break;case"removesource":case"source-remove":o.removeRemoteStream($(e).find(">jingle>content"));break;default:_.warn("jingle action not implemented",n),i.attrs({type:"error"}),i.c("error",{type:"cancel"}).c("bad-request",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up()}return this.connection.send(i),!0}},{key:"newP2PJingleSession",value:function(e,t){var n=new v.a(f.a.randomHexString(12),e,t,this.connection,this.mediaConstraints,this.p2pIceConfig,!0,!0,this.xmpp.options);return this.sessions[n.sid]=n,n}},{key:"terminate",value:function(e,t,n){this.sessions.hasOwnProperty(e)&&("ended"!==this.sessions[e].state&&this.sessions[e].onTerminated(t,n),delete this.sessions[e])}},{key:"getStunAndTurnCredentials",value:function(){var e=this;this.connection.sendIQ(Object(c.$iq)({type:"get",to:this.connection.domain}).c("services",{xmlns:"urn:xmpp:extdisco:1"}).c("service",{host:"turn."+this.connection.domain}),function(t){var n=[];$(t).find(">services>service").each(function(e,t){t=$(t);var r={},i=t.attr("type");switch(i){case"stun":r.url="stun:"+t.attr("host"),t.attr("port")&&(r.url+=":"+t.attr("port")),n.push(r);break;case"turn":case"turns":r.url=i+":";var o=t.attr("username");if(o){var a=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);a&&parseInt(a[2],10)<28?r.url+=o+"@":r.username=o}r.url+=t.attr("host");var s=t.attr("port");s&&"3478"!==s&&(r.url+=":"+t.attr("port"));var c=t.attr("transport");c&&"udp"!==c&&(r.url+="?transport="+c),r.credential=t.attr("password")||r.credential,n.push(r)}});var r=e.xmpp.options;r.useStunTurn&&(e.jvbIceConfig.iceServers=n),r.p2p&&r.p2p.useStunTurn&&(e.p2pIceConfig.iceServers=n)},function(e){_.warn("getting turn credentials failed",e),_.warn("is mod_turncredentials or similar installed?")})}},{key:"getLog",value:function(){var e=this,t={};return Object.keys(this.sessions).forEach(function(n){var r=e.sessions[n],i=r.peerconnection;i&&i.updateLog&&(t["jingle_"+n]={updateLog:i.updateLog,stats:i.stats,url:window.location.href})}),t}}]),t}(g.b)}).call(t,"modules/xmpp/strophe.jingle.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(101),s=n.n(a),c=n(0),u=(n.n(c),n(2)),l=(n.n(u),n(102)),d=n(50),p=n(51),h=n(103),f=n(12),m=n(104),v=n(5),g=n(7),y=n.n(g),b=n(3),_=n.n(b),S=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),T=Object(c.getLogger)(e),C=function(e){function t(e,n,o,a,c,u,l,d,p){r(this,t);var h=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,a,c,u));return h._iceCheckingStartedTimestamp=null,h._gatheringStartedTimestamp=null,h._localVideoActive=!0,h._remoteVideoActive=!0,h._gatheringReported=!1,h.lasticecandidate=!1,h.closed=!1,h.isInitiator=d,h.isP2P=l,h.signalingLayer=new m.a,h.webrtcIceUdpDisable=Boolean(p.webrtcIceUdpDisable),h.webrtcIceTcpDisable=Boolean(p.webrtcIceTcpDisable),h.failICE=Boolean(p.failICE),h.modificationQueue=s.a.queue(h._processQueueTasks.bind(h),1),h.wasConnected=!1,h.establishmentDuration=void 0,h}return o(t,e),S(t,null,[{key:"parseVideoSenders",value:function(e){var t=e.find('>content[name="video"]');if(t.length){var n=t[0].getAttribute("senders");if("both"===n||"initiator"===n||"responder"===n||"none"===n)return n}return null}}]),S(t,[{key:"_assertNotEnded",value:function(e){return this.state!==d.b||(T.log("The session has ended - cancelling action: "+e),!1)}},{key:"doInitialize",value:function(){var e=this;this.lasticecandidate=!1,this.isreconnect=!1,this.wasstable=!1,this.isP2P?this.peerconnection=this.rtc.createPeerConnection(this.signalingLayer,this.iceConfig,this.isP2P,{disableSimulcast:!0,disableRtx:this.room.options.disableRtx,disableH264:this.room.options.p2p&&this.room.options.p2p.disableH264,preferH264:this.room.options.p2p&&this.room.options.p2p.preferH264}):this.peerconnection=this.rtc.createPeerConnection(this.signalingLayer,this.iceConfig,this.isP2P,{disableSimulcast:this.room.options.disableSimulcast||this.room.options.preferH264&&!this.room.options.disableH264,disableRtx:this.room.options.disableRtx,disableH264:this.room.options.disableH264,preferH264:this.room.options.preferH264,enableFirefoxSimulcast:this.room.options.testing&&this.room.options.testing.enableFirefoxSimulcast}),this.peerconnection.onicecandidate=function(t){if(t){var n=t.candidate,r=window.performance.now();if(n){null===e._gatheringStartedTimestamp&&(e._gatheringStartedTimestamp=r);var i=n.protocol;if("string"==typeof i)if("tcp"===(i=i.toLowerCase())||"ssltcp"===i){if(e.webrtcIceTcpDisable)return}else if("udp"===i&&e.webrtcIceUdpDisable)return}else if(!e._gatheringReported){var o=e.isP2P?"p2p.ice.":"ice.";o+=e.isInitiator?"initiator":"responder",o+=".gatheringDuration",v.a.analytics.sendEvent(o,{value:r-e._gatheringStartedTimestamp}),e._gatheringReported=!0}e.sendIceCandidate(n)}},this.peerconnection.onsignalingstatechange=function(){e.peerconnection&&("stable"===e.peerconnection.signalingState?e.wasstable=!0:"closed"!==e.peerconnection.signalingState&&"closed"!==e.peerconnection.connectionState||e.closed||e.room.eventEmitter.emit(y.a.SUSPEND_DETECTED,e))},this.peerconnection.oniceconnectionstatechange=function(){if(e.peerconnection&&e._assertNotEnded("oniceconnectionstatechange")){var t=window.performance.now();switch(e.isP2P||(e.room.connectionTimes["ice.state."+e.peerconnection.iceConnectionState]=t),T.log("(TIME) ICE "+e.peerconnection.iceConnectionState+" P2P? "+e.isP2P+":\t",t),v.a.analytics.sendEvent((e.isP2P?"p2p.ice.":"ice.")+e.peerconnection.iceConnectionState,{value:t}),e.room.eventEmitter.emit(y.a.ICE_CONNECTION_STATE_CHANGED,e,e.peerconnection.iceConnectionState),e.peerconnection.iceConnectionState){case"checking":e._iceCheckingStartedTimestamp=t;break;case"connected":if("stable"===e.peerconnection.signalingState&&e.isreconnect&&e.room.eventEmitter.emit(y.a.CONNECTION_RESTORED,e),!e.wasConnected&&e.wasstable){var n=e.isP2P?"p2p.ice.":"ice.";n+=e.isInitiator?"initiator.":"responder.",v.a.analytics.sendEvent(n+"checksDuration",{value:t-e._iceCheckingStartedTimestamp});var r=Math.min(e._iceCheckingStartedTimestamp,e._gatheringStartedTimestamp);e.establishmentDuration=t-r,v.a.analytics.sendEvent(n+"establishmentDuration",{value:e.establishmentDuration}),e.wasConnected=!0,e.room.eventEmitter.emit(y.a.CONNECTION_ESTABLISHED,e)}e.isreconnect=!1;break;case"disconnected":if(e.closed)break;e.isreconnect=!0,e.wasstable&&e.room.eventEmitter.emit(y.a.CONNECTION_INTERRUPTED,e);break;case"failed":e.room.eventEmitter.emit(y.a.CONNECTION_ICE_FAILED,e),e.room.eventEmitter.emit(y.a.CONFERENCE_SETUP_FAILED,e,new Error("ICE fail"))}}},this.peerconnection.onnegotiationneeded=function(){e.room.eventEmitter.emit(y.a.PEERCONNECTION_READY,e)},this.signalingLayer.setChatRoom(this.room)}},{key:"sendIceCandidate",value:function(e){var t=this,n=new p.a(this.peerconnection.localDescription.sdp);if(e&&!this.lasticecandidate){var r=f.a.iceparams(n.media[e.sdpMLineIndex],n.session),i=f.a.candidateToJingle(e.candidate);if(!r||!i)return _.a.callErrorHandler(new Error("failed to get ice && jcand")),void T.error("failed to get ice && jcand");r.xmlns="urn:xmpp:jingle:transports:ice-udp:1",this.usedrip?(0===this.dripContainer.length&&setTimeout(function(){0!==t.dripContainer.length&&(t.sendIceCandidates(t.dripContainer),t.dripContainer=[])},20),this.dripContainer.push(e)):this.sendIceCandidates([e])}else T.log("sendIceCandidate: last candidate."),this.lasticecandidate=!0}},{key:"sendIceCandidates",value:function(e){var t=this;if(this._assertNotEnded("sendIceCandidates")){T.log("sendIceCandidates",e);for(var n=Object(u.$iq)({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-info",initiator:this.initiator,sid:this.sid}),r=new p.a(this.peerconnection.localDescription.sdp),i=0;i<r.media.length;i++)!function(i){var o=e.filter(function(e){return e.sdpMLineIndex===i}),a=f.a.parseMLine(r.media[i].split("\r\n")[0]);if(o.length>0){var s=f.a.iceparams(r.media[i],r.session);s.xmlns="urn:xmpp:jingle:transports:ice-udp:1",n.c("content",{creator:t.initiator===t.localJid?"initiator":"responder",name:o[0].sdpMid?o[0].sdpMid:a.media}).c("transport",s);for(var c=0;c<o.length;c++){var u=f.a.candidateToJingle(o[c].candidate);t.failICE&&(u.ip="1.1.1.1"),n.c("candidate",u).up()}var l=f.a.findLine(r.media[i],"a=fingerprint:",r.session);if(l){var d=f.a.parseFingerprint(l);d.required=!0,n.c("fingerprint",{xmlns:"urn:xmpp:jingle:apps:dtls:0"}).t(d.fingerprint),delete d.fingerprint,n.attrs(d),n.up()}n.up(),n.up()}}(i);this.connection.sendIQ(n,null,this.newJingleErrorHandler(n),1e4)}}},{key:"addIceCandidates",value:function(e){var t=this;if("closed"===this.peerconnection.signalingState)return void T.warn("Ignored add ICE candidate when in closed state");var n=[];if(e.find(">content>transport>candidate").each(function(e,t){var r=f.a.candidateFromJingle(t);r=r.replace("\r\n","").replace("a=","");var i=new RTCIceCandidate({sdpMLineIndex:0,sdpMid:"",candidate:r});n.push(i)}),!n.length)return void T.error("No ICE candidates to add ?",e[0]&&e[0].outerHTML);var r=function(e){var r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;t.peerconnection.addIceCandidate(c,function(){T.debug("addIceCandidate ok!")},function(e){T.error("addIceCandidate failed!",e)})}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}e()};T.debug("Queued add ("+n.length+") ICE candidates task..."),this.modificationQueue.push(r)}},{key:"readSsrcInfo",value:function(e){var t=this;$(e).find('>description>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(e,n){var r=Number(n.getAttribute("ssrc"));t.isP2P?t.signalingLayer.setSSRCOwner(r,u.Strophe.getResourceFromJid(t.peerjid)):$(n).find('>ssrc-info[xmlns="http://jitsi.org/jitmeet"]').each(function(e,n){var i=n.getAttribute("owner");i&&i.length&&(isNaN(r)||r<0?T.warn("Invalid SSRC "+r+" value received for "+i):t.signalingLayer.setSSRCOwner(r,u.Strophe.getResourceFromJid(i)))})})}},{key:"generateRecvonlySsrc",value:function(){this.peerconnection?this.peerconnection.generateRecvonlySsrc():T.error("Unable to generate recvonly SSRC - no peerconnection")}},{key:"acceptOffer",value:function(e,t,n,r){var i=this;this.setOfferAnswerCycle(e,function(){i.sendSessionAccept(t,n)},n,r)}},{key:"invite",value:function(e){var t=this;if(!this.isInitiator)throw new Error("Trying to invite from the responder session");var n=function(n){var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;t.peerconnection.addTrack(c)}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}t.peerconnection.createOffer(function(e){t.peerconnection.setLocalDescription(e,function(){t.sendSessionInitiate(t.peerconnection.localDescription.sdp),n()},function(t){T.error("Failed to set local SDP",t,e),n(t)})},function(e){T.error("Failed to create an offer",e,t.mediaConstraints),n(e)},t.mediaConstraints)};this.modificationQueue.push(n,function(e){e?T.error("invite error",e):T.debug("invite executed - OK")})}},{key:"sendSessionInitiate",value:function(e){var t=Object(u.$iq)({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-initiate",initiator:this.initiator,sid:this.sid});new p.a(e).toJingle(t,this.initiator===this.me?"initiator":"responder"),t=t.tree(),T.info("Session-initiate: ",t),this.connection.sendIQ(t,function(){T.info('Got RESULT for "session-initiate"')},function(e){T.error('"session-initiate" error',e)},1e4)}},{key:"setAnswer",value:function(e){if(!this.isInitiator)throw new Error("Trying to set an answer on the responder session");this.setOfferAnswerCycle(e,function(){T.info("setAnswer - succeeded")},function(e){T.error("setAnswer failed: ",e)})}},{key:"setOfferAnswerCycle",value:function(e,n,r,i){var o=this,a=function(n){if(i){var r=!0,a=!1,s=void 0;try{for(var c,u=i[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var l=c.value;o.peerconnection.addTrack(l)}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}}var h=o._processNewJingleOfferIq(e),f=o.peerconnection.localDescription.sdp;o._renegotiate(h.raw).then(function(){if(o.state===d.c&&(o.state=d.a,o.isP2P&&!o._localVideoActive&&o.sendContentModify(o._localVideoActive)),f){var e=new p.a(o.peerconnection.localDescription.sdp);o.notifyMySSRCUpdate(new p.a(f),e)}n()},function(e){T.error("Error renegotiating after setting new remote "+(o.isInitiator?"answer: ":"offer: ")+e,h),t.onJingleFatalError(o,e),n(e)})};this.modificationQueue.push(a,function(e){e?r(e):n()})}},{key:"replaceTransport",value:function(e,t,n){var r=this;this.room.eventEmitter.emit(y.a.ICE_RESTARTING,this);var i=e.clone();e.find(">content[name='data']").remove(),this.setOfferAnswerCycle(e,function(){r.setOfferAnswerCycle(i,function(){var e=new p.a(r.peerconnection.localDescription.sdp);r.sendTransportAccept(e,t,n)},n)},n)}},{key:"sendSessionAccept",value:function(e,t){var n=this,r=new p.a(this.peerconnection.localDescription.sdp),i=Object(u.$iq)({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-accept",initiator:this.initiator,responder:this.responder,sid:this.sid});this.webrtcIceTcpDisable&&(r.removeTcpCandidates=!0),this.webrtcIceUdpDisable&&(r.removeUdpCandidates=!0),this.failICE&&(r.failICE=!0),r.toJingle(i,this.initiator===this.localJid?"initiator":"responder",null),i=i.tree(),T.info("Sending session-accept",i),this.connection.sendIQ(i,e,this.newJingleErrorHandler(i,function(e){t(e),n.room.eventEmitter.emit(y.a.SESSION_ACCEPT_TIMEOUT,n)}),1e4)}},{key:"sendContentModify",value:function(e){var t=e?"both":"none",n=Object(u.$iq)({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"content-modify",initiator:this.initiator,sid:this.sid}).c("content",{name:"video",senders:t});T.info("Sending content-modify, video senders: "+t),this.connection.sendIQ(n,null,this.newJingleErrorHandler(n),1e4)}},{key:"sendTransportAccept",value:function(e,t,n){var r=this,i=Object(u.$iq)({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-accept",initiator:this.initiator,sid:this.sid});e.media.forEach(function(t,n){var o=f.a.parseMLine(t.split("\r\n")[0]);i.c("content",{creator:r.initiator===r.localJid?"initiator":"responder",name:o.media}),e.transportToJingle(n,i),i.up()}),i=i.tree(),T.info("Sending transport-accept: ",i),this.connection.sendIQ(i,t,this.newJingleErrorHandler(i,n),1e4)}},{key:"sendTransportReject",value:function(e,t){var n=Object(u.$iq)({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-reject",initiator:this.initiator,sid:this.sid});n=n.tree(),T.info("Sending 'transport-reject",n),this.connection.sendIQ(n,e,this.newJingleErrorHandler(n,t),1e4)}},{key:"terminate",value:function(e,t,n){if(this.state!==d.b){if(!n||Boolean(n.sendSessionTerminate)){var r=Object(u.$iq)({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-terminate",initiator:this.initiator,sid:this.sid}).c("reason").c(n&&n.reason||"success");n&&n.reasonDescription&&r.up().c("text").t(n.reasonDescription),r=r.tree(),T.info("Sending session-terminate",r),this.connection.sendIQ(r,e,this.newJingleErrorHandler(r,t),1e4)}else T.info("Skipped sending session-terminate for "+this);this.connection.jingle.terminate(this.sid)}}},{key:"onTerminated",value:function(e,t){this.state=d.b,this.establishmentDuration=void 0,T.info("Session terminated "+this,e,t),this.close()}},{key:"_parseSsrcInfoFromSourceAdd",value:function(e,t){var n=[];return $(e).each(function(e,r){var i=$(r).attr("name"),o="";$(r).find('ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map(function(){return this.getAttribute("ssrc")}).get();t.length&&(o+="a=ssrc-group:"+e+" "+t.join(" ")+"\r\n")}),$(r).find('source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=$(this).attr("ssrc");if(t.containsSSRC(e))return void T.warn("Source-add request for existing SSRC: "+e);$(this).find(">parameter").each(function(){o+="a=ssrc:"+e+" "+$(this).attr("name"),$(this).attr("value")&&$(this).attr("value").length&&(o+=":"+$(this).attr("value")),o+="\r\n"})}),t.media.forEach(function(e,t){f.a.findLine(e,"a=mid:"+i)&&(n[t]||(n[t]=""),n[t]+=o)})}),n}},{key:"addRemoteStream",value:function(e){this._addOrRemoveRemoteStream(!0,e)}},{key:"removeRemoteStream",value:function(e){this._addOrRemoveRemoteStream(!1,e)}},{key:"_addOrRemoveRemoteStream",value:function(e,t){var n=this,r=e?"addRemoteStream":"removeRemoteStream";e&&this.readSsrcInfo(t);var i=function(i){if(!n.peerconnection.localDescription||!n.peerconnection.localDescription.sdp){var o=r+" - localDescription not ready yet";return T.error(o),void i(o)}T.log("Processing "+r),T.log("ICE connection state: ",n.peerconnection.iceConnectionState);var a=new p.a(n.peerconnection.localDescription.sdp),s=new p.a(n.peerconnection.remoteDescription.sdp),c=e?n._parseSsrcInfoFromSourceAdd(t,s):n._parseSsrcInfoFromSourceRemove(t,s),u=e?n._processRemoteAddSource(c):n._processRemoteRemoveSource(c);n._renegotiate(u.raw).then(function(){var e=new p.a(n.peerconnection.localDescription.sdp);T.log(r+" - OK, SDPs: ",a,e),n.notifyMySSRCUpdate(a,e),i()},function(e){T.error(r+" failed:",e),i(e)})};this.modificationQueue.push(i)}},{key:"_processQueueTasks",value:function(e,t){e(t)}},{key:"_processNewJingleOfferIq",value:function(e){var t=new p.a("");return this.webrtcIceTcpDisable&&(t.removeTcpCandidates=!0),this.webrtcIceUdpDisable&&(t.removeUdpCandidates=!0),this.failICE&&(t.failICE=!0),t.fromJingle(e),this.readSsrcInfo($(e).find(">content")),t}},{key:"_processRemoteRemoveSource",value:function(e){var t=new p.a(this.peerconnection.remoteDescription.sdp);return e.forEach(function(e,n){e=e.split("\r\n"),e.pop(),e.forEach(function(e){t.media[n]=t.media[n].replace(e+"\r\n","")})}),t.raw=t.session+t.media.join(""),t}},{key:"_processRemoteAddSource",value:function(e){var t=new p.a(this.peerconnection.remoteDescription.sdp);return e.forEach(function(e,n){t.media[n]+=e}),t.raw=t.session+t.media.join(""),t}},{key:"_renegotiate",value:function(e){var t=this,n=e||this.peerconnection.remoteDescription.sdp;if(!n)return Promise.reject("Can not renegotiate without remote description,- current state: "+this.state);var r=new RTCSessionDescription({type:this.isInitiator?"answer":"offer",sdp:n});return new Promise(function(e,n){if("closed"===t.peerconnection.signalingState)return void n("Attempted to renegotiate in state closed");t.isInitiator?t._initiatorRenegotiate(r,e,n):t._responderRenegotiate(r,e,n)})}},{key:"_responderRenegotiate",value:function(e,t,n){var r=this;T.debug("Renegotiate: setting remote description"),this.peerconnection.setRemoteDescription(e,function(){T.debug("Renegotiate: creating answer"),r.peerconnection.createAnswer(function(e){T.debug("Renegotiate: setting local description"),r.peerconnection.setLocalDescription(e,function(){t()},function(e){n("setLocalDescription failed: "+e)})},function(e){return n("createAnswer failed: "+e)},r.mediaConstraints)},function(e){return n("setRemoteDescription failed: "+e)})}},{key:"_initiatorRenegotiate",value:function(e,t,n){var r=this;"have-local-offer"===this.peerconnection.signalingState?(T.debug("Renegotiate: setting remote description"),this.peerconnection.setRemoteDescription(e,function(){r._initiatorRenegotiate(e,t,n)},function(e){return n("setRemoteDescription failed: "+e)})):(T.debug("Renegotiate: creating offer"),this.peerconnection.createOffer(function(i){T.debug("Renegotiate: setting local description"),r.peerconnection.setLocalDescription(i,function(){T.debug("Renegotiate: setting remote description"),r.peerconnection.setRemoteDescription(e,function(){t()},function(e){return n("setRemoteDescription failed: "+e)})},function(e){n("setLocalDescription failed: ",e)})},function(e){return n("createOffer failed: "+e)},this.mediaConstraints))}},{key:"replaceTrack",value:function(e,t){var n=this,r=function(r){if("closed"===n.peerconnection.signalingState||"closed"===n.peerconnection.connectionState||n.closed)return void r();var i=n.peerconnection.localDescription.sdp;!e&&t&&t.isVideoTrack()?n.peerconnection.clearRecvonlySsrc():e&&e.isVideoTrack()&&!t&&(n.peerconnection.clearRecvonlySsrc(),n.peerconnection.generateRecvonlySsrc()),e&&n.peerconnection.removeTrack(e),t&&n.peerconnection.addTrack(t),(e||t)&&n.state===d.a?n._renegotiate().then(function(){var e=new p.a(n.peerconnection.localDescription.sdp);n.notifyMySSRCUpdate(new p.a(i),e),r()},r):r()};this.modificationQueue.push(r,function(e){e?T.error("Replace track error:",e):T.info("Replace track done!")})}},{key:"_parseSsrcInfoFromSourceRemove",value:function(e,t){var n=[];return $(e).each(function(e,r){var i=$(r).attr("name"),o="";$(r).find('ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map(function(){return this.getAttribute("ssrc")}).get();t.length&&(o+="a=ssrc-group:"+e+" "+t.join(" ")+"\r\n")});var a=[];$(r).find('source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=$(this).attr("ssrc");a.push(e)}),t.media.forEach(function(e,t){f.a.findLine(e,"a=mid:"+i)&&(n[t]||(n[t]=""),a.forEach(function(r){var i=f.a.findLines(e,"a=ssrc:"+r);i.length&&(n[t]+=i.join("\r\n")+"\r\n")}),n[t]+=o)})}),n}},{key:"_verifyNoSSRCChanged",value:function(e,t){var n=new p.a(this.peerconnection.localDescription.sdp),r=new h.a(t,n),i=r.getNewMedia();if(Object.keys(i).length)return T.error(this+" - some SSRC were added on "+e,i),!1;r=new h.a(n,t);var o=r.getNewMedia();return!Object.keys(o).length||(T.error(this+" - some SSRCs were removed on "+e,o),!1)}},{key:"addTrackAsUnmute",value:function(e){return this._addRemoveTrackAsMuteUnmute(!1,e)}},{key:"removeTrackAsMute",value:function(e){return this._addRemoveTrackAsMuteUnmute(!0,e)}},{key:"_addRemoveTrackAsMuteUnmute",value:function(e,t){var n=this;if(!t)return Promise.reject('invalid "track" argument value');var r=e?"removeTrackMute":"addTrackUnmute",i=function(i){var o=n.peerconnection;if(!o)return void i("Error:  tried "+r+" track with no active peerconnection");var a=o.localDescription.sdp;(e?o.removeTrackMute.bind(o,t):o.addTrackUnmute.bind(o,t))()?a&&o.remoteDescription.sdp?n._renegotiate().then(function(){n._verifyNoSSRCChanged(r,new p.a(a)),i()},i):i():i(r+" failed!")};return new Promise(function(e,t){n.modificationQueue.push(i,function(n){n?t(n):e()})})}},{key:"setMediaTransferActive",value:function(e,t){var n=this;if(!this.peerconnection)return Promise.reject('Can not modify transfer active state, before "initialize" is called');var r=e?"audio active":"audio inactive",i=t?"video active":"video inactive";T.info("Queued make "+i+", "+r+" task...");var o=function(r){var i=n.state===d.a,o=n.peerconnection.setAudioTransferActive(e);n._localVideoActive!==t&&(n._localVideoActive=t,n.isP2P&&i&&n.sendContentModify(t));var a=n.peerconnection.setVideoTransferActive(n._localVideoActive&&n._remoteVideoActive);i&&(o||a)?n._renegotiate().then(r,r):r()};return new Promise(function(e,t){n.modificationQueue.push(o,function(n){n?t(n):e()})})}},{key:"modifyContents",value:function(e){var n=this,r=t.parseVideoSenders(e);if(null===r)return void T.error(this+' - failed to parse video "senders" attribute in"content-modify" action');var i=function(e){n._assertNotEnded("content-modify")&&n._modifyRemoteVideoActive(r)?n._renegotiate().then(e,e):e()};T.debug(this+' queued "content-modify" task(video senders="'+r+'")'),this.modificationQueue.push(i,function(e){e&&T.error('"content-modify" failed',e)})}},{key:"_modifyRemoteVideoActive",value:function(e){var t="both"===e||"initiator"===e&&this.isInitiator||"responder"===e&&!this.isInitiator;return t!==this._remoteVideoActive&&(T.debug(this+" new remote video active: "+t),this._remoteVideoActive=t),this.peerconnection.setVideoTransferActive(this._localVideoActive&&this._remoteVideoActive)}},{key:"notifyMySSRCUpdate",value:function(e,t){if(this.state!==d.a)return void T.warn("Skipping SSRC update in '"+this.state+" ' state.");var n=new h.a(t,e),r=Object(u.$iq)({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"source-remove",initiator:this.initiator,sid:this.sid});n.toJingle(r)?(T.info("Sending source-remove",r.tree()),this.connection.sendIQ(r,null,this.newJingleErrorHandler(r),1e4)):T.log("removal not necessary"),n=new h.a(e,t);var i=Object(u.$iq)({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"source-add",initiator:this.initiator,sid:this.sid});n.toJingle(i)?(T.info("Sending source-add",i.tree()),this.connection.sendIQ(i,null,this.newJingleErrorHandler(i),1e4)):T.log("addition not necessary")}},{key:"newJingleErrorHandler",value:function(e,t){var n=this;return function(e){var r={},i=$(e).find("error");if(i.length){r.code=i.attr("code");var o=$(e).find("error :first");o.length&&(r.reason=o[0].tagName);var a=i.find(">text");a.length&&(r.msg=a.text())}e||(r.reason="timeout"),r.session=n.toString(),t?t(r):n.state===d.b&&"item-not-found"===r.reason?T.debug("Jingle error: "+JSON.stringify(r)):_.a.callErrorHandler(new Error("Jingle error: "+JSON.stringify(r)))}}},{key:"getIceConnectionState",value:function(){return this.peerconnection.iceConnectionState}},{key:"close",value:function(){this.closed=!0,this.signalingLayer.setChatRoom(null),this.peerconnection&&(this.peerconnection.signalingState&&"closed"!==this.peerconnection.signalingState||this.peerconnection.connectionState&&"closed"!==this.peerconnection.connectionState)&&this.peerconnection.close()}},{key:"toString",value:function(){return"JingleSessionPC[p2p="+this.isP2P+",initiator="+this.isInitiator+",sid="+this.sid+"]"}}],[{key:"onJingleFatalError",value:function(e,t){this.room&&(this.room.eventEmitter.emit(y.a.CONFERENCE_SETUP_FAILED,e,t),this.room.eventEmitter.emit(y.a.JINGLE_FATAL_ERROR,e,t))}}]),t}(l.a);t.a=C}).call(t,"modules/xmpp/JingleSessionPC.js")},function(e,t,n){(function(n,r){var i,o;!function(){function a(e){var t=!1;return function(){if(t)throw new Error("Callback was already called.");t=!0,e.apply(s,arguments)}}var s,c,u={};s=this,null!=s&&(c=s.async),u.noConflict=function(){return s.async=c,u};var l=Object.prototype.toString,d=Array.isArray||function(e){return"[object Array]"===l.call(e)},p=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n+=1)t(e[n],n,e)},h=function(e,t){if(e.map)return e.map(t);var n=[];return p(e,function(e,r,i){n.push(t(e,r,i))}),n},f=function(e,t,n){return e.reduce?e.reduce(t,n):(p(e,function(e,r,i){n=t(n,e,r,i)}),n)},m=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};void 0!==n&&n.nextTick?(u.nextTick=n.nextTick,u.setImmediate=void 0!==r?function(e){r(e)}:u.nextTick):"function"==typeof r?(u.nextTick=function(e){r(e)},u.setImmediate=u.nextTick):(u.nextTick=function(e){setTimeout(e,0)},u.setImmediate=u.nextTick),u.each=function(e,t,n){function r(t){t?(n(t),n=function(){}):(i+=1)>=e.length&&n()}if(n=n||function(){},!e.length)return n();var i=0;p(e,function(e){t(e,a(r))})},u.forEach=u.each,u.eachSeries=function(e,t,n){if(n=n||function(){},!e.length)return n();var r=0,i=function(){t(e[r],function(t){t?(n(t),n=function(){}):(r+=1,r>=e.length?n():i())})};i()},u.forEachSeries=u.eachSeries,u.eachLimit=function(e,t,n,r){v(t).apply(null,[e,n,r])},u.forEachLimit=u.eachLimit;var v=function(e){return function(t,n,r){if(r=r||function(){},!t.length||e<=0)return r();var i=0,o=0,a=0;!function s(){if(i>=t.length)return r();for(;a<e&&o<t.length;)o+=1,a+=1,n(t[o-1],function(e){e?(r(e),r=function(){}):(i+=1,a-=1,i>=t.length?r():s())})}()}},g=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[u.each].concat(t))}},y=function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[v(e)].concat(n))}},b=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[u.eachSeries].concat(t))}},_=function(e,t,n,r){if(t=h(t,function(e,t){return{index:t,value:e}}),r){var i=[];e(t,function(e,t){n(e.value,function(n,r){i[e.index]=r,t(n)})},function(e){r(e,i)})}else e(t,function(e,t){n(e.value,function(e){t(e)})})};u.map=g(_),u.mapSeries=b(_),u.mapLimit=function(e,t,n,r){return S(t)(e,n,r)};var S=function(e){return y(e,_)};u.reduce=function(e,t,n,r){u.eachSeries(e,function(e,r){n(t,e,function(e,n){t=n,r(e)})},function(e){r(e,t)})},u.inject=u.reduce,u.foldl=u.reduce,u.reduceRight=function(e,t,n,r){var i=h(e,function(e){return e}).reverse();u.reduce(i,t,n,r)},u.foldr=u.reduceRight;var T=function(e,t,n,r){var i=[];t=h(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&i.push(e),t()})},function(e){r(h(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};u.filter=g(T),u.filterSeries=b(T),u.select=u.filter,u.selectSeries=u.filterSeries;var C=function(e,t,n,r){var i=[];t=h(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||i.push(e),t()})},function(e){r(h(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};u.reject=g(C),u.rejectSeries=b(C);var E=function(e,t,n,r){e(t,function(e,t){n(e,function(n){n?(r(e),r=function(){}):t()})},function(e){r()})};u.detect=g(E),u.detectSeries=b(E),u.some=function(e,t,n){u.each(e,function(e,r){t(e,function(e){e&&(n(!0),n=function(){}),r()})},function(e){n(!1)})},u.any=u.some,u.every=function(e,t,n){u.each(e,function(e,r){t(e,function(e){e||(n(!1),n=function(){}),r()})},function(e){n(!0)})},u.all=u.every,u.sortBy=function(e,t,n){u.map(e,function(e,n){t(e,function(t,r){t?n(t):n(null,{value:e,criteria:r})})},function(e,t){if(e)return n(e);var r=function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0};n(null,h(t.sort(r),function(e){return e.value}))})},u.auto=function(e,t){t=t||function(){};var n=m(e),r=n.length;if(!r)return t();var i={},o=[],a=function(e){o.unshift(e)},s=function(e){for(var t=0;t<o.length;t+=1)if(o[t]===e)return void o.splice(t,1)},c=function(){r--,p(o.slice(0),function(e){e()})};a(function(){if(!r){var e=t;t=function(){},e(null,i)}}),p(n,function(n){var r=d(e[n])?e[n]:[e[n]],o=function(e){var r=Array.prototype.slice.call(arguments,1);if(r.length<=1&&(r=r[0]),e){var o={};p(m(i),function(e){o[e]=i[e]}),o[n]=r,t(e,o),t=function(){}}else i[n]=r,u.setImmediate(c)},l=r.slice(0,Math.abs(r.length-1))||[],h=function(){return f(l,function(e,t){return e&&i.hasOwnProperty(t)},!0)&&!i.hasOwnProperty(n)};if(h())r[r.length-1](o,i);else{var v=function(){h()&&(s(v),r[r.length-1](o,i))};a(v)}})},u.retry=function(e,t,n){var r=[];"function"==typeof e&&(n=t,t=e,e=5),e=parseInt(e,10)||5;var i=function(i,o){for(;e;)r.push(function(e,t){return function(n){e(function(e,r){n(!e||t,{err:e,result:r})},o)}}(t,!(e-=1)));u.series(r,function(e,t){t=t[t.length-1],(i||n)(t.err,t.result)})};return n?i():i},u.waterfall=function(e,t){if(t=t||function(){},!d(e)){var n=new Error("First argument to waterfall must be an array of functions");return t(n)}if(!e.length)return t();var r=function(e){return function(n){if(n)t.apply(null,arguments),t=function(){};else{var i=Array.prototype.slice.call(arguments,1),o=e.next();o?i.push(r(o)):i.push(t),u.setImmediate(function(){e.apply(null,i)})}}};r(u.iterator(e))()};var w=function(e,t,n){if(n=n||function(){},d(t))e.map(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.each(m(t),function(e,n){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)})},function(e){n(e,r)})}};u.parallel=function(e,t){w({map:u.map,each:u.each},e,t)},u.parallelLimit=function(e,t,n){w({map:S(t),each:v(t)},e,n)},u.series=function(e,t){if(t=t||function(){},d(e))u.mapSeries(e,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};u.eachSeries(m(e),function(t,r){e[t](function(e){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),n[t]=i,r(e)})},function(e){t(e,n)})}},u.iterator=function(e){var t=function(n){var r=function(){return e.length&&e[n].apply(null,arguments),r.next()};return r.next=function(){return n<e.length-1?t(n+1):null},r};return t(0)},u.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var R=function(e,t,n,r){var i=[];e(t,function(e,t){n(e,function(e,n){i=i.concat(n||[]),t(e)})},function(e){r(e,i)})};u.concat=g(R),u.concatSeries=b(R),u.whilst=function(e,t,n){e()?t(function(r){if(r)return n(r);u.whilst(e,t,n)}):n()},u.doWhilst=function(e,t,n){e(function(r){if(r)return n(r);var i=Array.prototype.slice.call(arguments,1);t.apply(null,i)?u.doWhilst(e,t,n):n()})},u.until=function(e,t,n){e()?n():t(function(r){if(r)return n(r);u.until(e,t,n)})},u.doUntil=function(e,t,n){e(function(r){if(r)return n(r);var i=Array.prototype.slice.call(arguments,1);t.apply(null,i)?n():u.doUntil(e,t,n)})},u.queue=function(e,t){function n(e,t,n,r){if(e.started||(e.started=!0),d(t)||(t=[t]),0==t.length)return u.setImmediate(function(){e.drain&&e.drain()});p(t,function(t){var i={data:t,callback:"function"==typeof r?r:null};n?e.tasks.unshift(i):e.tasks.push(i),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),u.setImmediate(e.process)})}void 0===t&&(t=1);var r=0,i={tasks:[],concurrency:t,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(e,t){n(i,e,!1,t)},kill:function(){i.drain=null,i.tasks=[]},unshift:function(e,t){n(i,e,!0,t)},process:function(){if(!i.paused&&r<i.concurrency&&i.tasks.length){var t=i.tasks.shift();i.empty&&0===i.tasks.length&&i.empty(),r+=1;var n=function(){r-=1,t.callback&&t.callback.apply(t,arguments),i.drain&&i.tasks.length+r===0&&i.drain(),i.process()},o=a(n);e(t.data,o)}},length:function(){return i.tasks.length},running:function(){return r},idle:function(){return i.tasks.length+r===0},pause:function(){!0!==i.paused&&(i.paused=!0,i.process())},resume:function(){!1!==i.paused&&(i.paused=!1,i.process())}};return i},u.priorityQueue=function(e,t){function n(e,t){return e.priority-t.priority}function r(e,t,n){for(var r=-1,i=e.length-1;r<i;){var o=r+(i-r+1>>>1);n(t,e[o])>=0?r=o:i=o-1}return r}function i(e,t,i,o){if(e.started||(e.started=!0),d(t)||(t=[t]),0==t.length)return u.setImmediate(function(){e.drain&&e.drain()});p(t,function(t){var a={data:t,priority:i,callback:"function"==typeof o?o:null};e.tasks.splice(r(e.tasks,a,n)+1,0,a),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),u.setImmediate(e.process)})}var o=u.queue(e,t);return o.push=function(e,t,n){i(o,e,t,n)},delete o.unshift,o},u.cargo=function(e,t){var n=!1,r=[],i={tasks:r,payload:t,saturated:null,empty:null,drain:null,drained:!0,push:function(e,n){d(e)||(e=[e]),p(e,function(e){r.push({data:e,callback:"function"==typeof n?n:null}),i.drained=!1,i.saturated&&r.length===t&&i.saturated()}),u.setImmediate(i.process)},process:function o(){if(!n){if(0===r.length)return i.drain&&!i.drained&&i.drain(),void(i.drained=!0);var a="number"==typeof t?r.splice(0,t):r.splice(0,r.length),s=h(a,function(e){return e.data});i.empty&&i.empty(),n=!0,e(s,function(){n=!1;var e=arguments;p(a,function(t){t.callback&&t.callback.apply(null,e)}),o()})}},length:function(){return r.length},running:function(){return n}};return i};var k=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[e]&&p(n,function(t){console[e](t)}))}]))}};u.log=k("log"),u.dir=k("dir"),u.memoize=function(e,t){var n={},r={};t=t||function(e){return e};var i=function(){var i=Array.prototype.slice.call(arguments),o=i.pop(),a=t.apply(null,i);a in n?u.nextTick(function(){o.apply(null,n[a])}):a in r?r[a].push(o):(r[a]=[o],e.apply(null,i.concat([function(){n[a]=arguments;var e=r[a];delete r[a];for(var t=0,i=e.length;t<i;t++)e[t].apply(null,arguments)}])))};return i.memo=n,i.unmemoized=e,i},u.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},u.times=function(e,t,n){for(var r=[],i=0;i<e;i++)r.push(i);return u.map(r,t,n)},u.timesSeries=function(e,t,n){for(var r=[],i=0;i<e;i++)r.push(i);return u.mapSeries(r,t,n)},u.seq=function(){var e=arguments;return function(){var t=this,n=Array.prototype.slice.call(arguments),r=n.pop();u.reduce(e,n,function(e,n,r){n.apply(t,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);r(e,t)}]))},function(e,n){r.apply(t,[e].concat(n))})}},u.compose=function(){return u.seq.apply(null,Array.prototype.reverse.call(arguments))};var I=function(e,t){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();return e(t,function(e,t){e.apply(n,r.concat([t]))},i)};return arguments.length>2?n.apply(this,Array.prototype.slice.call(arguments,2)):n};u.applyEach=g(I),u.applyEachSeries=b(I),u.forever=function(e,t){function n(r){if(r){if(t)return t(r);throw r}e(n)}n()},void 0!==e&&e.exports?e.exports=u:(i=[],void 0!==(o=function(){return u}.apply(t,i))&&(e.exports=o))}()}).call(t,n(32),n(38).setImmediate)},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(50)),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=Object(i.getLogger)(e),c=function(){function e(t,n,i,o,a,s){r(this,e),this.sid=t,this.localJid=n,this.peerjid=i,this.connection=o,this.mediaConstraints=a,this.iceConfig=s,this.usedrip=!0,this.dripContainer=[],this.room=null,this.state=null,this.rtc=null}return a(e,[{key:"initialize",value:function(e,t,n){if(null!==this.state){var r="attempt to initiate on session "+this.sid+"\n                   in state "+this.state;throw s.error(r),new Error(r)}this.room=t,this.rtc=n,this.state=o.c,this.initiator=e?this.localJid:this.peerjid,this.responder=e?this.peerjid:this.localJid,this.doInitialize()}},{key:"doInitialize",value:function(){}},{key:"addIceCandidates",value:function(e){}},{key:"getState",value:function(){return this.state}},{key:"addSources",value:function(e){}},{key:"removeSources",value:function(e){}},{key:"terminate",value:function(e,t,n){}},{key:"acceptOffer",value:function(e,t,n){}}]),e}();t.a=c}).call(t,"modules/xmpp/JingleSession.js")},function(e,t,n){"use strict";function r(e,t){if(!t)return!1;if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]instanceof Array&&t[n]instanceof Array){if(!e[n].equals(t[n]))return!1}else if(e[n]!==t[n])return!1;return!0}function i(e,t){if(this.mySDP=e,this.otherSDP=t,!e)throw new Error('"mySDP" is undefined!');if(!t)throw new Error('"otherSDP" is undefined!')}t.a=i;var o=n(12);i.prototype.getNewMedia=function(){var e=this.mySDP.getMediaSsrcMap(),t=this.otherSDP.getMediaSsrcMap(),n={};return Object.keys(t).forEach(function(i){var o=e[i],a=t[i];if(!o&&a)return void(n[i]=a);Object.keys(a.ssrcs).forEach(function(e){-1===Object.keys(o.ssrcs).indexOf(e)&&(n[i]||(n[i]={mediaindex:a.mediaindex,mid:a.mid,ssrcs:{},ssrcGroups:[]}),n[i].ssrcs[e]=a.ssrcs[e])}),a.ssrcGroups.forEach(function(e){for(var t=!1,s=0;s<o.ssrcGroups.length;s++){var c=o.ssrcGroups[s];if(e.semantics===c.semantics&&r(e.ssrcs,c.ssrcs)){t=!0;break}}t||(n[i]||(n[i]={mediaindex:a.mediaindex,mid:a.mid,ssrcs:{},ssrcGroups:[]}),n[i].ssrcGroups.push(e))})}),n},i.prototype.toJingle=function(e){var t=this.getNewMedia(),n=!1;return Object.keys(t).forEach(function(r){n=!0;var i=t[r];e.c("content",{name:i.mid}),e.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:i.mid}),Object.keys(i.ssrcs).forEach(function(t){var n=i.ssrcs[t];e.c("source",{xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),e.attrs({ssrc:n.ssrc}),n.lines.forEach(function(t){var n=t.indexOf(" "),r=t.substr(n+1);if(e.c("parameter"),-1===r.indexOf(":"))e.attrs({name:r});else{var i=r.split(":",2),a=i[0],s=o.a.filterSpecialChars(i[1]);e.attrs({name:a}),e.attrs({value:s})}e.up()}),e.up()}),i.ssrcGroups.forEach(function(t){t.ssrcs.length&&(e.c("ssrc-group",{semantics:t.semantics,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),t.ssrcs.forEach(function(t){e.c("source",{ssrc:t}).up()}),e.up())}),e.up(),e.up()}),n}},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=(n.n(a),n(4)),c=n(52),u=n(105),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=Object(a.getLogger)(e),p=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.ssrcOwners=new Map,e.chatRoom=null,e}return o(t,e),l(t,[{key:"setChatRoom",value:function(e){var t=this,n=this.chatRoom;this.chatRoom=e,n&&(n.removePresenceListener("audiomuted",this._audioMuteHandler),n.removePresenceListener("videomuted",this._videoMuteHandler),n.removePresenceListener("videoType",this._videoTypeHandler)),e&&(this._audioMuteHandler=function(e,n){t.eventEmitter.emit(c.a,n,s.a,"true"===e.value)},e.addPresenceListener("audiomuted",this._audioMuteHandler),this._videoMuteHandler=function(e,n){t.eventEmitter.emit(c.a,n,s.b,"true"===e.value)},e.addPresenceListener("videomuted",this._videoMuteHandler),this._videoTypeHandler=function(e,n){t.eventEmitter.emit(c.b,n,e.value)},e.addPresenceListener("videoType",this._videoTypeHandler))}},{key:"getPeerMediaInfo",value:function(e,t){if(this.chatRoom)return this.chatRoom.getMediaPresenceInfo(e,t);d.error("Requested peer media info, before room was set")}},{key:"getSSRCOwner",value:function(e){return this.ssrcOwners.get(e)}},{key:"setSSRCOwner",value:function(e,t){if("number"!=typeof e)throw new TypeError("SSRC("+e+") must be a number");this.ssrcOwners.set(e,t)}}]),t}(u.a);t.a=p}).call(t,"modules/xmpp/SignalingLayerImpl.js")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(9),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"getSSRCOwner",value:function(e){throw new Error("not implemented")}},{key:"getPeerMediaInfo",value:function(e,t){throw new Error("not implemented")}}]),t}(a.a);t.a=c},function(e,t,n){"use strict";(function(e){var r=n(0),i=(n.n(r),n(2)),o=(n.n(i),n(3)),a=n.n(o),s=Object(r.getLogger)(e),c=-1,u=/request id \d+.\d+ got 200/,l=/request errored, status: (\d+), number of errors: \d+/;t.a=function(){i.Strophe.log=function(e,t){switch(s.trace("Strophe",e,t),"string"==typeof t&&-1!==t.indexOf("Request ")&&-1!==t.indexOf("timed out (secondary), restarting")&&(e=i.Strophe.LogLevel.WARN),e){case i.Strophe.LogLevel.DEBUG:-1!==c&&u.test(t)&&(s.debug("Reset lastErrorStatus"),c=-1);break;case i.Strophe.LogLevel.WARN:s.warn("Strophe: "+t);var n=l.exec(t);n&&2===n.length&&(c=parseInt(n[1],10),s.debug("lastErrorStatus set to: "+c));break;case i.Strophe.LogLevel.ERROR:case i.Strophe.LogLevel.FATAL:t="Strophe: "+t,a.a.callErrorHandler(new Error(t)),s.error(t)}},i.Strophe.getLastErrorStatus=function(){return c},i.Strophe.getStatusString=function(e){switch(e){case i.Strophe.Status.ERROR:return"ERROR";case i.Strophe.Status.CONNECTING:return"CONNECTING";case i.Strophe.Status.CONNFAIL:return"CONNFAIL";case i.Strophe.Status.AUTHENTICATING:return"AUTHENTICATING";case i.Strophe.Status.AUTHFAIL:return"AUTHFAIL";case i.Strophe.Status.CONNECTED:return"CONNECTED";case i.Strophe.Status.DISCONNECTED:return"DISCONNECTED";case i.Strophe.Status.DISCONNECTING:return"DISCONNECTING";case i.Strophe.Status.ATTACHED:return"ATTACHED";default:return"unknown"}}}}).call(t,"modules/xmpp/strophe.util.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=(n.n(a),n(2)),c=(n.n(s),n(3)),u=n.n(c),l=n(22),d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},h=Object(a.getLogger)(e),f=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.failedPings=0,n.xmpp=e,n}return o(t,e),d(t,[{key:"init",value:function(e){p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),s.Strophe.addNamespace("PING","urn:xmpp:ping")}},{key:"ping",value:function(e,t,n,r){var i=Object(s.$iq)({type:"get",to:e});i.c("ping",{xmlns:s.Strophe.NS.PING}),this.connection.sendIQ(i,t,n,r)}},{key:"hasPingSupport",value:function(e,t){this.xmpp.caps.getFeatures(e).then(function(e){return t(e.has("urn:xmpp:ping"))},function(e){var n="Ping feature discovery error";u.a.callErrorHandler(new Error(n+": "+e)),h.error(n,e),t(!1)})}},{key:"startInterval",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;if(this.intervalId){var r="Ping task scheduled already";return u.a.callErrorHandler(new Error(r)),void h.error(r)}this.intervalId=window.setInterval(function(){t.ping(e,function(){t.failedPings=0},function(e){t.failedPings+=1;var n="Ping "+(e?"error":"timeout");t.failedPings>=3?(u.a.callErrorHandler(new Error(n)),h.error(n,e)):h.warn(n,e)},15e3)},n),h.info("XMPP pings will be sent every "+n+" ms")}},{key:"stopInterval",value:function(){this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null,this.failedPings=0,h.info("Ping interval cleared"))}}]),t}(l.b);t.a=function(e){s.Strophe.addConnectionPlugin("ping",new f(e))}}).call(t,"modules/xmpp/strophe.ping.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=(n.n(a),n(2)),c=(n.n(s),n(22)),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},d=Object(a.getLogger)(e),p=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"init",value:function(e){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this.connection.addHandler(this.onRayo.bind(this),"urn:xmpp:rayo:1","iq","set",null,null)}},{key:"onRayo",value:function(e){d.info("Rayo IQ",e)}},{key:"dial",value:function(e,t,n,r,i){var o=this;return new Promise(function(a,c){if(!i)return void c(new Error("Internal error!"));var u=Object(s.$iq)({type:"set",to:i});u.c("dial",{xmlns:"urn:xmpp:rayo:1",to:e,from:t}),u.c("header",{name:"JvbRoomName",value:n}).up(),r&&r.length&&u.c("header",{name:"JvbRoomPassword",value:r}).up(),o.connection.sendIQ(u,function(e){d.info("Dial result ",e);var t=$(e).find("ref").attr("uri");o.callResource=t.substr("xmpp:".length),d.info("Received call resource: "+o.callResource),a()},function(e){d.info("Dial error ",e),c(e)})})}},{key:"hangup",value:function(){var e=this;return new Promise(function(t,n){if(!e.callResource)return n(new Error("No call in progress")),void d.warn("No call in progress");var r=Object(s.$iq)({type:"set",to:e.callResource});r.c("hangup",{xmlns:"urn:xmpp:rayo:1"}),e.connection.sendIQ(r,function(n){d.info("Hangup result ",n),e.callResource=null,t()},function(t){d.info("Hangup error ",t),e.callResource=null,n(new Error("Hangup error "))})})}}]),t}(c.b);t.a=function(){s.Strophe.addConnectionPlugin("rayo",new p)}}).call(t,"modules/xmpp/strophe.rayo.js")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(2),s=(n.n(a),n(22)),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},l=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.log=[],e}return o(t,e),c(t,[{key:"init",value:function(e){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this.connection.rawInput=this.logIncoming.bind(this),this.connection.rawOutput=this.logOutgoing.bind(this)}},{key:"logIncoming",value:function(e){this.log.push([(new Date).getTime(),"incoming",e])}},{key:"logOutgoing",value:function(e){this.log.push([(new Date).getTime(),"outgoing",e])}}]),t}(s.b);t.a=function(){a.Strophe.addConnectionPlugin("logger",new l)}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){var n=0;return h.some(function(r){return 0!==(n=e[r]>t[r]&&1||e[r]<t[r]&&-1)}),n}var s=n(2),c=(n.n(s),n(7)),u=n.n(c),l=n(9),d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=["category","type","lang","name"],h=["category","type","lang"],f=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"http://jitsi.org/jitsimeet";r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(o.node=n,o.disco=e.disco,!o.disco)throw new Error("Missing strophe-plugins (disco plugin is required)!");o.versionToCapabilities=Object.create(null),o.jidToVersion=Object.create(null),o.version="",o.rooms=new Set;var a=e.emuc;return a.addListener(u.a.EMUC_ROOM_ADDED,function(e){return o._addChatRoom(e)}),a.addListener(u.a.EMUC_ROOM_REMOVED,function(e){return o._removeChatRoom(e)}),Object.keys(a.rooms).forEach(function(e){o._addChatRoom(a.rooms[e])}),s.Strophe.addNamespace("CAPS","http://jabber.org/protocol/caps"),o.disco.addFeature(s.Strophe.NS.CAPS),e.addHandler(o._handleCaps.bind(o),s.Strophe.NS.CAPS),o._onMucMemberLeft=o._removeJidToVersionEntry.bind(o),o}return o(t,e),d(t,[{key:"addFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.disco.addFeature(e),this._generateVersion(),t&&this.submit()}},{key:"removeFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.disco.removeFeature(e),this._generateVersion(),t&&this.submit()}},{key:"submit",value:function(){this.rooms.forEach(function(e){return e.sendPresence()})}},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=e in this.jidToVersion?this.jidToVersion[e]:null;if(!(r&&r.version in this.versionToCapabilities)){var i=r?r.node+"#"+r.version:null;return new Promise(function(o,a){return t.disco.info(e,i,function(e){var n=new Set;$(e).find(">query>feature").each(function(e,t){return n.add(t.getAttribute("var"))}),r&&(t.versionToCapabilities[r.version]=n),o(n)},a,n)})}return Promise.resolve(this.versionToCapabilities[r.version])}},{key:"_addChatRoom",value:function(e){this.rooms.add(e),e.addListener(u.a.MUC_MEMBER_LEFT,this._onMucMemberLeft),this._fixChatRoomPresenceMap(e)}},{key:"_removeChatRoom",value:function(e){this.rooms.delete(e),e.removeListener(u.a.MUC_MEMBER_LEFT,this._onMucMemberLeft)}},{key:"_fixChatRoomPresenceMap",value:function(e){e.addToPresence("c",{attributes:{xmlns:s.Strophe.NS.CAPS,hash:"sha-1",node:this.node,ver:this.version}})}},{key:"_notifyVersionChanged",value:function(){var e=this;this.rooms.forEach(function(t){return e._fixChatRoomPresenceMap(t)}),this.submit()}},{key:"_generateVersion",value:function(){var e=this.disco._identities.sort(a).reduce(function(e,t){return p.reduce(function(e,n,r){return e+(0===r?"":"/")+t[n]},"")+"<"},""),t=this.disco._features.sort().reduce(function(e,t){return e+t+"<"},"");this.version=Object(s.b64_sha1)(e+t),this._notifyVersionChanged()}},{key:"_handleCaps",value:function(e){var t=e.getAttribute("from"),n=e.querySelector("c"),r=n.getAttribute("ver"),i=n.getAttribute("node"),o=this.jidToVersion[t];return this.jidToVersion[t]={version:r,node:i},o&&o.version!==r&&this.eventEmitter.emit(u.a.PARTCIPANT_FEATURES_CHANGED,t),!0}},{key:"_removeJidToVersionEntry",value:function(e){e in this.jidToVersion&&delete this.jidToVersion[e]}}]),t}(l.a);t.a=f},function(e,t,n){"use strict";(function(e){function r(e){this.conference=e,e.on(d.TRACK_MUTE_CHANGED,function(t){if(t.isLocal()&&e.statistics){var n=t.isP2P?e.p2pJingleSession:e.jvbJingleSession,r=n&&n.peerconnection||null;e.statistics.sendMuteEvent(r,t.isMuted(),t.getType())}}),e.on(d.CONNECTION_INTERRUPTED,m.a.sendEventToAll.bind(m.a,"connection.interrupted")),e.on(d.CONNECTION_RESTORED,m.a.sendEventToAll.bind(m.a,"connection.restored"))}t.a=r;var i=n(2),o=(n.n(i),n(47)),a=n.n(o),s=n(112),c=n.n(s),u=n(0),l=(n.n(u),n(30)),d=n(6),p=n(4),h=n(8),f=n.n(h),m=n(5),v=n(7),g=n.n(v),y=Object(u.getLogger)(e);r.prototype.setupChatRoomListeners=function(){var e=this,t=this.conference,n=t.room;this.chatRoomForwarder=new c.a(n,this.conference.eventEmitter),n.addListener(g.a.ICE_RESTARTING,function(e){e.isP2P||t.rtc.closeBridgeChannel()}),n.addListener(g.a.AUDIO_MUTED_BY_FOCUS,function(e){m.a.analytics.sendEvent("conference.remotelyMuted"),t.rtc.setAudioMute(e).then(function(){t.isMutedByFocus=!0},function(){return y.warn("Error while audio muting due to focus request")})}),this.chatRoomForwarder.forward(g.a.SUBJECT_CHANGED,d.SUBJECT_CHANGED),this.chatRoomForwarder.forward(g.a.MUC_JOINED,d.CONFERENCE_JOINED),n.addListener(g.a.MUC_JOINED,function(){e.conference.isJvbConnectionInterrupted=!1,Object.keys(n.connectionTimes).forEach(function(e){var t=n.connectionTimes[e];m.a.analytics.sendEvent("conference."+e,{value:t})}),Object.keys(n.xmpp.connectionTimes).forEach(function(e){var t=n.xmpp.connectionTimes[e];m.a.analytics.sendEvent("xmpp."+e,{value:t})})}),this.chatRoomForwarder.forward(g.a.ROOM_JOIN_ERROR,d.CONFERENCE_FAILED,l.CONNECTION_ERROR),this.chatRoomForwarder.forward(g.a.ROOM_CONNECT_ERROR,d.CONFERENCE_FAILED,l.CONNECTION_ERROR),this.chatRoomForwarder.forward(g.a.ROOM_CONNECT_NOT_ALLOWED_ERROR,d.CONFERENCE_FAILED,l.NOT_ALLOWED_ERROR),this.chatRoomForwarder.forward(g.a.ROOM_MAX_USERS_ERROR,d.CONFERENCE_FAILED,l.CONFERENCE_MAX_USERS),this.chatRoomForwarder.forward(g.a.PASSWORD_REQUIRED,d.CONFERENCE_FAILED,l.PASSWORD_REQUIRED),this.chatRoomForwarder.forward(g.a.AUTHENTICATION_REQUIRED,d.CONFERENCE_FAILED,l.AUTHENTICATION_REQUIRED),this.chatRoomForwarder.forward(g.a.BRIDGE_DOWN,d.CONFERENCE_FAILED,l.VIDEOBRIDGE_NOT_AVAILABLE),n.addListener(g.a.BRIDGE_DOWN,function(){return m.a.analytics.sendEvent("conference.bridgeDown")}),this.chatRoomForwarder.forward(g.a.RESERVATION_ERROR,d.CONFERENCE_FAILED,l.RESERVATION_ERROR),this.chatRoomForwarder.forward(g.a.GRACEFUL_SHUTDOWN,d.CONFERENCE_FAILED,l.GRACEFUL_SHUTDOWN),n.addListener(g.a.JINGLE_FATAL_ERROR,function(e,n){e.isP2P||t.eventEmitter.emit(d.CONFERENCE_FAILED,l.JINGLE_FATAL_ERROR,n)}),n.addListener(g.a.CONNECTION_ICE_FAILED,function(e){t._onIceConnectionFailed(e)}),this.chatRoomForwarder.forward(g.a.MUC_DESTROYED,d.CONFERENCE_FAILED,l.CONFERENCE_DESTROYED),this.chatRoomForwarder.forward(g.a.CHAT_ERROR_RECEIVED,d.CONFERENCE_ERROR,l.CHAT_ERROR),this.chatRoomForwarder.forward(g.a.FOCUS_DISCONNECTED,d.CONFERENCE_FAILED,l.FOCUS_DISCONNECTED),n.addListener(g.a.FOCUS_LEFT,function(){m.a.analytics.sendEvent("conference.focusLeft"),t.eventEmitter.emit(d.CONFERENCE_FAILED,l.FOCUS_LEFT)});var r=function(e){return m.a.sendEventToAll("conference.error."+e)};n.addListener(g.a.SESSION_ACCEPT_TIMEOUT,function(e){r(e.isP2P?"p2pSessionAcceptTimeout":"sessionAcceptTimeout")}),this.chatRoomForwarder.forward(g.a.RECORDER_STATE_CHANGED,d.RECORDER_STATE_CHANGED),this.chatRoomForwarder.forward(g.a.TRANSCRIPTION_STATUS_CHANGED,d.TRANSCRIPTION_STATUS_CHANGED),this.chatRoomForwarder.forward(g.a.VIDEO_SIP_GW_AVAILABILITY_CHANGED,d.VIDEO_SIP_GW_AVAILABILITY_CHANGED),this.chatRoomForwarder.forward(g.a.PHONE_NUMBER_CHANGED,d.PHONE_NUMBER_CHANGED),n.addListener(g.a.CONFERENCE_SETUP_FAILED,function(e,n){e.isP2P||t.eventEmitter.emit(d.CONFERENCE_FAILED,l.SETUP_FAILED,n)}),n.setParticipantPropertyListener(function(e,n){var r=t.getParticipantById(n);r&&r.setProperty(e.tagName.substring("jitsi_participant_".length),e.value)}),this.chatRoomForwarder.forward(g.a.KICKED,d.KICKED),n.addListener(g.a.KICKED,function(){t.room=null,t.leave()}),n.addListener(g.a.SUSPEND_DETECTED,t.onSuspendDetected.bind(t)),this.chatRoomForwarder.forward(g.a.MUC_LOCK_CHANGED,d.LOCK_STATE_CHANGED),n.addListener(g.a.MUC_MEMBER_JOINED,t.onMemberJoined.bind(t)),n.addListener(g.a.MUC_MEMBER_LEFT,t.onMemberLeft.bind(t)),this.chatRoomForwarder.forward(g.a.MUC_LEFT,d.CONFERENCE_LEFT),n.addListener(g.a.DISPLAY_NAME_CHANGED,t.onDisplayNameChanged.bind(t)),n.addListener(g.a.LOCAL_ROLE_CHANGED,function(e){t.onLocalRoleChanged(e),t.statistics&&t.isModerator()&&t.on(d.RECORDER_STATE_CHANGED,function(e,t){var n={id:"recorder_status",status:e};t&&(n.error=t),m.a.sendLog(JSON.stringify(n))})}),n.addListener(g.a.MUC_ROLE_CHANGED,t.onUserRoleChanged.bind(t)),n.addListener(a.a.IDENTITY_UPDATED,function(e,n){t.authEnabled=e,t.authIdentity=n,t.eventEmitter.emit(d.AUTH_STATUS_CHANGED,e,n)}),n.addListener(g.a.MESSAGE_RECEIVED,function(e,n,r,o,a){var s=i.Strophe.getResourceFromJid(e);t.eventEmitter.emit(d.MESSAGE_RECEIVED,s,r,a)}),n.addListener(g.a.PRESENCE_STATUS,function(e,n){var r=i.Strophe.getResourceFromJid(e),o=t.getParticipantById(r);o&&o._status!==n&&(o._status=n,t.eventEmitter.emit(d.USER_STATUS_CHANGED,r,n))}),n.addListener(g.a.JSON_MESSAGE_RECEIVED,function(e,n){var r=i.Strophe.getResourceFromJid(e),o=t.getParticipantById(r);o?t.eventEmitter.emit(d.ENDPOINT_MESSAGE_RECEIVED,o,n):y.warn("Ignored XMPPEvents.JSON_MESSAGE_RECEIVED for not existing participant: "+e,n)}),n.addPresenceListener("startmuted",function(e,n){var r=!1;if(t.myUserId()===n&&t.isModerator())r=!0;else{var i=t.getParticipantById(n);i&&i.isModerator()&&(r=!0)}if(r){var o="true"===e.attributes.audio,a="true"===e.attributes.video,s=!1;o!==t.startMutedPolicy.audio&&(t.startMutedPolicy.audio=o,s=!0),a!==t.startMutedPolicy.video&&(t.startMutedPolicy.video=a,s=!0),s&&t.eventEmitter.emit(d.START_MUTED_POLICY_CHANGED,t.startMutedPolicy)}}),n.addPresenceListener("devices",function(e,n){var r=!1,i=!1;e.children.forEach(function(e){"audio"===e.tagName&&(r="true"===e.value),"video"===e.tagName&&(i="true"===e.value)});var o=void 0;if(t.myUserId()===n)o=t.availableDevices;else{var a=t.getParticipantById(n);if(!a)return;o=a._availableDevices}var s=!1;o.audio!==r&&(s=!0,o.audio=r),o.video!==i&&(s=!0,o.video=i),s&&t.eventEmitter.emit(d.AVAILABLE_DEVICES_CHANGED,n,o)}),t.statistics&&(n.addListener(g.a.CONNECTION_ICE_FAILED,function(e){t.statistics.sendIceConnectionFailedEvent(e.peerconnection)}),n.addListener(g.a.ADD_ICE_CANDIDATE_FAILED,function(e,n){t.statistics.sendAddIceCandidateFailed(e,n)}))},r.prototype.setupRTCListeners=function(){var e=this.conference,t=e.rtc;t.addListener(f.a.REMOTE_TRACK_ADDED,e.onRemoteTrackAdded.bind(e)),t.addListener(f.a.REMOTE_TRACK_REMOVED,e.onRemoteTrackRemoved.bind(e)),t.addListener(f.a.DOMINANT_SPEAKER_CHANGED,function(t){e.lastDominantSpeaker!==t&&e.room&&(e.lastDominantSpeaker=t,e.eventEmitter.emit(d.DOMINANT_SPEAKER_CHANGED,t)),e.statistics&&e.myUserId()===t&&e.statistics.sendDominantSpeakerEvent()}),t.addListener(f.a.DATA_CHANNEL_OPEN,function(){var t=window.performance.now();y.log("(TIME) data channel opened ",t),e.room.connectionTimes["data.channel.opened"]=t,m.a.analytics.sendEvent("conference.dataChannel.open",{value:t}),e.eventEmitter.emit(d.DATA_CHANNEL_OPENED)}),t.addListener(f.a.AVAILABLE_DEVICES_CHANGED,function(t){return e.room.updateDeviceAvailability(t)}),t.addListener(f.a.ENDPOINT_MESSAGE_RECEIVED,function(t,n){var r=e.getParticipantById(t);r?e.eventEmitter.emit(d.ENDPOINT_MESSAGE_RECEIVED,r,n):y.warn("Ignored ENDPOINT_MESSAGE_RECEIVED for not existing participant: "+t,n)}),t.addListener(f.a.LOCAL_UFRAG_CHANGED,function(e,t){e.isP2P||m.a.sendLog(JSON.stringify({id:"local_ufrag",value:t}))}),t.addListener(f.a.REMOTE_UFRAG_CHANGED,function(e,t){e.isP2P||m.a.sendLog(JSON.stringify({id:"remote_ufrag",value:t}))}),e.statistics&&(t.addListener(f.a.CREATE_ANSWER_FAILED,function(t,n){e.statistics.sendCreateAnswerFailed(t,n)}),t.addListener(f.a.CREATE_OFFER_FAILED,function(t,n){e.statistics.sendCreateOfferFailed(t,n)}),t.addListener(f.a.SET_LOCAL_DESCRIPTION_FAILED,function(t,n){e.statistics.sendSetLocalDescFailed(t,n)}),t.addListener(f.a.SET_REMOTE_DESCRIPTION_FAILED,function(t,n){e.statistics.sendSetRemoteDescFailed(t,n)}))},r.prototype.setupXMPPListeners=function(){var e=this.conference;e.xmpp.caps.addListener(g.a.PARTCIPANT_FEATURES_CHANGED,function(t){var n=e.getParticipantById(i.Strophe.getResourceFromJid(t));n&&e.eventEmitter.emit(d.PARTCIPANT_FEATURES_CHANGED,n)}),e.xmpp.addListener(g.a.CALL_INCOMING,e.onIncomingCall.bind(e)),e.xmpp.addListener(g.a.CALL_ACCEPTED,e.onCallAccepted.bind(e)),e.xmpp.addListener(g.a.TRANSPORT_INFO,e.onTransportInfo.bind(e)),e.xmpp.addListener(g.a.CALL_ENDED,e.onCallEnded.bind(e)),e.xmpp.addListener(g.a.START_MUTED_FROM_FOCUS,function(t,n){e.options.config.ignoreStartMuted||(e.startAudioMuted=t,e.startVideoMuted=n,e.getLocalTracks().forEach(function(t){switch(t.getType()){case p.a:e.startAudioMuted&&t.mute();break;case p.b:e.startVideoMuted&&t.mute()}}),e.eventEmitter.emit(d.STARTED_MUTED))})},r.prototype.setupStatisticsListeners=function(){var e=this.conference;e.statistics&&(e.statistics.addAudioLevelListener(function(t,n,r,i){e.rtc.setAudioLevel(t,n,r,i)}),e.statistics.addBeforeDisposedListener(function(){e.eventEmitter.emit(d.BEFORE_STATISTICS_DISPOSED)}),e.statistics.addByteSentStatsListener(function(t,n){e.getLocalTracks(p.a).forEach(function(e){var r=t.getLocalSSRC(e);r&&n.hasOwnProperty(r)&&e._onByteSentStatsReceived(t,n[r])})}))}}).call(t,"JitsiConferenceEventManager.js")},function(e,t){function n(e,t){if(!e||!t||"function"!=typeof e.addListener||"function"!=typeof t.emit)throw new Error("Invalid arguments passed to EventEmitterForwarder");this.src=e,this.dest=t}n.prototype.forward=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0];t[0]=this.dest,this.src.addListener(r,Function.prototype.bind.apply(this.dest.emit,t))},e.exports=n},function(e,t,n){(function(e){function t(e,t){var n=e.getTrack();if(!n)throw new Error("Failed to initialize DTMFSender: no audio track.");this.dtmfSender=t.peerconnection.createDTMFSender(n),r.debug("Initialized DTMFSender")}var r=n(0).getLogger(e);t.prototype.sendTones=function(e,t,n){this.dtmfSender.insertDTMF(e,t||200,n||200)}}).call(t,"modules/DTMF/JitsiDTMFManager.js")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(2),o=(n.n(i),n(6)),a=n(34),s=n(4),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(){function e(t,n,o,s,c){r(this,e),this._jid=t,this._id=i.Strophe.getResourceFromJid(t),this._conference=n,this._displayName=o,this._supportsDTMF=!1,this._tracks=[],this._role="none",this._status=null,this._availableDevices={audio:void 0,video:void 0},this._hidden=s,this._statsID=c,this._connectionStatus=a.a.ACTIVE,this._properties={}}return c(e,[{key:"getConference",value:function(){return this._conference}},{key:"getProperty",value:function(e){return this._properties[e]}},{key:"hasAnyVideoTrackWebRTCMuted",value:function(){return this.getTracks().some(function(e){return e.getType()===s.b&&e.isWebRTCTrackMuted()})}},{key:"_setConnectionStatus",value:function(e){this._connectionStatus=e}},{key:"getConnectionStatus",value:function(){return this._connectionStatus}},{key:"setProperty",value:function(e,t){var n=this._properties[e];t!==n&&(this._properties[e]=t,this._conference.eventEmitter.emit(o.PARTICIPANT_PROPERTY_CHANGED,this,e,n,t))}},{key:"getTracks",value:function(){return this._tracks.slice()}},{key:"getTracksByMediaType",value:function(e){return this.getTracks().filter(function(t){return t.getType()===e})}},{key:"getId",value:function(){return this._id}},{key:"getJid",value:function(){return this._jid}},{key:"getDisplayName",value:function(){return this._displayName}},{key:"getStatsID",value:function(){return this._statsID}},{key:"getStatus",value:function(){return this._status}},{key:"isModerator",value:function(){return"moderator"===this._role}},{key:"isHidden",value:function(){return this._hidden}},{key:"isAudioMuted",value:function(){return this._isMediaTypeMuted(s.a)}},{key:"_isMediaTypeMuted",value:function(e){return this.getTracks().reduce(function(t,n){return t&&(n.getType()!==e||n.isMuted())},!0)}},{key:"isVideoMuted",value:function(){return this._isMediaTypeMuted(s.b)}},{key:"getRole",value:function(){return this._role}},{key:"supportsDTMF",value:function(){return this._supportsDTMF}},{key:"getFeatures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;return this._conference.xmpp.caps.getFeatures(this._jid,e)}}]),e}();t.a=u},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(6)),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=Object(i.getLogger)(e),c=function(){function e(t){var n=this;r(this,e),this._conference=t,this._jvb121=!0,this._conference.addEventListener(o.USER_JOINED,function(){return n.evaluateStatus()}),this._conference.addEventListener(o.USER_LEFT,function(){return n.evaluateStatus()}),this._conference.addEventListener(o.P2P_STATUS,function(){return n.evaluateStatus()})}return a(e,[{key:"evaluateStatus",value:function(){var e=this._jvb121,t=!this._conference.isP2PActive()&&this._conference.getParticipantCount()<=2;e!==t&&(this._jvb121=t,s.debug("JVB121 status "+e+" => "+t),this._conference.eventEmitter.emit(o.JVB121_STATUS,e,t))}}]),e}();t.a=c}).call(t,"modules/event/Jvb121EventGenerator.js")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(6),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.conference=t,t.addEventListener(i.TRACK_AUDIO_LEVEL_CHANGED,this._audioLevel.bind(this)),this.myUserID=this.conference.myUserId()}return o(e,[{key:"_audioLevel",value:function(e,t){!this.conference.isP2PActive()||t<=.6||e===this.myUserID&&this.conference.getLocalAudioTrack().isMuted()||this.conference.eventEmitter.emit(i.DOMINANT_SPEAKER_CHANGED,e)}}]),e}();t.a=a},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(8)),a=n.n(o),s=n(3),c=n.n(s),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=Object(i.getLogger)(e),d=function(){function e(t,n,i){var o=this;if(r(this,e),!t&&!n)throw new TypeError("At least peerconnection or wsUrl must be given");if(t&&n)throw new TypeError("Just one of peerconnection or wsUrl must be given");if(t?l.debug("constructor() with peerconnection"):l.debug('constructor() with wsUrl:"'+n+'"'),this._channel=null,this._eventEmitter=i,this._mode=null,t)t.ondatachannel=function(e){var t=e.channel;o._handleChannel(t),o._mode="datachannel"};else if(n){var a=new WebSocket(n);this._handleChannel(a),this._mode="websocket"}}return u(e,[{key:"close",value:function(){if(this._channel){try{this._channel.close()}catch(e){}this._channel=null}}},{key:"isOpen",value:function(){return this._channel&&("open"===this._channel.readyState||this._channel.readyState===WebSocket.OPEN)}},{key:"sendMessage",value:function(e,t){this._send({colibriClass:"EndpointMessage",msgPayload:t,to:e})}},{key:"sendSetLastNMessage",value:function(e){var t={colibriClass:"LastNChangedEvent",lastN:e};this._send(t),l.log("Channel lastN set to: "+e)}},{key:"sendPinnedEndpointMessage",value:function(e){l.log("sending pinned changed notification to the bridge for endpoint ",e),this._send({colibriClass:"PinnedEndpointChangedEvent",pinnedEndpoint:e||null})}},{key:"sendSelectedEndpointMessage",value:function(e){l.log("sending selected changed notification to the bridge for endpoint ",e),this._send({colibriClass:"SelectedEndpointChangedEvent",selectedEndpoint:e||null})}},{key:"sendReceiverVideoConstraintMessage",value:function(e){l.log("sending a ReceiverVideoConstraint message with a maxFrameHeight of "+e+" pixels"),this._send({colibriClass:"ReceiverVideoConstraint",maxFrameHeight:e})}},{key:"_handleChannel",value:function(e){var t=this,n=this._eventEmitter;e.onopen=function(){l.info(t._mode+" channel opened"),n.emit(a.a.DATA_CHANNEL_OPEN)},e.onerror=function(e){l.error("Channel error:",e)},e.onmessage=function(e){var t=e.data,r=void 0;try{r=JSON.parse(t)}catch(e){return c.a.callErrorHandler(e),void l.error("Failed to parse channel message as JSON: ",t,e)}var i=r.colibriClass;switch(i){case"DominantSpeakerEndpointChangeEvent":var o=r.dominantSpeakerEndpoint;l.info("Channel new dominant speaker event: ",o),n.emit(a.a.DOMINANT_SPEAKER_CHANGED,o);break;case"EndpointConnectivityStatusChangeEvent":var s=r.endpoint,u="true"===r.active;l.info("Endpoint connection status changed: "+s+" active ? "+u),n.emit(a.a.ENDPOINT_CONN_STATUS_CHANGED,s,u);break;case"EndpointMessage":n.emit(a.a.ENDPOINT_MESSAGE_RECEIVED,r.from,r.msgPayload);break;case"LastNEndpointsChangeEvent":var d=r.lastNEndpoints;l.info("Channel new last-n event: ",d,r),n.emit(a.a.LASTN_ENDPOINT_CHANGED,d,r);break;default:l.debug("Channel JSON-formatted message: ",r),n.emit("rtc.datachannel."+i,r)}},e.onclose=function(){l.info("Channel closed"),t._channel=null},this._channel=e}},{key:"_send",value:function(e){var t=this._channel;if(!this.isOpen())throw new Error("No opened channel");t.send(JSON.stringify(e))}},{key:"mode",get:function(){return this._mode}}]),e}();t.a=d}).call(t,"modules/RTC/BridgeChannel.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(53),s=n.n(a),c=n(0),u=(n.n(c),n(54)),l=n(11),d=n(15),p=n(17),h=n(4),f=n(1),m=n(8),v=n.n(m),g=n(27),y=n(5),b=n(16),_=n.n(b),S=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),T=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},C=Object(c.getLogger)(e),E=function(e){function t(e){var n=e.deviceId,o=e.facingMode,a=e.mediaType,s=e.resolution,c=e.rtcId,u=e.sourceId,l=e.sourceType,d=e.stream,h=e.track,m=e.videoType;r(this,t);var y=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,null,d,h,function(){return y.emit(p.LOCAL_TRACK_STOPPED)},a,m));return y.rtcId=c,y.sourceId=u,y.sourceType=l,f.a.usesNewGumFlow()?(y.resolution=h.getSettings().height,y._constraints=h.getConstraints()):y.resolution=f.a.isFirefox()?null:s,y.deviceId=n,y._prevSetMuted=Promise.resolve(),y._facingMode=o,y._trackEnded=!1,y._hasSentData=!1,y._testDataSent=!0,y._realDeviceId=""===y.deviceId?void 0:y.deviceId,y._noDataFromSourceTimeout=null,y._onDeviceListChanged=function(e){y._setRealDeviceIdFromDeviceList(e),void 0!==y.getTrack().readyState||void 0===y._realDeviceId||e.find(function(e){return e.deviceId===y._realDeviceId})||(y._trackEnded=!0)},y.isAudioTrack()&&g.a.isDeviceChangeAvailable("output")&&(y._onAudioOutputDeviceChanged=y.setAudioOutput.bind(y),g.a.addListener(v.a.AUDIO_OUTPUT_DEVICE_CHANGED,y._onAudioOutputDeviceChanged)),g.a.addListener(v.a.DEVICE_LIST_CHANGED,y._onDeviceListChanged),y._initNoDataFromSourceHandlers(),y}return o(t,e),S(t,[{key:"isEnded",value:function(){return"ended"===this.getTrack().readyState||this._trackEnded}},{key:"_initNoDataFromSourceHandlers",value:function(){var e=this;if(this.isVideoTrack()&&this.videoType===_.a.CAMERA){var t=this._onNoDataFromSourceError.bind(this);this._setHandler("track_mute",function(){if(e._checkForCameraIssues()){var n=window.performance.now();e._noDataFromSourceTimeout=setTimeout(t,3e3),e._setHandler("track_unmute",function(){e._clearNoDataFromSourceMuteResources(),y.a.sendEventToAll(e.getType()+".track_unmute",{value:window.performance.now()-n})})}}),this._setHandler("track_ended",t)}}},{key:"_clearNoDataFromSourceMuteResources",value:function(){this._noDataFromSourceTimeout&&(clearTimeout(this._noDataFromSourceTimeout),this._noDataFromSourceTimeout=null),this._setHandler("track_unmute",void 0)}},{key:"_onNoDataFromSourceError",value:function(){this._clearNoDataFromSourceMuteResources(),this._checkForCameraIssues()&&this._fireNoDataFromSourceEvent()}},{key:"_fireNoDataFromSourceEvent",value:function(){this.emit(p.NO_DATA_FROM_SOURCE);var e=this.getType()+".no_data_from_source";y.a.analytics.sendEvent(e);var t={name:e};this.isAudioTrack()&&(t.isReceivingData=this._isReceivingData()),y.a.sendLog(JSON.stringify(t))}},{key:"_setRealDeviceIdFromDeviceList",value:function(e){var t=this.getTrack(),n=e.find(function(e){return e.kind===t.kind+"input"&&e.label===t.label});n&&(this._realDeviceId=n.deviceId)}},{key:"_setStream",value:function(e){T(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_setStream",this).call(this,e),e?(this.storedMSID=this.getMSID(),C.debug("Setting new MSID: "+this.storedMSID+" on "+this)):C.debug("Setting 'null' stream on "+this)}},{key:"mute",value:function(){return this._queueSetMuted(!0)}},{key:"unmute",value:function(){return this._queueSetMuted(!1)}},{key:"_queueSetMuted",value:function(e){var t=this._setMuted.bind(this,e);return this._prevSetMuted=this._prevSetMuted.then(t,t),this._prevSetMuted}},{key:"_setMuted",value:function(e){var t=this;if(this.isMuted()===e)return Promise.resolve();var n=Promise.resolve(),r=function(){return C.info("Mute "+t+": "+e)};if(this.isAudioTrack()||this.videoType===_.a.DESKTOP||!f.a.doesVideoMuteByStreamRemove())r(),this.track&&(this.track.enabled=!e);else if(e)n=new Promise(function(e,n){r(),t._removeStreamFromConferenceAsMute(function(){t._unregisterHandlers(),t._stopStream(),t._setStream(null),e()},n)});else{r();var i={cameraDeviceId:this.getDeviceId(),devices:[h.b],facingMode:this.getCameraFacingMode()};f.a.usesNewGumFlow()?n=g.a.newObtainAudioAndVideoPermissions(Object.assign({},i,{constraints:{video:this._constraints}})):(this.resolution&&(i.resolution=this.resolution),n=g.a.obtainAudioAndVideoPermissions(i)),n.then(function(e){var n=t.getType(),r=f.a.usesNewGumFlow()?e.find(function(e){return e.track.kind===n}):e.find(function(e){return e.mediaType===n});if(!r)throw new l.a(d.TRACK_NO_STREAM_FOUND);return t._setStream(r.stream),t.track=r.track,t.videoType!==r.videoType&&(C.warn(t+": video type has changed after unmute!",t.videoType,r.videoType),t.videoType=r.videoType),t.containers=t.containers.map(function(e){return g.a.attachMediaStream(e,t.stream)}),t._addStreamToConferenceAsUnmute()})}return n.then(function(){return t._sendMuteStatus(e)}).then(function(){return t.emit(p.TRACK_MUTE_CHANGED,t)})}},{key:"_addStreamToConferenceAsUnmute",value:function(){var e=this;return this.conference?new Promise(function(t,n){e.conference._addLocalTrackAsUnmute(e).then(t,function(e){return n(new Error(e))})}):Promise.resolve()}},{key:"_removeStreamFromConferenceAsMute",value:function(e,t){if(!this.conference)return void e();this.conference._removeLocalTrackAsMute(this).then(e,function(e){return t(new Error(e))})}},{key:"_sendMuteStatus",value:function(e){var t=this;return this.conference&&this.conference.room?new Promise(function(n){t.conference.room[t.isAudioTrack()?"setAudioMute":"setVideoMute"](e,n)}):Promise.resolve()}},{key:"dispose",value:function(){var e=this,n=Promise.resolve();return this.conference&&(n=this.conference.removeTrack(this)),this.stream&&(this._stopStream(),this.detach()),g.a.removeListener(v.a.DEVICE_LIST_CHANGED,this._onDeviceListChanged),this._onAudioOutputDeviceChanged&&g.a.removeListener(v.a.AUDIO_OUTPUT_DEVICE_CHANGED,this._onAudioOutputDeviceChanged),n.then(function(){return T(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",e).call(e)})}},{key:"isMuted",value:function(){return!(this.stream&&(!this.isVideoTrack()||this.isActive())&&this.track&&this.track.enabled)}},{key:"_setConference",value:function(e){this.conference=e;for(var t=0;t<this.containers.length;t++)this._maybeFireTrackAttached(this.containers[t])}},{key:"isLocal",value:function(){return!0}},{key:"getDeviceId",value:function(){return this._realDeviceId||this.deviceId}},{key:"getParticipantId",value:function(){return this.conference&&this.conference.myUserId()}},{key:"_onByteSentStatsReceived",value:function(e,t){var n=this;t>0&&(this._hasSentData=!0);var r=e.getConnectionState();this._testDataSent&&"connected"===r&&(setTimeout(function(){n._hasSentData||(C.warn(n+" 'bytes sent' <= 0:                         "+n._bytesSent),n._fireNoDataFromSourceEvent())},3e3),this._testDataSent=!1)}},{key:"getCameraFacingMode",value:function(){if(this.isVideoTrack()&&this.videoType===_.a.CAMERA){var e=void 0;try{e=this.track.getSettings()}catch(e){}return e&&"facingMode"in e?e.facingMode:void 0!==this._facingMode?this._facingMode:s.a.USER}}},{key:"_stopStream",value:function(){this._stopStreamInProgress=!0;try{g.a.stopMediaStream(this.stream)}finally{this._stopStreamInProgress=!1}}},{key:"_switchCamera",value:function(){this.isVideoTrack()&&this.videoType===_.a.CAMERA&&"function"==typeof this.track._switchCamera&&(this.track._switchCamera(),this._facingMode=this._facingMode===s.a.ENVIRONMENT?s.a.USER:s.a.ENVIRONMENT)}},{key:"_checkForCameraIssues",value:function(){return!(!this.isVideoTrack()||this._stopStreamInProgress||this.videoType===_.a.DESKTOP||this._isReceivingData())}},{key:"_isReceivingData",value:function(){return!!this.stream&&this.stream.getTracks().some(function(e){return!("readyState"in e&&"live"!==e.readyState||"muted"in e&&!0===e.muted)})}},{key:"toString",value:function(){return"LocalTrack["+this.rtcId+","+this.getType()+"]"}}]),t}(u.a);t.a=E}).call(t,"modules/RTC/JitsiLocalTrack.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=(n.n(a),n(120)),c=n.n(s),u=n(123),l=n(126),d=n(127),p=n(19),h=n.n(p),f=n(12),m=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),v=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),g=Object(a.getLogger)(e),y={stable:"stable",haveLocalOffer:"have-local-offer",haveRemoteOffer:"have-remote-offer",closed:"closed"},b={new:"new",gathering:"gathering",complete:"complete"},_="jitsi-ortc-cname-"+h.a.randomInt(1e4,99999),S=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return g.debug("constructor() pcConfig:",e),n._bufferedIceCandidates=[],n._closed=!1,n._dtlsTransport=null,n._iceGatherer=null,n._iceGatheringState=b.new,n._iceTransport=null,n._localCapabilities=null,n._localDescription=null,n._localTrackInfos=new Map,n._mids=new Map,n._remoteDescription=null,n._remoteStreams=new Map,n._remoteTrackInfos=new Map,n._sdpGlobalFields={id:f.a.generateSsrc(),version:0},n._signalingState=y.stable,n._setIceGatherer(e),n._setIceTransport(n._iceGatherer),n._setDtlsTransport(n._iceTransport),n}return o(t,e),v(t,[{key:"addIceCandidate",value:function(e){var t=void 0,n=void 0,r=void 0;if(!e)throw new TypeError("candidate missing");if(0==(arguments.length<=1?0:arguments.length-1))t=!0;else{if(t=!1,n=arguments.length<=1?void 0:arguments[1],r=arguments.length<=2?void 0:arguments[2],"function"!=typeof n)throw new TypeError("callback missing");if("function"!=typeof r)throw new TypeError("errback missing")}if(g.debug("addIceCandidate() candidate:",e),t)return this._addIceCandidate(e);this._addIceCandidate(e).then(function(){return n()}).catch(function(e){return r(e)})}},{key:"addStream",value:function(e){g.debug("addStream()"),this._addStream(e)}},{key:"close",value:function(){if(!this._closed){this._closed=!0,g.debug("close()"),this._updateAndEmitSignalingStateChange(y.closed);try{this._iceGatherer.close()}catch(e){g.warn("iceGatherer.close() failed:"+e)}try{this._iceTransport.stop()}catch(e){g.warn("iceTransport.stop() failed:"+e)}try{this._dtlsTransport.stop()}catch(e){g.warn("dtlsTransport.stop() failed:"+e)}var e=!0,t=!1,n=void 0;try{for(var r,i=this._localTrackInfos.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=o.rtpSender;try{a.stop()}catch(e){g.warn("rtpSender.stop() failed:"+e)}}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this._localTrackInfos.clear();var s=!0,c=!1,u=void 0;try{for(var l,d=this._remoteTrackInfos.values()[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var p=l.value,h=p.rtpReceiver;try{h.stop()}catch(e){g.warn("rtpReceiver.stop() failed:"+e)}}}catch(e){c=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(c)throw u}}this._remoteTrackInfos.clear(),this._remoteStreams.clear()}}},{key:"createAnswer",value:function(){var e=void 0,t=void 0,n=void 0,r=void 0;if(arguments.length<=1)e=!0,t=arguments.length<=0?void 0:arguments[0];else{if(e=!1,n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],t=arguments.length<=2?void 0:arguments[2],"function"!=typeof n)throw new TypeError("callback missing");if("function"!=typeof r)throw new TypeError("errback missing")}if(g.debug("createAnswer() options:",t),e)return this._createAnswer(t);this._createAnswer(t).then(function(e){return n(e)}).catch(function(e){return r(e)})}},{key:"createDataChannel",value:function(){throw g.debug("createDataChannel()"),new Error("createDataChannel() not supported in Edge")}},{key:"createOffer",value:function(){var e=void 0,t=void 0,n=void 0,r=void 0;if(arguments.length<=1)e=!0,t=arguments.length<=0?void 0:arguments[0];else{if(e=!1,n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],t=arguments.length<=2?void 0:arguments[2],"function"!=typeof n)throw new TypeError("callback missing");if("function"!=typeof r)throw new TypeError("errback missing")}if(g.debug("createOffer() options:",t),e)return this._createOffer(t);this._createOffer(t).then(function(e){return n(e)}).catch(function(e){return r(e)})}},{key:"getLocalStreams",value:function(){return Array.from(this._localTrackInfos.values()).map(function(e){return e.stream}).filter(function(e,t,n){return n.indexOf(e)===t})}},{key:"getRemoteStreams",value:function(){return Array.from(this._remoteStreams.values())}},{key:"getStats",value:function(){var e=void 0,t=void 0,n=void 0,r=void 0;if("function"==typeof(arguments.length<=0?void 0:arguments[0])?(e=!1,n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1]):"function"==typeof(arguments.length<=1?void 0:arguments[1])?(e=!1,t=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1],r=arguments.length<=2?void 0:arguments[2]):(e=!0,t=arguments.length<=0?void 0:arguments[0]),e||r||(r=function(e){g.error("getStats() failed: "+e),g.error(e.stack)}),e)return this._getStats(t);this._getStats(t).then(function(e){return n(e)}).catch(function(e){return r(e)})}},{key:"removeStream",value:function(e){g.debug("removeStream()"),this._removeStream(e)}},{key:"setLocalDescription",value:function(e){var t=void 0,n=void 0,r=void 0;if(!e)throw new TypeError("description missing");if(0==(arguments.length<=1?0:arguments.length-1))t=!0;else{if(t=!1,n=arguments.length<=1?void 0:arguments[1],r=arguments.length<=2?void 0:arguments[2],"function"!=typeof n)throw new TypeError("callback missing");if("function"!=typeof r)throw new TypeError("errback missing")}if(g.debug("setLocalDescription() desc:",e),t)return this._setLocalDescription(e);this._setLocalDescription(e).then(function(){return n()}).catch(function(e){return r(e)})}},{key:"setRemoteDescription",value:function(e){var t=void 0,n=void 0,r=void 0;if(!e)throw new TypeError("description missing");if(0==(arguments.length<=1?0:arguments.length-1))t=!0;else{if(t=!1,n=arguments.length<=1?void 0:arguments[1],r=arguments.length<=2?void 0:arguments[2],"function"!=typeof n)throw new TypeError("callback missing");if("function"!=typeof r)throw new TypeError("errback missing")}if(g.debug("setRemoteDescription() desc:",e),t)return this._setRemoteDescription(e);this._setRemoteDescription(e).then(function(){return n()}).catch(function(e){return r(e)})}},{key:"_addIceCandidate",value:function(e){return this._closed?Promise.reject(new d.a("RTCPeerConnection closed")):Promise.reject(new Error("addIceCandidate() not supported"))}},{key:"_addStream",value:function(e){if(this._closed)throw new d.a("RTCPeerConnection closed");var t=!0,n=!1,r=void 0;try{for(var i,o=e.getTracks()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if("ended"!==a.readyState)if(this._localTrackInfos.has(a.id))g.warn("ignoring already handled MediaStreamTrack");else{var s=new RTCRtpSender(a,this._dtlsTransport);this._localTrackInfos.set(a.id,{rtpSender:s,stream:e})}else g.warn("ignoring ended MediaStreamTrack")}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}var c=!0,u=!1,l=void 0;try{for(var p,h=this._localTrackInfos[Symbol.iterator]();!(c=(p=h.next()).done);c=!0){var f=p.value,v=m(f,2),y=v[0],b=v[1],_=b.rtpSender.track;if("ended"===_.readyState){g.warn("_addStream() an already handled track was stopped, track.id:"+_.id);try{b.rtpSender.stop()}catch(e){g.warn("rtpSender.stop() failed:"+e)}this._localTrackInfos.delete(_.id)}else if(b.stream===e&&!e.getTrackById(y)){g.warn("_addStream() a track in this stream was removed, track.id:"+y);try{b.rtpSender.stop()}catch(e){g.warn("rtpSender.stop() failed:"+e)}this._localTrackInfos.delete(_.id)}}}catch(e){u=!0,l=e}finally{try{!c&&h.return&&h.return()}finally{if(u)throw l}}this._emitNegotiationNeeded()}},{key:"_createAnswer",value:function(e){if(this._closed)return Promise.reject(new d.a("RTCPeerConnection closed"));if(this.signalingState!==y.haveRemoteOffer)return Promise.reject(new d.a('invalid signalingState "'+this.signalingState+'"'));var t=this._createLocalDescription("answer");return Promise.resolve(t)}},{key:"_createLocalDescription",value:function(e){function t(t,o){var u={};switch(u.type=o,o){case"audio":case"video":u.protocol="RTP/SAVPF",u.port=9,u.direction="sendrecv";break;case"application":u.protocol="DTLS/SCTP",u.port=0,u.payloads="0",u.direction="inactive"}u.connection={ip:"127.0.0.1",version:4},u.mid=t,u.iceUfrag=r.usernameFragment,u.icePwd=r.password,u.candidates=[];var d=!0,p=!1,h=void 0;try{for(var m,v=i[Symbol.iterator]();!(d=(m=v.next()).done);d=!0){var g=m.value,y={};y.component=1,y.foundation=g.foundation,y.ip=g.ip,y.port=g.port,y.priority=g.priority,y.transport=g.protocol.toLowerCase(),y.type=g.type,"tcp"===y.transport&&(y.tcptype=g.tcpType),u.candidates.push(y)}}catch(e){p=!0,h=e}finally{try{!d&&v.return&&v.return()}finally{if(p)throw h}}if(u.endOfCandidates="end-of-candidates",u.setup="offer"===e?"actpass":"server"===a.role?"active":"passive","audio"===o||"video"===o){u.rtp=[],u.rtcpFb=[],u.fmtp=[];var b=[],S=!0,T=!1,C=void 0;try{for(var E,w=s.codecs[Symbol.iterator]();!(S=(E=w.next()).done);S=!0){var R=E.value;if(!R.kind||R.kind===o){b.push(R.preferredPayloadType);var k={codec:R.name,payload:R.preferredPayloadType,rate:R.clockRate};if(R.numChannels>1&&(k.encoding=R.numChannels),u.rtp.push(k),R.parameters){var I={config:"",payload:R.preferredPayloadType},P=!0,A=!1,O=void 0;try{for(var D,x=Object.keys(R.parameters)[Symbol.iterator]();!(P=(D=x.next()).done);P=!0){var N=D.value;I.config&&(I.config+=";"),I.config+=N+"="+R.parameters[N]}}catch(e){A=!0,O=e}finally{try{!P&&x.return&&x.return()}finally{if(A)throw O}}I.config&&u.fmtp.push(I)}var L=!0,M=!1,j=void 0;try{for(var F,U=(R.rtcpFeedback||[])[Symbol.iterator]();!(L=(F=U.next()).done);L=!0){var H=F.value;u.rtcpFb.push({payload:R.preferredPayloadType,subtype:H.parameter||void 0,type:H.type})}}catch(e){M=!0,j=e}finally{try{!L&&U.return&&U.return()}finally{if(M)throw j}}}}}catch(e){T=!0,C=e}finally{try{!S&&w.return&&w.return()}finally{if(T)throw C}}0===b.length?(u.payloads="9",u.port=0,u.direction="inactive"):u.payloads=b.join(" "),u.ssrcs=[],u.ssrcGroups=[];var B=!0,G=!1,J=void 0;try{for(var V,W=c.values()[Symbol.iterator]();!(B=(V=W.next()).done);B=!0){var q=V.value,K=q.rtpSender,z=q.stream.id,$=K.track;if("ended"!==$.readyState&&$.kind===o){q.ssrc||(q.ssrc=f.a.generateSsrc());var Q=l&&"video"===$.kind;Q&&!q.rtxSsrc&&(q.rtxSsrc=q.ssrc+1),u.ssrcs.push({attribute:"cname",id:q.ssrc,value:_}),u.ssrcs.push({attribute:"msid",id:q.ssrc,value:z+" "+$.id}),u.ssrcs.push({attribute:"mslabel",id:q.ssrc,value:z}),u.ssrcs.push({attribute:"label",id:q.ssrc,value:$.id}),Q&&(u.ssrcs.push({attribute:"cname",id:q.rtxSsrc,value:_}),u.ssrcs.push({attribute:"msid",id:q.rtxSsrc,value:z+" "+$.id}),u.ssrcs.push({attribute:"mslabel",id:q.rtxSsrc,value:z}),u.ssrcs.push({attribute:"label",id:q.rtxSsrc,value:$.id}),u.ssrcGroups.push({semantics:"FID",ssrcs:q.ssrc+" "+q.rtxSsrc}))}}}catch(e){G=!0,J=e}finally{try{!B&&W.return&&W.return()}finally{if(G)throw J}}u.ext=[];var X=!0,Y=!1,Z=void 0;try{for(var ee,te=s.headerExtensions[Symbol.iterator]();!(X=(ee=te.next()).done);X=!0){var ne=ee.value;ne.kind&&ne.kind!==o||u.ext.push({value:ne.preferredId,uri:ne.uri})}}catch(e){Y=!0,Z=e}finally{try{!X&&te.return&&te.return()}finally{if(Y)throw Z}}u.rtcpMux="rtcp-mux",u.rtcpRsize="rtcp-rsize"}n.media.push(u)}var n={},r=this._iceGatherer.getLocalParameters(),i=this._iceGatherer.getLocalCandidates(),o=this._dtlsTransport.getLocalParameters(),a=this._dtlsTransport.getRemoteParameters(),s=this._localCapabilities,c=this._localTrackInfos;"offer"===e&&this._sdpGlobalFields.version++,n.version=0,n.origin={address:"127.0.0.1",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"jitsi-ortc-webrtc-shim"},n.name="-",n.timing={start:0,stop:0},n.msidSemantic={semantic:"WMS",token:"*"},n.groups=[{mids:Array.from(this._mids.keys()).join(" "),type:"BUNDLE"}],n.media=[],n.fingerprint={hash:o.fingerprints[0].value,type:o.fingerprints[0].algorithm};var l=!1,d=!0,p=!1,h=void 0;try{for(var v,y=s.codecs[Symbol.iterator]();!(d=(v=y.next()).done);d=!0){var b=v.value;if("video"===b.kind&&"rtx"===b.name){l=!0;break}}}catch(e){p=!0,h=e}finally{try{!d&&y.return&&y.return()}finally{if(p)throw h}}var S=!0,T=!1,C=void 0;try{for(var E,w=this._mids[Symbol.iterator]();!(S=(E=w.next()).done);S=!0){var R=E.value,k=m(R,2),I=k[0],P=k[1];t.call(this,I,P)}}catch(e){T=!0,C=e}finally{try{!S&&w.return&&w.return()}finally{if(T)throw C}}var A=new u.a({type:e,_sdpObject:n});return g.debug("_createLocalDescription():",A),A}},{key:"_createOffer",value:function(e){return this._closed?Promise.reject(new d.a("RTCPeerConnection closed")):this.signalingState!==y.stable?Promise.reject(new d.a('invalid signalingState "'+this.signalingState+'"')):Promise.reject(new Error("createoOffer() not yet supported"))}},{key:"_emitAddStream",value:function(e){if(!this._closed){g.debug('emitting "addstream"');var t=new c.a.Event("addstream");t.stream=e,this.dispatchEvent(t)}}},{key:"_emitBufferedIceCandidates",value:function(){if(!this._closed){var e=!0,t=!1,n=void 0;try{for(var r,i=this._bufferedIceCandidates[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;if(o){o.sdpMIndex=this._mids.keys().next().value,g.debug('emitting buffered "icecandidate", candidate:',o);var a=new c.a.Event("icecandidate");a.candidate=o,this.dispatchEvent(a)}}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this._bufferedIceCandidates=[]}}},{key:"_emitConnectionStateChange",value:function(){if(!this._closed||"closed"===this.connectionState){g.debug('emitting "connectionstatechange", connectionState:',this.connectionState);var e=new c.a.Event("connectionstatechange");this.dispatchEvent(e)}}},{key:"_emitIceCandidate",value:function(e){if(!this._closed){var t=null;if(e){var n=this._mids.keys().next().value,r="candidate:"+e.foundation+" 1 "+e.protocol+" "+e.priority+" "+e.ip+" "+e.port+" typ "+e.type;e.relatedAddress&&(r+=" raddr "+e.relatedAddress),e.relatedPort&&(r+=" rport "+e.relatedPort),"tcp"===e.protocol&&(r+=" tcptype "+e.tcpType),t={candidate:r,component:1,foundation:e.foundation,ip:e.ip,port:e.port,priority:e.priority,protocol:e.protocol,type:e.type,sdpMIndex:n,sdpMLineIndex:0},"tcp"===e.protocol&&(t.tcptype=e.tcpType),e.relatedAddress&&(t.relatedAddress=e.relatedAddress),e.relatedPort&&(t.relatedPort=e.relatedPort)}if(this._localDescription){g.debug('emitting "icecandidate", candidate:',t);var i=new c.a.Event("icecandidate");i.candidate=t,this.dispatchEvent(i)}else g.debug("buffering gathered ICE candidate:",t),this._bufferedIceCandidates.push(t)}}},{key:"_emitIceConnectionStateChange",value:function(){if(!this._closed||"closed"===this.iceConnectionState){g.debug('emitting "iceconnectionstatechange", iceConnectionState:',this.iceConnectionState);var e=new c.a.Event("iceconnectionstatechange");this.dispatchEvent(e)}}},{key:"_emitNegotiationNeeded",value:function(){if(this.signalingState===y.stable){g.debug('emitting "negotiationneeded"');var e=new c.a.Event("negotiationneeded");this.dispatchEvent(e)}}},{key:"_emitRemoveStream",value:function(e){if(!this._closed){g.debug('emitting "removestream"');var t=new c.a.Event("removestream");t.stream=e,this.dispatchEvent(t)}}},{key:"_getParametersForRtpReceiver",value:function(e,t){var n=t.ssrc,r=t.rtxSsrc,i=t.cname,o=this._localCapabilities,a={codecs:[],degradationPreference:"balanced",encodings:[],headerExtensions:[],muxId:"",rtcp:{cname:i,compound:!0,mux:!0,reducedSize:!0}},s=[],c=void 0,u=!0,l=!1,d=void 0;try{for(var p,h=o.codecs[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){var f=p.value;if(f.kind===e&&"rtx"!==f.name){c=f.preferredPayloadType,s.push({clockRate:f.clockRate,maxptime:f.maxptime,mimeType:f.mimeType,name:f.name,numChannels:f.numChannels,parameters:f.parameters,payloadType:f.preferredPayloadType,ptime:f.ptime,rtcpFeedback:f.rtcpFeedback});break}}}catch(e){l=!0,d=e}finally{try{!u&&h.return&&h.return()}finally{if(l)throw d}}if(r){var m=!0,v=!1,g=void 0;try{for(var y,b=o.codecs[Symbol.iterator]();!(m=(y=b.next()).done);m=!0){var _=y.value;if(_.kind===e&&"rtx"===_.name){s.push({clockRate:_.clockRate,mimeType:_.mimeType,name:"rtx",parameters:_.parameters,payloadType:_.preferredPayloadType,rtcpFeedback:_.rtcpFeedback});break}}}catch(e){v=!0,g=e}finally{try{!m&&b.return&&b.return()}finally{if(v)throw g}}}a.codecs=s;var S={active:!0,codecPayloadType:c,ssrc:n};r&&(S.rtx={ssrc:r}),a.encodings.push(S);var T=!0,C=!1,E=void 0;try{for(var w,R=o.headerExtensions[Symbol.iterator]();!(T=(w=R.next()).done);T=!0){var k=w.value;k.kind===e&&a.headerExtensions.push({encrypt:k.preferredEncrypt,id:k.preferredId,uri:k.uri})}}catch(e){C=!0,E=e}finally{try{!T&&R.return&&R.return()}finally{if(C)throw E}}return a}},{key:"_getParametersForRtpSender",value:function(e,t){var n=t.ssrc,r=t.rtxSsrc,i=_,o=this._localCapabilities,a={codecs:[],degradationPreference:"balanced",encodings:[],headerExtensions:[],muxId:"",rtcp:{cname:i,compound:!0,mux:!0,reducedSize:!0}},s=[],c=void 0,u=!0,l=!1,d=void 0;try{for(var p,h=o.codecs[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){var f=p.value;if(f.kind===e&&"rtx"!==f.name){c=f.preferredPayloadType,s.push({clockRate:f.clockRate,maxptime:f.maxptime,mimeType:f.mimeType,name:f.name,numChannels:f.numChannels,parameters:f.parameters,payloadType:f.preferredPayloadType,ptime:f.ptime,rtcpFeedback:f.rtcpFeedback});break}}}catch(e){l=!0,d=e}finally{try{!u&&h.return&&h.return()}finally{if(l)throw d}}if(r){var m=!0,v=!1,g=void 0;try{for(var y,b=o.codecs[Symbol.iterator]();!(m=(y=b.next()).done);m=!0){var S=y.value;if(S.kind===e&&"rtx"===S.name){s.push({clockRate:S.clockRate,mimeType:S.mimeType,name:"rtx",parameters:S.parameters,payloadType:S.preferredPayloadType,rtcpFeedback:S.rtcpFeedback});break}}}catch(e){v=!0,g=e}finally{try{!m&&b.return&&b.return()}finally{if(v)throw g}}}a.codecs=s;var T={active:!0,codecPayloadType:c,ssrc:n};r&&(T.rtx={ssrc:r}),a.encodings.push(T);var C=!0,E=!1,w=void 0;try{for(var R,k=o.headerExtensions[Symbol.iterator]();!(C=(R=k.next()).done);C=!0){var I=R.value;I.kind===e&&a.headerExtensions.push({encrypt:I.preferredEncrypt,id:I.preferredId,uri:I.uri})}}catch(e){E=!0,w=e}finally{try{!C&&k.return&&k.return()}finally{if(E)throw w}}return a}},{key:"_getStats",value:function(e){if(this._closed)return Promise.reject(new d.a("RTCPeerConnection closed"));var t=this._iceGatherer,n=this._iceTransport,r=[],i=[],o=[],a=!0,s=!1,c=void 0;try{for(var u,l=this._localTrackInfos.values()[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var p=u.value,h=p.rtpSender;p.sending&&r.push(h)}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}var f=!0,m=!1,v=void 0;try{for(var g,y=this._remoteTrackInfos.values()[Symbol.iterator]();!(f=(g=y.next()).done);f=!0){var b=g.value,_=b.rtpReceiver;i.push(_)}}catch(e){m=!0,v=e}finally{try{!f&&y.return&&y.return()}finally{if(m)throw v}}t&&o.push(t.getStats().catch(function(){return null})),n&&(o.push(n.getStats().catch(function(){return null})),"function"==typeof n.msGetStats&&o.push(n.msGetStats().catch(function(){return null})));var S=!0,T=!1,C=void 0;try{for(var E,w=r[Symbol.iterator]();!(S=(E=w.next()).done);S=!0){var h=E.value;!function(e){var t="audio"===e.track.kind;o.push(e.getStats().then(function(e){if(!t){var n=!0,r=!1,i=void 0;try{for(var o,a=Object.keys(e)[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=e[s];"track"===c.type&&delete c.audioLevel}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}return e}).catch(function(){return null}))}(h)}}catch(e){T=!0,C=e}finally{try{!S&&w.return&&w.return()}finally{if(T)throw C}}var R=!0,k=!1,I=void 0;try{for(var P,A=i[Symbol.iterator]();!(R=(P=A.next()).done);R=!0){var _=P.value;!function(e){var t="audio"===e.track.kind;o.push(e.getStats().then(function(e){if(!t){var n=!0,r=!1,i=void 0;try{for(var o,a=Object.keys(e)[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=e[s];"track"===c.type&&delete c.audioLevel}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}return e}).catch(function(){return null}))}(_)}}catch(e){k=!0,I=e}finally{try{!R&&A.return&&A.return()}finally{if(k)throw I}}return Promise.all(o).then(function(e){var t={},n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s){var c=!0,u=!1,l=void 0;try{for(var d,p=Object.keys(s)[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var h=d.value;t[h]=s[h]}}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}}}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t})}},{key:"_handleLocalInitialAnswer",value:function(e){g.debug("_handleLocalInitialAnswer(), desc:",e);var t=e.sdpObject;this._localCapabilities=l.a(t),g.debug("local capabilities:",this._localCapabilities)}},{key:"_handleLocalReAnswer",value:function(e){g.debug("_handleLocalReAnswer(), desc:",e);var t=e.sdpObject;this._localCapabilities=l.a(t),g.debug("local capabilities:",this._localCapabilities)}},{key:"_handleRemoteInitialOffer",value:function(e){g.debug("_handleRemoteInitialOffer(), desc:",e);var t=e.sdpObject;this._mids=l.e(t);var n=l.a(t);g.debug("remote capabilities:",n),this._localCapabilities=l.g(n),this._startIceAndDtls(e)}},{key:"_handleRemoteReOffer",value:function(e){g.debug("_handleRemoteReOffer(), desc:",e);var t=e.sdpObject;this._mids=l.e(t);var n=l.a(t);g.debug("remote capabilities:",n),this._localCapabilities=l.g(n)}},{key:"_receiveMedia",value:function(){g.debug("_receiveMedia()");var e=new Set(this._remoteTrackInfos.keys()),t=l.f(this._remoteDescription.sdpObject),n=new Map,r=new Map,i=new Map;g.debug("_receiveMedia() remote track infos:",t);var o=!0,a=!1,s=void 0;try{for(var c,u=t[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var d=c.value,p=m(d,2),h=p[0],f=p[1];if(!e.has(h)){g.debug("_receiveMedia() new remote track, ssrc:"+h),this._remoteTrackInfos.set(h,f);var v=f.kind,y=f.rtxSsrc,b=f.streamId,_=f.trackId,S=f.cname,T=!this._remoteStreams.has(b),C=void 0;T?(g.debug("_receiveMedia() new remote stream, id:"+b),C=new MediaStream,C.jitsiRemoteId=b,n.set(b,C),this._remoteStreams.set(b,C)):C=this._remoteStreams.get(b);var E=new RTCRtpReceiver(this._dtlsTransport,v),w=this._getParametersForRtpReceiver(v,{ssrc:h,rtxSsrc:y,cname:S});f.track=E.track,E.onerror=function(e){g.error('rtpReceiver "error" event, event:'),g.error(e)},f.stream=C,f.rtpReceiver=E,g.debug("calling rtpReceiver.receive(), parameters:",w);try{E.receive(w);var R=f.track;R.jitsiRemoteId=_,C.addTrack(R),n.has(b)||r.set(R,C)}catch(e){g.error("rtpReceiver.receive() failed:"+e.message),g.error(e)}}}}catch(e){a=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}var k=!0,I=!1,P=void 0;try{for(var A,O=e[Symbol.iterator]();!(k=(A=O.next()).done);k=!0){var D=A.value;if(!t.has(D)){g.debug("_receiveMedia() remote track removed, ssrc:"+D);var x=this._remoteTrackInfos.get(D),C=x.stream,N=x.track,E=x.rtpReceiver;try{E.stop()}catch(e){g.warn("rtpReceiver.stop() failed:"+e)}i.set(N,C),C.removeTrack(N),this._remoteTrackInfos.delete(D)}}}catch(e){I=!0,P=e}finally{try{!k&&O.return&&O.return()}finally{if(I)throw P}}var L=!0,M=!1,j=void 0;try{for(var F,U=r[Symbol.iterator]();!(L=(F=U.next()).done);L=!0){var H=F.value,B=m(H,2),N=B[0],C=B[1],G=new Event("addtrack");G.track=N,C.dispatchEvent(G)}}catch(e){M=!0,j=e}finally{try{!L&&U.return&&U.return()}finally{if(M)throw j}}var J=!0,V=!1,W=void 0;try{for(var q,K=i[Symbol.iterator]();!(J=(q=K.next()).done);J=!0){var z=q.value,$=m(z,2),Q=$[0],X=$[1],G=new Event("removetrack");G.track=Q,X.dispatchEvent(G)}}catch(e){V=!0,W=e}finally{try{!J&&K.return&&K.return()}finally{if(V)throw W}}var Y=!0,Z=!1,ee=void 0;try{for(var te,ne=n.values()[Symbol.iterator]();!(Y=(te=ne.next()).done);Y=!0){var re=te.value;0===re.getTracks().length?(g.warn("ignoring new stream for which no track could be added"),n.delete(re.jitsiRemoteId),this._remoteStreams.delete(re.jitsiRemoteId)):this._emitAddStream(re)}}catch(e){Z=!0,ee=e}finally{try{!Y&&ne.return&&ne.return()}finally{if(Z)throw ee}}var ie=!0,oe=!1,ae=void 0;try{for(var se,ce=this._remoteStreams[Symbol.iterator]();!(ie=(se=ce.next()).done);ie=!0){var ue=se.value,le=m(ue,2),b=le[0],de=le[1];de.getTracks().length>0||(this._remoteStreams.delete(b),this._emitRemoveStream(de))}}catch(e){oe=!0,ae=e}finally{try{!ie&&ce.return&&ce.return()}finally{if(oe)throw ae}}}},{key:"_removeStream",value:function(e){if(this._closed)throw new d.a("RTCPeerConnection closed");var t=!0,n=!1,r=void 0;try{for(var i,o=e.getTracks()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(this._localTrackInfos.has(a.id)){var s=this._localTrackInfos.get(a.id).rtpSender;try{s.stop()}catch(e){g.warn("rtpSender.stop() failed:"+e)}this._localTrackInfos.delete(a.id)}}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this._emitNegotiationNeeded()}},{key:"_sendMedia",value:function(){g.debug("_sendMedia()");var e=!0,t=!1,n=void 0;try{for(var r,i=this._localTrackInfos.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;if(!o.sending){var a=o.rtpSender,s=o.ssrc,c=o.rtxSsrc,u=a.track,l=u.kind,d=this._getParametersForRtpSender(l,{ssrc:s,rtxSsrc:c});g.debug("calling rtpSender.send(), parameters:",d);try{a.send(d),o.sending=!0}catch(e){g.error("rtpSender.send() failed:"+e.message),g.error(e)}}}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"_setDtlsTransport",value:function(e){var t=this,n=new RTCDtlsTransport(e);n.onstatechange=function(){g.debug('dtlsTransport "statechange" event, state:'+n.state),t._emitConnectionStateChange()},n.ondtlsstatechange=function(){g.debug('dtlsTransport "dtlsstatechange" event, state:'+n.state),t._emitConnectionStateChange()},n.onerror=function(e){var n=void 0;e.message?n=e.message:e.error&&(n=e.error.message),g.error('dtlsTransport "error" event, message:'+n),t._emitConnectionStateChange()},this._dtlsTransport=n}},{key:"_setIceGatherer",value:function(e){var t=this,n={gatherPolicy:e.iceTransportPolicy||"all",iceServers:e.iceServers||[]},r=new RTCIceGatherer(n);r.onstatechange=function(){g.debug('iceGatherer "statechange" event, state:'+r.state),t._updateAndEmitIceGatheringStateChange(r.state)},r.onlocalcandidate=function(e){var n=e.candidate,r=e.complete;g.debug('iceGatherer "localcandidate" event, candidate:',n),r||!n||0===Object.keys(n).length?(n=null,t._updateAndEmitIceGatheringStateChange(b.complete),t._emitIceCandidate(null)):t._emitIceCandidate(n)},r.onerror=function(e){var t=e.errorCode,n=e.errorText;g.error('iceGatherer "error" event, errorCode:'+t+", errorText:"+n)};try{r.gather()}catch(e){g.warn("iceGatherer.gather() failed:"+e)}this._iceGatherer=r}},{key:"_setIceTransport",value:function(e){var t=this,n=new RTCIceTransport(e);n.onstatechange=function(){g.debug('iceTransport "statechange" event, state:'+n.state),t._emitIceConnectionStateChange()},n.onicestatechange=function(){g.debug('iceTransport "icestatechange" event, state:'+n.state),"completed"===n.state&&g.debug("nominated candidate pair:",n.getNominatedCandidatePair()),t._emitIceConnectionStateChange()},n.oncandidatepairchange=function(e){g.debug('iceTransport "candidatepairchange" event, pair:'+e.pair)},this._iceTransport=n}},{key:"_setLocalDescription",value:function(e){var t=this;if(this._closed)return Promise.reject(new d.a("RTCPeerConnection closed"));var n=void 0;try{n=new u.a(e)}catch(e){return Promise.reject(new TypeError("invalid RTCSessionDescriptionInit: "+e))}switch(e.type){case"offer":return this.signalingState!==y.stable?Promise.reject(new d.a('invalid signalingState "'+this.signalingState+'"')):Promise.reject(new TypeError('setLocalDescription() with type "offer" not supported'));case"answer":if(this.signalingState!==y.haveRemoteOffer)return Promise.reject(new d.a('invalid signalingState "'+this.signalingState+'"'));var r=Boolean(!this._localDescription);return Promise.resolve().then(function(){return r?t._handleLocalInitialAnswer(n):t._handleLocalReAnswer(n)}).then(function(){g.debug("setLocalDescription() succeed"),t._localDescription=n,t._updateAndEmitSignalingStateChange(y.stable),r&&t._emitBufferedIceCandidates(),t._sendMedia(),t._receiveMedia()}).catch(function(e){throw g.error("setLocalDescription() failed: "+e.message),g.error(e),e});default:return Promise.reject(new TypeError('unsupported description.type "'+e.type+'"'))}}},{key:"_setRemoteDescription",value:function(e){var t=this;if(this._closed)return Promise.reject(new d.a("RTCPeerConnection closed"));var n=void 0;try{n=new u.a(e)}catch(e){return Promise.reject(new TypeError("invalid RTCSessionDescriptionInit: "+e))}switch(e.type){case"offer":if(this.signalingState!==y.stable)return Promise.reject(new d.a('invalid signalingState "'+this.signalingState+'"'));var r=Boolean(!this._remoteDescription);return Promise.resolve().then(function(){return r?t._handleRemoteInitialOffer(n):t._handleRemoteReOffer(n)}).then(function(){g.debug("setRemoteDescription() succeed"),t._remoteDescription=n,t._updateAndEmitSignalingStateChange(y.haveRemoteOffer)}).catch(function(e){throw g.error("setRemoteDescription() failed: "+e),e});case"answer":return this.signalingState!==y.haveLocalOffer?Promise.reject(new d.a('invalid signalingState "'+this.signalingState+'"')):Promise.reject(new TypeError('setRemoteDescription() with type "answer" not supported'));default:return Promise.reject(new TypeError('unsupported description.type "'+e.type+'"'))}}},{key:"_startIceAndDtls",value:function(e){var t=e.sdpObject,n=l.d(t),r=l.c(t),i=l.b(t);switch(e.type){case"offer":this._iceTransport.start(this._iceGatherer,n,"controlled");break;case"answer":this._iceTransport.start(this._iceGatherer,n,"controlling")}var o=!0,a=!1,s=void 0;try{for(var c,u=r[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var d=c.value;0!==d.port&&9!==d.port&&this._iceTransport.addRemoteCandidate(d)}}catch(e){a=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}switch(this._iceTransport.addRemoteCandidate({}),e.type){case"offer":i.role="server";break;case"answer":i.role="client"}this._dtlsTransport.start(i)}},{key:"_updateAndEmitIceGatheringStateChange",value:function(e){if(!this._closed&&e!==this.iceGatheringState){this._iceGatheringState=e,g.debug('emitting "icegatheringstatechange", iceGatheringState:',this.iceGatheringState);var t=new c.a.Event("icegatheringstatechange");this.dispatchEvent(t)}}},{key:"_updateAndEmitSignalingStateChange",value:function(e){if(e!==this.signalingState){this._signalingState=e,g.debug('emitting "signalingstatechange", signalingState:',this.signalingState);var t=new c.a.Event("signalingstatechange");this.dispatchEvent(t)}}},{key:"connectionState",get:function(){return this._dtlsTransport.state}},{key:"iceConnectionState",get:function(){return this._iceTransport.state}},{key:"iceGatheringState",get:function(){return this._iceGatheringState}},{key:"localDescription",get:function(){return this._localDescription}},{key:"remoteDescription",get:function(){return this._remoteDescription}},{key:"signalingState",get:function(){return this._signalingState}}]),t}(c.a.EventTarget);t.a=S}).call(t,"modules/RTC/ortc/RTCPeerConnection.js")},function(e,t,n){e.exports={EventTarget:n(121),Event:n(122)}},function(e,t){function n(){this._listeners={}}Object.defineProperties(n.prototype,{listeners:{get:function(){return this._listeners}}}),n.prototype.addEventListener=function(e,t){var n,r,i;if(e&&t){for(n=this._listeners[e],void 0===n&&(this._listeners[e]=n=[]),r=0;i=n[r];r++)if(i===t)return;n.push(t)}},n.prototype.removeEventListener=function(e,t){var n,r,i;if(e&&t&&void 0!==(n=this._listeners[e])){for(r=0;i=n[r];r++)if(i===t){n.splice(r,1);break}0===n.length&&delete this._listeners[e]}},n.prototype.dispatchEvent=function(e){var t,n,r,i,o,a=!1;if(!e||"string"!=typeof e.type)throw new Error("`event` must have a valid `type` property");e._yaeti&&(e.target=this,e.cancelable=!0);try{e.stopImmediatePropagation=function(){a=!0}}catch(e){}if(t=e.type,n=this._listeners[t]||[],"function"==typeof(r=this["on"+t]))try{r.call(this,e)}catch(e){console.error(e)}for(i=0;(o=n[i])&&!a;i++)try{o.call(this,e)}catch(e){console.error(e)}return!e.defaultPrevented},e.exports=n},function(e,t,n){(function(t){e.exports=t.Event}).call(t,n(20))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(13),o=n.n(i),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(){function e(t){switch(r(this,e),this._sdp=null,this._sdpObject=null,this._type=null,t.type){case"offer":case"answer":break;default:throw new TypeError('invalid type "'+t.type+'"')}if(this._type=t.type,"string"==typeof t.sdp){this._sdp=t.sdp;try{this._sdpObject=o.a.parse(t.sdp)}catch(e){throw new Error("invalid sdp: "+e)}}else{if("object"!==a(t._sdpObject))throw new TypeError("invalid sdp or _sdpObject");this._sdpObject=t._sdpObject;try{this._sdp=o.a.write(t._sdpObject)}catch(e){throw new Error("invalid sdp object: "+e)}}}return s(e,[{key:"toJSON",value:function(){return{sdp:this._sdp,type:this._type}}},{key:"sdp",get:function(){return this._sdp},set:function(e){try{this._sdpObject=o.a.parse(e)}catch(e){throw new Error("invalid sdp: "+e)}this._sdp=e}},{key:"sdpObject",get:function(){return this._sdpObject}},{key:"type",get:function(){return this._type}}]),e}();t.a=c},function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=r(e[o+1]))},o=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:r?t[e.name]:t;i(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},a=n(55),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var t=e[0],i=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(i))return o(c,r,i)}}),t.media=n,t};var c=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length&&(e[n[0]]=r(n[1])),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(c,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(c,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}})})}},function(e,t,n){var r=n(55),i=/%[sdv%]/g,o=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},a=function(e,t,n){var r=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,i=[e+"="+r];if(t.names)for(var a=0;a<t.names.length;a+=1){var s=t.names[a];t.name?i.push(n[t.name][s]):i.push(n[t.names[a]])}else i.push(n[t.name]);return o.apply(null,i)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||s,i=t.innerOrder||c,o=[];return n.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(a(t,n,e))})})}),e.media.forEach(function(e){o.push(a("m",r.m[0],e)),i.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(a(t,n,e))})})})}),o.join("\r\n")+"\r\n"}},function(e,t,n){"use strict";function r(e){var t=new Map,n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e.media[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value,u=c.type;if("audio"===u||"video"===u){var l=!0,d=!1,h=void 0;try{for(var f,m=c.rtp[Symbol.iterator]();!(l=(f=m.next()).done);l=!0){var v=f.value,g={clockRate:v.rate,kind:u,mimeType:u+"/"+v.codec,name:v.codec,numChannels:v.encoding||1,parameters:{},preferredPayloadType:v.payload,rtcpFeedback:[]};t.set(g.preferredPayloadType,g)}}catch(e){d=!0,h=e}finally{try{!l&&m.return&&m.return()}finally{if(d)throw h}}var y=!0,b=!1,_=void 0;try{for(var S,T=(c.fmtp||[])[Symbol.iterator]();!(y=(S=T.next()).done);y=!0){var C=S.value,E=p.a.parseFmtpConfig(C.config),g=t.get(C.payload);g&&(g.parameters=E)}}catch(e){b=!0,_=e}finally{try{!y&&T.return&&T.return()}finally{if(b)throw _}}var w=!0,R=!1,k=void 0;try{for(var I,P=(c.rtcpFb||[])[Symbol.iterator]();!(w=(I=P.next()).done);w=!0){var A=I.value,g=t.get(A.payload);g&&g.rtcpFeedback.push({parameter:A.subtype||"",type:A.type})}}catch(e){R=!0,k=e}finally{try{!w&&P.return&&P.return()}finally{if(R)throw k}}var O=!0,D=!1,x=void 0;try{for(var N,L=(c.ext||[])[Symbol.iterator]();!(O=(N=L.next()).done);O=!0){var M=N.value;!function(e){var t=e.value,r=e.uri,i={kind:u,uri:r,preferredId:t};n.find(function(e){return i.kind===e.kind&&i.uri===e.uri})||n.push(i)}(M)}}catch(e){D=!0,x=e}finally{try{!O&&L.return&&L.return()}finally{if(D)throw x}}}}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return{codecs:Array.from(t.values()),fecMechanisms:[],headerExtensions:n}}function i(e){var t=l(e),n=t.fingerprint||e.fingerprint,r=void 0;switch(t.setup){case"active":r="client";break;case"passive":r="server";break;case"actpass":r="auto"}return{role:r,fingerprints:[{algorithm:n.type,value:n.hash}]}}function o(e){var t=l(e),n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t.candidates[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;if(1===c.component){var u={foundation:c.foundation,ip:c.ip,port:c.port,priority:c.priority,protocol:c.transport.toLowerCase(),type:c.type};n.push(u)}}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}function a(e){var t=l(e),n=t.iceUfrag,r=t.icePwd;return{icelite:"ice-lite"===e.icelite,password:r,usernameFragment:n}}function s(e){var t=new Map,n=!0,r=!1,i=void 0;try{for(var o,a=e.media[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;t.set(s.mid,s.type)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t}function c(e){var t=new Map,n=new Map,r=new Set,i=!0,o=!1,a=void 0;try{for(var s,c=e.media[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,l=u.type;if("audio"===l||"video"===l){var d=!0,p=!1,h=void 0;try{for(var f,m=(u.ssrcGroups||[])[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var v=f.value;if("FID"===v.semantics){var g=v.ssrcs.split(" ").map(function(e){return Number(e)}),y=g[0],b=g[1];n.set(y,b),r.add(b)}}}catch(e){p=!0,h=e}finally{try{!d&&m.return&&m.return()}finally{if(p)throw h}}var _=!0,S=!1,T=void 0;try{for(var C,E=(u.ssrcs||[])[Symbol.iterator]();!(_=(C=E.next()).done);_=!0){var w=C.value,y=w.id;if(!r.has(y)){var R=t.get(y);switch(R||(R={kind:l,rtxSsrc:n.get(y),ssrc:y},t.set(y,R)),w.attribute){case"cname":R.cname=w.value;break;case"msid":var k=w.value.split(" "),I=k[0],P=k[1];R.streamId=I,R.trackId=P;break;case"mslabel":var A=w.value;R.streamId=A;break;case"label":var O=w.value;R.trackId=O}}}}catch(e){S=!0,T=e}finally{try{!_&&E.return&&E.return()}finally{if(S)throw T}}}}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}return t}function u(e){var t=RTCRtpReceiver.getCapabilities(),n={codecs:[],fecMechanisms:[],headerExtensions:[]},r=new Map,i=!0,o=!1,a=void 0;try{for(var s,c=e.codecs[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;!function(e){var i=e.name.toLowerCase();if("rtx"===i)return r.set(e.parameters.apt,e.preferredPayloadType),"continue";var o=t.codecs.find(function(t){return t.name.toLowerCase()===i&&t.kind===e.kind&&t.clockRate===e.clockRate});if(!o)return"continue";var a={clockRate:o.clockRate,kind:o.kind,mimeType:o.kind+"/"+o.name,name:o.name,numChannels:o.numChannels||1,parameters:{},preferredPayloadType:e.preferredPayloadType,rtcpFeedback:[]},s=!0,c=!1,u=void 0;try{for(var l,d=Object.keys(e.parameters)[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var p=l.value,h=e.parameters[p],f=!0,m=!1,v=void 0;try{for(var g,y=Object.keys(o.parameters)[Symbol.iterator]();!(f=(g=y.next()).done);f=!0){var b=g.value,_=o.parameters[b];if(b===p&&_===h){a.parameters[b]=_;break}}}catch(e){m=!0,v=e}finally{try{!f&&y.return&&y.return()}finally{if(m)throw v}}}}catch(e){c=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(c)throw u}}var S=!0,T=!1,C=void 0;try{for(var E,w=e.rtcpFeedback[Symbol.iterator]();!(S=(E=w.next()).done);S=!0){var R=E.value;!function(e){var t=o.rtcpFeedback.find(function(t){return t.type===e.type&&t.parameter===e.parameter});t&&a.rtcpFeedback.push(t)}(R)}}catch(e){T=!0,C=e}finally{try{!S&&w.return&&w.return()}finally{if(T)throw C}}n.codecs.push(a)}(u)}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}var l=!0,d=!1,p=void 0;try{for(var h,f=n.codecs[Symbol.iterator]();!(l=(h=f.next()).done);l=!0){var m=h.value,v=m.preferredPayloadType;if(r.has(v)){var g={clockRate:m.clockRate,kind:m.kind,mimeType:m.kind+"/rtx",name:"rtx",parameters:{apt:v},preferredPayloadType:r.get(v),rtcpFeedback:[]};n.codecs.push(g)}}}catch(e){d=!0,p=e}finally{try{!l&&f.return&&f.return()}finally{if(d)throw p}}var y=!0,b=!1,_=void 0;try{for(var S,T=e.headerExtensions[Symbol.iterator]();!(y=(S=T.next()).done);y=!0){var C=S.value;!function(e){var r=t.headerExtensions.find(function(t){return t.kind===e.kind&&t.uri===e.uri});if(r){var i={kind:r.kind,preferredEncrypt:Boolean(e.preferredEncrypt),preferredId:e.preferredId,uri:r.uri};n.headerExtensions.push(i)}}(C)}}catch(e){b=!0,_=e}finally{try{!y&&T.return&&T.return()}finally{if(b)throw _}}var E=!0,w=!1,R=void 0;try{for(var k,I=e.fecMechanisms[Symbol.iterator]();!(E=(k=I.next()).done);E=!0){var P=k.value;!function(e){var r=t.fecMechanisms.find(function(t){return t===e});r&&n.fecMechanisms.push(r)}(P)}}catch(e){w=!0,R=e}finally{try{!E&&I.return&&I.return()}finally{if(w)throw R}}return n}function l(e){return e.media.find(function(e){return e.iceUfrag&&0!==e.port})}t.a=r,t.b=i,t.c=o,t.d=a,t.e=s,t.f=c,t.g=u;var d=n(13),p=n.n(d)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return a});var a=function(e){return function(t){function n(t){r(this,n);var o=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return Object.defineProperty(o,"name",{value:e}),o}return o(n,t),n}(Error)}("InvalidStateError")},function(e,t,n){"use strict";(function(e){function r(e,t,n){T(["screen"],function(e){return t({stream:e})},n)}function i(e){return"https://chrome.google.com/webstore/detail/"+e.desktopSharingChromeExtId}function o(e,t){try{for(var n=e.split("."),r=t.split("."),i=Math.max(n.length,r.length),o=0;o<i;o++){var a=0,s=0;if(o<n.length&&(a=parseInt(n[o],10)),o<r.length&&(s=parseInt(r[o],10)),isNaN(a)||isNaN(s))return!0;if(a!==s)return a>s}return!1}catch(e){return g.callErrorHandler(e),v.error("Failed to parse extension version",e),!0}}function a(e,t){if("undefined"==typeof chrome||!chrome||!chrome.runtime)return void e(!1,!1);chrome.runtime.sendMessage(t.desktopSharingChromeExtId,{getVersion:!0},function(n){if(!n||!n.version)return v.warn("Extension not installed?: ",chrome.runtime.lastError),void e(!1,!1);var r=n.version;v.log("Extension version is: "+r);var i=o(t.desktopSharingChromeMinExtVersion,r);e(!i,i)})}function s(e,t,n){chrome.runtime.sendMessage(e.desktopSharingChromeExtId,{getStream:!0,sources:e.desktopSharingChromeSources},function(e){if(!e){var r=chrome.runtime.lastError;return void n(r instanceof Error?r:new h.a(f.CHROME_EXTENSION_GENERIC_ERROR,r))}v.log("Response from extension: ",e),d(e,t,n)})}function c(e){0===$("link[rel=chrome-webstore-item]").length&&$("head").append('<link rel="chrome-webstore-item">'),$("link[rel=chrome-webstore-item]").attr("href",i(e))}function u(e){return c(e),new Promise(function(t){a(function(e,n){y=e,b=n,v.info("Chrome extension installed: "+y+" updateRequired: "+b),t()},e)})}function l(e,t,n){return 0===n?Promise.reject():new Promise(function(r,i){var o=n,s=window.setInterval(function(){a(function(e){e?(window.clearInterval(s),r()):0==--o&&(i(),window.clearInterval(s))},e)},t)})}function d(e,t,n){var r=e.streamId,i=e.streamType,o=e.error;if(r)T(["desktop"],function(e){return t({stream:e,sourceId:r,sourceType:i})},n,{desktopStream:r});else{if(""===r)return void n(new h.a(f.CHROME_EXTENSION_USER_CANCELED));n(new h.a(f.CHROME_EXTENSION_GENERIC_ERROR,o))}}function p(e){if(!e.desktopSharingFirefoxDisabled&&!1!==_&&!0!==_){if(!e.desktopSharingFirefoxExtId)return void(_=!1);var t=document.createElement("img");t.onload=function(){v.log("Detected firefox screen sharing extension."),_=!0},t.onerror=function(){v.log("Detected lack of firefox screen sharing extension."),_=!1};var n=e.desktopSharingFirefoxExtId.replace("@","."),r=document.location.hostname,i="chrome://"+n+"/content/"+r+".png";t.setAttribute("src",i)}}var h=n(11),f=n(15),m=n(1),v=n(0).getLogger(e),g=n(3),y=!1,b=!1,_=null,S=!1,T=null,C={intChromeExtPromise:null,obtainStream:null,init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{disableDesktopSharing:!1,desktopSharingChromeDisabled:!1,desktopSharingChromeExtId:null,desktopSharingFirefoxDisabled:!1,desktopSharingFirefoxExtId:null},t=arguments[1];this.options=e=e||{},T=t,this.obtainStream=this.options.disableDesktopSharing?null:this._createObtainStreamMethod(e),this.obtainStream||v.info("Desktop sharing disabled")},_createObtainStreamMethod:function(e){var t=this;if(m.a.isNWJS())return function(e,t,n){window.JitsiMeetNW.obtainDesktopStream(t,function(e,t){var r=void 0;r=e&&"InvalidStateError"===e.name?new h.a(f.CHROME_EXTENSION_USER_CANCELED):new h.a(e,t,["desktop"]),"function"==typeof n&&n(r)})};if(m.a.isElectron())return this.obtainScreenOnElectron;if(m.a.isTemasysPluginUsed()){var i=n(35).WebRTCPlugin.plugin;return i.HasScreensharingFeature?i.isScreensharingAvailable?(v.info("Using Temasys plugin for desktop sharing"),r):(v.warn("Screensharing not available with Temasys plugin on this site"),null):(v.warn("Screensharing not supported by this plugin version"),null)}return m.a.isChrome()||m.a.isOpera()?(m.a.getChromeVersion()||m.a.getOperaVersion())<34?(v.info("Chrome extension not supported until ver 34"),null):e.desktopSharingChromeDisabled||!1===e.desktopSharingChromeMethod||!e.desktopSharingChromeExtId?null:(v.info("Using Chrome extension for desktop sharing"),this.intChromeExtPromise=u(e).then(function(){t.intChromeExtPromise=null}),this.obtainScreenFromExtension):m.a.isFirefox()?e.desktopSharingFirefoxDisabled?null:"http:"===window.location.protocol?(v.log("Screen sharing is not supported over HTTP. Use of HTTPS is required."),null):(p(e),this.obtainScreenOnFirefox):(v.log("Screen sharing not supported by the current browser: ",m.a.getBrowserType(),m.a.getBrowserName()),null)},isSupported:function(){return null!==this.obtainStream},obtainScreenOnFirefox:function(e,t,n){var i=this,o=!1,a=this.options.desktopSharingFirefoxMaxVersionExtRequired;return(-1===a||a>=0&&m.a.getFirefoxVersion()<=a)&&(o=!0,v.log("Jidesha extension required on firefox version "+m.a.getFirefoxVersion())),o&&!0!==_?(S&&(S=!1,p(this.options)),null===_?(window.setTimeout(function(){null===_&&(_=!1),i.obtainScreenOnFirefox(t,n)},300),void v.log("Waiting for detection of jidesha on firefox to finish.")):(_=null,S=!0,void n(new h.a(f.FIREFOX_EXTENSION_NEEDED)))):void r(e,t,n)},obtainScreenOnElectron:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2];window.JitsiMeetScreenObtainer&&window.JitsiMeetScreenObtainer.openDesktopPicker?window.JitsiMeetScreenObtainer.openDesktopPicker({desktopSharingSources:e.desktopSharingSources||this.options.desktopSharingChromeSources},function(e,r){return d({streamId:e,streamType:r},t,n)},function(e){return n(new h.a(f.ELECTRON_DESKTOP_PICKER_ERROR,e))}):n(new h.a(f.ELECTRON_DESKTOP_PICKER_NOT_FOUND))},obtainScreenFromExtension:function(e,t,n){var r=this;if(null!==this.intChromeExtPromise)return void this.intChromeExtPromise.then(function(){r.obtainScreenFromExtension(e,t,n)});var o=this.options,a=o.desktopSharingChromeExtId,c=o.desktopSharingChromeSources,u={desktopSharingChromeExtId:a,desktopSharingChromeSources:e.desktopSharingSources||c};if(y)s(u,t,n);else{if(b&&alert("Jitsi Desktop Streamer requires update. Changes will take effect after next Chrome restart."),m.a.isOpera())return void this.handleExternalInstall(e,t,n);try{chrome.webstore.install(i(this.options),function(i){v.log("Extension installed successfully",i),y=!0,l(r.options,200,10).then(function(){s(u,t,n)}).catch(function(){r.handleExtensionInstallationError(e,t,n)})},this.handleExtensionInstallationError.bind(this,e,t,n))}catch(r){this.handleExtensionInstallationError(e,t,n,r)}}},handleExternalInstall:function(e,t,n,r){var o=i(this.options);e.listener("waitingForExtension",o),this.checkForChromeExtensionOnInterval(e,t,n,r)},handleExtensionInstallationError:function(e,t,n,r){var o=i(this.options);if(("Inline installs can not be initiated from pop-up windows."===r||"Chrome Web Store installations can only be started by the top frame."===r||"Installs can only be initiated by one of the Chrome Web Store item's verified sites."===r||"Inline installation is not supported for this item. The user will be redirected to the Chrome Web Store."===r)&&e.interval>0&&"function"==typeof e.checkAgain&&"function"==typeof e.listener)return void this.handleExternalInstall(e,t,n,r);var a="Failed to install the extension from "+o;v.log(a,r);var s="Chrome Web Store installations can only be initated by a user gesture."===r?f.CHROME_EXTENSION_USER_GESTURE_REQUIRED:f.CHROME_EXTENSION_INSTALLATION_ERROR;n(new h.a(s,a))},checkForChromeExtensionOnInterval:function(e,t,n){var r=this;if(!1===e.checkAgain())return void n(new h.a(f.CHROME_EXTENSION_INSTALLATION_ERROR));l(this.options,e.interval,1).then(function(){y=!0,e.listener("extensionFound"),r.obtainScreenFromExtension(e,t,n)}).catch(function(){r.checkForChromeExtensionOnInterval(e,t,n)})}};t.a=C}).call(t,"modules/RTC/ScreenObtainer.js")},function(e,t,n){"use strict";(function(t){var r=n(130);e.exports=r({window:t.window})}).call(t,n(20))},function(e,t,n){"use strict";var r=n(10);e.exports=function(e,t){var i=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in t)hasOwnProperty.call(t,a)&&(o[a]=t[a]);var s=r.log,c=r.detectBrowser(i),u={browserDetails:c,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings},l=n(131)||null,d=n(133)||null,p=n(137)||null,h=n(139)||null,f=n(140)||null;switch(c.browser){case"chrome":if(!l||!l.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),u;s("adapter.js shimming chrome."),u.browserShim=l,f.shimCreateObjectURL(i),l.shimGetUserMedia(i),l.shimMediaStream(i),l.shimSourceObject(i),l.shimPeerConnection(i),l.shimOnTrack(i),l.shimAddTrackRemoveTrack(i),l.shimGetSendersWithDtmf(i),f.shimRTCIceCandidate(i);break;case"firefox":if(!p||!p.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),u;s("adapter.js shimming firefox."),u.browserShim=p,f.shimCreateObjectURL(i),p.shimGetUserMedia(i),p.shimSourceObject(i),p.shimPeerConnection(i),p.shimOnTrack(i),f.shimRTCIceCandidate(i);break;case"edge":if(!d||!d.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),u;s("adapter.js shimming edge."),u.browserShim=d,f.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimPeerConnection(i),d.shimReplaceTrack(i);break;case"safari":if(!h||!o.shimSafari)return s("Safari shim is not included in this adapter release."),u;s("adapter.js shimming safari."),u.browserShim=h,f.shimCreateObjectURL(i),h.shimRTCIceServerUrls(i),h.shimCallbacksAPI(i),h.shimLocalStreamsAPI(i),h.shimRemoteStreamsAPI(i),h.shimTrackEventTransceiver(i),h.shimGetUserMedia(i),h.shimCreateOfferLegacy(i),f.shimRTCIceCandidate(i);break;default:s("Unsupported browser!")}return u}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(10),o=i.log,a={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}),t.stream.getTracks().forEach(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=this,o=n.apply(i,arguments);return o||(o=t(i,e),i._senders.push(o)),o};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;i.apply(t,arguments);var n=t._senders.indexOf(e);-1!==n&&t._senders.splice(n,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],o.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],a.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"===(void 0===e?"undefined":r(e))&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;if(this._srcObject=e,this.src&&t.revokeObjectURL(this.src),!e)return void(this.src="");this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})}}))},shimAddTrackRemoveTrack:function(e){function t(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function n(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}var r=i.detectBrowser(e);if(!(e.RTCPeerConnection.prototype.addTrack&&r.version>=63)){var o=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=o.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());n._streams[t.id]=r,n._reverseStreams[r.id]=t,t=r}a.apply(n,[t])};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},s.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var o=r._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);r._streams[n.id]=a,r._reverseStreams[a.id]=n,r.addStream(a)}return r.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(n){var r=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){var e=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var i=t(e,r);n[0].apply(null,[i])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(n){return t(e,n)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=n(e,arguments[0]),c.apply(e,arguments)):c.apply(e,arguments)};var u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,n=u.get.apply(this);return""===n.type?n:t(e,n)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==t)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var n;Object.keys(t._streams).forEach(function(r){t._streams[r].getTracks().find(function(t){return e.track===t})&&(n=t._streams[r])}),n&&(1===n.getTracks().length?t.removeStream(t._reverseStreams[n.id]):n.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(e){var t=i.detectBrowser(e);if(e.RTCPeerConnection){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,r.push(a)):r.push(e.iceServers[o])}e.iceServers=r}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}else e.RTCPeerConnection=function(t,n){return o("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return a.apply(this,arguments);if(0===a.length&&(0===arguments.length||"function"!=typeof arguments[0]))return a.apply(this,[]);var o=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){i[1](s(o(e)))};return a.apply(this,[c,arguments[0]])}return new Promise(function(e,t){a.apply(r,[function(t){e(s(o(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,i){n.apply(t,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===r(arguments[0])){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){n.apply(e,[r,i,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var s=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:a.shimMediaStream,shimOnTrack:a.shimOnTrack,shimAddTrackRemoveTrack:a.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:a.shimGetSendersWithDtmf,shimSourceObject:a.shimSourceObject,shimPeerConnection:a.shimPeerConnection,shimGetUserMedia:n(132)}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(10),o=i.log;e.exports=function(e){var t=i.detectBrowser(e),n=e&&e.navigator,a=function(e){if("object"!==(void 0===e?"undefined":r(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"===r(e[n])?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var a={};"number"==typeof i.ideal?(a[o("min",n)]=i.ideal,t.optional.push(a),a={},a[o("max",n)]=i.ideal,t.optional.push(a)):(a[o("",n)]=i.ideal,t.optional.push(a))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===r(e.audio)){var s=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),s(e.audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=a(e.audio)}if(e&&"object"===r(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":r(c))?c:{ideal:c});var u=t.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||u)){delete e.video.facingMode;var l;if("environment"===c.exact||"environment"===c.ideal?l=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(l=["front"]),l)return n.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var n=t.find(function(e){return l.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!n&&t.length&&-1!==l.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=c.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=a(e.video),o("chrome: "+JSON.stringify(e)),i(e)})}e.video=a(e.video)}return o("chrome: "+JSON.stringify(e)),i(e)},c=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},u=function(e,t,r){s(e,function(e){n.webkitGetUserMedia(e,t,function(e){r&&r(c(e))})})};n.getUserMedia=u;var l=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:l,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return s(e,function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(c(e))})})}}else n.mediaDevices.getUserMedia=function(e){return l(e)};void 0===n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){o("Dummy mediaDevices.addEventListener called.")}),void 0===n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){o("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,n){"use strict";var r=n(10),i=n(134);e.exports={shimGetUserMedia:n(136),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=i(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},function(e,t,n){"use strict";function r(e,t,n,r,i){var o=c.writeRtpDescription(e.kind,t);if(o+=c.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=c.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+"\r\n"),o}function i(e,t){var n=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}return!1})}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function a(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}var c=n(56);e.exports=function(e,t){var n=function(n){var r=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=o[e].bind(o)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy){var a=new Error("rtcpMuxPolicy 'negotiate' is not supported");throw a.name="NotSupportedError",a}switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=i(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var s=n.iceCandidatePoolSize;s>0;s--)this._iceGatherers=new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy});else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=c.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0};return n.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),"function"==typeof this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},n.prototype.getConfiguration=function(){return this._config},n.prototype.getLocalStreams=function(){return this.localStreams},n.prototype.getRemoteStreams=function(){return this.remoteStreams},n.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&t)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();n.iceTransport=r.iceTransport,n.dtlsTransport=r.dtlsTransport}return this.transceivers.push(n),n},n.prototype.addTrack=function(t,n){for(var r,i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},n.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},n.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},n.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},n.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},n.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].candidates=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].candidates&&r.transceivers[t].candidates.push(e.candidate)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},n.prototype._gather=function(t,n){var r=this,i=this.transceivers[n].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[n].candidates;this.transceivers[n].candidates=null,i.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),i.onlocalcandidate=function(e){if(!(r.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,s=!a||0===Object.keys(a).length;s?"new"!==i.state&&"gathering"!==i.state||(i.state="completed"):("new"===i.state&&(i.state="gathering"),a.component=1,o.candidate.candidate=c.writeCandidate(a));var u=c.splitSections(r.localDescription.sdp);u[o.candidate.sdpMLineIndex+1]+=s?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",r.localDescription.sdp=u.join("");var l=r.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),s||(r.dispatchEvent(o),"function"==typeof r.onicecandidate&&r.onicecandidate(o)),l&&(r.dispatchEvent(new Event("icecandidate")),"function"==typeof r.onicecandidate&&r.onicecandidate(new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){var t=new Event("RTCIceGatherEvent");t.candidate=e,i.onlocalcandidate(t)})},0)}},n.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},n.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},n.prototype._transceive=function(e,n,r){var i=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:c.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),r&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),i.encodings=e.recvEncodingParameters,i.rtcp={cname:e.rtcpParameters.cname,compound:e.rtcpParameters.compound},e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},n.prototype.setLocalDescription=function(e){var t=this,n=arguments;if(!a("setLocalDescription",e.type,this.signalingState))return new Promise(function(r,i){var o=new Error("Can not set local "+e.type+" in state "+t.signalingState);o.name="InvalidStateError",n.length>2&&"function"==typeof n[2]&&n[2].apply(null,[o]),i(o)});var r,i;if("offer"===e.type)r=c.splitSections(e.sdp),i=r.shift(),r.forEach(function(e,n){var r=c.parseRtpParameters(e);t.transceivers[n].localCapabilities=r}),this.transceivers.forEach(function(e,n){t._gather(e.mid,n)});else if("answer"===e.type){r=c.splitSections(t.remoteDescription.sdp),i=r.shift();var s=c.matchPrefix(i,"a=ice-lite").length>0;r.forEach(function(e,n){var r=t.transceivers[n],a=r.iceGatherer,u=r.iceTransport,l=r.dtlsTransport,d=r.localCapabilities,p=r.remoteCapabilities;if(!(c.isRejected(e)&&1===!c.matchPrefix(e,"a=bundle-only").length||r.isDatachannel)){var h=c.getIceParameters(e,i),f=c.getDtlsParameters(e,i);s&&(f.role="server"),t.usingBundle&&0!==n||(t._gather(r.mid,n),"new"===u.state&&u.start(a,h,s?"controlling":"controlled"),"new"===l.state&&l.start(f));var m=o(d,p);t._transceive(r,m.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var u=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(e){u&&u.apply(null),e()})},n.prototype.setRemoteDescription=function(n){var r=this,i=arguments;if(!a("setRemoteDescription",n.type,this.signalingState))return new Promise(function(e,t){var o=new Error("Can not set remote "+n.type+" in state "+r.signalingState);o.name="InvalidStateError",i.length>2&&"function"==typeof i[2]&&i[2].apply(null,[o]),t(o)});var o={};this.remoteStreams.forEach(function(e){o[e.id]=e});var u=[],l=c.splitSections(n.sdp),d=l.shift(),p=c.matchPrefix(d,"a=ice-lite").length>0,h=c.matchPrefix(d,"a=group:BUNDLE ").length>0;this.usingBundle=h;var f=c.matchPrefix(d,"a=ice-options:")[0];switch(this.canTrickleIceCandidates=!!f&&f.substr(14).split(" ").indexOf("trickle")>=0,l.forEach(function(i,a){var l=c.splitLines(i),f=c.getKind(i),m=c.isRejected(i)&&1===!c.matchPrefix(i,"a=bundle-only").length,v=l[0].substr(2).split(" ")[2],g=c.getDirection(i,d),y=c.parseMsid(i),b=c.getMid(i)||c.generateIdentifier();if("application"===f&&"DTLS/SCTP"===v)return void(r.transceivers[a]={mid:b,isDatachannel:!0});var _,S,T,C,E,w,R,k,I,P,A,O=c.parseRtpParameters(i);m||(P=c.getIceParameters(i,d),A=c.getDtlsParameters(i,d),A.role="client"),R=c.parseRtpEncodingParameters(i);var D=c.parseRtcpParameters(i),x=c.matchPrefix(i,"a=end-of-candidates",d).length>0,N=c.matchPrefix(i,"a=candidate:").map(function(e){return c.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===n.type||"answer"===n.type)&&!m&&h&&a>0&&r.transceivers[a]&&(r._disposeIceAndDtlsTransports(a),r.transceivers[a].iceGatherer=r.transceivers[0].iceGatherer,r.transceivers[a].iceTransport=r.transceivers[0].iceTransport,r.transceivers[a].dtlsTransport=r.transceivers[0].dtlsTransport,r.transceivers[a].rtpSender&&r.transceivers[a].rtpSender.setTransport(r.transceivers[0].dtlsTransport),r.transceivers[a].rtpReceiver&&r.transceivers[a].rtpReceiver.setTransport(r.transceivers[0].dtlsTransport)),"offer"!==n.type||m)"answer"!==n.type||m||(_=r.transceivers[a],S=_.iceGatherer,T=_.iceTransport,C=_.dtlsTransport,E=_.rtpReceiver,w=_.sendEncodingParameters,k=_.localCapabilities,r.transceivers[a].recvEncodingParameters=R,r.transceivers[a].remoteCapabilities=O,r.transceivers[a].rtcpParameters=D,N.length&&"new"===T.state&&(!p&&!x||h&&0!==a?N.forEach(function(e){s(_.iceTransport,e)}):T.setRemoteCandidates(N)),h&&0!==a||("new"===T.state&&T.start(S,P,"controlling"),"new"===C.state&&C.start(A)),r._transceive(_,"sendrecv"===g||"recvonly"===g,"sendrecv"===g||"sendonly"===g),!E||"sendrecv"!==g&&"sendonly"!==g?delete _.rtpReceiver:(I=E.track,y?(o[y.stream]||(o[y.stream]=new e.MediaStream),o[y.stream].addTrack(I),u.push([I,E,o[y.stream]])):(o.default||(o.default=new e.MediaStream),o.default.addTrack(I),u.push([I,E,o.default]))));else{_=r.transceivers[a]||r._createTransceiver(f),_.mid=b,_.iceGatherer||(_.iceGatherer=r._createIceGatherer(a,h)),N.length&&"new"===_.iceTransport.state&&(!x||h&&0!==a?N.forEach(function(e){s(_.iceTransport,e)}):_.iceTransport.setRemoteCandidates(N)),k=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(k.codecs=k.codecs.filter(function(e){return"rtx"!==e.name})),w=_.sendEncodingParameters||[{ssrc:1001*(2*a+2)}];var L=!1;if(("sendrecv"===g||"sendonly"===g)&&(L=!_.rtpReceiver,E=_.rtpReceiver||new e.RTCRtpReceiver(_.dtlsTransport,f),L)){var M;I=E.track,y?(o[y.stream]||(o[y.stream]=new e.MediaStream,Object.defineProperty(o[y.stream],"id",{get:function(){return y.stream}})),Object.defineProperty(I,"id",{get:function(){return y.track}}),M=o[y.stream]):(o.default||(o.default=new e.MediaStream),M=o.default),M.addTrack(I),u.push([I,E,M])}_.localCapabilities=k,_.remoteCapabilities=O,_.rtpReceiver=E,_.rtcpParameters=D,_.sendEncodingParameters=w,_.recvEncodingParameters=R,r._transceive(r.transceivers[a],!1,L)}}),void 0===this._dtlsRole&&(this._dtlsRole="offer"===n.type?"active":"passive"),this.remoteDescription={type:n.type,sdp:n.sdp},n.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+n.type+'"')}return Object.keys(o).forEach(function(t){var n=o[t];if(n.getTracks().length){if(-1===r.remoteStreams.indexOf(n)){r.remoteStreams.push(n);var i=new Event("addstream");i.stream=n,e.setTimeout(function(){r.dispatchEvent(i),"function"==typeof r.onaddstream&&r.onaddstream(i)})}u.forEach(function(t){var i=t[0],o=t[1];if(n.id===t[2].id){var a=new Event("track");a.track=i,a.receiver=o,a.transceiver={receiver:o},a.streams=[n],e.setTimeout(function(){r.dispatchEvent(a),"function"==typeof r.ontrack&&r.ontrack(a)})}})}}),e.setTimeout(function(){r&&r.transceivers&&r.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),new Promise(function(e){i.length>1&&"function"==typeof i[1]&&i[1].apply(null),e()})},n.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},n.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),"function"==typeof this.onsignalingstatechange&&this.onsignalingstatechange(t)},n.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(!1!==t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t.dispatchEvent(e),"function"==typeof t.onnegotiationneeded&&t.onnegotiationneeded(e)}},0))},n.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connected>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this.dispatchEvent(n),"function"==typeof this.oniceconnectionstatechange&&this.oniceconnectionstatechange(n)}},n.prototype.createOffer=function(){var n,i=this,o=arguments;1===arguments.length&&"function"!=typeof arguments[0]?n=arguments[0]:3===arguments.length&&(n=arguments[2]);var a=this.transceivers.filter(function(e){return"audio"===e.kind}).length,s=this.transceivers.filter(function(e){return"video"===e.kind}).length;if(n){if(n.mandatory||n.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==n.offerToReceiveAudio&&(a=!0===n.offerToReceiveAudio?1:!1===n.offerToReceiveAudio?0:n.offerToReceiveAudio),void 0!==n.offerToReceiveVideo&&(s=!0===n.offerToReceiveVideo?1:!1===n.offerToReceiveVideo?0:n.offerToReceiveVideo)}for(this.transceivers.forEach(function(e){"audio"===e.kind?--a<0&&(e.wantReceive=!1):"video"===e.kind&&--s<0&&(e.wantReceive=!1)});a>0||s>0;)a>0&&(this._createTransceiver("audio"),a--),s>0&&(this._createTransceiver("video"),s--);var u=c.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach(function(n,r){var o=n.track,a=n.kind,s=c.generateIdentifier();n.mid=s,n.iceGatherer||(n.iceGatherer=i._createIceGatherer(r,i.usingBundle));var u=e.RTCRtpSender.getCapabilities(a);t<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var l=n.sendEncodingParameters||[{ssrc:1001*(2*r+1)}];o&&t>=15019&&"video"===a&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,a)),n.localCapabilities=u,n.sendEncodingParameters=l}),"max-compat"!==this._config.bundlePolicy&&(u+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",this.transceivers.forEach(function(e,t){u+=r(e,e.localCapabilities,"offer",e.stream,i._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===i.iceGatheringState||0!==t&&i.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,u+="a="+c.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))});var l=new e.RTCSessionDescription({type:"offer",sdp:u});return new Promise(function(e){if(o.length>0&&"function"==typeof o[0])return o[0].apply(null,[l]),void e();e(l)})},n.prototype.createAnswer=function(){var n=this,i=arguments,a=c.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.usingBundle&&(a+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var s=c.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach(function(e,i){if(!(i+1>s)){if(e.isDatachannel)return void(a+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n");if(e.stream){var c;"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var u=o(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=r(e,u,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var u=new e.RTCSessionDescription({type:"answer",sdp:a});return new Promise(function(e){if(i.length>0&&"function"==typeof i[0])return i[0].apply(null,[u]),void e();e(u)})},n.prototype.addIceCandidate=function(e){var t,n;if(e&&""!==e.candidate){if(void 0===e.sdpMLineIndex&&!e.sdpMid)throw new TypeError("sdpMLineIndex or sdpMid required");if(this.remoteDescription){var r=e.sdpMLineIndex;if(e.sdpMid)for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].mid===e.sdpMid){r=i;break}var o=this.transceivers[r];if(o){if(o.isDatachannel)return Promise.resolve();var a=Object.keys(e.candidate).length>0?c.parseCandidate(e.candidate):{};if("tcp"===a.protocol&&(0===a.port||9===a.port))return Promise.resolve();if(a.component&&1!==a.component)return Promise.resolve();if((0===r||r>0&&o.iceTransport!==this.transceivers[0].iceTransport)&&(s(o.iceTransport,a)||(t=new Error("Can not add ICE candidate"),t.name="OperationError")),!t){var u=e.candidate.trim();0===u.indexOf("a=")&&(u=u.substr(2)),n=c.splitSections(this.remoteDescription.sdp),n[r+1]+="a="+(a.type?u:"end-of-candidates")+"\r\n",this.remoteDescription.sdp=n.join("")}}else t=new Error("Can not add ICE candidate"),t.name="OperationError"}else t=new Error("Can not add ICE candidate without a remote description"),t.name="InvalidStateError"}else for(var l=0;l<this.transceivers.length&&(this.transceivers[l].isDatachannel||(this.transceivers[l].iceTransport.addRemoteCandidate({}),n=c.splitSections(this.remoteDescription.sdp),n[l+1]+="a=end-of-candidates\r\n",this.remoteDescription.sdp=n.join(""),!this.usingBundle));l++);var d=arguments;return new Promise(function(e,n){t?(d.length>2&&"function"==typeof d[2]&&d[2].apply(null,[t]),n(t)):(d.length>1&&"function"==typeof d[1]&&d[1].apply(null),e())})},n.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],n=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(r){var i=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=n(e[t]),i.set(t,e[t])})}),t&&t.apply(null,i),r(i)})})},n}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports=function(e){var t=e&&e.navigator,n=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(n(e))})}}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(10),o={shimOnTrack:function(e){"object"!==(void 0===e?"undefined":r(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}}),"object"===(void 0===e?"undefined":r(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"===(void 0===e?"undefined":r(e))&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=i.detectBrowser(e);if("object"===(void 0===e?"undefined":r(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,r){if(t.version<38&&n&&n.iceServers){for(var i=[],o=0;o<n.iceServers.length;o++){var a=n.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(n.iceServers[o])}n.iceServers=i}return new e.mozRTCPeerConnection(n,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var o=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},a={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return s.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=o(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=a[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:a[t.type]||t.type}))})}return e}).then(n,r)}}}};e.exports={shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:n(138)}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(10),o=i.log;e.exports=function(e){var t=i.detectBrowser(e),n=e&&e.navigator,a=e&&e.MediaStreamTrack,s=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,i,a){var c=function(e){if("object"!==(void 0===e?"undefined":r(e))||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i=e[n]="object"===r(e[n])?e[n]:{ideal:e[n]};if(void 0===i.min&&void 0===i.max&&void 0===i.exact||t.push(n),void 0!==i.exact&&("number"==typeof i.exact?i.min=i.max=i.exact:e[n]=i.exact,delete i.exact),void 0!==i.ideal){e.advanced=e.advanced||[];var o={};"number"==typeof i.ideal?o[n]={min:i.ideal,max:i.ideal}:o[n]=i.ideal,e.advanced.push(o),delete i.ideal,Object.keys(i).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(o("spec: "+JSON.stringify(e)),e.audio&&(e.audio=c(e.audio)),e.video&&(e.video=c(e.video)),o("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,i,function(e){a(s(e))})},u=function(e){return new Promise(function(t,n){c(e,t,n)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:u,addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var l=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return l().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(s(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var p=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},h=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":r(e))&&"object"===r(e.audio)&&(e=JSON.parse(JSON.stringify(e)),p(e.audio,"autoGainControl","mozAutoGainControl"),p(e.audio,"noiseSuppression","mozNoiseSuppression")),h(e)},a&&a.prototype.getSettings){var f=a.prototype.getSettings;a.prototype.getSettings=function(){var e=f.apply(this,arguments);return p(e,"mozAutoGainControl","autoGainControl"),p(e,"mozNoiseSuppression","noiseSuppression"),e}}if(a&&a.prototype.applyConstraints){var m=a.prototype.applyConstraints;a.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":r(e))&&(e=JSON.parse(JSON.stringify(e)),p(e,"autoGainControl","mozAutoGainControl"),p(e,"noiseSuppression","mozNoiseSuppression")),m.apply(this,[e])}}}n.getUserMedia=function(e,r,o){if(t.version<44)return c(e,r,o);i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(r,o)}}},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(10),o={shimLocalStreamsAPI:function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var n=new Event("addstream");n.stream=e.streams[0],this.dispatchEvent(n)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};var c=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=c,c=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=c,c=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=c}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(e.iceServers[o])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){var r=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection("sendonly"):"recvonly"===r.direction&&r.setDirection("inactive"):!0!==e.offerToReceiveAudio||r||n.addTransceiver("audio");var i=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||n.addTransceiver("video")}return t.apply(n,arguments)}}};e.exports={shimCallbacksAPI:o.shimCallbacksAPI,shimLocalStreamsAPI:o.shimLocalStreamsAPI,shimRemoteStreamsAPI:o.shimRemoteStreamsAPI,shimGetUserMedia:o.shimGetUserMedia,shimRTCIceServerUrls:o.shimRTCIceServerUrls,shimTrackEventTransceiver:o.shimTrackEventTransceiver,shimCreateOfferLegacy:o.shimCreateOfferLegacy}},function(e,t,n){"use strict";function r(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){r(n(e))};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(56),a=n(10);e.exports={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"===(void 0===e?"undefined":i(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2));var n=new t(e),r=o.parseCandidate(e.candidate),a=Object.assign(n,r);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a},r(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"===(void 0===e?"undefined":i(e))&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var n=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),o=new Map,s=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++s;return o.set(t,e),a.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){r(e),o.delete(e)};var c=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return c.get.apply(this)},set:function(e){return this.srcObject=o.get(e)||null,c.set.apply(this,[e])}});var u=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=o.get(arguments[1])||null),u.apply(this,arguments)}}}}},function(e,t,n){"use strict";(function(e){function r(e,t,r,i,o,a,s){var c=this;this.audioTransferActive=!0,this.videoTransferActive=!0,this.rtc=e,this.id=t,this.isP2P=a,this.remoteTracks=new Map,this.localTracks=new Map,this._addedStreams=new Set,this.localSSRCs=new Map,this.localUfrag=null,this.remoteUfrag=null,this.signalingLayer=r,this._peerVideoTypeChanged=this._peerVideoTypeChanged.bind(this),this.signalingLayer.on(C.b,this._peerVideoTypeChanged),this._peerMutedChanged=this._peerMutedChanged.bind(this),this.signalingLayer.on(C.a,this._peerMutedChanged),this.options=s,this.peerconnection=new f.a.RTCPeerConnectionType(i,o),this.updateLog=[],this.stats={},this.statsinterval=null,this.maxstats=0;var u=n(146).Interop;this.interop=new u;var l=n(150);this.simulcast=new l({numOfLayers:R,explodeRemoteSimulcast:!1}),this.sdpConsistency=new _.a(this.toString()),this.localSdpMunger=new p.a(this),this.eventEmitter=e.eventEmitter,this.rtxModifier=new y.a,this.trace=function(e,t){c.updateLog.push({time:new Date,type:e,value:t||""})},this.onicecandidate=null,this.peerconnection.onicecandidate=function(e){m.a.isTemasysPluginUsed()||c.trace("onicecandidate",JSON.stringify(e.candidate,null," ")),null!==c.onicecandidate&&c.onicecandidate(e)},this.peerconnection.onaddstream=function(e){return c._remoteStreamAdded(e.stream)},this.peerconnection.onremovestream=function(e){return c._remoteStreamRemoved(e.stream)},this.onsignalingstatechange=null,this.peerconnection.onsignalingstatechange=function(e){c.trace("onsignalingstatechange",c.signalingState),null!==c.onsignalingstatechange&&c.onsignalingstatechange(e)},this.oniceconnectionstatechange=null,this.peerconnection.oniceconnectionstatechange=function(e){c.trace("oniceconnectionstatechange",c.iceConnectionState),null!==c.oniceconnectionstatechange&&c.oniceconnectionstatechange(e)},this.onnegotiationneeded=null,this.peerconnection.onnegotiationneeded=function(e){c.trace("onnegotiationneeded"),null!==c.onnegotiationneeded&&c.onnegotiationneeded(e)},this.ondatachannel=null,this.peerconnection.ondatachannel=function(e){c.trace("ondatachannel",e),null!==c.ondatachannel&&c.ondatachannel(e)},!m.a.isFirefox()&&this.maxstats&&(this.statsinterval=window.setInterval(function(){c.peerconnection.getStats(function(e){for(var t=e.result(),n=new Date,r=0;r<t.length;++r)!function(e){t[e].names().forEach(function(r){var i=t[e].id+"-"+r,o=c.stats[i];o||(c.stats[i]=o={startTime:n,endTime:n,values:[],times:[]}),o.values.push(t[e].stat(r)),o.times.push(n.getTime()),o.values.length>c.maxstats&&(o.values.shift(),o.times.shift()),o.endTime=n})}(r)})},1e3)),w.info("Create new "+this)}function i(e){var t=new Map,n=new Map;if("object"!==(void 0===e?"undefined":E(e))||null===e||"string"!=typeof e.sdp)return w.warn("An empty description was passed as an argument."),t;var r=c.a.parse(e.sdp);if(!Array.isArray(r.media))return t;var i=!0,o=!1,a=void 0;try{for(var s,u=r.media[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(Array.isArray(l.ssrcs)){if(Array.isArray(l.ssrcGroups)){var d=!0,p=!1,h=void 0;try{for(var f,m=l.ssrcGroups[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var v=f.value;if(void 0!==v.semantics&&void 0!==v.ssrcs){var g=v.ssrcs.split(" ").map(function(e){return parseInt(e,10)}),y=g[0];v.ssrcs=g,n.has(y)||n.set(y,[]),n.get(y).push(v)}}}catch(e){p=!0,h=e}finally{try{!d&&m.return&&m.return()}finally{if(p)throw h}}}var b=!0,_=!1,S=void 0;try{for(var T,C=l.ssrcs[Symbol.iterator]();!(b=(T=C.next()).done);b=!0){var R=T.value;if("msid"===R.attribute){var k=R.value,I=t.get(k);I||(I={ssrcs:[],groups:[],msid:k},t.set(k,I));var P=R.id;if(I.ssrcs.push(P),n.has(P)){var A=n.get(P),O=!0,D=!1,x=void 0;try{for(var N,L=A[Symbol.iterator]();!(O=(N=L.next()).done);O=!0){var M=N.value;I.groups.push(M)}}catch(e){D=!0,x=e}finally{try{!O&&L.return&&L.return()}finally{if(D)throw x}}}}}}catch(e){_=!0,S=e}finally{try{!b&&C.return&&C.return()}finally{if(_)throw S}}}}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return t}function o(e){return e&&e.groups&&e.groups.length?e.groups[0].ssrcs[0]:e&&e.ssrcs&&e.ssrcs.length?e.ssrcs[0]:null}t.a=r;var a=n(0),s=(n.n(a),n(13)),c=n.n(s),u=n(3),l=(n.n(u),n(142)),d=n(4),p=n(143),h=n(26),f=n(27),m=n(1),v=n(8),g=n.n(v),y=n(144),b=n(51),_=n(145),S=n(28),T=n(12),C=n(52),E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w=Object(a.getLogger)(e),R=3,k=["1","2","3"],I=function(e){return void 0===e||null===e?"":"type: "+e.type+"\r\n"+e.sdp};r.prototype.getConnectionState=function(){var e=this.peerconnection.iceConnectionState;return"completed"===e?"connected":e},r.prototype._getDesiredMediaDirection=function(e){var t=!0;return e===d.a?t=this.audioTransferActive:e===d.b&&(t=this.videoTransferActive),t?this.hasAnyTracksOfType(e)?"sendrecv":"recvonly":"inactive"},r.prototype.isSimulcastOn=function(){return!this.options.disableSimulcast&&m.a.supportsSimulcast()&&(!m.a.isFirefox()||this.options.enableFirefoxSimulcast)},r.prototype._peerVideoTypeChanged=function(e,t){if(!e)return void w.error("No endpointID on peerVideoTypeChanged "+this);var n=this.getRemoteTracks(e,d.b);n.length&&n[0]._setVideoType(t)},r.prototype._peerMutedChanged=function(e,t,n){if(!e)return void w.error("On peerMuteChanged - no endpoint ID");var r=this.getRemoteTracks(e,t);r.length&&r[0].setMute(n)},r.prototype.getLocalTracks=function(e){var t=Array.from(this.localTracks.values());return void 0!==e&&(t=t.filter(function(t){return t.getType()===e})),t},r.prototype.hasAnyTracksOfType=function(e){if(!e)throw new Error('"mediaType" is required');return this.getLocalTracks(e).length>0},r.prototype.getRemoteTracks=function(e,t){var n=[],r=e?[e]:this.remoteTracks.keys(),i=!0,o=!1,a=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,l=this.remoteTracks.get(u);if(l){var d=!0,p=!1,h=void 0;try{for(var f,m=l.keys()[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var v=f.value;if(!t||t===v){var g=l.get(v);g&&n.push(g)}}}catch(e){p=!0,h=e}finally{try{!d&&m.return&&m.return()}finally{if(p)throw h}}}}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}return n},r.prototype.getTrackBySSRC=function(e){if("number"!=typeof e)throw new Error("SSRC "+e+" is not a number");var t=!0,n=!1,r=void 0;try{for(var i,o=this.localTracks.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(this.getLocalSSRC(a)===e)return a}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}var s=!0,c=!1,u=void 0;try{for(var l,d=this.getRemoteTracks()[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var p=l.value;if(p.getSSRC()===e)return p}}catch(e){c=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(c)throw u}}return null},r.prototype._remoteStreamAdded=function(e){var t=this,n=h.a.getStreamID(e);if(!h.a.isUserStreamById(n))return void w.info(this+" ignored remote 'stream added' event for non-user streamid: "+n);(m.a.isChrome()||m.a.isNWJS()||m.a.isElectron()||m.a.isEdge())&&(e.onaddtrack=function(n){t._remoteTrackAdded(e,n.track)},e.onremovetrack=function(n){t._remoteTrackRemoved(e,n.track)});var r=e.getAudioTracks(),i=!0,o=!1,a=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;this._remoteTrackAdded(e,u)}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}var l=e.getVideoTracks(),d=!0,p=!1,f=void 0;try{for(var v,g=l[Symbol.iterator]();!(d=(v=g.next()).done);d=!0){var y=v.value;this._remoteTrackAdded(e,y)}}catch(e){p=!0,f=e}finally{try{!d&&g.return&&g.return()}finally{if(p)throw f}}},r.prototype._remoteTrackAdded=function(e,t){var n=h.a.getStreamID(e),r=t.kind;if(w.info(this+" remote track added:",n,r),!r)return void u.callErrorHandler(new Error("MediaType undefined for remote track, stream id: "+n));var i=new b.a(this.remoteDescription.sdp),o=i.media.filter(function(e){return e.startsWith("m="+r)});if(!o.length)return void u.callErrorHandler(new Error("No media lines for type "+r+" found in remote SDP for remote track: "+n));var a=T.a.findLines(o[0],"a=ssrc:");if(a=a.filter(function(e){var t=m.a.isTemasysPluginUsed()?"mslabel":"msid";return-1!==e.indexOf(t+":"+n)}),!a.length)return void u.callErrorHandler(new Error("No SSRC lines for streamId "+n+" for remote track, media type: "+r));var s=a[0].substring(7).split(" ")[0],c=Number(s),l=this.signalingLayer.getSSRCOwner(c);if(isNaN(c)||c<0)return void u.callErrorHandler(new Error("Invalid SSRC: "+s+" for remote track, msid: "+n+" media type: "+r));if(!l)return void u.callErrorHandler(new Error("No SSRC owner known for: "+c+" for remote track, msid: "+n+" media type: "+r));w.log(this+" associated ssrc",l,c);var d=this.signalingLayer.getPeerMediaInfo(l,r);if(!d)return void u.callErrorHandler(new Error(this+": no peer media info available for "+l));var p=d.muted,f=d.videoType;this._createRemoteTrack(l,e,t,r,f,c,p)},r.prototype._createRemoteTrack=function(e,t,n,r,i,o,a){var s=new l.a(this.rtc,this.rtc.conference,e,t,n,r,i,o,a,this.isP2P),c=this.remoteTracks.get(e);c||(c=new Map,this.remoteTracks.set(e,c)),c.has(r)&&w.error(this+" overwriting remote track! "+s,e,r),c.set(r,s),this.eventEmitter.emit(g.a.REMOTE_TRACK_ADDED,s)},r.prototype._remoteStreamRemoved=function(e){if(!h.a.isUserStream(e)){var t=h.a.getStreamID(e);return void w.info("Ignored remote 'stream removed' event for non-user stream "+t)}var n=e.getVideoTracks(),r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;this._remoteTrackRemoved(e,c)}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}var u=e.getAudioTracks(),l=!0,d=!1,p=void 0;try{for(var f,m=u[Symbol.iterator]();!(l=(f=m.next()).done);l=!0){var v=f.value;this._remoteTrackRemoved(e,v)}}catch(e){d=!0,p=e}finally{try{!l&&m.return&&m.return()}finally{if(d)throw p}}},r.prototype._remoteTrackRemoved=function(e,t){var n=h.a.getStreamID(e),r=t&&h.a.getTrackID(t);return w.info(this+" - remote track removed: "+n+", "+r),n?r?void(this._removeRemoteTrackById(n,r)||w.warn(this+" Removed track not found for msid: "+n+",\n             track id: "+r)):void u.callErrorHandler(new Error(this+" remote track removal failed - no track ID")):void u.callErrorHandler(new Error(this+" remote track removal failed - no stream ID"))},r.prototype._getRemoteTrackById=function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=this.remoteTracks.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=!0,u=!1,l=void 0;try{for(var d,p=s.values()[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var h=d.value;if(h.getStreamId()==e&&h.getTrackId()==t)return h}}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}},r.prototype.removeRemoteTracks=function(e){var t=[],n=this.remoteTracks.get(e);if(n){var r=n.get(d.a),i=n.get(d.b);r&&t.push(r),i&&t.push(i),this.remoteTracks.delete(e)}return w.debug(this+" removed remote tracks for "+e+" count: "+t.length),t},r.prototype._removeRemoteTrack=function(e){e.dispose();var t=e.getParticipantId(),n=this.remoteTracks.get(t);n?n.delete(e.getType())||w.error("Failed to remove "+e+" - type mapping messed up ?"):w.error("removeRemoteTrack: no remote tracks map for "+t),this.eventEmitter.emit(g.a.REMOTE_TRACK_REMOVED,e)},r.prototype._removeRemoteTrackById=function(e,t){var n=this._getRemoteTrackById(e,t);return n&&this._removeRemoteTrack(n),n};var P=function(e){if("object"!==(void 0===e?"undefined":E(e))||null===e||"string"!=typeof e.sdp)return w.warn("An empty description was passed as an argument."),e;var t=n(13),r=t.parse(e.sdp);void 0!==r&&void 0!==r.media&&Array.isArray(r.media)&&r.media.forEach(function(e){var t=[],n=[];if(void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach(function(e){void 0!==e.semantics&&"FID"===e.semantics&&void 0!==e.ssrcs&&t.push(Number(e.ssrcs.split(" ")[0]))}),Array.isArray(e.ssrcs)){var r=void 0;for(r=0;r<e.ssrcs.length;r++)"object"===E(e.ssrcs[r])&&void 0!==e.ssrcs[r].id&&t.indexOf(e.ssrcs[r].id)>=0&&(n.push(e.ssrcs[r]),delete e.ssrcs[r]);for(r=0;r<e.ssrcs.length;r++)void 0!==e.ssrcs[r]&&n.push(e.ssrcs[r]);e.ssrcs=n}});var i=t.write(r);return new RTCSessionDescription({type:e.type,sdp:i})},A=function(e){if(e&&e.sdp){var t=new S.a(e.sdp),n=t.selectMedia("audio"),r=!1;n&&"sendrecv"!==n.direction&&(n.direction="sendrecv",r=!0);var i=t.selectMedia("video");i&&"sendrecv"!==i.direction&&(i.direction="sendrecv",r=!0),r&&(e.sdp=t.toRawSDP())}};r.prototype.getLocalSSRC=function(e){var t=this._getSSRC(e.rtcId);return t&&t.ssrcs[0]},r.prototype._injectSsrcGroupForUnifiedSimulcast=function(e){var t=c.a.parse(e.sdp),n=t.media.find(function(e){return"video"===e.type});if(n.simulcast_03){var r=[];if(n.ssrcs.forEach(function(e){"msid"===e.attribute&&r.push(e.id)}),n.ssrcGroups=n.ssrcGroups||[],n.ssrcGroups.find(function(e){return"SIM"===e.semantics}))return e;n.ssrcGroups.push({semantics:"SIM",ssrcs:r.join(" ")})}return e.sdp=c.a.write(t),e};var O={signalingState:function(){return this.peerconnection.signalingState},iceConnectionState:function(){return this.peerconnection.iceConnectionState},localDescription:function(){var e=this.peerconnection.localDescription;return this.trace("getLocalDescription::preTransform",I(e)),e&&m.a.usesUnifiedPlan()&&(e=this.interop.toPlanB(e),this.trace("getLocalDescription::postTransform (Plan B)",I(e)),e=this._injectSsrcGroupForUnifiedSimulcast(e),this.trace("getLocalDescription::postTransform (inject ssrc group)",I(e))),m.a.doesVideoMuteByStreamRemove()&&(this.localSdpMunger.maybeMungeLocalSdp(e),w.debug("getLocalDescription::postTransform (munge local SDP)",e)),A(e),e||{}},remoteDescription:function(){var e=this.peerconnection.remoteDescription;return this.trace("getRemoteDescription::preTransform",I(e)),m.a.usesUnifiedPlan()&&(e=this.interop.toPlanB(e),this.trace("getRemoteDescription::postTransform (Plan B)",I(e))),e||{}}};Object.keys(O).forEach(function(e){Object.defineProperty(r.prototype,e,{get:O[e]})}),r.prototype._getSSRC=function(e){return this.localSSRCs.get(e)},r.prototype.addTrack=function(e){var t=e.rtcId;if(w.info("add "+e+" to: "+this),this.localTracks.has(t))return void w.error(e+" is already in "+this);this.localTracks.set(t,e);var n=e.getOriginalStream();if(n?this._addStream(n):(!m.a.doesVideoMuteByStreamRemove()||e.isAudioTrack()||e.isVideoTrack()&&!e.isMuted())&&w.error(this+" no WebRTC stream for: "+e),m.a.doesVideoMuteByStreamRemove()&&e.isVideoTrack()&&e.isMuted()){var r=this.generateNewStreamSSRCInfo(e);this.sdpConsistency.setPrimarySsrc(r.ssrcs[0]);var i=r.groups.find(function(e){return"SIM"===e.semantics});i&&this.simulcast.setSsrcCache(i.ssrcs);var o=r.groups.filter(function(e){return"FID"===e.semantics});if(o){var a=new Map;o.forEach(function(e){var t=e.ssrcs[0],n=e.ssrcs[1];a.set(t,n)}),this.rtxModifier.setSsrcCache(a)}}},r.prototype.addTrackUnmute=function(e){if(!this._assertTrackBelongs("addTrackUnmute",e))return!1;w.info("Adding "+e+" as unmute to "+this);var t=e.getOriginalStream();return t?(this._addStream(t),!0):(w.error("Unable to add "+e+" as unmute to "+this+" - no WebRTC stream"),!1)},r.prototype._addStream=function(e){this.peerconnection.addStream(e),this._addedStreams.add(e)},r.prototype._removeStream=function(e){m.a.isFirefox()?this._handleFirefoxRemoveStream(e):this.peerconnection.removeStream(e),this._addedStreams.delete(e)},r.prototype._assertTrackBelongs=function(e,t){var n=this.localTracks.has(t.rtcId);return n||w.error(e+": "+t+" does not belong to "+this),n},r.prototype.isMediaStreamInPc=function(e){return this._addedStreams.has(e)},r.prototype.removeTrack=function(e){var t=e.getOriginalStream();this.trace("removeStream",e.rtcId,t?t.id:void 0),this._assertTrackBelongs("removeStream",e)&&(this.localTracks.delete(e.rtcId),this.localSSRCs.delete(e.rtcId),t&&(m.a.isFirefox()?this._handleFirefoxRemoveStream(t):this.peerconnection.removeStream(t)))},r.prototype.removeTrackMute=function(e){var t=e.getOriginalStream();return this.trace("removeStreamMute",e.rtcId,t?t.id:null),!!this._assertTrackBelongs("removeStreamMute",e)&&(t?(w.info("Removing "+e+" as mute from "+this),this._removeStream(t),!0):(w.error("removeStreamMute - no WebRTC stream for "+e),!1))},r.prototype._handleFirefoxRemoveStream=function(e){if(e){var t=null,n=null;if(e.getAudioTracks()&&e.getAudioTracks().length?n=e.getAudioTracks()[0]:e.getVideoTracks()&&e.getVideoTracks().length&&(n=e.getVideoTracks()[0]),!n)return void w.error("Cannot remove tracks: no tracks.");this.peerconnection.getSenders().some(function(e){return e.track===n&&(t=e,!0)}),t?this.peerconnection.removeTrack(t):w.log("Cannot remove tracks: no RTPSender.")}},r.prototype.createDataChannel=function(e,t){return this.trace("createDataChannel",e,t),this.peerconnection.createDataChannel(e,t)},r.prototype._ensureSimulcastGroupIsLast=function(e){var t=e.sdp,n=t.indexOf("m=video"),r=t.indexOf("a=ssrc-group:SIM",n),i=t.lastIndexOf("a=ssrc-group");if(-1!==r&&-1!==i&&i!==r){var o=t.indexOf("\r\n",r),a=t.substring(r,o+2);t=t.replace(a,""),i=t.lastIndexOf("a=ssrc-group");var s=t.indexOf("\r\n",i);t=t.slice(0,s)+"\r\n"+a.trim()+t.slice(s),e.sdp=t}},r.prototype._adjustLocalMediaDirection=function(e){var t=new S.a(e.sdp),n=!1,r=t.selectMedia("audio");if(r){var i=this._getDesiredMediaDirection(d.a);r.direction!==i&&(r.direction=i,w.info("Adjusted local audio direction to "+i),n=!0)}else w.warn('No "audio" media found int the local description');var o=t.selectMedia("video");if(o){var a=this._getDesiredMediaDirection(d.b);o.direction!==a&&(o.direction=a,w.info("Adjusted local video direction to "+a),n=!0)}else w.warn('No "video" media found in the local description');n&&(e.sdp=t.toRawSDP())},r.prototype.setLocalDescription=function(e,t,n){var r=this,i=e;if(this.trace("setLocalDescription::preTransform",I(i)),this.options.disableH264||this.options.preferH264){var o=c.a.parse(i.sdp),a=o.media.find(function(e){return"video"===e.type});this.options.disableH264?T.a.stripVideoCodec(a,"h264"):T.a.preferVideoCodec(a,"h264"),i.sdp=c.a.write(o),this.trace("setLocalDescription::postTransform (H264)",I(i))}this._adjustLocalMediaDirection(i),this._ensureSimulcastGroupIsLast(i),m.a.usesUnifiedPlan()&&(i=this.interop.toUnifiedPlan(i),this.trace("setLocalDescription::postTransform (Unified Plan)",I(i))),this.peerconnection.setLocalDescription(i,function(){r.trace("setLocalDescriptionOnSuccess");var e=T.a.getUfrag(i.sdp);e!==r.localUfrag&&(r.localUfrag=e,r.eventEmitter.emit(g.a.LOCAL_UFRAG_CHANGED,r,e)),t()},function(e){r.trace("setLocalDescriptionOnFailure",e),r.eventEmitter.emit(g.a.SET_LOCAL_DESCRIPTION_FAILED,e,r),n(e)})},r.prototype.setAudioTransferActive=function(e){w.debug(this+" audio transfer active: "+e);var t=this.audioTransferActive!==e;return this.audioTransferActive=e,t},r.prototype._insertUnifiedPlanSimulcastReceive=function(e){var t=c.a.parse(e.sdp),n=t.media.find(function(e){return"video"===e.type});return n.rids=[{id:"1",direction:"recv"},{id:"2",direction:"recv"},{id:"3",direction:"recv"}],n.simulcast_03={value:"recv rid="+k.join(";")},e.sdp=c.a.write(t),e},r.prototype.setRemoteDescription=function(e,t,n){var r=this;if(this.trace("setRemoteDescription::preTransform",I(e)),e=this.simulcast.mungeRemoteDescription(e),this.trace("setRemoteDescription::postTransform (simulcast)",I(e)),this.options.preferH264){var i=c.a.parse(e.sdp),o=i.media.find(function(e){return"video"===e.type});T.a.preferVideoCodec(o,"h264"),e.sdp=c.a.write(i)}m.a.usesUnifiedPlan()?(e.sdp=this.rtxModifier.stripRtx(e.sdp),this.trace("setRemoteDescription::postTransform (stripRtx)",I(e)),e=this.interop.toUnifiedPlan(e),this.trace("setRemoteDescription::postTransform (Plan A)",I(e)),this.isSimulcastOn()&&(e=this._insertUnifiedPlanSimulcastReceive(e),this.trace("setRemoteDescription::postTransform (sim receive)",I(e)))):e=P(e),this.peerconnection.setRemoteDescription(e,function(){r.trace("setRemoteDescriptionOnSuccess");var n=T.a.getUfrag(e.sdp);n!==r.remoteUfrag&&(r.remoteUfrag=n,r.eventEmitter.emit(g.a.REMOTE_UFRAG_CHANGED,r,n)),t()},function(e){r.trace("setRemoteDescriptionOnFailure",e),r.eventEmitter.emit(g.a.SET_REMOTE_DESCRIPTION_FAILED,e,r),n(e)})},r.prototype.setVideoTransferActive=function(e){w.debug(this+" video transfer active: "+e);var t=this.videoTransferActive!==e;return this.videoTransferActive=e,t},r.prototype.generateRecvonlySsrc=function(){var e=T.a.generateSsrc();w.info(this+" generated new recvonly SSRC: "+e),this.sdpConsistency.setPrimarySsrc(e)},r.prototype.clearRecvonlySsrc=function(){w.info("Clearing primary video SSRC!"),this.sdpConsistency.clearVideoSsrcCache()},r.prototype.close=function(){this.trace("stop"),this.signalingLayer.off(C.a,this._peerMutedChanged),this.signalingLayer.off(C.b,this._peerVideoTypeChanged);var e=!0,t=!1,n=void 0;try{for(var r,i=this.remoteTracks.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=!0,s=!1,c=void 0;try{for(var u,l=o.values()[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value;this._removeRemoteTrack(d)}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this.remoteTracks.clear(),this._addedStreams.clear(),this.rtc._removePeerConnection(this)||w.error("RTC._removePeerConnection returned false"),null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),w.info("Closing "+this+"..."),this.peerconnection.close()};var D=function(e,t){m.a.isChrome()&&e&&t&&e.media&&t.media&&e.media.length===t.media.length&&(t.media.forEach(function(n,r){T.a.findLine(e.media[r],"a=setup:actpass",e.session)&&(t.media[r]=n.replace(/a=setup:active/g,"a=setup:passive"))}),t.raw=t.session+t.media.join(""))};r.prototype.createAnswer=function(e,t,n){if(m.a.supportsRtpSender()&&this.isSimulcastOn()){var r=this.peerconnection.getSenders().find(function(e){return"video"===e.track.kind}),i={encodings:[{rid:"1",scaleResolutionDownBy:4},{rid:"2",scaleResolutionDownBy:2},{rid:"3"}]};r.setParameters(i)}this._createOfferOrAnswer(!1,e,t,n)},r.prototype.createOffer=function(e,t,n){this._createOfferOrAnswer(!0,e,t,n)},r.prototype._createOfferOrAnswer=function(e,t,n,r){var o=this,a=e?"Offer":"Answer";this.trace("create"+a,JSON.stringify(r,null," "));var s=function(r){try{if(o.trace("create"+a+"OnSuccess::preTransform",I(r)),m.a.usesUnifiedPlan()&&(r=o.interop.toPlanB(r),o.trace("create"+a+"OnSuccess::postTransform (Plan B)",I(r)),o.isSimulcastOn()&&(r=o._injectSsrcGroupForUnifiedSimulcast(r),o.trace("create"+a+"OnSuccess::postTransform(inject ssrc group)",I(r)))),m.a.isFirefox()||(o.hasAnyTracksOfType(d.b)||o.sdpConsistency.hasPrimarySsrcCached()||o.generateRecvonlySsrc(),r.sdp=o.sdpConsistency.makeVideoPrimarySsrcsConsistent(r.sdp),o.trace("create"+a+"OnSuccess::postTransform (make primary audio/video ssrcs consistent)",I(r))),o.isSimulcastOn()&&(r=o.simulcast.mungeLocalDescription(r),o.trace("create"+a+"OnSuccess::postTransform (simulcast)",I(r))),!o.options.disableRtx&&m.a.supportsRtx()&&(r.sdp=o.rtxModifier.modifyRtxSsrcs(r.sdp),o.trace("create"+a+"OnSuccess::postTransform (rtx modifier)",I(r))),!e){var s=new b.a(o.remoteDescription.sdp),c=new b.a(r.sdp);D(s,c),r.sdp=c.raw}var u=i(r);w.debug("Got local SSRCs MAP: ",u),o._processLocalSSRCsMap(u),t(r)}catch(e){o.trace("create"+a+"OnError",e),o.trace("create"+a+"OnError",I(r)),w.error("create"+a+"OnError",e,I(r)),n(e)}},c=function(t){o.trace("create"+a+"OnFailure",t);var r=e?g.a.CREATE_OFFER_FAILED:g.a.CREATE_ANSWER_FAILED;o.eventEmitter.emit(r,t,o),n(t)};e?this.peerconnection.createOffer(s,c,r):this.peerconnection.createAnswer(s,c,r)},r.prototype._processLocalSSRCsMap=function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=this.localTracks.values()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value,c=s.getMSID();if(e.has(c)){var u=e.get(c);if(!u)return void w.error("No SSRC found for: "+c+" in "+this);var l=this.localSSRCs.get(s.rtcId),d=o(u),p=o(l);d!==p?(null===p?w.info("Storing new local SSRC for "+s+" in "+this,u):w.error("Overwriting SSRC for "+s+" "+c+" in "+this+" with: ",u),this.localSSRCs.set(s.rtcId,u)):w.debug("The local SSRC("+d+") for "+s+" "+c+"is still up to date in "+this)}else w.warn("No local track matched with: "+c+" in "+this)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}},r.prototype.addIceCandidate=function(e,t,n){this.trace("addIceCandidate",JSON.stringify(e,null," ")),this.peerconnection.addIceCandidate(e,t,n)},r.prototype.getStats=function(e,t){m.a.isFirefox()||m.a.isTemasysPluginUsed()||m.a.isReactNative()?this.peerconnection.getStats(null,e,t||function(){}):this.peerconnection.getStats(e)},r.prototype.generateNewStreamSSRCInfo=function(e){var t=e.rtcId,n=this._getSSRC(t);if(n&&w.error("Will overwrite local SSRCs for track ID: "+t),this.isSimulcastOn()){n={ssrcs:[],groups:[]};for(var r=0;r<R;r++)n.ssrcs.push(T.a.generateSsrc());n.groups.push({ssrcs:n.ssrcs.slice(),semantics:"SIM"})}else n={ssrcs:[T.a.generateSsrc()],groups:[]};if(!this.options.disableRtx&&m.a.supportsRtx())for(var i=n.ssrcs.length,o=0;o<i;++o){var a=n.ssrcs[o],s=T.a.generateSsrc();n.ssrcs.push(s),n.groups.push({ssrcs:[a,s],semantics:"FID"})}return n.msid=e.storedMSID,this.localSSRCs.set(t,n),n},r.prototype.toString=function(){return"TPC["+this.id+",p2p:"+this.isP2P+"]"}}).call(t,"modules/RTC/TraceablePeerConnection.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(54),s=n(17),c=n(1),u=n(5),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=n(0).getLogger(e),p=n(8),h=!1,f=!1,m=function(e){function t(e,n,o,a,s,c,u,l,d,p){r(this,t);var h=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,a,s,function(){},c,u));if(h.rtc=e,"number"!=typeof l)throw new TypeError("SSRC "+l+" is not a number");return h.ssrc=l,h.ownerEndpointId=o,h.muted=d,h.isP2P=p,h.hasBeenMuted=d,h.rtc&&h.track&&h._bindMuteHandlers(),h}return o(t,e),l(t,[{key:"_bindMuteHandlers",value:function(){var e=this;this.track.addEventListener?(this.track.addEventListener("mute",function(){return e._onTrackMute()}),this.track.addEventListener("unmute",function(){return e._onTrackUnmute()})):this.track.attachEvent&&(this.track.attachEvent("onmute",function(){return e._onTrackMute()}),this.track.attachEvent("onunmute",function(){return e._onTrackUnmute()}))}},{key:"_onTrackMute",value:function(){d.debug('"onmute" event('+Date.now()+"): ",this.getParticipantId(),this.getType(),this.getSSRC()),this.rtc.eventEmitter.emit(p.REMOTE_TRACK_MUTE,this)}},{key:"_onTrackUnmute",value:function(){d.debug('"onunmute" event('+Date.now()+"): ",this.getParticipantId(),this.getType(),this.getSSRC()),this.rtc.eventEmitter.emit(p.REMOTE_TRACK_UNMUTE,this)}},{key:"setMute",value:function(e){this.muted!==e&&(e&&(this.hasBeenMuted=!0),this.stream&&(this.stream.muted=e),this.muted=e,this.emit(s.TRACK_MUTE_CHANGED,this))}},{key:"isMuted",value:function(){return this.muted}},{key:"getParticipantId",value:function(){return this.ownerEndpointId}},{key:"isLocal",value:function(){return!1}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"_setVideoType",value:function(e){this.videoType!==e&&(this.videoType=e,this.emit(s.TRACK_VIDEOTYPE_CHANGED,e))}},{key:"_playCallback",value:function(){var e=this.isVideoTrack()?"video":"audio",t=window.performance.now();console.log("(TIME) Render "+e+":\t",t),this.conference.getConnectionTimes()[e+".render"]=t;var n=window.connectionTimes["obtainPermissions.start"],r=window.connectionTimes["obtainPermissions.end"],i=isNaN(r)||isNaN(n)?0:r-n,o=t-(this.conference.getConnectionTimes()["session.initiate"]-this.conference.getConnectionTimes()["muc.joined"])-i;this.conference.getConnectionTimes()[e+".ttfm"]=o,console.log("(TIME) TTFM "+e+":\t",o);var a=e+".ttfm";this.hasBeenMuted&&(a+=".muted"),u.a.analytics.sendEvent(a,{value:o})}},{key:"_attachTTFMTracker",value:function(e){if(!(h&&this.isAudioTrack()||f&&this.isVideoTrack()))if(this.isAudioTrack()&&(h=!0),this.isVideoTrack()&&(f=!0),c.a.isTemasysPluginUsed()){var t=n(35);t.addEvent(e,"play",this._playCallback.bind(this))}else e.addEventListener("canplay",this._playCallback.bind(this))}},{key:"toString",value:function(){return"RemoteTrack["+this.ownerEndpointId+", "+this.getType()+", p2p: "+this.isP2P+"]"}}]),t}(a.a);t.a=m}).call(t,"modules/RTC/JitsiRemoteTrack.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(4)),a=n(28),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=Object(i.getLogger)(e),u=function(){function e(t){r(this,e),this.tpc=t}return s(e,[{key:"_addMutedLocalVideoTracksToSDP",value:function(e){var t=this.tpc.getLocalTracks(o.b);if(!t.length)return!1;1!==t.length&&c.error(this.tpc+" there is more than 1 video track ! Strange things may happen !",t);var n=e.selectMedia("video");if(!n)return c.error(this.tpc+' unable to hack local video track SDP- no "video" media'),!1;var r=!1,i=!0,a=!1,s=void 0;try{for(var u,l=t[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var d=u.value,p=d.isMuted(),h=d.getOriginalStream(),f=h&&this.tpc.isMediaStreamInPc(h),m=p||!f;if(c.debug(this.tpc+" "+d+" muted: "+p+", is in PeerConnection: "+f+" => should fake sdp ? : "+m),m){var v=this.tpc.isSimulcastOn()?this.tpc.simulcast.ssrcCache:[this.tpc.sdpConsistency.cachedPrimarySsrc];if(v.length){r=!0,n.direction="sendrecv";var g=v[0],y="injected-"+g,b=!0,_=!1,S=void 0;try{for(var T,C=v[Symbol.iterator]();!(b=(T=C.next()).done);b=!0){var E=T.value;n.removeSSRC(E),c.debug(this.tpc+" injecting video SSRC: "+E+" for "+d),n.addSSRCAttribute({id:E,attribute:"cname",value:y}),n.addSSRCAttribute({id:E,attribute:"msid",value:d.storedMSID})}}catch(e){_=!0,S=e}finally{try{!b&&C.return&&C.return()}finally{if(_)throw S}}if(v.length>1){var w={ssrcs:v.join(" "),semantics:"SIM"};n.findGroup(w.semantics,w.ssrcs)||(c.debug(this.tpc+" injecting SIM group for "+d,w),n.addSSRCGroup(w))}this.tpc.options.disableRtx||this.tpc.rtxModifier.modifyRtxSsrcs2(n)}else c.error("No SSRCs stored for: "+d+" in "+this.tpc)}}}catch(e){a=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw s}}return r}},{key:"maybeMungeLocalSdp",value:function(e){if(e&&e.sdp){var t=new a.a(e.sdp);this._addMutedLocalVideoTracksToSDP(t)&&(e.sdp=t.toRawSDP())}}}]),e}();t.a=u}).call(t,"modules/RTC/LocalSdpMunger.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){u.debug("Updating mline to associate "+n+"rtx ssrc with primary stream, "+t.id);var r=t.id,i=t.msid,o=t.cname,a=e.getRtxSSRC(r);if(a===n)return void u.debug(n+" was already associated with "+r);a&&(u.debug(r+" was previously associated with rtx"+a+", removing all references to it"),e.removeSSRC(a),u.debug("groups before filtering for "+a),u.debug(e.dumpSSRCGroups()),e.removeGroupsWithSSRC(a)),e.addSSRCAttribute({id:n,attribute:"cname",value:o}),e.addSSRCAttribute({id:n,attribute:"msid",value:i}),e.addSSRCGroup({semantics:"FID",ssrcs:r+" "+n})}var o=n(0),a=(n.n(o),n(28)),s=n(12),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=Object(o.getLogger)(e),l=function(){function e(){r(this,e),this.correspondingRtxSsrcs=new Map}return c(e,[{key:"clearSsrcCache",value:function(){this.correspondingRtxSsrcs.clear()}},{key:"setSsrcCache",value:function(e){u.debug("Setting ssrc cache to ",e),this.correspondingRtxSsrcs=e}},{key:"modifyRtxSsrcs",value:function(e){var t=new a.a(e),n=t.selectMedia("video");return n?this.modifyRtxSsrcs2(n)?t.toRawSDP():e:(u.error("No 'video' media found in the sdp: "+e),e)}},{key:"modifyRtxSsrcs2",value:function(e){if("recvonly"===e.direction)return u.debug("RtxModifier doing nothing, video m line is recvonly"),!1;if(e.getSSRCCount()<1)return u.debug("RtxModifier doing nothing, no video ssrcs present"),!1;u.debug("Current ssrc mapping: ",this.correspondingRtxSsrcs);var t=e.getPrimaryVideoSSRCs();u.debug("Parsed primary video ssrcs ",t," making sure all have rtx streams");var n=!0,r=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var l=a.value,d=e.getSSRCAttrValue(l,"msid"),p=e.getSSRCAttrValue(l,"cname"),h=this.correspondingRtxSsrcs.get(l);if(h)u.debug("Already have an associated rtx ssrc forvideo ssrc "+l+": "+h);else{u.debug("No previously associated rtx ssrc for video ssrc "+l);var f=e.getRtxSSRC(l);f?(u.debug("Rtx stream "+f+" already existed in the sdp as an rtx stream for "+l),h=f):(h=s.a.generateSsrc(),u.debug("Generated rtx ssrc "+h+" for ssrc "+l)),u.debug("Caching rtx ssrc "+h+" for video ssrc "+l),this.correspondingRtxSsrcs.set(l,h)}i(e,{id:l,cname:p,msid:d},h)}}catch(e){r=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(r)throw o}}return!0}},{key:"stripRtx",value:function(e){var t=new a.a(e),n=t.selectMedia("video");if(!n)return u.error("No 'video' media found in the sdp: "+e),e;if("recvonly"===n.direction)return u.debug("RtxModifier doing nothing, video m line is recvonly"),e;if(n.getSSRCCount()<1)return u.debug("RtxModifier doing nothing, no video ssrcs present"),e;if(!n.containsAnySSRCGroups())return u.debug("RtxModifier doing nothing, no video ssrcGroups present"),e;var r=n.findGroups("FID");n.removeGroupsBySemantics("FID");var i=!0,o=!1,s=void 0;try{for(var c,l=r[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var d=c.value,p=Object(a.c)(d);n.removeSSRC(p)}}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}return t.toRawSDP()}}]),e}();t.a=l}).call(t,"modules/xmpp/RtxModifier.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(28)),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=Object(i.getLogger)(e),c=function(){function e(t){r(this,e),this.clearVideoSsrcCache(),this.logPrefix=t}return a(e,[{key:"clearVideoSsrcCache",value:function(){this.cachedPrimarySsrc=null,this.injectRecvOnly=!1}},{key:"setPrimarySsrc",value:function(e){if("number"!=typeof e)throw new Error("Primary SSRC must be a number!");this.cachedPrimarySsrc=e}},{key:"hasPrimarySsrcCached",value:function(){return Boolean(this.cachedPrimarySsrc)}},{key:"makeVideoPrimarySsrcsConsistent",value:function(e){var t=new o.a(e),n=t.selectMedia("video");if(!n)return s.error(this.logPrefix+" no 'video' media found in the sdp: "+e),e;if("recvonly"===n.direction)this.cachedPrimarySsrc&&this.injectRecvOnly?n.addSSRCAttribute({id:this.cachedPrimarySsrc,attribute:"cname",value:"recvonly-"+this.cachedPrimarySsrc}):s.info(this.logPrefix+" no SSRC found for the recvonly videostream!");else{var r=n.getPrimaryVideoSsrc();if(!r)return s.info(this.logPrefix+" sdp-consistency couldn't parse new primary ssrc"),e;if(this.cachedPrimarySsrc){s.info(this.logPrefix+" sdp-consistency replacing new ssrc"+r+" with cached "+this.cachedPrimarySsrc),n.replaceSSRC(r,this.cachedPrimarySsrc);var i=!0,a=!1,c=void 0;try{for(var u,l=n.ssrcGroups[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var d=u.value;if("FID"===d.semantics){var p=Object(o.b)(d),h=Object(o.c)(d);p===r&&(d.ssrcs=this.cachedPrimarySsrc+" "+h)}}}catch(e){a=!0,c=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw c}}}else this.cachedPrimarySsrc=r,s.info(this.logPrefix+" sdp-consistency caching primary ssrc"+this.cachedPrimarySsrc);this.injectRecvOnly=!0}return t.toRawSDP()}}]),e}();t.a=c}).call(t,"modules/xmpp/SdpConsistency.js")},function(e,t,n){t.Interop=n(147)},function(e,t,n){"use strict";function r(){this.cache={mlB2UMap:{},mlU2BMap:{}}}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(148),a=n(149);e.exports=r,r.prototype.candidateToUnifiedPlan=function(e){var t=new RTCIceCandidate(e);return t.sdpMLineIndex=this.cache.mlB2UMap[t.sdpMLineIndex],t},r.prototype.candidateToPlanB=function(e){var t=new RTCIceCandidate(e);if(0===t.sdpMid.indexOf("audio"))t.sdpMid="audio";else{if(0!==t.sdpMid.indexOf("video"))throw new Error("candidate with "+t.sdpMid+" not allowed");t.sdpMid="video"}return t.sdpMLineIndex=this.cache.mlU2BMap[t.sdpMLineIndex],t},r.prototype.getFirstSendingIndexFromAnswer=function(e){if(!this.cache.answer)return null;var t=o.parse(this.cache.answer);if(t&&t.media&&Array.isArray(t.media))for(var n=0;n<t.media.length;n++)if(t.media[n].type==e&&(!t.media[n].direction||"sendrecv"===t.media[n].direction||"sendonly"===t.media[n].direction))return n;return null},r.prototype.toPlanB=function(e){var t=this;if("object"!==(void 0===e?"undefined":i(e))||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=o.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length<=3&&n.media.every(function(e){return-1!==["video","audio","data"].indexOf(e.mid)}))return console.warn("This description does not look like Unified Plan."),e;for(var r=e.sdp,a=!1,s=0;s<n.media.length;s++)n.media[s].rtp.forEach(function(e){if("NULL"===e.codec){a=!0;var n=o.parse(t.cache.offer);e.codec=n.media[s].rtp[0].codec}});a&&(r=o.write(n)),this.cache[e.type]=r;var c=n.media;n.media=[];var u={},l=[];c.forEach(function(e){if(("string"!=typeof e.rtcpMux||"rtcp-mux"!==e.rtcpMux)&&"inactive"!==e.direction)throw new Error("Cannot convert to Plan B because m-lines without the rtcp-mux attribute were found.");void 0!==u[e.type]&&"inactive"!==u[e.type].direction||(u[e.type]=e)}),c.forEach(function(e){if("application"===e.type)return n.media.push(e),void l.push(e.mid);"object"===i(e.sources)&&Object.keys(e.sources).forEach(function(t){"object"!==i(u[e.type].sources)&&(u[e.type].sources={}),u[e.type].sources[t]=e.sources[t],void 0!==e.msid&&(u[e.type].sources[t].msid=e.msid)}),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&(void 0!==u[e.type].ssrcGroups&&Array.isArray(u[e.type].ssrcGroups)||(u[e.type].ssrcGroups=[]),u[e.type].ssrcGroups=u[e.type].ssrcGroups.concat(e.ssrcGroups)),u[e.type]===e&&(e.mid=e.type,delete e.bundleOnly,delete e.msid,"inactive"!==e.direction&&l.push(e.type),n.media.push(e))}),n.groups.some(function(e){if("BUNDLE"===e.type)return e.mids=l.join(" "),!0}),n.msidSemantic={semantic:"WMS",token:"*"};var d=o.write(n);return new RTCSessionDescription({type:e.type,sdp:d})},r.prototype.toUnifiedPlan=function(e){var t=this;if("object"!==(void 0===e?"undefined":i(e))||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=o.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length>3||!n.media.every(function(e){return-1!==["video","audio","data"].indexOf(e.mid)}))return console.warn("This description does not look like Plan B."),e;var r=[];n.media.forEach(function(e){r.push(e.mid)});var s=!1;if(void 0!==n.groups&&Array.isArray(n.groups)&&(s=n.groups.every(function(e){return"BUNDLE"!==e.type||a.apply(e.mids.sort(),[r.sort()])})),!s)throw new Error("Cannot convert to Unified Plan because m-lines that are not bundled were found.");var c;void 0!==this.cache[e.type]&&(c=o.parse(this.cache[e.type]));var u={audio:{},video:{}},l={},d=0,p=0;if(n.media.forEach(function(n){if(("string"!=typeof n.rtcpMux||"rtcp-mux"!==n.rtcpMux)&&"inactive"!==n.direction)throw new Error("Cannot convert to Unified Plan because m-lines without the rtcp-mux attribute were found.");if("application"===n.type)return void(l[n.mid]=n);var r=n.sources,o=n.ssrcGroups,a=n.candidates,s=n.iceUfrag,h=n.icePwd,f=n.fingerprint,m=n.port;delete n.sources,delete n.ssrcGroups,delete n.candidates,delete n.iceUfrag,delete n.icePwd,delete n.fingerprint,delete n.port,delete n.mid;var v={};void 0!==o&&Array.isArray(o)&&o.forEach(function(e){"SIM"!==e.semantics&&void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&e.ssrcs.forEach(function(t){void 0===v[t]&&(v[t]=[]),v[t].push(e)})});var g={};"object"===(void 0===r?"undefined":i(r))&&Object.keys(r).forEach(function(o){var y;if("offer"===e.type&&!r[o].msid)return void(u[n.type][o]=r[o]);if(void 0!==v[o]&&Array.isArray(v[o])&&v[o].some(function(e){return e.ssrcs.some(function(e){if("object"===i(g[e]))return y=g[e],!0})}),"object"===(void 0===y?"undefined":i(y)))y.sources[o]=r[o],delete r[o].msid;else{if(y=Object.create(n),g[o]=y,void 0!==r[o].msid&&(y.msid=r[o].msid,delete r[o].msid),y.sources={},y.sources[o]=r[o],y.ssrcGroups=v[o],void 0!==c&&void 0!==c.media&&Array.isArray(c.media)&&c.media.forEach(function(e){"object"===i(e.sources)&&Object.keys(e.sources).forEach(function(t){t===o&&(y.mid=e.mid)})}),void 0===y.mid){if("answer"===e.type)throw new Error("An unmapped SSRC was found.");y.mid=[n.type,"-",o].join("")}y.candidates=a,y.iceUfrag=s,y.icePwd=h,y.fingerprint=f,y.port=m,l[y.mid]=y,t.cache.mlU2BMap[p]=d,void 0===t.cache.mlB2UMap[d]&&(t.cache.mlB2UMap[d]=p),p++}}),d++}),n.media=[],r=[],"answer"===e.type)for(var h=0;h<c.media.length;h++){var f=c.media[h];void 0===l[f.mid]&&(delete f.msid,delete f.sources,delete f.ssrcGroups,f.direction&&"sendrecv"!==f.direction?"sendonly"===f.direction&&(f.direction="inactive"):f.direction="recvonly"),n.media.push(f),"string"==typeof f.mid&&r.push(f.mid)}else void 0!==c&&void 0!==c.media&&Array.isArray(c.media)&&c.media.forEach(function(e){r.push(e.mid),void 0!==l[e.mid]?n.media.push(l[e.mid]):(delete e.msid,delete e.sources,delete e.ssrcGroups,e.direction&&"sendrecv"!==e.direction||(e.direction="recvonly"),e.direction&&"sendonly"!==e.direction||(e.direction="inactive"),n.media.push(e))}),Object.keys(l).forEach(function(e){-1===r.indexOf(e)&&(r.push(e),"recvonly"===l[e].direction?n.media.some(function(t){if(("sendrecv"===t.direction||"sendonly"===t.direction)&&t.type===l[e].type)return Object.keys(l[e].sources).forEach(function(n){t.sources[n]=l[e].sources[n]}),!0}):n.media.push(l[e]))});["audio","video"].forEach(function(e){if(n&&n.media&&Array.isArray(n.media)){var r=null;if(Object.keys(u[e]).length>0&&null===(r=t.getFirstSendingIndexFromAnswer(e)))for(var i=0;i<n.media.length;i++)if(n.media[i].type===e){r=i;break}if(r&&n.media.length>r){var o=n.media[r];Object.keys(u[e]).forEach(function(t){o.sources&&o.sources[t]&&console.warn("Replacing an existing SSRC."),o.sources||(o.sources={}),o.sources[t]=u[e][t]})}}}),n.groups.some(function(e){if("BUNDLE"===e.type)return e.mids=r.join(" "),!0}),n.msidSemantic={semantic:"WMS",token:"*"};var m=o.write(n);return this.cache[e.type]=m,new RTCSessionDescription({type:e.type,sdp:m})}},function(e,t,n){var r=n(13);t.write=function(e,t){return void 0!==e&&void 0!==e.media&&Array.isArray(e.media)&&e.media.forEach(function(e){void 0!==e.sources&&0!==Object.keys(e.sources).length&&(e.ssrcs=[],Object.keys(e.sources).forEach(function(t){var n=e.sources[t];Object.keys(n).forEach(function(r){e.ssrcs.push({id:t,attribute:r,value:n[r]})})}),delete e.sources),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach(function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.ssrcs=e.ssrcs.join(" "))})}),void 0!==e&&void 0!==e.groups&&Array.isArray(e.groups)&&e.groups.forEach(function(e){void 0!==e.mids&&Array.isArray(e.mids)&&(e.mids=e.mids.join(" "))}),r.write(e,t)},t.parse=function(e){var t=r.parse(e);return void 0!==t&&void 0!==t.media&&Array.isArray(t.media)&&t.media.forEach(function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.sources={},e.ssrcs.forEach(function(t){e.sources[t.id]||(e.sources[t.id]={}),e.sources[t.id][t.attribute]=t.value}),delete e.ssrcs),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach(function(e){"string"==typeof e.ssrcs&&(e.ssrcs=e.ssrcs.split(" "))})}),void 0!==t&&void 0!==t.groups&&Array.isArray(t.groups)&&t.groups.forEach(function(e){"string"==typeof e.mids&&(e.mids=e.mids.split(" "))}),t}},function(e,t){e.exports=function e(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var n=0,r=this.length;n<r;n++)if(this[n]instanceof Array&&t[n]instanceof Array){if(!e.apply(this[n],[t[n]]))return!1}else if(this[n]!=t[n])return!1;return!0}},function(e,t,n){function r(e,t,n){return e.ssrcs.filter(function(e){return e.id===t}).filter(function(e){return e.attribute===n}).map(function(e){return e.value})[0]}function i(e){this.options=e||{},this.options.numOfLayers||(this.options.numOfLayers=v),console.log("SdpSimulcast: using "+this.options.numOfLayers+" layers"),this.ssrcCache=[]}function o(){return Math.floor(4294967295*Math.random())+0}function a(e,t){null!=e&&Array.isArray(e.media)&&e.media.forEach(function(e){"video"===e.type&&t(e)})}function s(e){return e&&null!=e&&e.type&&""!=e.type&&e.sdp&&""!=e.sdp}function c(e){if(e&&Array.isArray(e.ssrcGroups))for(var t=f(e),n=[],r=e.ssrcGroups.length;r--;)if("SIM"===e.ssrcGroups[r].semantics){for(var i=e.ssrcGroups[r].ssrcs.split(" "),o=0;o<i.length;o++){var a=i[o];n.push(a);var s=t[a].msid.split(" ");t[a].msid=[s[0],"/",o," ",s[1],"/",o].join(""),t[a].cname=[t[a].cname,"/",o].join(""),e.ssrcGroups.forEach(function(e){if("SIM"!==e.semantics){var r=e.ssrcs.split(" ");-1!==r.indexOf(a)&&r.forEach(function(e){t[e].msid=t[a].msid,t[e].cname=t[a].cname,e!==a&&n.push(e)})}})}e.ssrcs=m(t,n),e.ssrcGroups.splice(r,1)}}function u(e){if(!e||!Array.isArray(e.ssrcGroups))return void console.info("Halt: There are no SSRC groups in the remote description.");var t=f(e);e.ssrcGroups.forEach(function(n){if("SIM"===n.semantics){console.info("Imploding SIM group: "+n.ssrcs),n.nuke=!0;for(var r=n.ssrcs.split(" "),i=1;i<r.length;i++){var o=r[i];delete t[o],e.ssrcGroups.forEach(function(e){if("SIM"!==e.semantics){var n=e.ssrcs.split(" ");-1!==n.indexOf(o)&&(n.forEach(function(e){delete t[e]}),e.nuke=!0)}})}}}),e.ssrcs=m(t);for(var n=e.ssrcGroups.length;n--;)e.ssrcGroups[n].nuke&&e.ssrcGroups.splice(n,1)}function l(e){if(e&&Array.isArray(e.invalid))for(var t=e.invalid.length;t--;)"x-google-flag:conference"==e.invalid[t].value&&e.invalid.splice(t,1)}function d(e){e&&(Array.isArray(e.invalid)||(e.invalid=[]),e.invalid.some(function(e){return"x-google-flag:conference"===e.value})||e.invalid.push({value:"x-google-flag:conference"}))}var p=n(13),h=n(151),f=h.parseSsrcs,m=h.writeSsrcs,v=3;i.prototype.clearSsrcCache=function(){this.ssrcCache=[]},i.prototype.setSsrcCache=function(e){this.ssrcCache=e},i.prototype._parseSimLayers=function(e){var t=e.ssrcGroups&&e.ssrcGroups.find(function(e){return"SIM"===e.semantics});return t?t.ssrcs.split(" ").map(function(e){return parseInt(e)}):[e.ssrcs[0].id]},i.prototype._buildNewToOldSsrcMap=function(e,t){for(var n={},r=0;r<e.length;++r){var i=e[r],o=t[r]||null;n[i]=o}return n},i.prototype._fillInSourceDataFromCache=function(e){console.log("SdpSimulcast restoring from cache: ",this.ssrcCache);var t=this._parseSimLayers(e);console.log("SdpSimulcast Parsed new sim ssrcs: ",t);var n=r(e,t[0],"msid"),i=r(e,t[0],"cname"),o=this._buildNewToOldSsrcMap(t,this.ssrcCache);console.log("SdpSimulcast built replacement map: ",o);var a=this.ssrcCache.filter(function(e){return-1===Object.values(o).indexOf(e)});return console.log("SdpSimulcast built ssrcs to add: ",a),e.ssrcs.forEach(function(e){o[e.id]&&(e.id=o[e.id])}),a.forEach(function(t){e.ssrcs.push({id:t,attribute:"msid",value:n}),e.ssrcs.push({id:t,attribute:"cname",value:i})}),e.ssrcGroups=e.ssrcGroups||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:this.ssrcCache.join(" ")}),e},i.prototype._generateSourceData=function(e,t){for(var n=r(e,t,"msid"),i=r(e,t,"cname"),a=[],s=0;s<this.options.numOfLayers-1;++s){var c=o();!function(e,t){e.ssrcs.push({id:t,attribute:"cname",value:i}),e.ssrcs.push({id:t,attribute:"msid",value:n})}(e,c),a.push(c)}return e.ssrcGroups=e.ssrcGroups||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:t+" "+a.join(" ")}),e},i.prototype._restoreSimulcast=function(e){var t,n=e.ssrcs&&e.ssrcs.map(function(e){return e.id}).filter(function(e,t,n){return n.indexOf(e)===t}).length||0,r=e.ssrcGroups&&e.ssrcGroups.length||0;if(0===n||n>2)return e;if(2==n&&0===r)return e;if(1===n)t=e.ssrcs[0].id;else{var i=e.ssrcGroups.filter(function(e){return"FID"===e.semantics})[0];if(!i)return e;t=parseInt(i.ssrcs.split(" ")[0])}return console.log("SdpSimulcast: current ssrc cache: ",this.ssrcCache),console.log("SdpSimulcast: parsed primary ssrc "+t),-1!==this.ssrcCache.indexOf(t)?(console.log("SdpSimulcast: Have seen primary ssrc before, filling in data from cache"),e=this._fillInSourceDataFromCache(e)):(console.log("SdpSimulcast: Have not seen primary ssrc before, generating source data"),e=this._generateSourceData(e,t)),this.ssrcCache=this._parseSimLayers(e),e},i.prototype.mungeRemoteDescription=function(e){if(!s(e))return e;var t=p.parse(e.sdp),n=this;return a(t,function(e){n.options.explodeRemoteSimulcast?c(e):u(e),n.ssrcCache.length<1?l(e):d(e)}),new RTCSessionDescription({type:e.type,sdp:p.write(t)})},i.prototype.mungeLocalDescription=function(e){if(!s(e))return e;var t=p.parse(e.sdp),n=this;return a(t,function(e){"recvonly"!=e.direction&&"inactive"!=e.direction&&n._restoreSimulcast(e)}),new RTCSessionDescription({type:e.type,sdp:p.write(t)})},e.exports=i},function(e,t){t.writeSsrcs=function(e,t){var n=[];if(void 0!==e&&0!==Object.keys(e).length){Array.isArray(t)||(t=[]);for(var r=0;r<t.length;r++){var i=t[r],o=e[i];Object.keys(o).forEach(function(e){n.push({id:i,attribute:e,value:o[e]})})}Object.keys(e).forEach(function(r){if(r=parseInt(r),!(t.indexOf(r)>=0)){var i=e[r];Object.keys(i).forEach(function(e){n.push({id:r,attribute:e,value:i[e]})})}})}return n},t.parseSsrcs=function(e){var t={};return void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&e.ssrcs.forEach(function(e){t[e.id]||(t[e.id]={}),t[e.id][e.attribute]=e.value}),t}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(6),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this._callback=n,this._eventFired=!1,t.statistics.addAudioLevelListener(this._audioLevel.bind(this)),t.on(i.TRACK_MUTE_CHANGED,this._trackMuteChanged.bind(this)),t.on(i.TRACK_ADDED,this._trackAdded.bind(this))}return o(e,[{key:"_audioLevel",value:function(e,t,n,r){r&&this.audioTrack&&!this._eventFired&&this.audioTrack.isMuted()&&n>.6&&(this._eventFired=!0,this._callback())}},{key:"_isLocalAudioTrack",value:function(e){return e.isAudioTrack()&&e.isLocal()}},{key:"_trackAdded",value:function(e){this._isLocalAudioTrack(e)&&(this.audioTrack=e)}},{key:"_trackMuteChanged",value:function(e){this._isLocalAudioTrack(e)&&e.isMuted()&&(this._eventFired=!1)}}]),e}();t.a=a},function(e,t,n){function r(){this.audioRecorder=new s,this.transcriptionService=new c,this.counter=null,this.startTime=null,this.transcription=null,this.callback=null,this.results=[],this.state=u,this.lineLength=0}function i(e,t){if(console.log("retrieved an answer from the transcription service. The answer has an array of length: "+t.wordArray.length),t.wordArray.length>0){var n=t.startTime.getUTCMilliseconds()-e.startTime.getUTCMilliseconds();n<0&&(n=0);var r="[";t.wordArray.forEach(function(e){e.begin+=n,e.end+=n,r+=e.word+","}),r+="]",console.log(r),t.wordArray.name=t.name}e.results.push(t.wordArray),e.counter--,console.log("current counter: "+e.counter),e.maybeMerge()}function o(e){for(var t=0;t<e.length;t++)0===e[t].length&&e.splice(t,1);return e.length>0}function a(e,t){if(0===e.length)e.push(t);else{if(e[e.length-1].begin<=t.begin)return void e.push(t);for(var n=0;n<e.length;n++)if(t.begin<e[n].begin)return void e.splice(n,0,t);e.push(t)}}var s=n(57),c=n(155),u="before";r.prototype.start=function(){if(this.state!==u)throw new Error("The transcription can only start when it's in the \""+u+'" state. It\'s currently in the "'+this.state+'" state');this.state="recording",this.audioRecorder.start(),this.startTime=new Date},r.prototype.stop=function(e){var t=this;if("recording"!==this.state)throw new Error('The transcription can only stop when it\'s in the "recording" state. It\'s currently in the "'+this.state+'" state');console.log("stopping recording and sending audio files"),this.audioRecorder.stop();var n=i.bind(null,this);this.audioRecorder.getRecordingResults().forEach(function(e){t.transcriptionService.send(e,n),t.counter++}),this.state="transcribing",this.callback=e},r.prototype.maybeMerge=function(){"transcribing"===this.state&&0===this.counter&&this.merge()},r.prototype.merge=function(){var e=this;console.log("starting merge process!\n The length of the array: "+this.results.length),this.transcription="";var t=this.results,n=[];for(o(t),t.forEach(function(e){return a(n,e)});o(t);)!function(){var n=t[0];t.forEach(function(e){e[0].begin<n[0].begin&&(n=e)});var r=n.shift();for(e.updateTranscription(r,n.name);n.length>0&&"break"!==function(){var i=!1,o=n[0].begin;if(t.forEach(function(e){e[0].begin<o&&(i=!0)}),i)return"break";r=n.shift(),e.updateTranscription(r,null)}(););}();this.state="finished",this.callback&&this.callback(this.transcription)},r.prototype.updateTranscription=function(e,t){void 0!==t&&null!==t&&(this.transcription+="\n"+t+":",this.lineLength=t.length+1),this.lineLength+e.word.length>80&&(this.transcription+="\n    ",this.lineLength=4),this.transcription+=" "+e.word,this.lineLength+=e.word.length+1},r.prototype.addTrack=function(e){this.audioRecorder.addTrack(e)},r.prototype.removeTrack=function(e){this.audioRecorder.removeTrack(e)},r.prototype.getTranscription=function(){if("finished"!==this.state)throw new Error('The transcription can only be retrieved when it\'s in the "finished" state. It\'s currently in the "'+this.state+'" state');return this.transcription},r.prototype.getState=function(){return this.state},r.prototype.reset=function(){this.state=u,this.counter=null,this.transcription=null,this.startTime=null,this.callback=null,this.results=[],this.lineLength=0},e.exports=r},function(e,t){var n=function(e,t,n,r){this.blob=e,this.name=t,this.startTime=n,this.wordArray=r};e.exports=n},function(e,t,n){function r(){var e="config does not contain an url to a Sphinx4 https server";if(void 0===config.sphinxURL)console.log(e);else{var t=config.sphinxURL;if(void 0!==t.includes&&t.includes("https://"))return t;console.log(e)}}var i=n(156),o=n(157),a=n(57),s=function(){this.url=r()};s.prototype=Object.create(i.prototype),s.constructor=s,s.prototype.sendRequest=function(e,t){console.log("sending an audio file  to "+this.url),console.log("the audio file being sent: "+e);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE&&200===n.status)t(n.responseText);else if(n.readyState===XMLHttpRequest.DONE)throw new Error("unable to accept response from sphinx server. status: "+n.status)},n.open("POST",this.url),n.setRequestHeader("Content-Type",a.determineCorrectFileType()),n.send(e),console.log("send "+e)},s.prototype.formatResponse=function(e){var t=JSON.parse(e).objects;t.shift();var n=[];return t.forEach(function(e){return e.filler||n.push(new o(e.word,e.start,e.end))}),n},s.prototype.verify=function(e){if(console.log("response from server:"+e.toString()),"string"!=typeof e)return!1;var t=void 0;try{t=JSON.parse(e)}catch(e){return console.log(e),!1}if(void 0===t.objects)return!1;var n=t.objects;return!(!n[0]||!n[0]["session-id"])},e.exports=s},function(e,t){var n=function(){throw new Error("TranscriptionService is abstract and cannot becreated")};n.prototype.send=function(e,t){var n=this;this.sendRequest(e.blob,function(r){n.verify(r)?e.wordArray=n.formatResponse(r):(console.log("the retrieved response from the server is not valid!"),e.wordArray=[]),t(e)})},n.prototype.sendRequest=function(e,t){throw new Error("TranscriptionService.sendRequest is abstract")},n.prototype.formatResponse=function(e){throw new Error("TranscriptionService.format is abstract")},n.prototype.verify=function(e){throw new Error("TranscriptionService.verify is abstract")},e.exports=n},function(e,t){var n=function(e,t,n){this.word=e,this.begin=t,this.end=n};n.prototype.getWord=function(){return this.word},n.prototype.getBeginTime=function(){return this.begin},n.prototype.getEndTime=function(){return this.end},e.exports=n},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(159)),a=n(36),s=n(7),c=n.n(s),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=Object(i.getLogger)(e),d=function(){function e(t){r(this,e),this.chatRoom=t,this.eventEmitter=t.eventEmitter,l.info("creating VideoSIPGW"),this.sessions={},this.sessionStateChangeListener=this.sessionStateChanged.bind(this),t.addPresenceListener("jibri-sip-status",this.handleJibriSIPStatus.bind(this)),t.addPresenceListener("jibri-sip-call-state",this.handleJibriSIPState.bind(this))}return u(e,[{key:"handleJibriSIPStatus",value:function(e){var t=e.attributes;if(t){l.log("Handle video sip gw status : ",t);var n=t.status;n===this.status||n!==a.STATUS_UNDEFINED&&n!==a.STATUS_AVAILABLE&&n!==a.STATUS_BUSY||(this.status=n,this.eventEmitter.emit(c.a.VIDEO_SIP_GW_AVAILABILITY_CHANGED,this.status))}}},{key:"handleJibriSIPState",value:function(e){var t=e.attributes;if(t){l.log("Handle video sip gw state : ",t);var n=t.state;if(n!==this.state)switch(n){case a.STATE_ON:case a.STATE_OFF:case a.STATE_PENDING:case a.STATE_RETRYING:case a.STATE_FAILED:var r=t.sipaddress;if(!r)return;var i=this.sessions[r];i?i.setState(n):l.warn("Video SIP GW session not found:",r)}}}},{key:"createVideoSIPGWSession",value:function(e,t){var n=new o.a(e,t,this.chatRoom);return n.addStateListener(this.sessionStateChangeListener),this.sessions[e]&&l.warn("There was already a Video SIP GW session for address",e),this.sessions[e]=n,n}},{key:"isVideoSIPGWAvailable",value:function(){return this.status===a.STATUS_AVAILABLE}},{key:"sessionStateChanged",value:function(e,t){if(t.newState===a.STATE_OFF||t.newState===a.STATE_FAILED){var n=this.sessions[e];if(!n)return void l.error("Missing Video SIP GW session with address:",e);n.removeStateListener(this.sessionStateChangeListener),delete this.sessions[e]}}}]),e}();t.a=d}).call(t,"modules/videosipgw/VideoSIPGW.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=(n.n(a),n(2)),c=(n.n(s),n(9)),u=n(36),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=Object(a.getLogger)(e),p=function(e){function t(e,n,o){r(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.sipAddress=e,a.displayName=n,a.chatRoom=o,a.state=void 0,a}return o(t,e),l(t,[{key:"stop",value:function(){if(this.state===u.STATE_OFF||this.state===u.STATE_FAILED)return void d.warn("Video SIP GW session already stopped or failed!");this._sendJibriIQ("stop")}},{key:"start",value:function(){if(this.state===u.STATE_ON||this.state===u.STATE_OFF||this.state===u.STATE_PENDING||this.state===u.STATE_RETRYING)return void d.warn("Video SIP GW session already started!");this._sendJibriIQ("start")}},{key:"setState",value:function(e){if(e!==this.state){var t=this.state;this.state=e,this.eventEmitter.emit(this.sipAddress,{name:"STATE_CHANGED",oldState:t,newState:this.state})}}},{key:"addStateListener",value:function(e){this.addListener("STATE_CHANGED",e)}},{key:"removeStateListener",value:function(e){this.removeListener("STATE_CHANGED",e)}},{key:"_sendJibriIQ",value:function(e){var t=this,n={xmlns:"http://jitsi.org/protocol/jibri",action:e,sipaddress:this.sipAddress};n.displayname=this.displayName;var r=Object(s.$iq)({to:this.chatRoom.focusMucJid,type:"set"}).c("jibri",n).up();d.log("Stop video SIP GW session",r.nodeTree),this.chatRoom.connection.sendIQ(r,function(e){d.log("Result",e);var n=$(e).find("jibri").attr("state");t.setState(n)},function(e){d.log("Failed to start video SIP GW session, error: ",e),t.setState(u.STATE_FAILED)})}}]),t}(c.a);t.a=p}).call(t,"modules/videosipgw/JitsiVideoSIPGWSession.js")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(6),o=n(161),a=n.n(o),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(){function e(t){r(this,e),this.stats={users:{},dominantSpeakerId:null};var n=t.myUserId();this.stats.users[n]=new a.a(n,null,!0),t.addEventListener(i.DOMINANT_SPEAKER_CHANGED,this._onDominantSpeaker.bind(this)),t.addEventListener(i.USER_JOINED,this._onUserJoin.bind(this)),t.addEventListener(i.USER_LEFT,this._onUserLeave.bind(this)),t.addEventListener(i.DISPLAY_NAME_CHANGED,this._onDisplayNameChange.bind(this))}return s(e,[{key:"_onDominantSpeaker",value:function(e){var t=this.stats.users[this.stats.dominantSpeakerId],n=this.stats.users[e];t&&t.setIsDominantSpeaker(!1),n&&n.setIsDominantSpeaker(!0),this.stats.dominantSpeakerId=e}},{key:"_onUserJoin",value:function(e,t){var n=this.stats.users[e];n||(n=this.stats.users[e]=new a.a(e,t.getDisplayName()))}},{key:"_onUserLeave",value:function(e){var t=this.stats.users[e];t&&t.markAsHasLeft()}},{key:"_onDisplayNameChange",value:function(e,t){var n=this.stats.users[e];n&&n.setDisplayName(t)}},{key:"getStats",value:function(){return this.stats.users}}]),e}();t.a=c},function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,r,i){n(this,e),this._userId=t,this.setDisplayName(r),this._isLocalStats=i||!1,this.setIsDominantSpeaker(!1),this.totalDominantSpeakerTime=0,this._dominantSpeakerStart=null,this._hasLeft=!1}return r(e,[{key:"getUserId",value:function(){return this._userId}},{key:"getDisplayName",value:function(){return this.displayName}},{key:"setDisplayName",value:function(e){this.displayName=e}},{key:"isLocalStats",value:function(){return this._isLocalStats}},{key:"isDominantSpeaker",value:function(){return this._isDominantSpeaker}},{key:"setIsDominantSpeaker",value:function(e){if(!this._isDominantSpeaker&&e)this._dominantSpeakerStart=Date.now();else if(this._isDominantSpeaker&&!e){var t=Date.now(),n=t-(this._dominantSpeakerStart||0);this.totalDominantSpeakerTime+=n,this._dominantSpeakerStart=null}this._isDominantSpeaker=e}},{key:"getTotalDominantSpeakerTime",value:function(){var e=this.totalDominantSpeakerTime;return this._isDominantSpeaker&&(e+=Date.now()-this._dominantSpeakerStart),e}},{key:"hasLeft",value:function(){return this._hasLeft}},{key:"markAsHasLeft",value:function(){this._hasLeft=!0,this.setIsDominantSpeaker(!1)}}]),e}();e.exports=i},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){var n=t.find(function(t){return"audiooutput"===t.kind&&t.deviceId===e});n&&h.a.sendActiveDeviceListEvent(u.a.getEventDataForActiveDevice(n))}var o=n(14),a=n.n(o),s=n(58),c=n(4),u=n(26),l=n(1),d=n(8),p=n.n(d),h=n(5),f=new a.a,m={enumerateDevices:function(e){u.a.enumerateDevices(e)},isDeviceListAvailable:function(){return u.a.isDeviceListAvailable()},isDeviceChangeAvailable:function(e){return u.a.isDeviceChangeAvailable(e)},isDevicePermissionGranted:function(e){var t=u.a.getDeviceAvailability();switch(e){case c.b:return!0===t.video;case c.a:return!0===t.audio;default:return!0===t.video&&!0===t.audio}},isMultipleAudioInputSupported:function(){return!l.a.isFirefox()},getAudioOutputDevice:function(){return u.a.getAudioOutputDevice()},setAudioOutputDevice:function(e){var t=u.a.getCurrentlyAvailableMediaDevices();return t&&t.length>0&&i(e,u.a.getCurrentlyAvailableMediaDevices()),u.a.setAudioOutputDevice(e)},addEventListener:function(e,t){f.addListener(e,t)},removeEventListener:function(e,t){f.removeListener(e,t)},emitEvent:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];f.emit.apply(f,[e].concat(r(n)))}};u.a.addListener(p.a.DEVICE_LIST_CHANGED,function(e){return f.emit(s.DEVICE_LIST_CHANGED,e)}),u.a.addListener(p.a.DEVICE_LIST_AVAILABLE,function(e){return i(m.getAudioOutputDevice(),e)}),t.a=m},function(e,t,n){"use strict";(function(e){var r=n(1),i=n(0).getLogger(e),o={getVideoElementName:function(){return r.a.isTemasysPluginUsed()?"object":"video"},findVideoElement:function(e){var t=o.getVideoElementName();if(!r.a.isTemasysPluginUsed())return $(e).find(t)[0];var n=$(e).find(" "+t+'>param[value="video"]');return n.length?(n.length>1&&i.warn("Container with more than one video elements: ",e),n.parent()[0]):void 0},isResizeEventSupported:function(){return!r.a.isTemasysPluginUsed()},setVolume:function(e,t){r.a.isIExplorer()||(e.volume=t)},setAutoPlay:function(e,t){r.a.isIExplorer()||(e.autoplay=t)}};t.a=o}).call(t,"modules/RTC/RTCUIHelper.js")}])});
//# sourceMappingURL=lib-jitsi-meet.min.map